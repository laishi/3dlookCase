var b4w="object"===typeof b4w?b4w:function(a){var p={};a.module=p;var d={};a.cleanup=function(a,c){var m=p[a];m&&(m.Rh=null);d[c||"__b4w_default"]=null};a.register=function(a,c){p[a]||(p[a]=c)};a.require=function(a,c){if(!p[a])throw Error('Module "'+a+'" not found');c=c||"__b4w_default";d[c]||(d[c]=function(a){return function(b){var c=p[b];if(!c)throw Error('Module "'+b+'" not found');c.Rh||(c.Rh={});c.Rh[a]||(c.Rh[a]={},c(c.Rh[a],d[a]));return c.Rh[a]}}(c));return d[c](a)};a.module_check=function(a){return p[a]?
!0:!1};a.get_namespace=function(a){for(var c in d)if(d[c]==a)return c;return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.kp&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function p(){var a=d,b=a.getDate(),b=10>b?"0"+String(b):String(b),e=a.getMonth()+1,e=10>e?"0"+String(e):String(e),t=String(a.getFullYear()),k=a.getHours(),k=10>k?"0"+String(k):String(k),n=a.getMinutes(),n=10>n?"0"+String(n):String(n),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return b+"."+e+"."+t+" "+k+":"+n+":"+a}var d=new Date(2015,10,26,18,58,4),b=[15,11];a.version=function(){return b};a.version_str=function(){for(var a="",d=0;d<b.length;d++)a=1==d?a+(10>b[d]?
"0"+b[d]:b[d]):a+b[d],d!=b.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return d};a.date_str=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.kp&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function d(){return b4w.module_check(a.oc.Vl)}function b(){for(var b=a.oc,d=null,k=document.getElementsByTagName("script"),n=0;n<k.length;n++){for(var g=k[n].src,m=0;m<b.Cu.length;m++)if(0<=g.indexOf(b.Cu[m])){d=g;break}if(null!==d)break}d||(c.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),d=document.location.href);b=d.indexOf("?");0<=b&&(d=d.substring(0,b));return d.substring(0,d.lastIndexOf("/")+1)}var c=p("__print"),
m=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.pA=m.qa(a.context);a.p={alpha_sort:!0,alpha_sort_threshold:.1,Zn:!1,jh:[5,7],Qd:1E4,console_verbose:!1,do_not_load_resources:!1,In:!1,Gt:1.5,JB:10,background_color:[0,0,0,0],gh:.01,canvas_resolution_factor:1,bl:3,allow_cors:!1,pp:!1,Il:!0,show_hud_debug_info:!1,yI:!0,Wi:!0,anaglyph_use:!1,Pk:!0,rc:!0,te:!0,ci:!0,pi:!0,Sl:!0,kh:!0,Zh:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,nx:!1,
hi:!0,Hk:!0,Pb:!0,dn:!0,water_dynamic:!0,shore_smoothing:!0,Xi:!0,zb:1024,Ai:512,Sw:!0,precision:"highp",quality:a.P_HIGH,Yn:!0,WD:!1,Xv:!1,cp:!1,bx:!1,ah:!1,dp:!1,dt:!1,qu:!1,Fo:!1,aK:!1,Tk:!1,allow_hidpi:!1,gyro_use:!1,Dt:!1,lq:!1,enable_selectable:!0,enable_outlining:!0,Ue:!0,Ru:128,Kp:!1,su:!1,ED:!1,eq:[0,0],fk:!1,zv:!0,$n:!1,url_params:null,sc:!0,nc:4,Ov:!1,Jv:!1,us:!1};a.gB=m.qa(a.p);a.Ag={tm:-1,Ht:!1,Ug:1};a.controls={TD:1/120};a.be={dir:"ASSETS=../../assets/",ND:15,Dq:!0,jq:!1,Yo:!1};a.tz=
m.qa(a.be);a.oc={shaders_dir:"",pF:"include/",YJ:"postprocessing/",Vl:"built_in_data",Cu:"b4w.min.js b4w.full.min.js b4w.simple.min.js b4w.whitespace.min.js src/b4w.js USER_DEFINED_MODULE".split(" "),Kv:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.n={enabled:!0,Qd:60,il:"",xo:!1,ping:!1,ml:!0};a.fE=m.qa(a.n);a.Ui={ym:1024,fm:384,jt:32,$A:128,ZA:256,ov:.25,mE:.5,lE:1};a.PE=m.qa(a.Ui);a.C={Nr:!0,Rm:!1,zs:!1,Vs:!1,tt:!1};a.oF=m.qa(a.C);a.Eb={outlining_overview_mode:!1,af:[1,.4,.05],
Mi:.2,Ni:3.8,Oi:1};a.$o={enabled:!1,QF:"MAIN_BLEND",PF:0,sF:"COLOR"};a.dB=m.qa(a.$o);a.pz=function(){var b=a.p,c=a.n,d=a.Ui;switch(b.quality){case a.P_ULTRA:b.Wi=!0;b.shore_smoothing=!0;b.te=!0;b.ci=!0;b.pi=!0;b.Sl=!0;b.Pk=!0;b.rc=!0;b.hi=!0;b.Hk=!0;b.Pb=!0;b.dn=!0;d.ym=2048;b.bl=3;b.Il=!0;b.In=!1;b.precision="highp";b.water_dynamic=!0;b.Xi=!0;b.antialiasing=!0;b.smaa=!1;b.Zh=!0;b.kh=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.Ue=!0;b.nc=16;c.Qd=120;break;case a.P_HIGH:b.Wi=!0;b.shore_smoothing=!0;
b.te=!0;b.ci=!0;b.pi=!0;b.Sl=!0;b.Pk=!0;b.rc=!0;b.hi=!0;b.Hk=!0;b.Pb=!0;b.dn=!0;d.ym=1024;b.bl=3;b.Il=!0;b.In=!1;b.precision="highp";b.water_dynamic=!0;b.Xi=!0;b.antialiasing=!0;b.smaa=!1;b.Zh=!0;b.kh=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.Ue=!0;b.nc=4;c.Qd=60;break;case a.P_LOW:b.Wi=!1,b.shore_smoothing=!1,b.te=!1,b.ci=!1,b.pi=!1,b.Sl=!1,b.Pk=!1,b.rc=!1,b.hi=!1,b.Hk=!1,b.Pb=!1,b.dn=!1,d.ym=512,b.bl=2,b.Il=!1,b.In=!0,b.precision="mediump",b.water_dynamic=!1,b.Xi=!1,b.antialiasing=!1,b.smaa=!1,
b.Zh=!1,b.kh=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.Ue=!1,b.nc=1,c.Qd=60}};a.set=function(b,d){switch(b){case "allow_cors":a.p.allow_cors=d;break;case "allow_hidpi":a.p.allow_hidpi=d;break;case "alpha":a.context.alpha=d;break;case "alpha_sort":a.p.alpha_sort=d;break;case "alpha_sort_threshold":a.p.alpha_sort_threshold=d;break;case "anaglyph_use":a.p.anaglyph_use=d;break;case "animation_framerate":a.Ag.tm=d;break;case "antialiasing":a.p.antialiasing=d;break;case "assets_dds_available":a.be.Yo=
d;break;case "assets_min50_available":a.be.jq=d;break;case "audio":a.C.Nr=d;break;case "background_color":a.p.background_color=d;break;case "built_in_module_name":a.oc.Vl=d;break;case "canvas_resolution_factor":a.p.canvas_resolution_factor=d;break;case "console_verbose":a.p.console_verbose=d;break;case "do_not_load_resources":a.p.do_not_load_resources=d;break;case "gyro_use":a.p.gyro_use=d;break;case "physics_enabled":a.n.enabled=d;break;case "physics_uranium_path":a.n.il=d;break;case "physics_calc_fps":a.n.xo=
d;break;case "physics_use_workers":a.n.ml=d;break;case "precision":a.p.precision=d;break;case "quality":a.p.quality=d;break;case "sfx_mix_mode":a.C.Rm=d;break;case "shaders_dir":a.oc.shaders_dir=d;break;case "show_hud_debug_info":a.p.show_hud_debug_info=d;break;case "smaa":a.p.smaa=d;break;case "smaa_search_texture_path":a.oc.smaa_search_texture_path=d;break;case "smaa_area_texture_path":a.oc.smaa_area_texture_path=d;break;case "wireframe_debug":a.p.wireframe_debug=d;break;case "enable_selectable":a.p.enable_selectable=
d;break;case "enable_outlining":a.p.enable_outlining=d;break;case "outlining_overview_mode":a.Eb.outlining_overview_mode=d;break;case "glow_materials":a.p.Ue=d;break;case "url_params":a.p.url_params=d;break;default:c.error("Unknown config property: "+b)}};a.get=function(b){switch(b){case "allow_cors":return a.p.allow_cors;case "allow_hidpi":return a.p.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.p.alpha_sort;case "alpha_sort_threshold":return a.p.alpha_sort_threshold;
case "anaglyph_use":return a.p.anaglyph_use;case "animation_framerate":return a.Ag.tm;case "antialiasing":return a.p.antialiasing;case "assets_dds_available":return a.be.Yo;case "assets_min50_available":return a.be.jq;case "audio":return a.C.Nr;case "background_color":return a.p.background_color;case "built_in_module_name":return a.oc.Vl;case "canvas_resolution_factor":return a.p.canvas_resolution_factor;case "console_verbose":return a.p.console_verbose;case "do_not_load_resources":return a.p.do_not_load_resources;
case "gyro_use":return a.p.gyro_use;case "physics_enabled":return a.n.enabled;case "physics_uranium_path":return a.n.il;case "physics_calc_fps":return a.n.xo;case "physics_use_workers":return a.n.ml;case "precision":return a.p.precision;case "quality":return a.p.quality;case "sfx_mix_mode":return a.C.Rm;case "shaders_dir":return a.oc.shaders_dir;case "show_hud_debug_info":return a.p.show_hud_debug_info;case "smaa":return a.p.smaa;case "smaa_search_texture_path":return a.oc.smaa_search_texture_path;
case "smaa_area_texture_path":return a.oc.smaa_area_texture_path;case "wireframe_debug":return a.p.wireframe_debug;case "enable_selectable":return a.p.enable_selectable;case "enable_outlining":return a.p.enable_outlining;case "outlining_overview_mode":return a.Eb.outlining_overview_mode;case "glow_materials":return a.p.Ue;case "url_params":return a.p.url_params;default:c.error("Unknown config property: "+b)}};a.reset=function(){a.context=m.qa(a.pA);a.p=m.qa(a.gB);a.be=m.qa(a.tz);a.n=m.qa(a.fE);a.Ui=
m.qa(a.PE);a.C=m.qa(a.oF);a.$o=m.qa(a.dB)};a.VC=d;a.eF=function(){var c=a.oc,t=a.n;d()||""!=c.shaders_dir||(c.shaders_dir=b()+"../shaders/");if(d())c.smaa_search_texture_path="smaa_search_texture.png",c.smaa_area_texture_path="smaa_area_texture.png";else if(""==c.smaa_search_texture_path||""==c.smaa_area_texture_path){var k=b()+c.Kv;c.smaa_search_texture_path=c.smaa_search_texture_path||k+"smaa_search_texture.png";c.smaa_area_texture_path=c.smaa_area_texture_path||k+"smaa_area_texture.png"}t.enabled&&
""==t.il&&(k=b()+c.Kv,t.il=k+"uranium.js")};a.get_std_assets_path=function(){return a.be.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,p){function d(a,l){var f=document.createElement("div"),h=f.style;h.position="absolute";h.backgroundColor="black";h.borderRadius="20px 20px 20px 0px";h.boxShadow="0px 0px 10px rgb(180, 180, 200)";h.opacity=1;h.padding="8px 12px";h.lineHeight="15px";h.visibility="hidden";h.fontSize="12px";var d=g.get_container();d.appendChild(f);var e=x.get_meta_tags(a);if(e)var q=e.title||a.name,v=e.description;else q=a.name,v="";var D=document.createElement("span"),G=D.style;D.innerHTML=
q;G.fontWeight="bold";G.fontSize="12px";G.lineHeight="15px";G.color="#fff";G.fontFamily="Arial";m(D);f.appendChild(D);if(v){var e=document.createElement("div"),k=e.style;k.position="absolute";k.bottom="0px";k.left="0px";k.backgroundColor="#000";k.borderRadius="20px 20px 20px 0px";k.boxShadow="0px 0px 10px rgb(180, 180, 200)";k.visibility="hidden";k.padding="8px 12px";k.overflow="hidden";k.lineHeight="15px";k.fontSize="12px";k.zIndex="2";f.appendChild(e);var q=document.createElement("span"),I=q.style;
q.innerHTML=v;I.fontSize="12px";I.fontFamily="Arial";I.fontWeight="bold";I.lineHeight="15px";I.color="#fff";I.visibility="hidden";e.appendChild(q);var r=!1,z=!1;d.addEventListener("mousedown",function(a){if(!(r||z||B))if(a.target!=D&&a.target!=f||"hidden"!=k.visibility||1!=h.opacity)"visible"==k.visibility&&(h.visibility="visible",G.visibility="visible",k.visibility="hidden",I.visibility="hidden");else{h.visibility="hidden";G.visibility="hidden";k.visibility="visible";r=z=!0;a=f.offsetWidth-24;var d=
f.offsetHeight-16,e=Math.min(l,b(v)),q=c(v,e);q==d&&(k.height=q+"px");e!=a?C.animate(a,e,200,function(a){a==e&&("visible"==k.visibility&&(I.visibility="visible"),r=!1);k.width=a+"px"}):r=!1;q!=d?C.animate(d,q,200,function(a){a==q&&("visible"==k.visibility&&(I.visibility="visible"),z=!1);k.height=a+"px"}):z=!1;z||r||(I.visibility="visible")}},!1)}return f}function b(a){var b=document.createElement("div"),l=document.createElement("span"),f=b.style;l.innerHTML=a;l.style.fontSize="12px";l.style.fontFamily=
"Arial";l.style.fontWeight="bold";l.style.color="#fff";l.style.visibility="hidden";f.lineHeight="15px";b.appendChild(l);f.position="absolute";f.visibility="hidden";f.fontSize="12px";f.display="inline-block";f.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function c(a,b){var l=document.createElement("div"),f=document.createElement("span"),c=l.style;f.innerHTML=a;f.style.fontSize="12px";f.style.fontFamily="Arial";f.style.fontWeight="bold";f.style.color=
"#fff";f.style.visibility="hidden";c.lineHeight="15px";l.appendChild(f);c.position="absolute";c.visibility="hidden";c.fontSize="12px";c.display="inline-block";c.width=b+"px";c.lineHeight="15px";document.body.appendChild(l);f=l.offsetHeight;document.body.removeChild(l);return f}function m(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";
a.style.cursor="default"}function e(){for(var a=0,b=0;b<q.length;b++)q[b].ai&&a++;z=new Float32Array(3*a)}function t(a,b){return b.depth-a.depth}var k=p("__batch"),n=p("__camera"),g=p("__container"),x=p("__objects"),l=p("__print"),h=p("__renderer"),v=p("__scenes"),C=p("__time"),A=p("__tsr");p("__util");p("__config");var B=!1,q=[],z=new Float32Array(0),u=new Uint8Array(16),r=new Float32Array(2),f=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<q.length;b++)if(q[b].obj==a){b=!0;break a}b=
!1}if(!b){b=a.anchor.ai&&Boolean(v.ia(v.oi(),"ANCHOR_VISIBILITY"));b={type:a.anchor.type,obj:a,x:0,y:0,depth:0,Th:"out",ai:b,element:null,Fi:null,Ty:a.anchor.OD,rs:0,nm:a.anchor.nm};switch(b.type){case "ANNOTATION":b.element=d(a,b.Ty);b.rs=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.anchor.nm),b.element||(l.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}q.push(b);e()}};a.remove=function(a){for(var b=0;b<q.length;b++){var l=q[b];if(l.obj==
a){"ANNOTATION"==l.type&&(a=l,g.get_container().removeChild(a.element));q.splice(b,1);e();break}}};a.update=function(){for(var a=0,b=q.length;b--;){var l=q[b];if(l.ai){var c=A.get_trans_view(l.obj.f.h);z.set(c,3*a++)}var h;h=l;var c=f,d=v.ni(v.oi());h=A.get_trans_view(h.obj.f.h);h=c=n.project_point(d,h,c);c=h[0];d=h[1];h=h[2];if(c!=l.x||d!=l.y||h!=l.depth){switch(l.type){case "ANNOTATION":var e=l.element;e.style.left=Math.floor(c)+"px";e.style.top=Math.floor(d-l.rs)+"px";break;case "ELEMENT":var e=
l.element,r=e.getBoundingClientRect();e.style.cssText+="left:"+Math.floor(c-r.width/2)+"px;top:"+Math.floor(d-r.height/2)+"px;"}l.x=c;l.y=d;l.depth=h;l.Fi&&l.Fi(c,d,l.Th,l.obj,e)}}q.sort(t);for(b=0;b<q.length;b++)l=q[b],"GENERIC"!=l.type&&(l.element.style.zIndex=b);0<a&&(a=v.ia(v.oi(),"ANCHOR_VISIBILITY").q[0].D,k.dG(a,z))};a.Rw=function(){for(var a=g.get_container(),b=q.length;b--;){var l=q[b],f=l.obj,c=l.x,d=l.y,e=l.depth,e=0>c||0>d||0>e||1<e||v.is_hidden(f)||c>=a.clientWidth||d>=a.clientHeight?
"out":"visible";if(l.ai&&"out"!=e){var e=l,k=v.ia(v.oi(),"ANCHOR_VISIBILITY").j,D=g.Bo(e.x,e.y,r,k);h.Fv(k.Od,D[0],k.height-D[1],2,2,u);e=1020==u[0]+u[4]+u[8]+u[12]?"visible":"out"==e.Th||0==u[0]+u[4]+u[8]+u[12]?"covered":e.Th}if(e!=l.Th){switch(l.type){case "ANNOTATION":case "ELEMENT":var G=l.element;if(!G)break;"out"==e?(G.style.visibility="hidden",G.children.length&&(G.children[0].style.visibility="hidden"),"ANNOTATION"==l.type&&1<G.children.length&&(k=G.children[1],k.style.visibility="hidden",
k.children.length&&(k.children[0].style.visibility="hidden"))):"visible"==e?(G.style.visibility="visible",G.children.length&&(G.children[0].style.visibility="visible"),G.style.opacity=1):(G.style.visibility="visible",G.style.opacity=.1,G.children.length&&(G.children[0].style.visibility="visible"),"ANNOTATION"==l.type&&1<G.children.length&&(k=G.children[1],k.style.visibility="hidden",k.children.length&&(k.children[0].style.visibility="hidden")))}l.Th=e;l.Fi&&l.Fi(c,d,l.Th,f,G)}}};a.attach_move_cb=
function(a,b){for(var l=0;l<q.length;l++)q[l].obj==a&&(q[l].Fi=b)};a.detach_move_cb=function(a){for(var b=0;b<q.length;b++)q[b].obj==a&&(q[b].Fi=null)};a.cleanup=function(){for(var a=0;a<q.length;a++){var b=q[a];"ANNOTATION"==b.type&&g.get_container().removeChild(b.element)}q.length=0};a.is_anchor=function(a){for(var b=0;b<q.length;b++)if(q[b].obj==a)return!0;return!1};a.get_element_id=function(a){for(var b=0;b<q.length;b++)if(q[b].obj==a)return q[b].nm;return!1};a.pause=function(){B=!0};a.resume=
function(){B=!1}};b4w.module.__armature=function(a,p){function d(a){a=a.f;for(var b=a.sn,l=a.Su,c=0;c<b.length;c++){for(var h=b[c],d=l[c],e=0;e<d.length;e+=2)for(var k=d[e],f=d[e+1],g=0;4>g;g++)h.Fc[k+g]=a.Fc[f+g],h.dd[k+g]=a.dd[f+g],h.Lc[k+g]=a.Lc[f+g],h.ld[k+g]=a.ld[f+g];h.Ad=a.Ad}}function b(a,l,c,h){var d=a.Br,e=a.hg,k=a.fl,r=a.xq;r?(r=r.fl,l?m.multiply(r,d,k):(l=g,m.invert(r,l),m.multiply(l,k,d))):l?m.copy(d,k):m.copy(k,d);d=n;m.invert(e,d);m.multiply(k,d,d);e=a.uf;c[4*e]=d[0];c[4*e+1]=d[1];c[4*e+2]=d[2];c[4*
e+3]=d[3];h[4*e]=d[4];h[4*e+1]=d[5];h[4*e+2]=d[6];h[4*e+3]=d[7];a=a.st;for(e=0;e<a.length;e++)k=a[e],k.Va||b(k,!0,c,h)}var c=p("__util"),m=p("__tsr"),e=p("__quat"),t=p("__mat4"),k=p("__vec3"),n=m.create(),g=m.create(),x=new Float32Array(4),l=new Float32Array(4),h=new Float32Array(4);a.Fh=function(a,b){for(var l=a.data.bones,h=a.pose.bones,d={},e=0;e<h.length;e++){var g=h[e],r=g.bone,f=r.name,E=d[f]={uf:0,cx:-1,xq:null,st:[],Xl:[],Va:null,el:m.create(),Br:m.create(),hg:m.create(),fl:m.create(),An:m.create(),
Cr:m.create(),Bn:!1,zw:new Float32Array(3)},f=new Float32Array(r.matrix_local),w=new Float32Array(16);t.invert(f,w);var g=new Float32Array(g.matrix_basis),x=E.zw;k.subtract(r.tail_local,r.head_local,x);c.XG(x,w,x);m.from_mat4(f,E.hg);m.from_mat4(g,E.An);m.copy(E.hg,E.fl)}for(e=0;e<l.length;e++){f=l[e].name;g=c.keysearch("name",f,h);E=d[f];r=g.parent_recursive;E.Xl.push(E);for(w=0;w<r.length;w++)g=r[w],g=g.name,g=d[g],E.Xl.push(g);r.length?(g=r[0],g=g.name,g=d[g],E.xq=g,m.invert(g.hg,n),m.multiply(n,
E.hg,E.el),g.st.push(E)):m.copy(E.hg,E.el);E.uf=e;E.name=f;m.multiply(E.el,E.An,E.Br)}b.f.td=d};a.get_bone_tsr=function(a,b,c,d,k){var z=a.f,u=z.Ad;b=z.td[b];var r=b.uf;a=b.hg;var f=z.Lc,E=z.ld,w=z.Fc,z=z.dd,t=f[4*r+1],O=f[4*r+2],K=f[4*r+3],F=E[4*r+1],Q=E[4*r+2],J=E[4*r+3];x[0]=(1-u)*f[4*r]+u*E[4*r];x[1]=(1-u)*t+u*F;x[2]=(1-u)*O+u*Q;x[3]=(1-u)*K+u*J;l[0]=w[4*r];l[1]=w[4*r+1];l[2]=w[4*r+2];l[3]=w[4*r+3];h[0]=z[4*r];h[1]=z[4*r+1];h[2]=z[4*r+2];h[3]=z[4*r+3];e.slerp(l,h,u,l);u=n;m.set_transcale(x,u);
m.set_quat(l,u);c?(c=g,m.translate(a,b.zw,c),m.multiply(u,c,u)):m.multiply(u,a,u);if(d){if(d=b.xq)c=g,m.invert(d.fl,c),m.multiply(c,u,u);d=g;m.invert(b.el,d);m.multiply(d,u,u)}m.copy(u,k)};a.set_bone_tsr=function(a,l,c,h){var e=a.f;l=e.td[l];var k=e.Lc,g=e.Fc;h?m.multiply(l.el,c,l.Br):m.copy(c,l.fl);b(l,h,k,g);e.Ad=0;d(a)};a.BG=d;a.kG=b;a.Kj=function(a,b){return b in a.f.td}};b4w.module.__boundings=function(a,p){function d(a,b){for(var c=a[0],d=a[1],e=a[2],k=a[0],q=a[1],g=a[2],u=3;u<a.length;u+=3)var r=a[u],f=a[u+1],E=a[u+2],c=Math.max(c,r),d=Math.max(d,f),e=Math.max(e,E),k=Math.min(k,r),q=Math.min(q,f),g=Math.min(g,E);b.max_x=c;b.max_y=d;b.max_z=e;b.min_x=k;b.min_y=q;b.min_z=g;return b}function b(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,e=a.max_z,k=a.min_x,q=a.min_y,g=a.min_z;b[0]=k;b[1]=q;b[2]=g;b[3]=c;b[4]=q;b[5]=g;b[6]=c;b[7]=d;b[8]=g;b[9]=k;b[10]=
d;b[11]=g;b[12]=k;b[13]=q;b[14]=e;b[15]=c;b[16]=q;b[17]=e;b[18]=c;b[19]=d;b[20]=e;b[21]=k;b[22]=d;b[23]=e;return b}function c(a,b,c){t.add(b,c,a.H);t.scale(a.H,.5,a.H);a.Ya=t.distance(a.H,b);return a}var m=p("__tsr"),e=p("__util"),t=p("__vec3"),k=new Float32Array(24),n=new Float32Array(3),g=new Float32Array(3),x=new Float32Array(3);a.bm=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.eI=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,
min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Id=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.yt=function(a,b){var c=a.max_y,d=a.max_z,e=a.min_x,k=a.min_y,q=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,e);a.min_y=Math.min(b.min_y,k);a.min_z=Math.min(b.min_z,q)};a.Bz=d;a.so=function(l,c,e){e||(e=a.Id());l=b(l,k);m.transform_vectors(l,c,l);return d(l,e)};a.AB=b;a.$J=function(b,c,d){d||
(d=a.Id());var e=c.min_x,k=c.max_x,g=c.min_y,q=c.max_y,z=c.min_z;c=c.max_z;if(e>=b.max_x||k<=b.min_x||g>=b.max_y||q<=b.min_y||z>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,e);d.max_x=Math.min(b.max_x,k);d.min_y=Math.max(b.min_y,g);d.max_y=Math.min(b.max_y,q);d.min_z=Math.max(b.min_z,z);d.max_z=Math.min(b.max_z,c);return d};a.dK=function(b,c,d){d||(d=a.Id());var e=b.max_x-b.min_x,k=b.max_y-b.min_y,g=b.max_z-b.min_z;d.min_x=
b.min_x-.5*(c-1)*e;d.max_x=b.max_x+.5*(c-1)*e;d.min_y=b.min_y-.5*(c-1)*k;d.max_y=b.max_y+.5*(c-1)*k;d.min_z=b.min_z-.5*(c-1)*g;d.max_z=b.max_z+.5*(c-1)*g;return d};a.vo=function(b,c,d){d||(d=a.sl());m.transform_vec3(b.H,c,d.H);d.Ya=b.Ya*m.get_scale(c);return d};a.uo=function(a,b,c){c||(c={ce:new Float32Array(3),de:new Float32Array(3),ee:new Float32Array(3),H:new Float32Array([0,0,0])});m.transform_vec3(a.H,b,c.H);t.copy(a.ce,c.ce);t.copy(a.de,c.de);t.copy(a.ee,c.ee);m.transform_dir_vec3(c.ce,b,c.ce);
m.transform_dir_vec3(c.de,b,c.de);m.transform_dir_vec3(c.ee,b,c.ee);return c};a.em=function(a,b){return{Ya:a,H:new Float32Array(b)}};a.sl=function(){return{H:new Float32Array([0,0,0]),Ya:0}};a.dm=function(a,b,c,d){return{ce:new Float32Array(a),de:new Float32Array(b),ee:new Float32Array(c),H:new Float32Array([d[0],d[1],d[2]])}};a.Cz=function(){return{H:new Float32Array([0,0,0]),Ya:1E12}};a.wB=function(a,b){var c=t.subtract(b.H,a.H,t.create());0==t.length(c)&&t.set(1,0,0,c);var d=t.normalize(c,t.create()),
c=t.scale(d,a.Ya,t.create());t.add(c,a.H,c);var e=t.scale(d,-a.Ya,t.create());t.add(e,a.H,e);var k=t.scale(d,b.Ya,t.create());t.add(k,b.H,k);var q=t.scale(d,-b.Ya,t.create());t.add(q,b.H,q);c=[c,e,k,q];d=t.normalize(d,t.create());e=c[0];k=c[0];for(q=1;q<c.length;q++){var g=t.dot(c[q],d);g<t.dot(e,d)&&(e=c[q]);g>t.dot(k,d)&&(k=c[q])}d=[e,k];c=d[0];d=d[1];a.H=t.scale(t.add(c,d,t.create()),.5,t.create());a.Ya=t.length(t.subtract(d,c,t.create()))/2};a.et=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,
c-d-2*a);return{Ya:a,height:e,H:new Float32Array([0,(c+d)/2,0])}};a.gt=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{Ya:a,height:e,H:new Float32Array([0,(c+d)/2,0])}};a.ft=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{Ya:a,height:e,H:new Float32Array([0,(c+d)/2,0])}};a.jI=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.vE=function(a){for(var b=0,c=0,d=0,e=0,k=0,q=0,g=0,u=0,r=0;r<
a.submeshes.length;r++){var f=a.submeshes[r];if(f.position.length){b=e=f.position[0];c=k=f.position[1];d=q=f.position[2];break}}for(r=0;r<a.submeshes.length;r++)for(var f=a.submeshes[r],f=f.position,E=0;E<f.length/3;E++)var w=f[3*E],t=f[3*E+1],n=f[3*E+2],b=Math.max(w,b),c=Math.max(t,c),d=Math.max(n,d),e=Math.min(w,e),k=Math.min(t,k),q=Math.min(n,q),g=Math.max(Math.sqrt(w*w+t*t+n*n),g),u=Math.max(Math.sqrt(w*w+n*n),u);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=e;a.b4w_bounding_box.max_y=c;
a.b4w_bounding_box.min_y=k;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=q;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=e;a.b4w_bounding_box_source.max_y=c;a.b4w_bounding_box_source.min_y=k;a.b4w_bounding_box_source.max_z=d;a.b4w_bounding_box_source.min_z=q;a.b4w_bounding_sphere_radius=g;a.b4w_bounding_cylinder_radius=u};a.uC=function(b){var d=b.subarray(0,3),k=b.subarray(6,9),m=b.subarray(12,15),A=b.subarray(18,21);b=t.subtract(k,d,n);t.normalize(b,b);var B=e.yC(d,k,m,
g),B=t.cross(B,b,B);t.normalize(B,B);var q=t.create(),z=t.create();t.subtract(k,d,x);z[0]=t.dot(x,b);z[1]=t.dot(x,B);k=t.create();t.subtract(m,d,x);k[0]=t.dot(x,b);k[1]=t.dot(x,B);m=t.create();t.subtract(A,d,x);m[0]=t.dot(x,b);m[1]=t.dot(x,B);A=a.sl();m=[q,z,k,m];q=c(A,m[0],m[1]);for(A=2;A<m.length;A++)if(t.distance(q.H,m[A])>q.Ya){for(var u=q,q=m,z=m[A],k=A-1,u=c(u,z,q[0]),r=1;r<=k;r++)if(t.distance(u.H,q[r])>u.Ya){for(var f=u,u=q,E=z,w=q[r],N=r-1,f=c(f,E,w),O=0;O<=N;O++)if(t.distance(f.H,u[O])>
f.Ya){var K=E,F=w,Q=u[O],J=t.subtract(F,Q,x),J=t.squaredLength(J),D=t.subtract(K,Q,x),G=t.squaredLength(D),D=t.subtract(K,F,x),M=t.squaredLength(D),D=J*(G+M-J),I=G*(M+J-G),J=M*(J+G-M),G=D+I+J;t.copy(K,f.H);t.scale(f.H,D/G,f.H);t.scaleAndAdd(f.H,F,I/G,f.H);t.scaleAndAdd(f.H,Q,J/G,f.H);f.Ya=t.distance(f.H,K)}u=f}q=u}A=q;b=t.scale(b,A.H[0],x);t.scaleAndAdd(b,B,A.H[1],b);t.add(b,d,A.H);return A}};b4w.module.__compat=function(a,p){function d(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function c(){return!window.ActiveXObject&&"ActiveXObject"in window}var m=p("__config"),e=p("__extensions"),t=p("__print");
p("__util");var k="R600;RV610;RV630;RV620;RV635;RV670;RS780;RS880;RV770;RV730;RV710;RV740;CEDAR;REDWOOD;JUNIPER;CYPRESS;PALM (Wrestler/Ontario);SUMO (Llano);SUMO2 (Llano);ARUBA (Trinity/Richland);BARTS;TURKS;CAICOS;CAYMAN".split(";"),n=m.Ag,g=m.p,x=m.context,l=m.Ui,h=m.C,v=m.n;a.kB=function(a){a.getError()==a.INVALID_ENUM&&t.warn("Possible Tegra invalid enum issue detected, ignoring")};a.YE=function(a){g.Ru=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);g.zb=a.getParameter(a.MAX_TEXTURE_SIZE);g.Ai=
a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);g.nc=g.sc?Math.min(g.nc,a.getParameter(a.MAX_SAMPLES)):1;var m=Boolean(e.pC());d("Firefox/28.0")&&(d("Linux")||d("Macintosh"))&&(t.warn("Firefox 28 detected, applying depth hack"),m=!1);d("Windows Phone")||(d("iPad")||d("iPhone")?(t.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, applying ios depth hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
x.alpha||(g.background_color[3]=1),g.bx=!0,g.smaa=!1,g.te=!1,g.precision="highp",g.qu=!0,g.su=!0):d("Mac OS X")&&d("Safari")&&!d("Chrome")&&(t.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures. Applying canvas alpha hack."),g.Ov=!0,h.zs=!0,h.Vs=!0));d("Windows")&&(d("Chrome/40")||d("Firefox/33")||d("Firefox/34")||d("Firefox/35")||d("Firefox/36"))&&(t.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),
g.Fo=!0);b()&&(t.warn("Mobile detected, applying various hacks for video textures."),g.ah=!0,d("iPad")||d("iPhone")||d("Windows Phone")||(t.warn("Mobile (not iOS) detected, disable playback rate for video textures."),h.tt=!0));(d("Firefox/35.0")||d("Firefox/36.0"))&&d("Windows")&&(t.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),g.Dt=!0);if(d("iPhone")||c()||d("Edge"))t.warn("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),g.Tk=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&
(t.warn("Not enough varyings, disable shadows on blend objects"),g.cp=!0);d("Windows Phone")&&(t.warn("Windows Phone detected. Disable wireframe mode, glow materials, ssao, smaa, shadows, reflections, refractions."),g.wireframe_debug=!1,g.precision="highp",g.Ue=!1,g.te=!1,g.smaa=!1,g.Wi=!1,g.Pk=!1,g.rc=!1,g.zv=!1);d("Firefox")&&g.ah&&(t.warn("Mobile Firefox detected, applying depth hack, disable workers."),m=v.ml=!1);var B=e.$t();if(B){var q=a.getParameter(B.UNMASKED_VENDOR_WEBGL),B=a.getParameter(B.UNMASKED_RENDERER_WEBGL),
z=/\b4\d{2}\b/;d("Macintosh")&&-1<B.indexOf("Intel HD Graphics 3000")&&(t.warn("OS X / Intel HD 3000 detected, applying depth hack"),m=!1);-1<q.indexOf("ARM")&&z.test(B)&&(t.warn("ARM Mali-400 series detected, applying depth and frames blending hacks"),m=!1,n.Ht=!0);-1<q.indexOf("ARM")&&-1<B.indexOf("Mali-T604")&&(t.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),g.precision="highp",g.Wi=!1);-1<q.indexOf("ARM")&&-1<B.indexOf("Mali-T760")&&(t.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),
g.precision="highp",g.te=!1,g.$n=!0);-1<q.indexOf("Qualcomm")&&-1<B.indexOf("Adreno")&&(t.warn("Qualcomm Adreno detected, applying shader constants hack."),g.Xv=!0,-1<B.indexOf("305")&&(t.warn('Qualcomm Adreno305 detected, set "highp" precision.'),g.precision="highp"),-1<B.indexOf("330")&&(t.warn('Qualcomm Adreno330 detected, set "highp" precision.'),g.precision="highp"));-1<q.indexOf("NVIDIA")&&-1<B.indexOf("Tegra 3")&&(t.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),
g.pp=!0);d("Windows")&&d("Chrome")&&!d("Edge")&&(B.match(/NVIDIA GeForce 8..0/)||B.match(/NVIDIA GeForce 9..0/))&&(t.warn("Chrome / Windows / NVIDIA GeForce 8000/9000 series detected, setting max cubemap size to 256, use canvas for resizing."),g.Ai=256,g.Jv=!0);q="";for(z=0;z<k.length;z++)if(-1<B.indexOf(k[z])){q=k[z];break}q&&(t.warn("Architecture "+q+" detected. Blending between frames and shadows on blend objects will be disabled. Applying clear depth hack."),g.us=!0,g.$n=!0,g.cp=!0)}0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&
(t.warn("Vertex textures are not allowed. Disabling vertex textures"),g.Yn=!1);m||(g.hi=!1,g.Hk=!1,g.Pb=!1,g.water_dynamic=!1,g.shore_smoothing=!1,g.Xi=!1,g.smaa=!1);g.Sw=Boolean(e.au());g.ak=m;0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(g.precision="mediump");c()&&(t.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),l.fm=512);if(c()&&d("Touch")||d("Edge"))t.warn("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),
g.Kp=!0;128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(t.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),g.pp=!0);d("Chrome")&&!d("Edge")&&(t.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),g.dt=!0);if(d("Chrome")&&!d("Edge")||d("Firefox"))g.dp=!0;if(c()||d("iPad"))t.warn("iPad or Internet Explorer detected. Applying alpha clip hack."),g.Zn=!0;b()&&d("Firefox")&&(t.log("Mobile firefox detected. Applying autoplay media hack."),
g.lq=!0);d("Edge")&&(t.warn("Microsoft Edge detected, set up new minimal texture size."),g.fk=!0)};a.fA=d;a.detect_mobile=b;a.nz=function(){d("Firefox/35.0")&&d("Windows")&&(t.warn("Windows/Firefox 35 detected, forcing context's alpha"),m.context.alpha=!0)};a.Tp=c};b4w.module.__constraints=function(a,p){function d(a){var b={};b.type=a;return b}function b(a,b){a.Va&&a.Va.T&&c(a.Va.T,a);if(b.T){var f=b.T;if(-1==f.Kd.indexOf(a))f.Kd.push(a);else throw"Descendant object override is forbidden";}a.Va=b}function c(a,b){var c=a.Kd.indexOf(b);if(-1!=c)a.Kd.splice(c,1);else throw"No descendant object";}function m(a,b,c){switch(b.type){case 1:var d=l.get_quat_view(a.f.h),D=b.T.f.h;c=l.get_quat_view(b.T.f.h);b.hc?(x.copy(b.hc,d),x.multiply(c,d,d)):x.copy(c,d);var e=l.transform_vec3(b.offset,
D,q);l.set_trans(e,a.f.h);e=l.get_scale(b.T.f.h);l.set_scale(b.Sk*e,a.f.h);break;case 9:e=l.get_trans_view(a.f.h);d=l.get_quat_view(a.f.h);D=b.T.f.h;c=l.get_quat_view(b.T.f.h);x.multiply(x.invert(b.th,b.th),d,d);x.multiply(c,d,d);l.transform_vec3(b.offset,D,e);x.copy(c,b.th);break;case 10:e=l.get_trans_view(a.f.h);d=l.get_quat_view(a.f.h);D=b.T.f.h;c=l.get_quat_view(b.T.f.h);x.multiply(x.invert(b.th,b.th),d,d);x.multiply(c,d,d);l.transform_vec3(b.offset,D,e);x.copy(c,b.th);e=l.get_quat_view(a.f.h);
d=l.get_quat_view(b.T.f.h);d=x.multiply(d,b.hc,f);d=n.Rt(d,A);e=n.Rt(e,B);n.rotate_eye_camera(a,h.vf(e[0],d[0]+b.jA,d[0]+b.iA),h.vf(e[1],d[1]+b.hA,d[1]+b.kA));break;case 13:var e=l.get_trans_view(a.f.h),d=l.get_quat_view(a.f.h),D=b.T.f.h,r=l.get_trans_view(D),I=b.uF,y=q,z=f;l.transform_vec3(b.offset,D,y);h.smooth_v(y,e,c,I,e);D=q;v.sub(r,e,D);v.normalize(D,D);var T=d,e=E,r=e.subarray(0,3),y=e.subarray(3,6),u=e.subarray(6,9);v.copy(D,y);v.negate(y,y);v.normalize(y,y);Boolean(.999999<Math.abs(v.dot(D,
h.AXIS_Y)))?(D=g.fromQuat(x.normalize(T,z),w),v.copy(D.subarray(0,3),r)):v.cross(h.AXIS_Y,y,r);v.normalize(r,r);v.cross(r,y,u);v.normalize(u,u);x.fromMat3(e,z);x.normalize(z,z);h.gw(z,d,c,.16*I,d);break;case 2:d=l.get_quat_view(a.f.h);c=N;C.get_bone_tsr(b.T,b.Eg,!0,!1,c);l.multiply(b.T.f.h,c,c);d[0]=c[4];d[1]=c[5];d[2]=c[6];d[3]=c[7];b.hc&&(x.copy(b.hc,d),x.multiply(d,b.hc,d));l.set_scale(b.Sk*c[3],a.f.h);e=l.get_trans_view(a.f.h);l.transform_vec3(b.offset,c,e);break;case 3:e=l.get_trans_view(a.f.h);
d=l.get_quat_view(a.f.h);c=l.get_trans_view(b.T.f.h);t(e,d,c);break;case 4:e=l.get_trans_view(a.f.h);d=l.get_quat_view(a.f.h);c=b.target;t(e,d,c);break;case 5:e=l.get_trans_view(a.f.h);d=l.get_quat_view(a.f.h);c=l.get_trans_view(b.T.f.h);t(e,d,c);d=v.dist(e,c);if(d=d>b.dist_max?d-b.dist_max:d<b.ck?d-b.ck:0)v.sub(c,e,q),v.normalize(q,q),v.scale(q,d,q),v.add(e,q,e);break;case 6:e=l.get_trans_view(a.f.h);d=l.get_quat_view(a.f.h);c=b.target;t(e,d,c);d=v.dist(e,c);if(d=d>b.dist_max?d-b.dist_max:d<b.ck?
d-b.ck:0)v.sub(c,e,q),v.normalize(q,q),v.scale(q,d,q),v.add(e,q,e);break;case 7:D=b.T.f.h;e=l.get_trans_view(a.f.h);l.transform_vec3(b.offset,D,e);break;case 8:r=l.get_trans_view(b.T.f.h);e=l.get_trans_view(a.f.h);v.add(r,b.offset,e);break;case 14:d=l.get_quat_view(a.f.h);D=b.T.f.h;c=l.get_quat_view(b.T.f.h);b.hc?(x.copy(b.hc,d),x.multiply(c,d,d)):x.copy(c,d);e=l.get_trans_view(a.f.h);l.transform_vec3(b.offset,D,e);break;case 11:l.multiply(b.T.f.h,b.Dn,a.f.h);break;case 12:e=b.Dn;c=N;C.get_bone_tsr(b.T,
b.Eg,!0,!1,c);l.multiply(b.T.f.h,c,c);l.multiply(c,e,a.f.h);break;case 15:d=b.T,c=n.sC(d),e=l.get_trans_view(a.f.h),I=n.vm(c,"TOP"),z=n.vm(c,"BOTTOM"),D=I-z,b.Gu?(r=n.vm(c,"LEFT"),e[0]=r+D*b.Zp):(r=n.vm(c,"RIGHT"),e[0]=r-D*b.Zp),e[2]=b.Ew?-(I-D*b.yr):-(z+D*b.yr),n.cD(c)?e[1]=-b.distance:(e[1]=-1,v.normalize(e,e),v.scale(e,b.distance/Math.abs(e[1]),e)),l.transform_dir_vec3(e,d.f.h,e),c=l.get_trans_view(d.f.h),v.add(c,e,e),e=l.get_quat_view(a.f.h),d=l.get_quat_view(d.f.h),b.hc?(x.copy(b.hc,e),x.multiply(d,
e,e)):x.copy(d,e)}"CAMERA"==a.f.type&&(e=h.AXIS_Y,10==b.type&&(c=l.get_quat_view(b.T.f.h),e=v.transformQuat(e,c,O)),n.Er(a),k(a,e))}function e(a,b){switch(b.type){case 1:var c=b.target.f.h,d=N;l.invert(a.f.h,d);l.multiply(d,c,d);C.set_bone_tsr(a,b.Eg,d,!1)}a.oq=!0}function t(a,b,c){var d=q;h.quat_to_dir(b,h.AXIS_MY,d);v.normalize(d,d);var f=z;v.subtract(c,a,f);v.normalize(f,f);a=h.Nv(d,f,r);x.multiply(a,b,b);x.normalize(b,b)}function k(a,b,c){var d=a.f,D=l.get_quat_view(d.h),e=h.quat_to_dir(D,h.AXIS_Y,
q);v.normalize(e,e);if(.999999<Math.abs(v.dot(b,e)))e=x.identity(f);else{var k=v.cross(b,e,z);v.normalize(k,k);d.Ia==n.MS_TARGET_CONTROLS?d.sr&&v.negate(k,k):(d=h.quat_to_dir(D,h.AXIS_Z,u),0<v.dot(d,b)&&v.negate(k,k));d=h.quat_to_dir(D,h.AXIS_X,u);v.normalize(d,d);var I=h.clamp(v.dot(d,k),-1,1),e=-.999999>=I?x.setAxisAngle(e,Math.acos(I),f):x.rotationTo(d,k,f);x.normalize(e,e)}x.multiply(e,D,D);c&&(c=h.quat_to_dir(D,h.AXIS_MZ,q),0>v.dot(b,c)&&x.rotateY(D,Math.PI,D));n.Er(a)}var n=p("__camera"),g=
p("__mat3"),x=p("__quat"),l=p("__tsr"),h=p("__util"),v=p("__vec3"),C=p("__armature");a.yH=1;a.xH=2;a.CH=3;a.DH=4;a.sH=5;a.tH=6;a.zH=7;a.rH=8;a.wH=9;a.vH=10;a.pH=11;a.qH=12;a.uH=13;a.AH=14;a.BH=15;a.oH=1;var A=new Float32Array(2),B=new Float32Array(2),q=new Float32Array(3),z=new Float32Array(3),u=new Float32Array(3),r=new Float32Array(4),f=new Float32Array(4),E=new Float32Array(9),w=new Float32Array(9),N=l.create(),O=new Float32Array(3);a.ss=function(a,c,f,e,D){var l=d(1);l.T=c;l.offset=new Float32Array(f);
l.hc=e?new Float32Array(e):null;l.Sk=D;b(a,l);m(a,l,0)};a.ez=function(a,c,f,e,l,h){var k=d(2);k.T=c;k.Eg=f;k.offset=new Float32Array(e);k.hc=l?new Float32Array(l):null;k.Sk=h;b(a,k);m(a,k,0)};a.dz=function(a,c,f,e){var D=d(9),h=l.get_quat_view(a.f.h),k=l.get_quat_view(c.f.h);D.T=c;D.offset=new Float32Array(f);D.th=new Float32Array(k);e&&(x.copy(e,h),x.multiply(k,h,h));b(a,D);m(a,D,0)};a.cz=function(a,c,f,e,D,k,q,I){var r=d(10),g=l.get_quat_view(a.f.h),T=l.get_quat_view(c.f.h);r.T=c;r.offset=new Float32Array(f);
r.th=new Float32Array(T);r.iA=h.angle_wrap_0_2pi(D);r.jA=h.angle_wrap_0_2pi(k);r.kA=h.angle_wrap_periodic(q,-Math.PI,Math.PI);r.hA=h.angle_wrap_periodic(I,-Math.PI,Math.PI);e?(r.hc=new Float32Array(e),x.copy(e,g),x.multiply(T,g,g)):r.hc=x.create();b(a,r);m(a,r,0)};a.bz=function(a,c,f,e){var l=d(13);l.T=c;l.offset=new Float32Array(f);l.uF=e;b(a,l);m(a,l,0)};a.hz=function(a,c,f,e){var l=d(14);l.T=c;l.offset=new Float32Array(f);l.Sk=1;l.hc=e?new Float32Array(e):null;b(a,l);m(a,l,0)};a.QJ=c;a.jz=function(a,
c){var f=d(3);f.T=c;b(a,f);m(a,f,0)};a.kz=function(a,c){var f=d(4);f.target=new Float32Array(c);b(a,f);m(a,f,0)};a.Yy=function(a,c,f,e){var l=d(5);l.T=c;l.ck=f;l.dist_max=e;b(a,l);m(a,l,0)};a.Zy=function(a,c,f,e){var l=d(6);l.target=new Float32Array(c);l.ck=f;l.dist_max=e;b(a,l);m(a,l,0)};a.gz=function(a,c,f){var l=d(7);l.T=c;l.offset=new Float32Array(f);b(a,l);m(a,l,0)};a.Xy=function(a,c,f){var l=d(8);l.T=c;l.offset=new Float32Array(f);b(a,l);m(a,l,0)};a.Vy=function(a,c,f){var l=d(11);l.T=c;l.Dn=
new Float32Array(f);b(a,l);m(a,l,0)};a.Wy=function(a,c,f,l){var e=d(12);e.T=c;e.Eg=f;e.Dn=new Float32Array(l);b(a,e);m(a,e,0)};a.append_stiff_viewport=function(a,c,f){var l=d(15);l.T=c;if("left"in f)l.Gu=!0,l.Zp=f.left;else if("right"in f)l.Gu=!1,l.Zp=f.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}if("top"in f)l.Ew=!0,l.yr=f.top;else if("bottom"in f)l.Ew=!1,l.yr=f.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in
f?(l.distance=f.distance,l.hc="rotation"in f?new Float32Array(f.rotation):null,b(a,l),m(a,l,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.qG=function(a,b){a.Va&&m(a,a.Va,b)};a.fz=function(a,b,c,f,l){var h=d(1);h.Eg=c;h.target=b;h.offset=new Float32Array(f);h.hc=l?new Float32Array(l):null;h.Sk=1;b=h.target;c=h.Eg;f=a.f.td[c];l=b.Lo;for(var k=0;k<l;k++){var I=l[k];if(I[0]==a&&I[1]==c){l.splice(k,1);break}}b.Lo.push([a,c]);f.Va=h;e(a,h)};a.jG=function(a,b){var c=a.f.td[b];c.Va&&
e(a,c.Va)};a.LE=t;a.correct_up=k;a.Zz=function(a){return a.Va?!0:!1};a.remove=function(a){a.Va.T&&c(a.Va.T,a);a.Va=null};a.dJ=function(a){return a.Va?a.Va.type:null};a.Cd=function(a){a=a.Va;return!a||11!=a.type&&12!=a.type?!1:!0};a.um=function(a){if((a=a.Va)&&11==a.type)return a.T.f.h;if(a&&12==a.type){var b=N;C.get_bone_tsr(a.T,a.Eg,!0,!1,b);l.multiply(a.T.f.h,b,b);return b}return null};a.Bd=function(a){a=a.Va;return!a||11!=a.type&&12!=a.type?null:a.Dn}};b4w.module.__container=function(a,p){var d,b,c,m,e;function t(a,c){d=a;b=c}function k(){var a=u.getBoundingClientRect();t(a.left,a.top)}function n(){return z.allow_hidpi&&2<=window.devicePixelRatio?!0:!1}var g=p("__anchors"),x=p("__config"),l=p("__data"),h=p("__hud");p("__objects");var v=p("__print"),C=p("__scenes"),A=p("__time"),B=p("__transform"),q=p("__util"),z=x.p,u=null,r=null,f=null,E=!1;m=c=0;e=1;d=b=0;var w=null;a.Sn=320;a.Rn=240;a.gd=function(a){w=a};a.get_canvas=function(){return u};a.get_canvas_hud=
function(){return r};a.get_container=function(){return f};a.init=function(a,b){a&&a.parentNode?(u=a,r=b,f=a.parentNode):q.O("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":f.insertBefore(a,f.firstElementChild);break;case "JUST_BEFORE_CANVAS":f.insertBefore(a,u);break;case "JUST_AFTER_CANVAS":u.nextElementSibling?f.insertBefore(a,u.nextElementSibling):f.appendChild(a,u);break;case "LAST":f.appendChild(a,u);break;default:v.error(b+" invalid stack order")}};
a.GC=function(){return c};a.FC=function(){return m};a.set_canvas_offsets=t;a.update_canvas_offsets=k;a.nF=function(a,b,f){c=a;m=b;e=f;k()};a.force_offsets_updating=function(){E=!0};a.client_to_canvas_coords=function(a,c,f){f||(f=new Float32Array(2));var l=f;E&&(k(),E=!1);l[0]=a-d;a=f;E&&(k(),E=!1);a[1]=c-b;return f};a.Bo=function(a,b,f,d){f||(f=new Float32Array(2));f[0]=a*e;f[1]=b*e;d&&(a=d.width/c,f[0]*=a,f[1]*=a);return f};a.bH=function(a,b,f,d){f||(f=new Float32Array(2));f[0]=a/e;f[1]=b/e;d&&(a=
d.width/c,f[0]/=a,f[1]/=a)};a.uu=function(b){return b&&b.parentNode?b.parentNode==f?!0:a.uu(b.parentNode):!1};a.ZC=n;a.HB=function(a){var b=document.getElementsByTagName("script");a=q.Ck(a);for(var c=0;c<b.length;c++)if(b[c].src==a)return b[c];return null};a.resize=function(b,c,d){if(!b||!c){b=a.Sn;c=a.Rn;var e=f;e.style.width=a.Sn+"px";e.style.height=a.Rn+"px"}var e=u,k=r;!1!==d&&(e.style.width=b+"px",e.style.height=c+"px",k&&(k.style.width=b+"px",k.style.height=c+"px"));k&&(k.width=b,k.height=c,
h.gl());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))z.canvas_resolution_factor=1;d=Math.floor(b*z.canvas_resolution_factor);c=Math.floor(c*z.canvas_resolution_factor);n()&&(d*=window.devicePixelRatio,c*=window.devicePixelRatio);l.is_primary_loaded()&&(k=C.get_active().k,d=Math.floor(d*k.Hc),c=Math.floor(c*k.Hc));e.width=d;e.height=c;if(d>w.drawingBufferWidth||c>w.drawingBufferHeight)v.warn("Canvas size exceeds platform limits, downscaling"),
k=Math.min(w.drawingBufferWidth/d,w.drawingBufferHeight/c),d*=k,c*=k,e.width=d,e.height=c;C.Wv(d,c,d/b);C.pa()&&B.o(C.get_active().vg);l.vG(e.width,e.height);l.is_primary_loaded()&&(g.update(),C.update(A.get_timeline(),0),g.Rw())}};b4w.module.__controls=function(a,p){function d(a){return{type:a,value:0,na:null,Md:!1,key:0,Ka:"",ge:!1,Io:null,Ho:function(){},Go:null,Xs:function(){},ef:null,from:new Float32Array(3),to:new Float32Array(3),tu:!1,Cm:!1,Ev:0,Dv:function(){},axis:"",kd:0,mj:new Float32Array(3),fn:new Float32Array(4),threshold:0,Av:new Float32Array(4),Ol:0,Nl:0,Mv:0,Pl:0,bd:0,repeat:!1,ho:!1,Bm:0,Am:0,zm:0,Fp:0,Ep:0,Dp:0}}function b(a,b){a.value=Number(b)}function c(a){for(var b=a.Vd,c=a.SE,f=0;f<b.length;f++)c[f]=
b[f].value;return a.DD(c)}function m(a){a=G.indexOf(a);-1<a?G.splice(a,1):E.error("Wrong object")}function e(a,b){for(var c=0,f=0;f<b.length;f++)for(var d=b[f].Yf,l=0;l<d.length;l++)for(var e=d[l].Vd,D=0;D<e.length;D++)e[D]===a&&c++;return c}function t(a,b){switch(a.type){case 80:w.remove_collision_test(a.Io,a.Ka,a.Ho);a.Md=!0;break;case 90:w.clear_collision_impulse_test(a.Go);a.Md=!0;break;case 100:w.remove_ray_test(a.Ev);a.Md=!0;break;case 130:a.Md=!0}var c=b.indexOf(a);-1<c&&b.splice(c,1)}function k(a){for(var c=
0;c<M.length;c++){var f=M[c];20==f.type&&a.keyCode==f.key&&b(f,1)}ga&&a.preventDefault();da&&da(a)}function n(a){for(var c=0;c<M.length;c++){var f=M[c];20==f.type&&0==a.keyCode&&16==f.key&&b(f,0);20==f.type&&a.keyCode==f.key&&b(f,0)}ga&&a.preventDefault();da&&da(a)}function g(a){var c=!1,d=null;ia=!0;R=a.clientX;ha=a.clientY;V=a.clientX;T=a.clientY;for(var l=0;l<M.length;l++){var e=M[l];50==e.type&&(b(e,1),e.na=a.which);160==e.type&&(c||(c=r.client_to_canvas_coords(a.clientX,a.clientY,ca),d=f.pick_object(c[0],
c[1]),c=!0),e.value=d==e.ef?1:0)}P&&a.preventDefault();ua&&ua(a)}function x(a){for(var c=0;c<M.length;c++){var f=M[c];50==f.type&&b(f,0);160==f.type&&f.ho&&(f.value=0)}ia=!1;P&&!na&&a.preventDefault();ua&&ua(a)}function l(a){var c=a.clientX,f=a.clientY;V=c;T=f;if(!D.Kp||ia)for(var d=c-R,l=f-ha,e=Math.sqrt(d*d+l*l),h=0;h<M.length;h++){var k=M[h];if(40===k.type)switch(k.axis){case "X":b(k,d);k.na=c;break;case "Y":b(k,l);k.na=f;break;case "XY":b(k,e),k.na[0]=c,k.na[1]=f}}P&&!na&&a.preventDefault();ua&&
ua(a)}function h(a){r.uu(a.relatedTarget)||x(a)}function v(a){var c=a.wheelDelta||-40*a.detail,c=c*J.TD;y+=c;for(c=0;c<M.length;c++){var f=M[c];30===f.type&&b(f,y)}va&&a.preventDefault();ea&&ea(a)}function C(a){var b=a.targetTouches;if(1==b.length){for(var c=b[0],b=c.clientX,c=c.clientY,d=!1,l=null,e=0;e<M.length;e++){var D=M[e];160==D.type&&(d||(d=r.client_to_canvas_coords(b,c,ca),l=f.pick_object(d[0],d[1]),d=!0),D.value=l==D.ef)}S[0]=b;S[1]=-1;X[0]=c;X[1]=-1}else 1<b.length&&(fa=ma=z(b),S[0]=b[0].clientX,
S[1]=b[1].clientX,X[0]=b[0].clientY,X[1]=b[1].clientY);aa.set(S);W.set(X);ra&&ra(a)}function A(c){var f=c.targetTouches;if(0!==f.length){if(1===f.length){aa[0]=f[0].clientX;aa[1]=-1;W[0]=f[0].clientY;W[1]=-1;var f=aa[0]-S[0],d=W[0]-X[0],l=Math.sqrt(f*f+d*d);if(-1!=S[1]&&-1!=X[1]){var e=aa[0]-S[1],D=W[0]-X[1],h=Math.sqrt(e*e+D*D);h<l&&(f=e,d=D,l=h)}for(h=0;h<M.length;h++){var k=M[h];if(60===k.type)switch(k.na=a.PL_SINGLE_TOUCH_MOVE,k.axis){case "X":b(k,f);break;case "Y":b(k,d);break;case "XY":b(k,
l)}}}else if(1<f.length){aa[0]=f[0].clientX;aa[1]=f[1].clientX;W[0]=f[0].clientY;W[1]=f[1].clientY;fa=z(f);l=fa-ma;e=ca;e[0]=(aa[0]+aa[1])/2;e[1]=(W[0]+W[1])/2;D=oa;D[0]=(S[0]+S[1])/2;D[1]=(X[0]+X[1])/2;var I,f=e[0],d=e[1],h=D[0],k=D[1];I=Math.sqrt((f-h)*(f-h)+(d-k)*(d-k));for(h=0;h<M.length;h++)if(k=M[h],70===k.type&&Math.abs(I)<Math.abs(l)&&(k.na=a.PL_MULTITOUCH_MOVE_ZOOM,b(k,l)),60===k.type&&Math.abs(I)>Math.abs(l))switch(k.na=a.PL_MULTITOUCH_MOVE_PAN,k.axis){case "X":f=e[0]-D[0];b(k,f);break;
case "Y":d=e[1]-D[1];b(k,d);break;case "XY":b(k,I)}}ja&&c.preventDefault();ra&&ra(c)}}function B(a){if(0==a.targetTouches.length)for(var c=0;c<M.length;c++){var f=M[c];160==f.type&&f.ho&&b(f,0)}ra&&ra(a)}function q(a){for(var c=0;c<M.length;c++){var f=M[c];if(170==f.type||180==f.type)f.Am=a.beta,f.Bm=a.gamma,f.zm=a.alpha,f.value||(f.Fp=a.gamma,f.Ep=a.beta,f.Dp=a.alpha,b(f,1))}}function z(a){var b=a[0],c=a[1];a=b.clientX;var b=b.clientY,f=c.clientX,c=c.clientY;return Math.sqrt((a-f)*(a-f)+(b-c)*(b-
c))}var u=p("__config"),r=p("__container"),f=p("__objects"),E=p("__print"),w=p("__physics"),N=p("__quat"),O=p("__time"),K=p("__tsr"),F=p("__util"),Q=p("__vec3"),J=u.controls,D=u.p,G=[],M=[],I={},y=0,V=0,T=0,R=0,ha=0,ia=!1,aa=new Float32Array(2),W=new Float32Array(2),S=new Float32Array(2),X=new Float32Array(2),ca=new Float32Array(2),oa=new Float32Array(2),fa=0,ma=0,L=!1,U=0,ga=!1,P=!1,va=!1,ja=!1,na=!1,da=null,ua=null,ea=null,ra=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.CT_CHANGE=
50;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(f,d){for(var l=0;l<M.length;l++){var e=M[l],D=f,h=d;if(h)switch(e.type){case 110:var k=e.ef,r=K.get_trans_view(k.f.h),k=K.get_quat_view(k.f.h),q=Q.dist(e.mj,r),g=e.Av;N.invert(e.fn,g);N.multiply(k,g,g);N.normalize(g,g);g=Math.abs(2*Math.acos(g[3]));q/=h;e.Ol=F.smooth(q,e.Ol,h,.3);e.na[0]=q;q=g/h;e.Nl=F.smooth(q,e.Nl,h,.3);e.na[1]=q;e.Ol>=e.threshold||e.Nl>=e.Mv?b(e,1):b(e,0);Q.copy(r,e.mj);N.copy(k,
e.fn);e.kd=D;break;case 120:k=e.ef;r=K.get_trans_view(k.f.h);k=Math.abs(r[1]-e.mj[1])/h;e.Pl=F.smooth(k,e.Pl,h,.3);e.na=k;e.Pl>=e.threshold?b(e,1):b(e,0);Q.copy(r,e.mj);e.kd=D;break;case 130:!e.Md&&0<=e.bd&&D-e.kd>=e.bd&&(b(e,1),e.repeat?e.kd=D:e.bd=-e.bd);break;case 140:e.kd||(e.kd=D);b(e,D-e.kd);e.kd=D;break;case 150:b(e,D);break;case 170:e.na[0]=Math.PI*(e.Bm-e.Fp)/180;e.na[1]=Math.PI*(e.Am-e.Ep)/180;e.na[2]=Math.PI*(e.zm-e.Dp)/180;e.Fp=e.Bm;e.Ep=e.Am;e.Dp=e.zm;break;case 180:e.na[0]=Math.PI*e.Bm/
180,e.na[1]=Math.PI*e.Am/180,e.na[2]=Math.PI*e.zm/180}}for(l=0;l<G.length;l++)for(h=G[l],e=h.Yf,D=0;D<e.length;D++)if(r=e[D],r.Jw!=U){r.Jw=U;g=r;k=0;switch(g.type){case a.CT_CONTINUOUS:k=g.We;(q=c(g))?(k=1,g.We=1):1==k?(k=-1,g.We=-1):k=0;break;case a.CT_TRIGGER:k=g.We;(q=c(g))&&-1==k?(k=1,g.We=1):q||1!=k?k=0:(k=-1,g.We=-1);break;case a.CT_SHOT:k=g.We;(q=c(g))&&-1==k?(k=1,g.We=1):q||1!=k?k=0:(k=0,g.We=-1);break;case a.CT_LEVEL:q=c(g);g.Du!=q?(k=1,g.Du=q):k=0;break;case a.CT_CHANGE:for(var q=g.Vd,g=
g.iD,v=0;v<q.length;v++){var w=q[v].value;k||w==g[v]||(k=1);g[v]=w}break;default:F.O("Wrong sensor manifold type: "+g.type)}if(k&&(q=h==I?null:h,L=!1,r.callback(q,r.id,k,r.Oz),L)){l=-1;break}}for(l=0;l<G.length;l++)for(h=G[l],e=h.Yf,D=0;D<e.length;D++)for(r=e[D],h=r.Vd,r=0;r<h.length;r++)switch(k=h[r],k.type){case 30:b(k,0);break;case 40:b(k,0);break;case 60:b(k,0);break;case 70:b(k,0);break;case 130:b(k,0)}y=0;R=V;ha=T;S.set(aa);X.set(W);ma=fa;U++};a.create_custom_sensor=function(a){var c=d(10);
b(c,a);return c};a.create_keyboard_sensor=function(a){var b=d(20);b.key=a;return b};a.create_collision_sensor=function(a,c,f){if(!a||!w.J(a))return E.error("Wrong collision object"),null;var e=d(80);e.Io=a;e.Ka=c;e.ge=f;e.na={coll_obj:null,coll_pos:f?new Float32Array(3):null,coll_norm:f?new Float32Array(3):null,coll_dist:0};e.Ho=function(a,c,f,d,l){b(e,a);a=e.na;a.coll_obj=c;e.ge&&(a.coll_pos.set(f),a.coll_norm.set(d),a.coll_dist=l)};e.Md=!0;return e};a.create_collision_impulse_sensor=function(a){if(!a||
!a.n)return E.error("Wrong collision impulse object"),null;var c=d(90);c.Go=a;c.Xs=function(a){b(c,a)};c.Md=!0;return c};a.create_ray_sensor=function(a,c,f,e,l,D,h){var k=d(100);k.ef=a;k.from=c;k.to=f;k.Ka=e;k.tu=l;k.ge=D;k.Cm=h;k.na={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3)};k.Dv=function(a,c,f,e,d,l){k.tu?b(k,-1==c?0:1):b(k,c);k.na.hit_fract=c;k.na.obj_hit=f;k.na.hit_time=e;k.ge&&(k.na.hit_pos.set(d),k.na.hit_norm.set(l))};k.Md=!0;return k};a.create_mouse_click_sensor=
function(){return d(50)};a.create_mouse_wheel_sensor=function(){return d(30)};a.create_mouse_move_sensor=function(a){var b=d(40);b.axis=a||"XY";b.na="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=function(a){var b=d(60);b.axis=a||"XY";b.na=0;return b};a.create_touch_zoom_sensor=function(){var a=d(70);a.na=0;return a};a.create_motion_sensor=function(a,b,c){if(!a)return E.error("Wrong collision object"),null;var f=d(110);f.ef=a;var e=K.get_trans_view(a.f.h);a=K.get_quat_view(a.f.h);
f.Av=new Float32Array(4);f.mj=new Float32Array(e);f.fn=new Float32Array(a);f.Ol=0;f.Nl=0;f.threshold=b||.1;f.Mv=c||.1;f.kd=0;f.na=new Float32Array([0,0]);return f};a.create_vertical_velocity_sensor=function(a,b){if(!a)return E.error("Wrong collision object"),null;var c=d(120);c.ef=a;var f=K.get_trans_view(a.f.h),e=K.get_quat_view(a.f.h);c.mj=new Float32Array(f);c.fn=new Float32Array(e);c.Pl=0;c.threshold=b||1;c.kd=0;c.na=0;return c};a.create_timer_sensor=function(a,b){var c=d(130);c.bd=a;c.repeat=
b;c.Md=!0;return c};a.reset_timer_sensor=function(a,b,c,f){a=a||I;a=a.Ud;if(!a||!a[b])return E.error("reset_timer_sensor(): wrong object"),null;b=a[b].Vd[c];if(!b)return E.error("reset_timer_sensor(): sensor not found"),null;b.kd=O.get_timeline();b.bd=f};a.create_elapsed_sensor=function(){var a=d(140);a.kd=0;return a};a.create_gyro_delta_sensor=function(){var a=d(170);a.na=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=d(180);a.na=new Float32Array(3);return a};a.create_timeline_sensor=
function(){return d(150)};a.create_selection_sensor=function(a,b){var c=d(160);c.ef=a;c.ho=b;return c};a.RE=b;a.get_sensor_value=function(a,b,c){a=a||I;a=a.Ud;if(!a||!a[b])return E.error("get_sensor_value(): wrong object"),null;b=a[b].Vd[c];return b?b.value:(E.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,c){a=a||I;a=a.Ud;if(!a||!a[b])return E.error("get_sensor_payload(): wrong object"),null;b=a[b].Vd[c];return b?b.na:(E.error("get_sensor_payload(): sensor not found"),
null)};a.cleanup=function(){G=[];M=[];I={}};a.check_sensor_manifold=function(a,b){a=a||I;if(!a.Ud)return!1;if(b&&a.Ud[b])return!0;if(!b)for(var c in a.Ud)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||I;var c=a.Ud;if(c){var f=a.Yf;if(b){var d=c[b];if(d){for(var l=d.Vd,D=0;D<l.length;D++)1===e(l[D],G)&&t(l[D],M);delete c[b];d=f.indexOf(d);-1<d?f.splice(d,1):F.O("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||m(a)}}else{for(b in c){d=c[b];l=d.Vd;for(D=0;D<l.length;D++)1===
e(l[D],G)&&t(l[D],M);delete c[b];d=f.indexOf(d);-1<d?f.splice(d,1):F.O("Incorrect manifolds array")}m(a);L=!0}}};a.create_sensor_manifold=function(a,b,c,f,d,l,D){a=a||I;a.Yf=a.Yf||[];a.Ud=a.Ud||{};var k=a.Ud,h=a.Yf,r=k[b];if(r){f=r.Vd;for(var q=0;q<f.length;q++)1===e(f[q],G)&&t(f[q],M);r=h.indexOf(r);-1<r?h.splice(r,1):F.O("Incorrect manifolds array")}c={id:b,type:c,Vd:f.slice(0),DD:d,SE:Array(f.length),callback:l,Oz:D,We:-1,Du:0,iD:Array(f.length),Jw:-1};k[b]=c;h.push(c);-1==G.indexOf(a)&&G.push(a);
a=c.Vd;for(b=0;b<a.length;b++){k=a[b];if(k.Md){switch(k.type){case 80:w.append_collision_test(k.Io,k.Ka,k.Ho,k.ge);break;case 90:w.apply_collision_impulse_test(k.Go,k.Xs);break;case 100:k.Ev=w.append_ray_test(k.ef,k.from,k.to,k.Ka,k.Dv,!1,!1,k.ge,k.Cm);break;case 130:k.kd=O.get_timeline(),0>k.bd&&(k.bd=-k.bd)}k.Md=!1}-1==M.indexOf(k)&&M.push(k)}L=!0};a.ot=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.pt=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];
return a[a.length-1]};a.reset=function(){for(var a=0;a<G.length;a++){var b=G[a],c=b.Ud,b=b.Yf,f;for(f in c)delete c[f];b.splice(0,b.length)}for(a=0;a<M.length;a++)t(M[a],M),a--;G.splice(0,G.length)};a.debug=function(){E.log(String(G.length)+" objects with manifolds",G);E.log(String(M.length)+" sensors",M);for(var a=[],b=[],c=0;c<M.length;c++){var f=M[c];80==f.type&&a.push(f);100==f.type&&b.push(f)}E.log(String(a.length)+" collision sensors",a);E.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=
function(a,b){a.addEventListener("keydown",k,!1);a.addEventListener("keyup",n,!1);ga=b};a.register_mouse_events=function(a,b,c){if(c)var f=window;else f=a,f.addEventListener("mouseout",h,!1);a.addEventListener("mousedown",g,!1);f.addEventListener("mousemove",l,!1);f.addEventListener("mouseup",x,!1);P=b;na=c};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",v,!1);a.addEventListener("DOMMouseScroll",v,!1);va=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",
C,!1);a.addEventListener("touchend",B,!1);a.addEventListener("touchmove",A,!1);document.addEventListener("touchstart",function(){});ja=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&D.gyro_use&&window.addEventListener("deviceorientation",q,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",k,!1);a.removeEventListener("keyup",n,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",g,!1);a.removeEventListener("mousemove",
l,!1);a.removeEventListener("mouseout",h,!1);a.removeEventListener("mouseup",x,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",v,!1);a.removeEventListener("DOMMouseScroll",v,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",C,!1);a.removeEventListener("touchmove",A,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&D.gyro_use&&window.removeEventListener("deviceorientation",
q,!1)};a.WH=function(a){da=a};a.XH=function(a){ua=a};a.ZH=function(a){ea=a};a.YH=function(a){ra=a}};b4w.module.__curve=function(a,p){function d(a,b,c,d,g){var m=d.length;g||(g=new Float32Array(m));for(var l=m+a,h=new Float32Array(l),v=1;v<=l-1;v++)h[v-1]=b>=c[v-1]&&b<c[v+1-1]?1:0;for(var C=2;C<=a;C++)for(v=1;v<=l-C;v++)h[v-1]=(0!=h[v-1]?(b-c[v-1])*h[v-1]/(c[v+C-1-1]-c[v-1]):0)+(0!=h[v+1-1]?(c[v+C-1]-b)*h[v+1-1]/(c[v+C-1]-c[v+1-1]):0);b==c[l-1]&&(h[m-1]=1);a=0;for(v=1;v<=m;v++)a+=h[v-1]*d[v-1];for(v=1;v<=m;v++)g[v-1]=0!=a?h[v-1]*d[v-1]/a:0;return g}function b(a){a=a.Km;return a[a.length-1]}function c(a){a=
a.kt;return a[a.length-1]}p("__print");var m=p("__util");a.QA=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var n=a.order_u;b.Pf=n;a=a.points;var g=a.length/5,m=[],l=g+n,g=g+2;m[0]=0;for(var h=2;h<=l;h++)m[h-1]=h>n&&h<g?m[h-2]+1:m[h-2];b.Km=m;if("2D"==c.dimensions)b.Jf=!1;else if("3D"==c.dimensions)b.Jf=!0;else throw"Wrong curve dimensions";n=[];m=[];for(c=0;c<a.length;c+=5)n.push(a[c]),n.push(a[c+1]),n.push(a[c+2]),b.Jf&&n.push(a[c+3]),m.push(a[c+
4]);b.No=n;b.Or=m;a=[];for(var c=b.No,n=b.Jf?4:3,m=b.Or,l=b.Km,g=b.Pf,h=c.length/n,v=h+g,C=0,A=l[v-1]/999,B=0;1E3>B;B++){5E-6>l[v-1]-C&&(C=l[v-1]);for(var q=d(g,C,l,m),z=0;z<n;z++)for(var u=a[n*B+z]=0;u<h;u++)a[n*B+z]+=q[u]*c[n*u+z];C+=A}n=b.Jf?4:3;m=new Float32Array(1E3);m[0]=0;for(c=1;1E3>c;c+=1)l=a[(c-1)*n],g=a[(c-1)*n+1],h=a[(c-1)*n+2],v=a[c*n],C=a[c*n+1],A=a[c*n+2],m[c]=m[c-1]+Math.sqrt((v-l)*(v-l)+(C-g)*(C-g)+(A-h)*(A-h));b.kt=m;return b};a.FF=function(a,c,k){k||(k=[]);var m=c,g=Math.max(m,
0);c=g=Math.min(m,b(a));var m=a.No,g=a.Jf?4:3,x=a.Or,l=a.Km,h=a.Pf;a=m.length/g;var v=a+h;5E-6>l[v-1]-c&&(c=l[v-1]);v=new Float32Array(a);d(h,c,l,x,v);for(c=0;c<g;c++)for(x=k[c]=0;x<a;x++)k[c]+=v[x]*m[g*x+c]};a.CF=function(a,b,c){c||(c=[]);var d=a.No,g=a.Jf?4:3,m=a.Or,l=a.Km,h=a.Pf;a=d.length/g;var v=a+h;5E-6>l[v-1]-b&&(b=l[v-1]);var v=new Float32Array(a),C=b;b=v;var A=m.length;b||(b=new Float32Array(A));var B=new Float32Array(A),q=new Float32Array(A),z=B,u=q;z||(z=new Float32Array(A));u||(u=new Float32Array(A));
for(var r=A+h,f=new Float32Array(r),E=new Float32Array(r),w=1;w<=r-1;w++)f[w-1]=C>=l[w-1]&&C<l[w+1-1]?1:0;C==l[r-1]&&(f[A-1]=1);for(var N=2;N<=h;N++)for(w=1;w<=r-N;w++){var O=0!=f[w-1]?f[w-1]/(l[w+N-1-1]-l[w-1]):0,K=0!=f[w+1-1]?-f[w+1-1]/(l[w+N-1]-l[w+1-1]):0,F=0!=E[w-1]?(C-l[w-1])*E[w-1]/(l[w+N-1-1]-l[w-1]):0,Q=0!=E[w+1-1]?(l[w+N-1]-C)*E[w+1-1]/(l[w+N-1]-l[w+1-1]):0;f[w-1]=(0!=f[w-1]?(C-l[w-1])*f[w-1]/(l[w+N-1-1]-l[w-1]):0)+(0!=f[w+1-1]?(l[w+N-1]-C)*f[w+1-1]/(l[w+N-1]-l[w+1-1]):0);E[w-1]=O+K+F+Q}for(w=
1;w<=A;w++)z[w-1]=f[w-1],u[w-1]=E[w-1];l=0;for(h=1;h<=A;h++)l+=B[h-1]*m[h-1];C=0;for(h=1;h<=A;h++)C+=q[h-1]*m[h-1];for(h=1;h<=A;h++)b[h-1]=0!=l?q[h-1]*m[h-1]/l+B[h-1]*m[h-1]*C/(l*l):0;for(m=0;m<g;m++)for(l=c[m]=0;l<a;l++)c[m]+=v[l]*d[g*l+m]};a.bK=b;a.EF=c;a.DF=function(a,d){if(0>=d)return 0;var k=b(a);if(d>=c(a))return k;var n=a.kt,g=m.Rl(n,d,0,n.length-1);return k*(g+(d-n[g])/(n[g+1]-n[g]))/1E3}};b4w.module.__dds=function(a,p){function d(a,b,c,d){var e=new Uint16Array(4),k=new Uint16Array(c*d),g=0,q=0,m=0,u=q=g=0,r=0,f=0,E=0,w=c/4;d/=4;for(var n=0;n<d;n++)for(var t=0;t<w;t++)m=b+4*(n*w+t),e[0]=a[m],e[1]=a[m+1],g=e[0]&31,q=e[0]&2016,u=e[0]&63488,r=e[1]&31,f=e[1]&2016,E=e[1]&63488,e[2]=5*g+3*r>>3|5*q+3*f>>3&2016|5*u+3*E>>3&63488,e[3]=5*r+3*g>>3|5*f+3*q>>3&2016|5*E+3*u>>3&63488,g=a[m+2],q=4*n*c+4*t,k[q]=e[g&3],k[q+1]=e[g>>2&3],k[q+2]=e[g>>4&3],k[q+3]=e[g>>6&3],q+=c,k[q]=e[g>>8&3],k[q+1]=e[g>>
10&3],k[q+2]=e[g>>12&3],k[q+3]=e[g>>14],g=a[m+3],q+=c,k[q]=e[g&3],k[q+1]=e[g>>2&3],k[q+2]=e[g>>4&3],k[q+3]=e[g>>6&3],q+=c,k[q]=e[g>>8&3],k[q+1]=e[g>>10&3],k[q+2]=e[g>>12&3],k[q+3]=e[g>>14];return k}function b(a,b,c,v){var m=new Int32Array(c,0,31),p,B,q,z,u,r;if(542327876!=m[0])return t.error("Invalid magic number in DDS header"),0;if(!m[20]&4)return t.error("Unsupported format, must contain a FourCC code"),0;p=m[21];switch(p){case k:B=8;q=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case n:B=16;q=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case g:B=16;q=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return t.error("Unsupported FourCC code:",e(p)),null}r=1;m[2]&131072&&!1!==v&&(r=Math.max(1,m[7]));z=m[4];u=m[3];m=m[1]+4;if(b)for(p=0;p<r;++p)v=Math.max(4,z)/4*Math.max(4,u)/4*B,b=new Uint8Array(c,m,v),a.compressedTexImage2D(a.TEXTURE_2D,p,q,z,u,0,b),m+=v,z=Math.max(.5*z,1),u=Math.max(.5*u,1);else if(p==k)Math.max(4,z),Math.max(4,u),b=new Uint16Array(c),c=d(b,m/2,z,u),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,z,u,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),v&&a.generateMipmap(a.TEXTURE_2D);else return t.error("No manual decoder for",e(p),"and no native support"),0;return r}function c(a,c,d,e,k,g){var m=new XMLHttpRequest;m.open("GET",d,!0);m.responseType="arraybuffer";m.onload=function(){if(200==m.status){a.bindTexture(a.TEXTURE_2D,e);var d=b(a,c,m.response,k);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}g&&
g(e)};m.send(null);return e}function m(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function e(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var t=p("__print"),k=m("DXT1"),n=m("DXT3"),g=m("DXT5");a.BI=d;a.EG=b;a.du=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.nC=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case k:b=6;break;case n:case g:b=4;break;default:t.error("Unsupported FourCC code:",e(a))}return b};
a.EJ=c;a.DJ=function(a,b,d,e){var k=a.createTexture();c(a,b,d,k,!0,e);return k}};b4w.module.__debug=function(a,p){function d(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a,b){typeof a!=typeof b&&n.O("Structure assertion failed: incompatible types");if(null!==a&&null!==b&&"object"==typeof a){for(var c in a)c in b||n.O("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||n.O("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&n.O("Structure assertion failed: incompatible types for key "+
c)}}var c=p("__config"),m=p("__extensions"),e=p("__print"),t=p("__textures"),k=p("__time"),n=p("__util"),g=p("__graph"),x=c.p,l=null,h={},v=!1,C={},A=[],B=-1,q=null,z=!1;a.WM_NONE=0;a.WM_OPAQUE_WIREFRAME=1;a.WM_TRANSPARENT_WIREFRAME=2;a.WM_FRONT_BACK_VIEW=3;a.WM_DEBUG_SPHERES=4;a.gd=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(h[a[d]]=d)}l=a};a.Do=function(a){if(v){var b=
l.getError();b!=l.NO_ERROR&&(b in h?n.O("GL Error: "+b+", gl."+h[b]+" ("+a+")"):n.O("Unknown GL error: "+b+" ("+a+")"))}};a.Wz=function(){if(v)switch(l.checkFramebufferStatus(l.FRAMEBUFFER)){case l.FRAMEBUFFER_COMPLETE:break;case l.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case l.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case l.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:e.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case l.FRAMEBUFFER_UNSUPPORTED:e.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:e.error("FRAMEBUFFER CHECK FAILED")}};a.$z=function(){if(-1!=B)return B;l.bindFramebuffer(l.FRAMEBUFFER,l.createFramebuffer());var a=t.Vj("DEBUG",t.Qh);t.resize(a,1,1);l.framebufferTexture2D(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,a.Bb,a.Oa,0);l.checkFramebufferStatus(l.FRAMEBUFFER)!=l.FRAMEBUFFER_COMPLETE?(B=!0,e.warn("depth-only issue was found")):B=!1;l.bindFramebuffer(l.FRAMEBUFFER,null);return B};
a.bA=function(a,b,c){if(v&&!l.getShaderParameter(a,l.COMPILE_STATUS))throw c=d(c),e.error("shader compilation failed:\n"+c+"\n"+l.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.cA=function(a,b,c,k,h,g){if(v&&!l.getProgramParameter(a,l.LINK_STATUS)){var q=m.Tt();q&&(h=q.getTranslatedShaderSource(c),g=q.getTranslatedShaderSource(k));h=d(h);g=d(g);e.error("shader linking failed:\n"+h+"\n\n\n"+g+"\n"+l.getProgramInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";
}};a.set_check_gl_errors=function(a){v=a};a.DE=function(a){if(x.show_hud_debug_info){var b=m.Ut();if(b){var c=b.qI();a.Zo.push(c);b.dI(b.My,c)}else a.Zo.push(performance.now())}};a.EE=function(a){if(x.show_hud_debug_info){var b=a.Zo,c=m.Ut();if(c){c.CI(c.My);for(var d=0;d<b.length;d++){var e=b[d],k=c.eC(e,c.JH),h=l.getParameter(c.GH);k&&!h&&(e=c.eC(e,c.KH)/1E6,a.Zj=n.smooth(e,a.Zj,1,100),b.splice(d,1),d--)}}else e=performance.now()-b.pop(),a.Zj=n.smooth(e,a.Zj,1,100)}};a.DI=function(a){C[a]=a in C?
C[a]+1:1};a.update=function(){for(var a in C)e.log(a,C[a]),C[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(n.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}A.push(a)};a.msg=function(){for(var a=1,b=0;b<A.length;b++){var c=A[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],n.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);A.push(c)};var u=["color: #3366FF",
"color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),l=0;l<A.length;l++){var k=A[l];a=k[0];if(!(a<d)){var h=String(k[1]);c[h]||(c[h]=u[b++%u.length]);a=["%c"+(a/1E3).toFixed(6),c[h],h];for(h=2;h<k.length;h++)a.push(k[h]);e.log.apply(this,a)}}A.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),d=0;d<A.length;d++){var l=A[d];a=l[0];if(!(a<c))for(var k=
2;k<l.length;k++){var h=String(l[1]);3<l.length&&(h+="_"+String(k-2));b[h]||(b[h]=h+"\n");b[h]+=String(a)+" "+l[k]+"\n"}}a="";for(h in b)a+=b[h]+"\n\n";e.log(a);A.splice(0)};a.kI=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&
b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(n.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.TH=function(a,b){a.constructor!=b&&n.O("Type assertion failed: value <"+a+"> has type <"+a.constructor+">, required <"+b+">")};a.UH=b;a.VH=function(a){z?b(a,q):z=!0;q=a};a.fake_load=function(a,b,c,d,e){(a=a||null)||n.O("Stage load callback is undefined");
b=b||5E3;c=c||0;d=d||100;100<d&&n.O("Max percentage must be less than 100");0>c&&n.O("Min percentage must be greater than 0");c>d&&n.O("Max percentage must be greater than min percentage");var l=k.animate(c,d,b,function(b){b=b.toFixed();a(b);100==b&&(k.clear_animation(l),e&&e())})};a.KJ=function(a){return g.cB(a,function(a,b){return b.type},function(b,c,d){b=g.La(a,b);c=g.La(a,c);return b.ra[d[0]].identifier+"\n==>\n"+c.F[d[1]].identifier})}};b4w.module.__extensions=function(a,p){function d(a){if(a in t)return t[a];var b=e.getExtension(a)||null;t[a]=b;c.log("%cGET EXTENSION","color: #"+(b?"0a0":"a00"),a);return b}var b=p("__config"),c=p("__print"),m=b.p,e=null,t={};a.gd=function(a){e=a};a.au=function(){return d("WEBGL_compressed_texture_s3tc")||d("WEBKIT_WEBGL_compressed_texture_s3tc")||d("MOZ_WEBGL_compressed_texture_s3tc")};a.pC=function(){return m.sc?{}:d("WEBGL_depth_texture")||d("WEBKIT_WEBGL_depth_texture")||d("MOZ_WEBGL_depth_texture")};
a.hC=function(){return d("EXT_texture_filter_anisotropic")||d("WEBKIT_EXT_texture_filter_anisotropic")||d("MOZ_EXT_texture_filter_anisotropic")};a.Tt=function(){return d("WEBGL_debug_shaders")};a.$t=function(){return d("WEBGL_debug_renderer_info")};a.Vt=function(){return m.sc?{}:d("OES_element_index_uint")};a.BC=function(){return m.sc?null:d("OES_standard_derivatives")};a.Ut=function(){return d("EXT_disjoint_timer_query")};a.cleanup=function(){t={}}};b4w.module.__graph=function(a,p){function d(a,c,d){d||(d=null);if(b(a,c))throw"Graph already has node with given ID";a.B.push(c,d)}function b(a,b){for(var c=a.B,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function c(a,c,d,f){f||(f=null);if(b(a,c)&&b(a,d))a.Y.push(c,d,f);else throw"Wrong node IDs";}function m(a,c){if(!b(a,c))throw"Node not found";for(var d=a.B,f=0;f<d.length;f+=2)d[f]==c&&(d.splice(f,2),f-=2)}function e(a,b,c,d){if(!N(a,b,c))throw"Edge not found";a=a.Y;for(var f=0,e=0;e<a.length;e+=
3)if(a[e]==b&&a[e+1]==c){if(-1==d)a.splice(e,3);else{if(d==f){a.splice(e,3);break}f++}e-=3}}function t(a){a=a.B;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}function k(a,b){for(var c=a.B,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function n(a){var b=[],c={};g(a,c);for(var d=a.B,e=0;e<d.length;e+=2)0==f(a,d[e])&&x(a,d[e],c,b);return{B:b,Y:a.Y.slice(0)}}function g(a,b){for(var c=a.B,d=0;d<c.length;d+=2)b[c[d]]=!1}function x(a,b,c,d){if(!c[b]){c[b]=!0;for(var f=0;f<r(a,b);f++)x(a,
E(a,b,f),c,d);d.unshift(b,u(a,b))}}function l(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var e=0;e<r(a,b);e++){var k=E(a,b,e);l(a,k,c,d)}if(20==d||30==d)for(e=0;e<f(a,b);e++)k=w(a,b,e),l(a,k,c,d)}}function h(a){for(var c=a.Y,d=0;d<c.length;d+=3){var f=c[d+1];b(a,c[d])&&b(a,f)||(c.splice(d,3),d-=3)}}function v(a){for(var b=[],c=a.B,d=0;d<c.length;d+=2){var f=c[d];r(a,f)||b.push(f)}return b}function C(a){var b=a.B;a=a.Y;for(var c=[],d=[],f=[],e=0;e<b.length;e++)f[b[2*e]]=e,c.push(e,b[2*e+1]);for(e=
0;e<a.length;e+=3)d.push(f[a[e]],f[a[e+1]],a[e+2]);return{B:c,Y:d}}function A(a,b,c){if(c.he==c.Nf){for(var d=0,e=0;d<c.Nf;d++)-1!=c.Je[d]&&(a[e]=d,b[e]=c.Je[d],e++);return!0}if(c.Nf>c.Hi||c.dg>c.eg||c.jj>c.lj||c.ij>c.kj)return!1;for(var e=d=-1,l=!1;!l&&B(c,J,d,e);)if(d=J[0],e=J[1],q(c,d,e)){var k;k=c;l={};l.nk=k.nk;l.ok=k.ok;l.qq=k.qq;l.mm=k.mm;l.Nf=k.Nf;l.Hi=k.Hi;l.Pf=k.Pf;l.he=l.Vm=k.he;l.ij=k.ij;l.jj=k.jj;l.dg=k.dg;l.kj=k.kj;l.lj=k.lj;l.eg=k.eg;l.Aj=-1;l.Je=k.Je;l.Kg=k.Kg;l.Yg=k.Yg;l.Zg=k.Zg;
l.qh=k.qh;l.rh=k.rh;l.qn=k.qn;k.qn[0]+=1;var l=k=l,h=d,g=e,m=l.nk,v=l.ok,u=l.Nf,n=l.Hi,t=l.Je,F=l.Kg,x=l.Yg,K=l.Zg,Q=l.qh,L=l.rh;z(h<u);z(g<n);z(l.he<u);z(l.he<n);u=++l.he;l.Aj=h;x[h]||(x[h]=u,l.ij++,Q[h]&&l.dg++);Q[h]||(Q[h]=u,l.jj++,x[h]&&l.dg++);K[g]||(K[g]=u,l.kj++,L[g]&&l.eg++);L[g]||(L[g]=u,l.lj++,K[g]&&l.eg++);t[h]=g;F[g]=h;for(t=0;t<f(m,h);t++)F=w(m,h,t),x[F]||(x[F]=u,l.ij++,Q[F]&&l.dg++);for(t=0;t<r(m,h);t++)F=E(m,h,t),Q[F]||(Q[F]=u,l.jj++,x[F]&&l.dg++);for(t=0;t<f(v,g);t++)F=w(v,g,t),K[F]||
(K[F]=u,l.kj++,L[F]&&l.eg++);for(t=0;t<r(v,g);t++)F=E(v,g,t),L[F]||(L[F]=u,l.lj++,K[F]&&l.eg++);l=A(a,b,k);z(1>=k.he-k.Vm);z(-1!=k.Aj);F=k.nk;h=k.ok;g=k.he;m=k.Aj;v=k.Je;x=k.Kg;u=k.Yg;K=k.Zg;n=k.qh;Q=k.rh;if(k.Vm<g){u[m]==g&&(u[m]=0);for(L=0;L<f(F,m);L++)t=w(F,m,L),u[t]==g&&(u[t]=0);n[m]==g&&(n[m]=0);for(L=0;L<r(F,m);L++)t=E(F,m,L),n[t]==g&&(n[t]=0);F=v[m];K[F]==g&&(K[F]=0);for(L=0;L<f(h,F);L++)t=w(h,F,L),K[t]==g&&(K[t]=0);Q[F]==g&&(Q[F]=0);for(L=0;L<r(h,F);L++)t=E(h,F,L),Q[t]==g&&(Q[t]=0);v[m]=-1;
x[F]=-1;k.he=k.Vm;k.Aj=-1}}return l}function B(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var f=a.dg,e=a.eg,l=a.jj,k=a.lj,h=a.ij,g=a.kj,q=a.he,r=a.Nf,m=a.Hi,v=a.Je,u=a.Kg,z=a.Yg,n=a.Zg,t=a.qh,L=a.rh;if(f>q&&e>q)for(;c<r&&(-1!=v[c]||0==t[c]||0==z[c]);)c++,d=0;else if(l>q&&k>q)for(;c<r&&(-1!=v[c]||0==t[c]);)c++,d=0;else if(h>q&&g>q)for(;c<r&&(-1!=v[c]||0==z[c]);)c++,d=0;else if(0==c&&0!=a.Pf){for(z=0;z<r&&-1!=v[c=a.Pf[z]];)z++;z==r&&(c=r)}else for(;c<r&&-1!=v[c];)c++,d=0;if(f>q&&e>q)for(;d<m&&(-1!=u[d]||0==
L[d]||0==n[d]);)d++;else if(l>q&&k>q)for(;d<m&&(-1!=u[d]||0==L[d]);)d++;else if(h>q&&g>q)for(;d<m&&(-1!=u[d]||0==n[d]);)d++;else for(;d<m&&-1!=u[d];)d++;return c<r&&d<m?(b[0]=c,b[1]=d,!0):!1}function q(a,b,c){var d=a.nk,e=a.ok,l=a.Hi,k=a.Je,h=a.Kg,g=a.Yg,q=a.Zg,m=a.qh,v=a.rh;z(b<a.Nf);z(c<l);z(-1==k[b]);z(-1==h[c]);if(!(0,a.qq)(u(d,b),u(e,c)))return!1;for(var n=l=0,t=0,F=0,J=0,x=0,K=0;K<r(d,b);K++){var L=E(d,b,K);if(-1!=k[L]){var U=k[L];if(!N(e,c,U)||!O(a.mm,d,b,L,e,c,U))return!1}else g[L]&&t++,m[L]&&
l++,g[L]||m[L]||J++}for(K=0;K<f(d,b);K++)if(L=w(d,b,K),-1!=k[L]){if(U=k[L],!N(e,U,c)||!O(a.mm,d,L,b,e,U,c))return!1}else g[L]&&t++,m[L]&&l++,g[L]||m[L]||J++;for(K=0;K<r(e,c);K++)if(U=E(e,c,K),-1!=h[U]){if(L=h[U],!N(d,b,L))return!1}else q[U]&&F++,v[U]&&n++,q[U]||v[U]||x++;for(K=0;K<f(e,c);K++)if(U=w(e,c,K),-1!=h[U]){if(L=h[U],!N(d,L,b))return!1}else q[U]&&F++,v[U]&&n++,q[U]||v[U]||x++;return t<=F&&l<=n&&J<=x}function z(a){if(!a)throw"Assertion failed";}function u(a,b){for(var c=a.B,d=0;d<c.length;d+=
2)if(c[d]==b)return c[d+1];return null}function r(a,b){for(var c=a.Y,d=0,f=0;f<c.length;f+=3)c[f]==b&&d++;return d}function f(a,b){for(var c=a.Y,d=0,f=0;f<c.length;f+=3)c[f+1]==b&&d++;return d}function E(a,b,c){a=a.Y;for(var d=0,f=0;f<a.length;f+=3)if(a[f]==b){if(d==c)return a[f+1];d++}return-1}function w(a,b,c){a=a.Y;for(var d=0,f=0;f<a.length;f+=3)if(a[f+1]==b){if(d==c)return a[f];d++}return-1}function N(a,b,c){a=a.Y;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function O(a,
b,c,d,f,e,l){for(var k=K(b,c,d),h=K(f,e,l),g=0;g<k;g++){for(var q=!1,r=0;r<h;r++)if(a(F(b,c,d,g),F(f,e,l,r))){q=!0;break}if(!q)return!1}return!0}function K(a,b,c){var d=0;a=a.Y;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&d++;return d}function F(a,b,c,d){a=a.Y;for(var f=0,e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c){if(f==d)return a[e+2];f++}return null}p("__print");var Q=p("__util"),J=[-1,-1];a.Yr=-1;a.FH=10;a.vl=20;a.MH=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var f=
a[d];switch(f.length){case 2:b.push(f[0],f[1]);break;case 3:c.push(f[0],f[1],f[2]);break;default:throw"Wrong graph constructor params";}}return{B:b,Y:c}};a.clone=function(a,b,c){if(b)for(var d=Array(a.B.length),f=0;f<a.B.length;f+=2)d[f]=a.B[f],d[f+1]=b(a.B[f+1]);else d=Q.qa(a.B);if(c)for(b=Array(a.Y.length),f=0;f<a.Y.length;f+=3)b[f]=a.Y[f],b[f+1]=a.Y[f+1],b[f+2]=c(a.Y[f+2]);else b=Q.qa(a.Y);return a={B:d,Y:b}};a.sI=function(a,b){for(var c=[],d=[],f=0;f<a.length;f++)c.push(a[f][0],a[f][1]);for(f=
0;f<b.length;f++)d.push(b[f][0],b[f][1],b[f][2]);return{B:c,Y:d}};a.Uh=d;a.jJ=b;a.dc=c;a.qe=m;a.yh=e;a.jn=function(a,b,c,d){if(!N(a,b,c))throw"Edge not found";a=a.Y;for(var f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c&&a[f+2][0]==d[0]&&a[f+2][1]==d[1]){a.splice(f,3);break}};a.u=function(a,b){if(-1==k(a,b)){var c=t(a);d(a,c,b);return c}throw"Non-unique attribute";};a.FE=function(a,b,c,d,f){a=a.Y;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&a[e+2]==d&&(a[e+2]=f)};a.iz=function(a,b,f){var e;f=f||[];
e=e||[];for(var l={},k=0;k<a.B.length;k+=2){var h=a.B[k],g=a.B[k+1],q=t(b);d(b,q,g);l[h]=q}for(k=0;k<a.Y.length;k+=3)g=l[a.Y[k]],q=l[a.Y[k+1]],h=a.Y[k+2],c(b,g,q,h);for(k=0;k<f.length;k+=3)g=l[f[k]],a=f[k+1],h=f[k+2],c(b,g,a,h);for(k=0;k<e.length;k+=3)f=e[k],q=l[e[k+1]],h=e[k+2],c(b,f,q,h)};a.pk=t;a.ne=k;a.m=function(a,b,d,f){b=k(a,b);d=k(a,d);if(-1!=b&&-1!=d)c(a,b,d,f);else throw"Attributes not found";};a.aa=function(a,b){for(var c=a.B,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.ye=function(a,b){for(var c=
a.Y,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.Wd=function(a,b,c){for(var d=a.Y,f=0;f<d.length;f+=3)if(d[f+1]==b){var e=d[f];if(c(e,u(a,e),d[f+2]))break}};a.gg=function(a,b,c){for(var d=a.Y,f=0;f<d.length;f+=3)if(d[f]==b){var e=d[f+1];if(c(e,u(a,e),d[f+2]))break}};a.zr=n;a.UF=function(a){a=n(a).B;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.uJ=function(){};a.wn=function(a,c,d){if(!b(a,c))throw"No such node";var f={};g(a,f);l(a,c,f,d);c=[];for(var e in f)f[e]&&(e=Number(e),c.push(e,
u(a,e)));a={B:c,Y:a.Y.slice(0)};h(a);return a};a.Eo=h;a.AC=function(a){for(var b=[],c=a.B,d=0;d<c.length;d+=2){var e=c[d];f(a,e)||b.push(e)}return b};a.tk=v;a.match=function(a,b,c,d){var f={};f.nk=C(a);f.ok=C(b);f.qq=c||function(a,b){return a==b};f.mm=d||function(a,b){return a==b};d=a.B.length/2;var e=b.B.length/2;f.Nf=d;f.Hi=e;f.Pf=0;f.he=f.Vm=0;f.dg=f.ij=f.jj=0;f.eg=f.kj=f.lj=0;f.Aj=-1;f.Je=Array(d);f.Kg=Array(e);f.Yg=Array(d);f.Zg=Array(e);f.qh=Array(d);f.rh=Array(e);f.qn=[1];for(c=0;c<d;c++)f.Je[c]=
-1,f.Yg[c]=0,f.qh[c]=0;for(c=0;c<e;c++)f.Kg[c]=-1,f.Zg[c]=0,f.rh[c]=0;e=Array(d);d=Array(d);if(A(e,d,f)){for(c=0;c<e.length;c++)e[c]=a.B[2*e[c]],d[c]=b.B[2*d[c]];return[e,d]}return null};a.La=u;a.Qf=r;a.Lp=f;a.Ff=E;a.rk=w;a.WI=K;a.Te=F;a.replace=function(a,b,c){for(var f=a.Y,e=t(a),l=0;l<b.length;l++){var k=b[l];m(a,k);for(var h=0;h<f.length;h+=3)f[h]==k&&(f[h]=e),f[h+1]==k&&(f[h+1]=e),f[h]==f[h+1]&&(f.splice(h,3),h-=3)}d(a,e,c)};a.Gv=function(a,b,c,d,f){if(!N(a,b,c))throw"Edge not found";a=a.Y;for(var e=
0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&(a[e]=d,a[e+1]=f)};a.uB=function(a,b){function c(a,b){if(-1!=h.indexOf(a)){var d=h.slice(h.indexOf(a));if(-1!=f[d[d.length-1]].indexOf(d[0])){g.push([a,d[d.length-1]]);return}}h.push(a);for(d=0;d<b.length;d++)b[d]in f&&c(b[d],f[b[d]])}b||(b=v(a)[0]);var d=a.Y;if(d.length){for(var f={},l=0,k=0;k<d.length;k+=3)d[k+1]in f?f[d[k+1]].push(d[k]):f[d[k+1]]=[d[k]],l++;var h=[],g=[];c(b,f[b]);for(k=0;k<g.length;k++)for(var q=l=0;q<d.length;q+=3)g[k][1]==d[q+1]&&g[k][0]==
d[q]&&e(a,d[q],d[q+1],l),l++}};a.cB=function(a,b,c){var d=a.B;a=a.Y;var f;f="digraph debug {\n    node [shape=box];\n";for(var e=0;e<d.length;e+=2){var l=d[e],k=d[e+1],k=b?b(l,k):String(l);f+="    ";f+=String(l)+' [label="'+k.replace(/\"/g,'\\"')+'"];\n'}for(e=0;e<a.length;e+=3)b=a[e],d=a[e+1],k=a[e+2],f+="    ",f+=String(b)+" -> "+String(d),c&&(f+=' [label="'+c(b,d,k)+'"]'),f+=";\n";return f+="}"}};b4w.module.__ipc=function(a,p){function d(a,b,c){for(var d=0;d<h.length;d+=2)h[d+1]==a&&(l[d+Number(!b)]=c)}function b(a){for(var b=0;b<a.length;b++){var c=a[b],d=0,e;for(e in c){var l=c[e];switch(l.constructor){case Float32Array:d+=l.length;break;case Number:d+=1}}--d;c.len=d}}var c=!0;a.Gx=0;var m=a.yx=1,e=a.Ax=2;a.zx=3;a.Cx=4;a.Dx=5;a.Ex=6;a.Hx=7;var t=a.Jx=8,k=a.Xr=9,n=a.Kx=10;a.Lx=11;var g=a.Mx=12;a.Nx=13;a.Ix=14;a.Fx=15;a.Bx=16;a.ny=100;a.Px=101;a.Qx=102;a.Rx=103;a.Sx=104;a.Ux=105;a.Tx=106;
a.Vx=107;a.Wx=108;a.Xx=109;a.Yx=110;a.Zx=111;a.$x=112;a.by=113;a.cy=114;a.qy=115;a.dy=116;a.ey=117;a.fy=118;a.hy=119;a.iy=120;a.jy=121;a.ly=122;a.my=123;a.oy=124;a.ay=125;a.sy=126;a.gy=127;a.$r=128;a.ry=129;a.ty=130;a.uy=131;a.vy=132;a.wy=133;a.xy=134;a.yy=135;a.zy=136;a.Ay=137;a.By=138;a.Cy=139;a.as=140;var x=a.yl=141;a.Dy=142;a.Zr=143;a.Ey=144;a.Fy=145;a.py=146;a.ky=147;a.Gy=148;var l=b4w.worker_listeners,h=b4w.worker_namespaces,v={ad:g,v:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),
ke:new Float32Array(3),ae:new Float32Array(3),len:0},C={ad:t,Co:0,Eq:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},A={ad:k,id:0,Xh:0,hit_fract:0,hit_time:0,len:0},B={ad:n,id:0,Xh:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},q={ad:m,Cg:0,Dg:0,result:0,len:0},z={ad:e,Cg:0,Dg:0,result:0,Ig:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},u={ad:x,v:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},r=[v,C,A,B,q,z,u];
a.WA=function(a,b){var e={Jm:a?!0:!1,qg:null,fe:[],yd:""};if(b)if(e.qg={addEventListener:function(a,b){"message"!=a&&panic("Wrong web worker event");d(e.yd,e.Jm,b)},removeEventListener:function(a){"message"!=a&&panic("Wrong web worker event");d(e.yd,e.Jm,null)},postMessage:function(a){var b;a:{for(b=0;b<h.length;b+=2)if(h[b+1]==e.yd){b=l[b+Number(!!e.Jm)];break a}b=null}b({data:a})},terminate:function(){for(var a=0;a<h.length;a+=2)if(h[a+1]==e.yd){l.splice(a,2);h.splice(a,2);break}}},e.Jm){var k=
p("__util"),g=p("__container"),q=b4w.get_namespace(p),k=k.nj(q+"_worker");h.push(q);h.push(k);l.push(null);l.push(null);e.yd=k;(g=g.HB(a))?c?g.addEventListener("load",function(){b4w.require("__bindings",e.yd)},!1):(b4w.cleanup("__bindings",e.yd),b4w.cleanup("__ipc",e.yd),b4w.require("__bindings",e.yd)):(g=document.createElement("script"),g.src=a,g.defer="defer",g.async="async",g.addEventListener("load",function(){c=!1;b4w.require("__bindings",e.yd)},!1),document.head.appendChild(g))}else e.yd=b4w.get_namespace(p);
else e.qg=a?new Worker(a):self;return e};a.yz=function(a,c){function d(b){if(b.constructor==ArrayBuffer)b=new Float32Array(b);else if(b[0].constructor==ArrayBuffer){for(var l=0;l<b.length;l++)d(b[l]);return}l=b[0]|0;switch(l){case g:var h=v;h.v=b[1]|0;h.time=b[2];h.trans[0]=b[3];h.trans[1]=b[4];h.trans[2]=b[5];h.quat[0]=b[6];h.quat[1]=b[7];h.quat[2]=b[8];h.quat[3]=b[9];h.ke[0]=b[10];h.ke[1]=b[11];h.ke[2]=b[12];h.ae[0]=b[13];h.ae[1]=b[14];h.ae[2]=b[15];break;case t:h=C;h.Co=b[1]|0;h.Eq=b[2]|0;h.trans[0]=
b[3];h.trans[1]=b[4];h.trans[2]=b[5];h.quat[0]=b[6];h.quat[1]=b[7];h.quat[2]=b[8];h.quat[3]=b[9];break;case k:h=A;h.id=b[1]|0;h.Xh=b[2]|0;h.hit_fract=b[3];h.hit_time=b[4];break;case n:h=B;h.id=b[1]|0;h.Xh=b[2]|0;h.hit_fract=b[3];h.hit_time=b[4];h.hit_pos[0]=b[5];h.hit_pos[1]=b[6];h.hit_pos[2]=b[7];h.hit_norm[0]=b[8];h.hit_norm[1]=b[9];h.hit_norm[2]=b[10];break;case m:h=q;h.Cg=b[1]|0;h.Dg=b[2]|0;h.result=!!b[3];break;case e:h=z;h.Cg=b[1]|0;h.Dg=b[2]|0;h.result=!!b[3];h.Ig[0]=b[4];h.Ig[1]=b[5];h.Ig[2]=
b[6];h.coll_norm[0]=b[7];h.coll_norm[1]=b[8];h.coll_norm[2]=b[9];h.coll_dist=b[10];break;case x:h=u;h.v=b[1]|0;h.trans[0]=b[2];h.trans[1]=b[3];h.trans[2]=b[4];h.quat[0]=b[5];h.quat[1]=b[6];h.quat[2]=b[7];h.quat[3]=b[8];break;default:h=b}c(a,l,h)}b(r);a.qg.addEventListener("message",function(a){d(a.data)},!1)};a.cleanup=function(){};a.w=function(a,b){if(a)switch(b){case g:var c=v,d=new Float32Array(c.len);d[0]=c.ad;d[1]=c.v;d[2]=c.time;d[3]=c.trans[0];d[4]=c.trans[1];d[5]=c.trans[2];d[6]=c.quat[0];
d[7]=c.quat[1];d[8]=c.quat[2];d[9]=c.quat[3];d[10]=c.ke[0];d[11]=c.ke[1];d[12]=c.ke[2];d[13]=c.ae[0];d[14]=c.ae[1];d[15]=c.ae[2];a.fe.push(d.buffer);break;case t:c=C;d=new Float32Array(c.len);d[0]=c.ad;d[1]=c.Co;d[2]=c.Eq;d[3]=c.trans[0];d[4]=c.trans[1];d[5]=c.trans[2];d[6]=c.quat[0];d[7]=c.quat[1];d[8]=c.quat[2];d[9]=c.quat[3];a.fe.push(d.buffer);break;case k:c=A;d=new Float32Array(c.len);d[0]=c.ad;d[1]=c.id;d[2]=c.Xh;d[3]=c.hit_fract;d[4]=c.hit_time;a.fe.push(d.buffer);break;case n:c=B;d=new Float32Array(c.len);
d[0]=c.ad;d[1]=c.id;d[2]=c.Xh;d[3]=c.hit_fract;d[4]=c.hit_time;d[5]=c.hit_pos[0];d[6]=c.hit_pos[1];d[7]=c.hit_pos[2];d[8]=c.hit_norm[0];d[9]=c.hit_norm[1];d[10]=c.hit_norm[2];a.fe.push(d.buffer);break;case m:c=q;d=new Float32Array(c.len);d[0]=c.ad;d[1]=c.Cg;d[2]=c.Dg;d[3]=c.result;a.fe.push(d.buffer);break;case e:c=z;d=new Float32Array(c.len);d[0]=c.ad;d[1]=c.Cg;d[2]=c.Dg;d[3]=c.result;d[4]=c.Ig[0];d[5]=c.Ig[1];d[6]=c.Ig[2];d[7]=c.coll_norm[0];d[8]=c.coll_norm[1];d[9]=c.coll_norm[2];d[10]=c.coll_dist;
a.fe.push(d.buffer);break;case x:c=u;d=new Float32Array(c.len);d[0]=c.ad;d[1]=c.v;d[2]=c.trans[0];d[3]=c.trans[1];d[4]=c.trans[2];d[5]=c.quat[0];d[6]=c.quat[1];d[7]=c.quat[2];d[8]=c.quat[3];a.fe.push(d.buffer);break;default:d=[];for(c=1;c<arguments.length;c++)d.push(arguments[c]);a.qg.postMessage(d)}};a.oE=function(a){a&&a.fe.length&&(a.qg.postMessage(a.fe),a.fe.length=0)};a.Yt=function(a){switch(a){case g:return v;case t:return C;case k:return A;case n:return B;case m:return q;case e:return z;case x:return u;
default:return null}};a.terminate=function(a){a.qg.terminate();a.qg=null};a.Gm=function(a){return!!a.qg};a.vu=function(a){return!!a.yd}};b4w.module.__hud=function(a,p){function d(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){c(' SCENE "'+a.name+'"');if(a.k){var b=0,d=0,e=0;k.aa(a.k.sb,function(a,l){if("SINK"==l.type)c(" (F)",l.type);else{var k=l.type,g=Math.round(l.j.width)+"x"+Math.round(l.j.height),m=l.q.length,r=l.Yj;"MAIN_CUBE_REFLECT"==l.type&&(m*=6);var f=l.enqueue&&l.yb,n=f?l.Zj:0;c(f?" (A)":" (P)",k,l.Um,g,r,"of",m,"  ",n.toFixed(3));l.Yj=0;f&&(b+=m,d+=r,e+=n)}});return[b,
d,e]}c("No INFO")}function c(){for(var a=80+20*x[0],b=arguments[0],c=1;c<arguments.length;c++){for(var d="",e=0;e<n[c]-String(arguments[c]).length;e++)d+=" ";b+=d+arguments[c]}x[0]++;g.fillText(b,30,a)}function m(a,b,c){b*=a.Za;c.x=a.x+b;c.y=a.y;c.Za=a.Za-2*b;c.Ta=a.Ta}function e(a){return a.x+a.Za/2}function t(a){var b=g,c={x:0,y:0,Za:0,Ta:0},d=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.Za=d;c.Ta=b;m(c,.01,c);d=.02*c.Ta;c.x=c.x;c.y+=d;c.Za=c.Za;c.Ta-=2*d;d=c.Za/8;c.x+=d*a;c.y=c.y;c.Za=d;c.Ta=
c.Ta;m(c,.02,c);return c}var k=p("__graph");p("__print");var n=[5,19,3,10,4,3,5],g=null,x=[0,0];a.init=function(a){a=a.getContext("2d");d(a);return g=a};a.gl=function(){g&&d(g)};a.reset=function(){var a=g;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),x[0]=0,x[1]=0)};a.rF=function(a,d){var e=g;if(e){e.textAlign="left";e.fillStyle="rgba(0,255,0,255)";c(" FPS",(1/d).toFixed(2));x[0]++;for(var k=e=0,m=0,n=0;n<a.length;n++){var q=
b(a[n]),e=e+q[0],k=k+q[1],m=m+q[2];x[0]++}c(" -----------------------------------------------");c("    ","TOTAL ACTIVE","","",k,"of",e,"  ",m.toFixed(3))}};a.print=function(){var a=g;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",c.apply(Math,arguments))};a.plot_array=function(a,b,c,d,k,m,q){var z=g;if(z){b=t(b);var u=b.Ta/5;b.x=b.x;b.y+=4*u;b.Za=b.Za;b.Ta=u;z.textAlign="center";z.fillStyle="#00FF00";g.fillText(a,e(b),b.y-10);z.strokeStyle="#00FF00";z.lineWidth=.5;z.beginPath();z.moveTo(b.x,
b.y);z.lineTo(b.x+b.Za,b.y);z.lineTo(b.x+b.Za,b.y+b.Ta);z.lineTo(b.x,b.y+b.Ta);z.closePath();z.stroke();if(!m&&!q)for(m=1E6,q=-1E6,a=0;a<c.length;a++)m=Math.min(m,c[a]),q=Math.max(q,c[a]);z.textAlign="right";g.fillText(String(m),b.x-10,b.y+b.Ta);g.fillText(String(q),b.x-10,b.y);z.textAlign="center";g.fillText(String(d),b.x,b.y+b.Ta+15);g.fillText(String(k),b.x+b.Za,b.y+b.Ta+15);z.strokeStyle="#FF0000";z.lineWidth=1.5;z.beginPath();d=b.Za/(c.length-1);q=b.Ta/(q-m);for(a=0;a<c.length;a++)k=b.x+d*a,
u=b.y+b.Ta-(c[a]-m)*q,0==a?z.moveTo(k,u):z.lineTo(k,u);z.stroke()}};a.draw_mixer_strip=function(a,b,c,d,k,m,q){var z=g;if(z)for(z.textAlign="center",z.fillStyle="#00FF00",z.font="bold 12px Courier",c=t(c),g.fillText(b?"["+a+"]":a,e(c),c.y),0<=m&&g.fillText(m?"[M]":"[ ]",e(c)-15,c.y+30),0<=q&&g.fillText(q?"[S]":"[ ]",e(c)+15,c.y+30),a={x:0,y:0,Za:0,Ta:0},b=0;b<d.length;b++){m=d[b];var u="VOLUME"==m[0];if(u){q=c.y+350;var r=c.Za,f=a;f.x=c.x;f.y=q;f.Za=r;f.Ta=250}else{q=c.y+10+50*b;var r=c.Za,f=c.Ta,
n=a;n.x=c.x;n.y=q;n.Za=r;n.Ta=f}q=z;var r=a,n=b==k,w=m[0],f=m[1],x=m[2],O=m[3],K=(O-x)/m[4],K=1>K?Math.floor(1/K-1E-5).toFixed(0).length:0;m=m[5]?Math.log(f/x)/Math.log(O/x):(f-x)/(O-x);q.textAlign="center";n?q.fillText("["+w+"]",e(r),r.y):q.fillText(w,e(r),r.y);q.strokeStyle="#00FF00";q.lineWidth=u?3:1;u?(q.textAlign="right",q.fillText(O.toFixed(K),e(r)-10,r.y+15),q.textAlign="right",q.fillText(x.toFixed(K),e(r)-10,r.y+r.Ta-15)):(q.textAlign="right",q.fillText(x.toFixed(K),r.x+28,r.y+15),q.textAlign=
"left",q.fillText(O.toFixed(K),r.x+r.Za-28,r.y+15));q.beginPath();if(u){var F=r.y+15+(r.Ta-30)*(1-m);q.moveTo(e(r),r.y+15);q.lineTo(e(r),r.y+r.Ta-15);q.moveTo(e(r)-5,r.y+15);q.lineTo(e(r)+5,r.y+15);q.moveTo(e(r)-5,r.y+r.Ta-15);q.lineTo(e(r)+5,r.y+r.Ta-15);q.moveTo(e(r)-5,F);q.lineTo(e(r)+5,F)}else{var Q=r.x+30+(r.Za-60)*m;q.moveTo(r.x+30,r.y+15);q.lineTo(r.x+r.Za-30,r.y+15);q.moveTo(r.x+30,r.y+15-5);q.lineTo(r.x+30,r.y+15+5);q.moveTo(r.x+r.Za-30,r.y+15-5);q.lineTo(r.x+r.Za-30,r.y+15+5);q.moveTo(Q,
r.y+15-5);q.lineTo(Q,r.y+15+5)}q.stroke();"EQ_Q"==w?(m=Math.log(1+1/(2*f*f)+Math.sqrt((2+1/(f*f))*(2+1/(f*f))/4-1))/Math.log(2),u?(q.textAlign="left",q.fillText(f.toFixed(K),e(r)+10,F),q.textAlign="left",q.fillText("("+m.toFixed(K+1)+")",e(r)+10,F+10)):(q.textAlign="right",q.fillText(f.toFixed(K),Q,r.y+30),q.textAlign="left",q.fillText("("+m.toFixed(K+1)+")",Q,r.y+30))):u?(q.textAlign="left",q.fillText(f.toFixed(K),e(r)+10,F)):(q.textAlign="center",q.fillText(f.toFixed(K),Q,r.y+30))}}};b4w.module.__renderer=function(a,p){function d(a){for(var b=a.j,d=a.q,e=0;e<d.length;e++){var l=d[e];if(l.yb){var k=a,h=b,g=l.Rd,q=l.D,D=q.Sb;u.useProgram(D.vh);for(var l=q.S,n=q.Ml,t=D.Hw,I=t.length;I--;){var y=t[I];y.tp(u,y.fh,k,g,q,h)}h=q.Ys;u.colorMask(h,h,h,h);u.depthMask(q.ha);q.hb?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE);h=q.Z;for(q=0;q<h.length;q++)t=h[q],u.activeTexture(u.TEXTURE0+q),u.bindTexture(t.Bb,t.Oa);if("SKY"==k.type){h=k;D=D.Eh;q=h.j.xb.Oa;t=h.Xj;for(I=0;6>I;I++)if(y=m(I),v.Fo?
(u.bindTexture(u.TEXTURE_CUBE_MAP,q),u.texImage2D(y,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,z)):(u.uniformMatrix4fv(D.u_cube_view_matrix,!1,t[I]),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,y,q,0),c(l,n,g.Jr)),h.Sm&&3!=I){var y=h,x=I,T=r;v.Fo?T.set(z):(u.readPixels(191,191,1,1,u.RGBA,u.UNSIGNED_BYTE,T),255!=T[0]&&255!=T[1]&&255!=T[2]||u.readPixels(191,220,1,1,u.RGBA,u.UNSIGNED_BYTE,T));var R=T[0],B=T[1],T=T[2],R=R/255,B=B/255,T=T/255;2===x?(y.Rc[3]=R,y.Rc[7]=B,y.Rc[11]=T):2>x?(y.Rc[4*x]=
R,y.Rc[4*x+1]=B,y.Rc[4*x+2]=T):(y.Rc[4*(x-2)]=R,y.Rc[4*(x-2)+1]=B,y.Rc[4*(x-2)+2]=T)}k.Yj+=6}else c(l,n,g.Jr),k.Yj++}}}function b(a){if(a){var b=(a.Ba?u.COLOR_BUFFER_BIT:0)|(a.Da?u.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=q;break;case "SHADOW_CAST":a=C;break;case "DEPTH":a=A;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=B;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=q;break;default:a=v.background_color}}else b=
u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT,a=v.background_color;u.colorMask(!0,!0,!0,!0);u.depthMask(!0);u.clearColor(a[0],a[1],a[2],a[3]);u.clear(b)}function c(a,b,c){u.bindBuffer(u.ARRAY_BUFFER,a.jg);for(var d=0;d<b.length;d++){var e=b[d];u.enableVertexAttribArray(e.fh);u.vertexAttribPointer(e.fh,e.oe,u.FLOAT,!1,0,e.zz+e.LB*c)}a.Ve?(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.Ve),u.drawElements(a.mode,a.count,a.Jp,0)):u.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],u.disableVertexAttribArray(e.fh)}
function m(a){switch(a){case 0:return u.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return u.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return u.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return u.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return u.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return u.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function e(a){var b=a.Eh,c=[],d=[],e={},k;for(k in b){var h=!1;switch(k){case "u_proj_matrix":var g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.lb)},h=!0;break;case "u_view_matrix":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,
!1,f.Ja)};h=!0;break;case "u_view_tsr":case "u_view_tsr_frag":g=function(a,b,c,d,e,f){a.uniformMatrix3fv(b,!1,f.lg)};h=!0;break;case "u_shadow_cast_billboard_view_tsr":g=function(a,b,c,d,e,f){a.uniformMatrix3fv(b,!1,f.Zv)};h=!0;break;case "u_view_proj_prev":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.sE)};h=!0;break;case "u_view_proj_matrix":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Yd)};h=!0;break;case "u_view_proj_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.ix)};h=!0;
break;case "u_sky_vp_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.re)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,b,c,d,e,f){a.uniform3fv(b,l.get_trans_view(f.h))};h=!0;break;case "u_camera_quat":g=function(a,b,c,d,e,f){a.uniform4fv(b,l.get_quat_view(f.h))};h=!0;break;case "u_view_max_depth":g=function(a,b,c,d,e,f){a.uniform1f(b,f.rb)};h=!0;break;case "u_camera_range":g=function(a,b,c,d,e,f){a.uniform2f(b,f.ub,f.rb)};break;case "u_csm_center_dists":g=function(a,
b,c,d,e,f){a.uniform4fv(b,f.it)};break;case "u_cam_water_depth":g=function(a,b,c){a.uniform1f(b,c.zo)};h=!0;break;case "u_waves_height":g=function(a,b,c){a.uniform1f(b,c.pg)};break;case "u_waves_length":g=function(a,b,c){a.uniform1f(b,c.Ph)};break;case "u_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.lc)};break;case "u_fog_params":g=function(a,b,c){a.uniform4fv(b,c.sm)};break;case "u_underwater_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.Zd)};break;case "u_bloom_key":g=function(a,
b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":g=function(a,b,c){a.uniform1f(b,c.time)};h=!0;break;case "u_wind":g=function(a,b,c){a.uniform3fv(b,c.lf)};h=!0;break;case "u_sky_tex_dvar":g=function(a,b,c){a.uniform1f(b,c.dw)};break;case "u_sky_tex_fac":g=function(a,b,c){a.uniform4fv(b,c.ew)};break;case "u_sky_tex_color":g=function(a,b,c){a.uniform3fv(b,c.cw)};break;case "u_horizon_color":g=function(a,b,c){a.uniform3fv(b,
c.Hf)};break;case "u_zenith_color":g=function(a,b,c){a.uniform3fv(b,c.rg)};break;case "u_environment_energy":g=function(a,b,c){a.uniform1f(b,c.Df)};break;case "u_sky_color":g=function(a,b,c){a.uniform3fv(b,c.$i)};break;case "u_rayleigh_brightness":g=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":g=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":g=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":g=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":g=function(a,b,c){a.uniform3fv(b,c.Nm)};break;case "u_light_directions":g=function(a,b,c){a.uniform3fv(b,c.aq)};break;case "u_light_color_intensities":g=function(a,b,c){a.uniform3fv(b,c.Mm)};break;case "u_light_factors":g=function(a,b,c){a.uniform4fv(b,c.bq)};break;case "u_sun_quaternion":g=function(a,b,c){a.uniform4fv(b,c.vw)};break;case "u_sun_intensity":g=function(a,b,c){a.uniform3fv(b,c.uw)};break;case "u_sun_direction":g=function(a,b,c){a.uniform3fv(b,c.nr)};break;case "u_height":g=
function(a,b,c,d,e,f){a.uniform1f(b,f.height)};h=!0;break;case "u_model_tsr":g=function(a,b,c,d){a.uniformMatrix3fv(b,!1,d.h)};h=!0;break;case "u_transb":g=function(a,b,c,d){a.uniform4fv(b,d.Lc)};h=!0;break;case "u_transa":g=function(a,b,c,d){a.uniform4fv(b,d.ld)};h=!0;break;case "u_arm_rel_trans":g=function(a,b,c,d){a.uniform4fv(b,d.eo)};h=!0;break;case "u_arm_rel_quat":g=function(a,b,c,d){a.uniform4fv(b,d.co)};h=!0;break;case "u_quat":g=function(a,b,c,d){c=l.get_quat_view(d.h);a.uniform4fv(b,c)};
h=!0;break;case "u_quatsb":g=function(a,b,c,d){a.uniform4fv(b,d.Fc)};h=!0;break;case "u_quatsa":g=function(a,b,c,d){a.uniform4fv(b,d.dd)};h=!0;break;case "u_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Ad)};h=!0;break;case "au_center_pos":g=function(){};h=!0;break;case "au_wind_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.ze)};h=!0;break;case "au_wind_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.mf)};h=!0;break;case "au_detail_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.Le)};h=
!0;break;case "au_detail_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.Ke)};h=!0;break;case "au_branch_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.Fe)};h=!0;break;case "u_node_values":g=function(a,b,c,d){a.uniform1fv(b,d.Ye)};h=!0;break;case "u_node_rgbs":g=function(a,b,c,d){a.uniform3fv(b,d.$c)};h=!0;break;case "u_diffuse_color":g=function(a,b,c,d,e){a.uniform4fv(b,e.yc)};h=!0;break;case "u_diffuse_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.Bf)};h=!0;break;case "u_diffuse_params":g=
function(a,b,c,d,e){a.uniform2fv(b,e.Tc)};h=!0;break;case "u_emit":g=function(a,b,c,d,e){a.uniform1f(b,e.Oe)};h=!0;break;case "u_ambient":g=function(a,b,c,d,e){a.uniform1f(b,e.Ce)};h=!0;break;case "u_specular_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.se)};h=!0;break;case "u_specular_alpha":g=function(a,b,c,d,e){a.uniform1f(b,e.fr)};h=!0;break;case "u_specular_params":g=function(a,b,c,d,e){a.uniform3fv(b,e.Kc)};h=!0;break;case "u_reflect_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.reflect_factor)};
h=!0;break;case "u_mirror_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.kq)};h=!0;break;case "u_grass_map_dim":g=function(a,b,c,d,e){a.uniform3fv(b,e.zc)};h=!0;break;case "u_grass_size":g=function(a,b,c,d,e){a.uniform1f(b,e.Cp)};h=!0;break;case "u_scale_threshold":g=function(a,b,c,d,e){a.uniform1f(b,e.eu)};h=!0;break;case "u_cube_fog":g=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.Rc)};break;case "u_jitter_amp":g=function(a,b,c,d,e){a.uniform1f(b,e.Au)};h=!0;break;case "u_jitter_freq":g=function(a,
b,c,d,e){a.uniform1f(b,e.Bu)};h=!0;break;case "u_wireframe_mode":g=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":g=function(a,b,c){a.uniform2fv(b,c.dD)};h=!0;break;case "u_subsample_indices":g=function(a,b,c){a.uniform4fv(b,c.eD)};h=!0;break;case "u_refr_bump":g=function(a,b,c,d,e){a.uniform1f(b,e.Hv)};h=!0;break;case "u_lamp_light_positions":g=function(a,b,c,d,e){a.uniform3fv(b,
e.Xp)};break;case "u_lamp_light_directions":g=function(a,b,c,d,e){a.uniform3fv(b,e.Vp)};break;case "u_lamp_light_color_intensities":g=function(a,b,c,d,e){a.uniform3fv(b,e.Up)};break;case "u_lamp_light_factors":g=function(a,b,c,d,e){a.uniform4fv(b,e.Wp)};break;case "u_halo_size":g=function(a,b,c,d,e){a.uniform1f(b,e.ku)};h=!0;break;case "u_halo_hardness":g=function(a,b,c,d,e){a.uniform1f(b,e.hu)};h=!0;break;case "u_halo_rings_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.ju)};h=!0;break;case "u_halo_lines_color":g=
function(a,b,c,d,e){a.uniform3fv(b,e.iu)};h=!0;break;case "u_halo_stars_blend":g=function(a,b,c,d,e){a.uniform1f(b,e.lu)};h=!0;break;case "u_halo_stars_height":g=function(a,b,c,d,e){a.uniform1f(b,e.mu)};h=!0;break;case "u_fresnel_params":g=function(a,b,c,d,e){a.uniform4fv(b,e.Pd)};h=!0;break;case "u_texture_scale":g=function(a,b,c,d,e){a.uniform3fv(b,e.fg)};h=!0;break;case "u_parallax_scale":g=function(a,b,c,d,e){a.uniform1f(b,e.parallax_scale)};h=!0;break;case "u_color_id":g=function(a,b,c,d){a.uniform3fv(b,
d.Zl)};h=!0;break;case "u_line_points":g=function(a,b,c,d,e){a.uniform3fv(b,e.CJ)};h=!0;break;case "u_diffuse_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Af)};h=!0;break;case "u_alpha_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.rf)};h=!0;break;case "u_specular_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Ch)};h=!0;break;case "u_normal_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Zu)};h=!0;break;case "u_normalmap0_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.nh[0])};h=!0;break;case "u_normalmap1_scale":g=
function(a,b,c,d,e){a.uniform2fv(b,e.nh[1])};h=!0;break;case "u_normalmap2_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.nh[2])};h=!0;break;case "u_normalmap3_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.nh[3])};h=!0;break;case "u_foam_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":g=function(a,b,c,d,e){a.uniform2fv(b,e.Ft)};h=!0;break;case "u_foam_mag":g=function(a,b,c,d,e){a.uniform2fv(b,e.Et)};h=!0;break;case "u_foam_scale":g=function(a,b,c,d,e){a.uniform2fv(b,
e.op)};h=!0;break;case "u_water_norm_uv_velocity":g=function(a,b,c,d,e){a.uniform1f(b,e.uj)};h=!0;break;case "u_shallow_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};h=!0;break;case "u_shore_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};h=!0;break;case "u_p_length":g=
function(a,b,c,d,e){a.uniform1f(b,e.za.Cw)};h=!0;break;case "u_p_cyclic":g=function(a,b,c,d,e){a.uniform1i(b,e.za.cyclic)};h=!0;break;case "u_p_max_lifetime":g=function(a,b,c,d,e){a.uniform1f(b,e.za.Hu)};h=!0;break;case "u_p_fade_in":g=function(a,b,c,d,e){a.uniform1f(b,e.za.Rg)};h=!0;break;case "u_p_fade_out":g=function(a,b,c,d,e){a.uniform1f(b,e.za.Uc)};h=!0;break;case "u_p_size":g=function(a,b,c,d,e){a.uniform1f(b,e.za.size)};h=!0;break;case "u_p_alpha_start":g=function(a,b,c,d,e){a.uniform1f(b,
e.za.ps)};h=!0;break;case "u_p_alpha_end":g=function(a,b,c,d,e){a.uniform1f(b,e.za.os)};h=!0;break;case "u_p_nfactor":g=function(a,b,c,d,e){a.uniform1f(b,e.za.pq)};h=!0;break;case "u_p_gravity":g=function(a,b,c,d,e){a.uniform1f(b,e.za.fu)};h=!0;break;case "u_p_mass":g=function(a,b,c,d,e){a.uniform1f(b,e.za.le)};h=!0;break;case "u_p_size_ramp":g=function(a,b,c,d,e){a.uniform2fv(b,e.za.$v)};h=!0;break;case "u_p_color_ramp":g=function(a,b,c,d,e){a.uniform4fv(b,e.za.Zs)};h=!0;break;case "u_p_wind_fac":g=
function(a,b,c,d,e){a.uniform1f(b,e.za.ox)};h=!0;break;case "u_texel_size":g=function(a,b,c){a.uniform2fv(b,c.wr)};h=!0;break;case "u_p_time":g=function(a,b,c,d,e){a.uniform1f(b,e.za.time)};h=!0;break;case "u_position":g=function(a,b,c,d,e){a.uniform3fv(b,e.Qi)};h=!0;break;case "u_va_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Xw)};h=!0;break;case "u_perspective_cast_far_bound":g=function(a,b,c){a.uniform1f(b,c.eE)};break;case "u_normal_offset":g=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};
break;case "u_pcf_blur_radii":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.an)};break;case "u_v_light_tsr":g=function(a,b,c){a.uniformMatrix3fv(b,!1,c.Ww)};h=!0;break;case "u_p_light_matrix0":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.sh[0])};h=!0;break;case "u_p_light_matrix1":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.sh[1])};h=!0;break;case "u_p_light_matrix2":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.sh[2])};h=!0;break;case "u_p_light_matrix3":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.sh[3])};
h=!0;break;case "u_motion_blur_exp":g=function(a,b,c){a.uniform1f(b,c.Tu)};h=!0;break;case "u_motion_blur_decay_threshold":g=function(a,b,c){a.uniform1f(b,c.mb_decay_threshold)};h=!0;break;case "u_refl_plane":g=function(a,b,c,d){a.uniform4fv(b,d.pc)};h=!0;break;case "u_radial_blur_step":g=function(a,b,c){a.uniform1f(b,c.hn)};break;case "u_god_rays_intensity":g=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=function(a,b,c){a.uniform1f(b,c.dj)};break;case "u_ssao_blur_discard_value":g=
function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":g=function(a,b,c){a.uniform1f(b,c.cj)};break;case "u_ssao_dist_factor":g=function(a,b,c){a.uniform1f(b,c.bj)};break;case "u_dof_dist":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_distance)};h=!0;break;case "u_dof_front":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_front)};h=!0;break;case "u_dof_rear":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_rear)};h=!0;break;case "u_outline_intensity":g=function(a,b,c,d){a.uniform1f(b,
d.Rf)};h=!0;break;case "u_outline_color":g=function(a,b,c){a.uniform3fv(b,c.af)};break;case "u_draw_outline":g=function(a,b,c){a.uniform1f(b,c.fp)};h=!0;break;case "u_glow_mask_small_coeff":g=function(a,b,c){a.uniform1f(b,c.small_glow_mask_coeff)};h=!0;break;case "u_glow_mask_large_coeff":g=function(a,b,c){a.uniform1f(b,c.large_glow_mask_coeff)};h=!0;break;case "u_brightness":g=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c){a.uniform1f(b,c.contrast)};break;
case "u_exposure":g=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:g=null}g&&(g={name:k,tp:g,fh:b[k]},h?c.push(g):(d.push(g),e[k]=g))}a.Hw=c;a.Jk=d;a.zq=e}var t=p("__batch"),k=p("__camera"),n=p("__config"),g=p("__debug"),x=p("__textures"),l=p("__tsr"),h=p("__util"),v=n.p,C=[1,1,1,1],A=[1,1,1,1],B=[0,0,0,1],q=[0,0,0,0],z=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);
new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var u=null,r=new Uint8Array(4);new Float32Array(9);new Float32Array(8);v=n.p;a.gd=function(a){var b=v.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);u=a};a.dk=function(a){if(a.yb){g.DE(a);if("RESOLVE"==a.type){var c=a.j;u.bindFramebuffer(u.READ_FRAMEBUFFER,c.rp);
u.bindFramebuffer(u.DRAW_FRAMEBUFFER,c.Od);u.blitFramebuffer(0,0,c.width,c.height,0,0,c.width,c.height,u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT,u.NEAREST);g.Do("draw resolve")}else if("COPY"==a.type)c=a.j,u.bindFramebuffer(u.FRAMEBUFFER,c.rp),u.bindTexture(u.TEXTURE_2D,c.xb.Oa),u.copyTexSubImage2D(u.TEXTURE_2D,0,0,0,0,0,c.width,c.height,0),g.Do("draw copy");else{c=a.j;u.bindFramebuffer(u.FRAMEBUFFER,c.Od);if(a.fo){var h=c.xb;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,h.Bb,h.Oa,0)}u.viewport(0,
0,c.width,c.height);"MAIN_CUBE_REFLECT"!=a.type&&b(a);a.Ua?u.enable(u.BLEND):u.disable(u.BLEND);a.ec?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST);if(a.ya){for(var c=a.j,h=a.q,q=0;q<h.length;q++){var r=h[q],n=r.D,z=n.Sb;u.useProgram(z.vh);r=r.Rd;z.Jk.length||e(z);for(var z=z.Jk,t=z.length;t--;){var x=z[t];x.tp(u,x.fh,a,r,n,c)}}a.ya=!1}switch(a.type){case "DEPTH":v.su?(u.enable(u.POLYGON_OFFSET_FILL),u.polygonOffset(5,5)):u.disable(u.POLYGON_OFFSET_FILL);u.cullFace(u.BACK);break;case "SHADOW_CAST":u.enable(u.POLYGON_OFFSET_FILL);
u.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);u.cullFace(u.BACK);break;case "MAIN_PLANE_REFLECT":u.disable(u.POLYGON_OFFSET_FILL);u.cullFace(u.FRONT);break;case "MAIN_GLOW":if(1<v.nc){u.enable(u.POLYGON_OFFSET_FILL);u.polygonOffset(-2,-2);break}default:u.disable(u.POLYGON_OFFSET_FILL),u.cullFace(u.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(c=a.j,h=c.xb.Oa,q=0;6>q;q++){n=m(q);c.Ja=a.Xj[q];l.from_mat4(c.Ja,c.lg);k.yo(c);u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,
n,h,0);b(a);n=a.q;for(r=0;r<n.length;r++)n[r].yb=n[r].ep[q];d(a)}else d(a);g.Do("draw subscene: "+a.type);u.bindFramebuffer(u.FRAMEBUFFER,null)}g.EE(a)}};a.clear=function(a){u.bindFramebuffer(u.FRAMEBUFFER,a.j.Od);b(a)};a.vs=function(a){var b=a.Ml;b.length=0;var c=a.S;a=a.Sb;c&&a||h.O("Incomplete batch");c=c.Yb;a=a.attributes;for(var d in a){var e=c[d];b.push({fh:a[d],zz:4*e.offset,LB:1<e.frames?4*e.length:0,oe:e.oe})}};a.xz=e;a.xs=function(a){var b=a.Sb,c=a.Z;a=a.$b;u.useProgram(b.vh);for(var d=
0;d<c.length;d++)u.uniform1i(b.Eh[a[d]],d)};a.Fv=function(a,b,c,d,e,l){d||(d=1);e||(e=1);l||(l=new Uint8Array(4*d*e));l.length!=4*d*e&&h.O("read_pixels(): Wrong storage");u.bindFramebuffer(u.FRAMEBUFFER,a);u.readPixels(b,c,d,e,u.RGBA,u.UNSIGNED_BYTE,l);u.bindFramebuffer(u.FRAMEBUFFER,null);return l};a.iG=function(a){var b=a.Sb;u.useProgram(b.vh);b.Jk.length||e(b);b=b.zq.u_cube_fog;b.tp(u,b.fh,null,null,a,null)};a.CE=function(a,b){var c=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,c);if(x.ui(a)){var d=
a.pd;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.RENDERBUFFER,d)}else if(x.wi(a)){var e=a,d=e.Oa,e=e.Bb==u.TEXTURE_CUBE_MAP?u.TEXTURE_CUBE_MAP_NEGATIVE_Z:e.Bb;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,e,d,0)}x.ui(b)?(d=b.pd,u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,d)):x.wi(b)&&(e=b,d=e.Oa,e=e.Bb,u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,e,d,0));g.Wz();u.bindFramebuffer(u.FRAMEBUFFER,null);return c};a.BE=function(a,b,c,
d,e){null==a?(u.bindFramebuffer(u.FRAMEBUFFER,a),u.viewport(0,0,d,e),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT)):(x.ui(b)?u.deleteRenderbuffer(b.pd):x.wi(b)&&u.deleteTexture(b.Oa),x.ui(c)?u.deleteRenderbuffer(c.pd):x.wi(c)&&u.deleteTexture(c.Oa),u.deleteFramebuffer(a))};a.mJ=function(){};a.nB=function(a,b,d,e,l,h){a=a.Oa;u.viewport(0,0,d,d);u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,b,a,0);b=t.Qo("FLIP_CUBEMAP_COORDS");a=b.Sb;u.activeTexture(u.TEXTURE0);u.bindTexture(u.TEXTURE_2D,
l);var k=l=0;d!=e&&(l=1/(6*e),k=1/(4*e));u.uniform1i(a.Eh.u_tex_number,h);u.uniform2fv(a.Eh.u_delta,[l,k]);u.useProgram(a.vh);c(b.S,b.Ml,0);u.bindTexture(u.TEXTURE_2D,null)};a.oB=function(a,b,d,e,l){u.bindFramebuffer(u.FRAMEBUFFER,e);e=a.Oa;a=a.Bb;u.bindTexture(a,e);u.viewport(0,0,b,d);u.texImage2D(a,0,u.RGBA,b,d,0,u.RGBA,u.UNSIGNED_BYTE,null);u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,a,e,0);b=t.Qo("NONE");d=b.Sb;u.bindTexture(a,null);u.activeTexture(u.TEXTURE0);u.bindTexture(a,l);
u.useProgram(d.vh);c(b.S,b.Ml,0);u.bindFramebuffer(u.FRAMEBUFFER,null);u.bindTexture(a,null)};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function d(a,c,d){var e=a.Cf;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.Cf,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function c(a,b){var c=a+b;if(q[c])return q[c];if(z){var d=z[b];if(!d)return null;d=p("__gpp_parser").NJ.parse(d)}else if(d=p("shader_texts")[b],!d)return null;return q[c]=d}function m(a,b,d){function f(b){b=b.a;for(var d=0;d<b.length;d++){var m=
b[d];switch(m.type){case "condition":a:for(var m=m.a,T=0;T<m.length;T++){var E=m[T];switch(E.type){case "if":case "elif":if(l(E.c)){f(E.group);break a}break;case "else":f(E.group);break a;case "ifdef":E.name in q&&f(E.group);break;case "ifndef":E.name in q||f(E.group)}}break;case "include":m=c(A.shaders_dir,A.pF+m.file);f(m);break;case "var":case "export":case "import":break;case "define":T=m.name;q[T]=m.b;m.M&&(r[T]=m.M);break;case "error":throw"Shader error: #error "+m.b.join(" ");case "line":break;
case "pragma":g.push("#pragma "+m.name+" "+m.b.join(" "));break;case "undef":m=m.name;delete q[m];delete r[m];break;case "warning":v.warn("Shader warning: #warning "+m.b.join(" "));break;case "extension":m=e(m.b,q,r,!1);g.push("#extension "+m.join(" "));break;case "#":break;case "node":n[m.name]=m;break;case "nodes_global":m=k;for(T=0;T<m.length;T++){var E=m[T],B=n[E.id];if(B)for(var p=0,O=0;O<B.i.length;O++){var L=B.i[O];"node_param"==L.type&&(L=L.qualifier.join(" ")+" ","vert"==a?L+=E.mg[p]:"frag"==
a&&(L+=E.M[p],null!==E.Ym[p]&&(L+=" = "+E.Ym[p])),L+=";",g.push(L),p++)}}break;case "nodes_main":m=k;for(T=0;T<m.length;T++)if(E=m[T],B=n[E.id]){p={};O={};for(L=0;L<E.xd.length;L++)O[E.xd[L][0]]=[E.xd[L][1]];x=t=u=0;for(var L=E,U=B.i,ga=p,P=O,C=0;C<U.length;C++){var M=U[C];switch(M.type){case "node_in":var N=L.F[u];if(null!==L.Np[u]){if(("MATERIAL_BEGIN"==L.id&&3===u||!P.MATERIAL_EXT&&("MATERIAL_BEGIN"==L.id&&4===u||"MATERIAL_END"==L.id&&3===u||"MATERIAL_END"==L.id&&4===u||"MATERIAL_END"==L.id&&5===
u)||"TEXTURE_COLOR"==L.id||"TEXTURE_NORMAL"==L.id)&&M.e){ga[M.name]=L.Np[u];u++;continue}var da=M.qualifier.join(" ")+" ",da=da+N,da=da+(" = "+L.Np[u]),da=da+";";g.push(da)}ga[M.name]=N;u++;break;case "node_out":N=L.ra[t];if(!M.e||-1<z.indexOf(N))da=M.qualifier.join(" ")+" ",da+=N,da+=";",g.push(da),ga[M.name]=N;-1<z.indexOf(N)&&(P["USE_OUT_"+M.name]=[1]);t++;break;case "node_param":"vert"==a?N=L.mg[x]:"frag"==a&&(N=L.M[x]),ga[M.name]=N,x++}}g.push("{");h(E,B.g,p,O);g.push("}")}break;case "textline":m=
e(m.b,q,r,!1);g.push(m.join(" "));break;default:throw"Unknown element type: "+m.type;}}}function l(a,b){var c;c=e(a,q,r,!0,b);for(var d=[],f=0;f<c.length;f++)if(c[f]instanceof Object)switch(c[f].type){case "conditional_expr":var h=d.pop(),k=d.pop();d.pop()?d.push(k):d.push(h);break;case "logical_or_expr":h=d.pop();for(k=0;k<c[f].d-1;k++)g=d.pop(),h=h||g;d.push(h);break;case "logical_and_expr":h=d.pop();for(k=0;k<c[f].d-1;k++)g=d.pop(),h=h&&g;d.push(h);break;case "logical_bitor_expr":h=d.pop();for(k=
0;k<c[f].d-1;k++)h|=d.pop();d.push(h);break;case "logical_bitxor_expr":h=d.pop();for(k=0;k<c[f].d-1;k++)h^=d.pop();d.push(h);break;case "logical_bitand_expr":h=d.pop();for(k=0;k<c[f].d-1;k++)h&=d.pop();d.push(h);break;case "equal_expr":h=d.pop();k=d.pop();d.push(k==h);break;case "non_equal_expr":h=d.pop();k=d.pop();d.push(k!=h);break;case "le_expr":h=d.pop();k=d.pop();d.push(k<=h);break;case "ge_expr":h=d.pop();k=d.pop();d.push(k>=h);break;case "l_expr":h=d.pop();k=d.pop();d.push(k<h);break;case "g_expr":h=
d.pop();k=d.pop();d.push(k>h);break;case "left_shift_expr":k=d.pop();h=d.pop();d.push(k<<h);break;case "right_shift_expr":k=d.pop();h=d.pop();d.push(k>>h);break;case "add_expr":k=d.pop();h=d.pop();d.push(k+h);break;case "sub_expr":k=d.pop();h=d.pop();d.push(k-h);break;case "mul_expr":k=d.pop();h=d.pop();d.push(k*h);break;case "div_expr":k=d.pop();h=d.pop();d.push(k/h);break;case "mod_expr":k=d.pop();h=d.pop();d.push(k%h);break;case "pre_inc_expr":case "post_inc_expr":g=d.pop();d.push(++g);break;case "pre_dec_expr":case "post_dec_expr":g=
d.pop();d.push(--g);break;case "positive_expr":g=d.pop();d.push(+g);break;case "negative_expr":g=d.pop();d.push(-g);break;case "one_compl_expr":g=d.pop();d.push(~g);break;case "logic_negative_expr":g=d.pop();d.push(!g);break;default:C.O("Unknown operation type: "+c[f].type)}else{var g=c[f];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(g)?d.push(0):d.push(parseFloat(c[f]))}1==d.length?c=d[0]:(C.O("Incorrect expression: "+c.join(" ")),c=void 0);return c}function h(a,b,c,d){for(var f=0;f<b.length;f++){var k=b[f];
switch(k.type){case "node_condition":a:for(var m=a,k=k.a,T=c,L=d,u=0;u<k.length;u++){var n=k[u];switch(n.type){case "node_if":case "node_elif":if(l(n.c,L)){h(m,n.g,T,L);break a}break;case "node_else":h(m,n.g,T,L);break a;case "node_ifdef":(n.name in q||n.name in L)&&h(m,n.g,T,L);break;case "node_ifndef":n.name in q||n.name in L||h(m,n.g,T,L)}}break;case "textline":m=[];for(T=0;T<k.b.length;T++)L=k.b[T],L in c?m.push(c[L]):m.push(L);m=e(m,q,r,!0,d);g.push(m.join(" "))}}}var k=d.Of;d=d.Cf||[];for(var g=
[],q={},m=0;m<d.length;m++)q[d[m][0]]=[d[m][1]];for(m=0;m<k.length;m++)q["USE_NODE_"+k[m].id]=[1];var r={},n={},z=[];for(m in k)for(var T in k[m].F)z.push(k[m].F[T]);f(b);var u=0,t=0,x=0;return g.join("\n")}function e(a,b,c,d,e){var f=[];t(a,b,c,d,f,e);return f}function t(a,b,c,d,e,f){for(var h=0;h<a.length;h++){var l=a[h];l in b||f&&l in f?(l=f&&f[l]||b[l],0==l.length&&d?e.push(0):t(l,b,c,d,e,f)):e.push(l)}}function k(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);h.bA(d,b,c);
return d}function n(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return g(a);case 2:return"vec2("+g(a[0])+","+g(a[1])+")";case 3:return"vec3("+g(a[0])+","+g(a[1])+","+g(a[2])+")";case 4:return"vec4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+")";case 9:return"mat3("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+")";case 16:return"mat4("+g(a[0])+","+g(a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(a[5])+","+g(a[6])+","+g(a[7])+
","+g(a[8])+","+g(a[9])+","+g(a[10])+","+g(a[11])+","+g(a[12])+","+g(a[13])+","+g(a[14])+","+g(a[15])+")";default:throw"Wrong glsl value dimension";}}function g(a){return a%1?String(a):String(a)+".0"}var x=p("__assets"),l=p("__config"),h=p("__debug"),v=p("__print"),C=p("__util"),A=l.oc,B={},q={},z=null,u="anchors.glslf anchors.glslv color_id.glslf color_id.glslv depth.glslf depth.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv main.glslf main.glslv main_stack.glslf main_stack.glslv particles_color.glslf particles_color.glslv particles_texture.glslf particles_texture.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/anaglyph.glslf postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf include/blending.glslf include/caustics.glslf include/color_util.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/fxaa.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
r=[],f=null,E=!1;a.gd=function(a){f=a};a.I=d;a.qC=b;a.vJ=function(a,b){for(var c=a.Cf,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.UE=function(a){a.Cf=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PERSPECTIVE_SHADOW_CAST PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_FOG WEBGL2 WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var e=b[c],f;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PERSPECTIVE_SHADOW_CAST":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_FOG":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":f=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":f=1;break;case "WEBGL2":f=l.p.sc|0;break;case "EPSILON":f="highp"==l.p.precision?1E-6:1E-4;break;case "SHADOW_TEX_RES":f=n(2048);break;case "AA_METHOD":f="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":f="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":f="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":f=
"POST_EFFECT_NONE";break;case "SHADOW_USAGE":f="NO_SHADOWS";break;case "SSAO_QUALITY":f="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":f="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":f="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":f=l.p.precision;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":f="u_va_frame_factor";break;default:v.error("Unknown directive ("+a.sj+", "+a.ji+"): "+e)}d(a,e,f)}};a.fJ=function(a){return a.sj};a.YI=function(a){return a.ji};a.nJ=function(a,c){for(var e=c.Cf,f=0;f<
e.length;f++){var h=e[f][0],l=e[f][1];b(a,h)&&d(a,h,l)}};a.mC=function(a){var b=JSON.stringify(a),d=B[b];if(d)return d;var e=a.ji,d=c(A.shaders_dir,a.sj),e=c(A.shaders_dir,e);if(!d||!e)return null;var l=m("vert",d,a),g=m("frag",e,a),d=f,q=k(d,b,l,d.VERTEX_SHADER),r=k(d,b,g,d.FRAGMENT_SHADER),e=d.createProgram();d.attachShader(e,q);d.attachShader(e,r);d.linkProgram(e);d.validateProgram(e);d.getProgramParameter(e,d.VALIDATE_STATUS)==d.EH&&v.error("shader program is not valid",b);h.cA(e,b,q,r,l,g);a=
{Mr:q,It:r,vh:e,attributes:{},Eh:{},Jk:[],zq:{},Hw:[],nb:a};g=d.getProgramParameter(e,d.ACTIVE_ATTRIBUTES);for(l=0;l<g;l++)q=d.getActiveAttrib(e,l).name,a.attributes[q]=d.getAttribLocation(e,q);g=d.getProgramParameter(e,d.ACTIVE_UNIFORMS);for(l=0;l<g;l++)q=d.getActiveUniform(e,l).name.split("[0]").join(""),a.Eh[q]=d.getUniformLocation(e,q);return B[b]=d=a};a.wD=function(){E=!1;if(b4w.module_check("shader_texts"))E=!0;else{for(var a=[],b=x.AT_TEXT,c=0;c<u.length;c++){var d=C.Ck(A.shaders_dir+u[c]);
a.push({id:u[c],type:b,url:d})}b=function(a,b){z||(z={});z[b]=a};a.length?x.enqueue(a,b,function(){E=!0}):v.error("Shaders have not been found.")}};a.dA=function(){return E};a.vI=function(){return r};a.St=function(){return B};a.cleanup=function(){for(var a in B){var b=B[a];f.deleteProgram(b.vh);f.deleteShader(b.Mr);f.deleteShader(b.It);delete B[a]}for(var c in q)delete q[c];for(var d in r)delete r[d]};a.wI=function(a){var b=a.Cf;v.log("Shader: "+a.sj+" "+a.ji+", "+String(b.length)+" directives: ");
for(a=0;a<b.length;a++)v.log("  "+b[a][0],b[a][1])};a.s=n;a.Us=function(a,b){return b in a.Eh?!0:!1};a.EC=function(a){return(f.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function d(a,b){for(var c=1;c<a.fa.length;c++){for(var d=a.fa[c].mc,e=d.a_position,f=d.a_normal,l=b.a_position,h=b.a_normal,k=e.length,g=a.fa[c].Fm,q=0;q<k;q++)l[q]+=g*e[q],h[q]+=g*f[q];d=d.a_tangent;e=b.a_tangent;f=d.length;for(q=0;q<f;q++)e[q]+=g*d[q]}}function b(a){return 65536<a.U?f.Vt()?!1:!0:!1}function c(a){return 0<a.xa.length?!0:!1}function m(a,b,d){if(!c(a))return a;d||E.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.U*(b||1)+
", will use drawArrays","color: #aa0");b=a.xa;d=a.U;var f=a.R,l=a.A,h;for(h in f){var k=f[h],g=C(k,d);f[h]=e(b,k,g)}for(f=0;f<l.length;f++){var q=l[f];for(h in q)k=q[h],g=C(k,d),q[h]=e(b,k,g)}for(f=0;f<a.fa.length;f++){h=a.fa[f].mc;for(var m in h)k=h[m],g=C(k,d),h[m]=e(b,k,g)}a.U=b.length;a.xa=new Uint16Array(0);return a}function e(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var f=a[e],h=0;h<c;h++)d[c*e+h]=b[c*f+h];return d}function t(a,
b){var c=a.od,d=a.Yb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function k(b,c){var d,e;switch(c){case a.wj:case a.xl:d=J.TRIANGLES;e=J.STATIC_DRAW;break;case a.Wr:d=J.POINTS;e=J.STATIC_DRAW;break;case a.wl:d=J.TRIANGLES;e=J.DYNAMIC_DRAW;break;case a.Vr:d=J.POINTS;e=J.DYNAMIC_DRAW;break;case a.vx:d=J.LINES;e=J.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.jl=e}function n(a){a.If?(a.Ve||(a.Ve=J.createBuffer()),J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,
a.Ve),J.bufferData(J.ELEMENT_ARRAY_BUFFER,a.If,a.jl),a.hm=a.If.byteLength):a.hm=0;a.jg||(a.jg=J.createBuffer());J.bindBuffer(J.ARRAY_BUFFER,a.jg);J.bufferData(J.ARRAY_BUFFER,a.od,a.jl);a.nt=a.od.byteLength}function g(a){for(var b=N.Ib("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].xa.length;b.xa=new Uint32Array(c);var e=c=0,f=0;if(0<a[0].fa.length)for(var h=0;h<a[0].fa.length;h++){for(d=0;d<a.length;d++)c+=a[d].fa[h].mc.a_position.length,e+=a[d].fa[h].mc.a_normal.length,f+=a[d].fa[h].mc.a_tangent.length;
d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(f)};b.fa.push({Fm:a[0].fa[h].Fm,mc:d})}for(d=c=0;d<a.length;d++)c+=a[d].U;b.U=c;var e=a[0],l;for(l in e.R){for(d=c=0;d<a.length;d++)c+=a[d].R[l].length;b.R[l]=new Float32Array(c)}for(l in e.A[0]){for(d=c=0;d<a.length;d++)c+=a[d].A[0][l].length;for(d=0;d<e.A.length;d++)b.A[d]=b.A[d]||{},b.A[d][l]=new Float32Array(c)}for(l=e=c=0;l<a.length;l++){for(var f=a[l],k=f.xa,h=f.U,g=f.R,d=0;d<k.length;d++)b.xa[c+d]=k[d]+
e;var c=c+k.length,q;for(q in g){var k=g[q],m=e*C(k,h);b.R[q].set(k,m)}for(d=0;d<f.A.length;d++){var g=f.A[d],r=b.A[d];for(q in g)k=g[q],m=e*C(k,h),r[q].set(k,m)}e+=h}if(0<b.fa.length)for(l=0;l<b.fa.length;l++)for(q=b.fa[l].mc,d=f=e=c=0;d<a.length;d++)h=a[d].fa[l].mc,q.a_position.set(h.a_position,c),q.a_normal.set(h.a_normal,e),q.a_tangent.set(h.a_tangent,f),c+=h.a_position.length,e+=h.a_normal.length,f+=h.a_tangent.length;return b}function x(a,b,c,d,e,f){var k=N.Ib("SUBMESH_"+a.name+"_"+b),g=a.submeshes[b],
q=g.base_length,r=a.materials[b];k.U=q;var n=!1;if(h(c,"a_texcoord")){var u=null,t=a.materials[b];b=a.submeshes[b];if(t.texture_slots.length)switch(t=t.texture_slots[0],t.texture_coords){case "UV":t=a.uv_textures.indexOf(t.uv_layer);0==t?u=new Float32Array(b.texcoord):1==t&&(u=new Float32Array(b.texcoord2));break;case "ORCO":for(var x=a.b4w_bounding_box_source,u=new Float32Array(2*b.base_length),t=(x.max_x+x.min_x)/2,F=(x.max_z+x.min_z)/2,w=x.max_x-x.min_x,x=x.max_z-x.min_z,B=0,p=0;p<b.position.length;p+=
3)u[B++]=(b.position[p]-t)/w+.5,u[B++]=(F-b.position[p+2])/x+.5}null===u&&(u=new Float32Array(2*b.base_length));b=u}else b=new Float32Array(0);if(h(c,"a_orco_tex_coord")){u=a.b4w_bounding_box_source;t=new Float32Array(3*g.base_length);F=u.max_x-u.min_x;w=u.max_y-u.min_y;x=u.max_z-u.min_z;for(p=B=0;p<g.position.length;p+=3)0==F?t[B++]=.5:t[B++]=N.clamp(parseFloat(((g.position[p]-u.min_x)/F).toFixed(5)),0,1),0==x?t[B++]=.5:t[B++]=N.clamp(parseFloat(((u.max_z-g.position[p+2])/x).toFixed(5)),0,1),0==
w?t[B++]=.5:t[B++]=N.clamp(parseFloat(((g.position[p+1]-u.min_y)/w).toFixed(5)),0,1);u=t}else u=new Float32Array(0);var L,t=g.group;if(h(c,"a_influence")&&d){F=new Float32Array(4*q);w=t.length/q;x=new Float32Array(w);for(B=0;B<w;B++)for(L in x[B]=-1,d)if(p=d[L],p.cx===B){x[B]=p.ap;break}var U=3<w?w:4;d=new Float32Array(U);L=new Uint32Array(U);for(var B=new Float32Array(4),p=new Float32Array(U),U=new Uint32Array(U),ga=new Float32Array(4),P=0;P<q;P++)d.set(p),L.set(U),B.set(ga),F.set(v(t,w,P,q,x,d,
L,B),4*P)}else F=new Float32Array(0);L=F;d=e?N.qa(e):{};d.a_color={Vg:!0};d.a_color.src=h(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Dd:7}]:[];e={a_texcoord:b,a_influence:L,a_orco_tex_coord:u};L=g.vertex_colors;b=g.color;u=a.name;t=[];for(F=0;F<L.length;F++)t.push(L[F].name);for(var K in d)if(F=d[K].src,F.length){for(x=w=0;x<F.length;x++)w+=N.zh(F[x].Dd);e[K]=new Float32Array(w*q);for(x=B=0;x<F.length;x++){var A=F[x].name,p=F[x].Dd,U=N.Lv(p),C=t.indexOf(A);-1==C&&N.O('vertex color "'+
A+'" for mesh "'+u+'" not found.');ga=L[C].mask;P=N.zh(ga);(p&ga)!==p&&E.error("Wrong color extraction from "+A+" to "+K+".");for(var da=A=0;da<C;da++)A+=N.zh(L[da].mask);C=A*q;for(A=0;A<q;A++)for(da=0;3>da;da++)U[da]&&(e[K][A*w+(B+N.Rk(p,da))]=b[C+A*P+N.Rk(ga,da)]);B+=P}}else e[K]=new Float32Array(0);K=a.uv_textures;d=g.texcoord;L=g.texcoord2;if(f)for(var O in f){b=K.indexOf(O);if(0==b)var ea=new Float32Array(d);else 1==b&&(ea=new Float32Array(L));e[f[O]]=ea}k.R=e;k.xa=new Uint32Array(g.indices);
f=g.position.length/q/3;ea=(O=h(c,"a_normal")&&g.normal.length?!0:!1)&&h(c,"a_tangent")&&g.tangent.length?!0:!1;K=r.texture_slots[0];K=O&&r.texture_slots.length&&h(c,"a_tangent")&&"ORCO"==K.texture_coords&&K.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&(n=!0);for(e=0;e<f;e++){r=l(g,c,q,O,ea,K,e,a.name);if(n)if(d={},d.name=a.b4w_shape_keys[e].name,k.fa.push(d),0!=e){d.mc=r;d.Fm=a.b4w_shape_keys[e].value;continue}else d.mc=l(g,c,q,O,ea,K,e,a.name),d.Fm=1;k.A.push(r)}if(1<f&&!n){a=k.A[0];var r={},
Q;for(Q in a)r[Q]=new Float32Array(a[Q]);k.A.push(r)}h(c,"a_polyindex")&&(m(k,1,!0),k.R.a_polyindex=z(k));return k}function l(a,b,c,d,e,f,l,k){var g={},q=new Float32Array(3*c),m=new Float32Array(d?3*c:0),r=new Float32Array(e||f?4*c:0),u=l*c*3;q.set(a.position.subarray(u,u+3*c),0);d&&(u=l*c*3,m.set(a.normal.subarray(u,u+3*c),0));if(e)u=l*c*4,r.set(a.tangent.subarray(u,u+4*c),0);else if(f)for(a=r,E.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+
k+'". Please add a UV-map.'),k=0;k<c;k++)b=K,d=F,b[0]=m[3*k],b[1]=m[3*k+1],b[2]=m[3*k+2],O.cross(b,N.AXIS_Z,d),0==O.length(d)&&O.cross(b,N.AXIS_X,d),O.normalize(d,d),a[4*k]=d[0],a[4*k+1]=d[1],a[4*k+2]=d[2],a[4*k+3]=1;else if(d&&h(b,"a_tangent"))for(r=new Float32Array(4*c),c=0;c<r.length;c++)r[c]=1;g.a_position=q;g.a_normal=m;g.a_tangent=r;return g}function h(a,b){return-1<a.indexOf(b)?!0:!1}function v(b,c,d,e,f,h,l,k){for(var g=!0,q=0;q<c;q++){var m=b[q*e+d];if(-1!==m){var r=f[q];-1!==r&&(h[q]=m,
l[q]=r,g=!1)}}if(g)return k;A(h,l,a.Vn,!1);for(q=b=0;4>q;q++)b+=h[q];if(.01>b)return k;for(q=0;4>q;q++)h[q]/=b;if(.01>Math.abs(h[0]-1))k[0]=l[0]+1;else for(q=0;4>q;q++)k[q]=l[q]+h[q];return k}function C(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function A(b,c,d,e){for(var f=b.length,h=f,l=!1,k=e?-1:1;1<h||l;){1<h&&(h=Math.floor(h/1.247330950103979));for(var l=!1,g=0;h+g<f;g++)if(d==
a.Vn?0>k*(b[g]-b[g+h]):b[g]<b[g+h]&&e)l=b[g],b[g]=b[g+h],b[g+h]=l,l=c[g],c[g]=c[g+h],c[g+h]=l,l=!0}}function B(a,b,c){var d=[],e=[];O.subtract(b,a,d);O.subtract(c,a,e);O.normalize(d,d);O.normalize(e,e);return Math.acos(O.dot(d,e))}function q(a,b,d){b||(b=[]);d=d?a.A[0].a_normal:a.A[0].a_position;if(c(a)){a=a.xa;for(var e=a.length/3,f=0;f<e;f++){var h=new Float32Array(9),l=a[3*f];h[0]=d[3*l];h[1]=d[3*l+1];h[2]=d[3*l+2];l=a[3*f+1];h[3]=d[3*l];h[4]=d[3*l+1];h[5]=d[3*l+2];l=a[3*f+2];h[6]=d[3*l];h[7]=
d[3*l+1];h[8]=d[3*l+2];b[f]=h}}else for(f=0;f<d.length;f++)h=new Float32Array(9),h[0]=d[9*f],h[1]=d[9*f+1],h[2]=d[9*f+2],h[3]=d[9*f+3],h[4]=d[9*f+4],h[5]=d[9*f+5],h[6]=d[9*f+6],h[7]=d[9*f+7],h[8]=d[9*f+8],b[f]=h;return b}function z(a){for(var b=new Float32Array(a.U),c=0;c<a.U;c++)b[c]=c%3;return b}function u(a,b,c){var d=O.dist(a,b);a=O.dist(a,c);b=O.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function r(a,b,c,d,e){c-=b;for(var f=0;f<c;f+=d)f%d==e&&vec3.normalize(a.subarray(f+b-e,f+b+1),a.subarray(f+
b-e,f+b+1))}var f=p("__extensions"),E=p("__print"),w=p("__tsr"),N=p("__util"),O=p("__vec3"),K=new Float32Array(3),F=new Float32Array(3),Q=new Float32Array(3);a.Be=10;a.es=20;a.NH=30;a.xl=10;a.Wr=20;a.wl=30;a.Vr=40;a.vx=50;a.Vn=0;a.Hy=1;a.wj=a.xl;var J=null;a.gd=function(a){J=a};a.xI=function(a){var b=_buffers[a];J.deleteBuffer(b.Ve);J.deleteBuffer(b.jg);delete _buffers[a]};a.OF=function(e,f,h,l){b(e)&&m(e);var g=e.xa,q=e.U,r=e.A,u={},t;for(t in e.R)t in l&&!l[t].Vg||(u[t]=e.R[t]);l={If:null,od:null,
Jp:0,count:0,Yb:{},mode:0,jl:0,hm:0,nt:0,jg:null,Ve:null,Dm:null,fa:null};0<e.fa.length&&d(e,r[0]);if(g.length)if(t=g.length,65536>=q)var z=new Uint16Array(g),v=J.UNSIGNED_SHORT;else z=new Uint32Array(g),v=J.UNSIGNED_INT;else t=q,z=null;var x=0,E=r.length,F;for(F in r[0])var w=r[0][F],x=x+w.length*E;for(F in u)w=u[F],x+=w.length;F=new Float32Array(x);var x=0,E={},B;for(B in u){var p=u[B];if(w=p.length)F.set(p,x),E[B]={$H:B,oe:C(p,q),offset:x,frames:1,length:w},x+=w}u=r.length;for(B in r[0])if(p=r[0][B],
w=p.length,p=C(p,q),w){E[B]={oe:p,offset:x,frames:u,length:w};1<u&&(E[B+"_next"]={oe:p,offset:x+w,frames:u,length:w});for(var K=0;K<u;K++)p=r[K][B],F.set(p,x),x+=w}l.count=t;l.If=z;l.od=F;l.Jp=v;l.Yb=E;k(l,h);n(l);f!=a.Be&&c(e)&&(l.Dm={QD:new Float32Array(g.length),RD:new Float32Array(g.length),mB:new Float32Array(g.length/3),type:f});l.fa=e.fa;return l};a.MF=d;a.aD=b;a.$C=c;a.xn=m;a.mG=function(a,b,c){k(a,b);a.count=c.length;a.If=c;a.Jp=c instanceof Uint16Array?J.UNSIGNED_SHORT:J.UNSIGNED_INT};a.Fn=
function(a,b,c,d){var e=a.od,f=a.Yb,h=f[b];h?(c&&h.oe!=c&&N.O('invalid num_comp for "'+b+'"'),e.set(d,h.offset)):(e=e.length,h=new Float32Array(e+d.length),h.set(a.od),h.set(d,e),a.od=h,f[b]={oe:c,offset:e});n(a)};a.zB=t;a.HJ=function(a){a.jl=J.STATIC_DRAW};a.HD=function(a){a.jl=J.DYNAMIC_DRAW};a.Mw=n;a.Ws=function(a){a.Ve&&J.deleteBuffer(a.Ve);a.jg&&J.deleteBuffer(a.jg)};a.nu=function(a,b){return a.submeshes[b].base_length?!1:!0};a.sw=function(a,b){for(var c=0;c<a.A.length;c++){var d=a.A[c].a_position;
w.transform_vectors(d,b,d,0);d=a.A[c].a_normal;0<d.length&&w.transform_dir_vectors(d,b,d,0);d=a.A[c].a_tangent;0<d.length&&w.transform_tangents(d,b,d,0)}(c=a.R.au_center_pos)&&c.length&&w.transform_vectors(c,b,c,0);return a};a.LF=function(a,b){var c=a.R.au_center_pos;if(c&&c.length){var d=new Float32Array(c);w.transform_vectors(d,b,d,0);for(var e=0;e<a.A.length;e++)for(var f=0;f<d.length;f++)a.A[e].a_position[f]+=d[f]-c[f];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';
};a.KF=function(a,b){var c=a.U,d;for(d in b){var e=b[d].length;a.R[d]=new Float32Array(e*c);for(var f=0;f<c;f++)for(var h=0;h<e;h++)a.R[d][f*e+h]=b[d][h]}};a.NF=g;a.GD=function(a,b,c){if(!a.U)return N.Ib("EMPTY");var d=c.length;65536<a.U*d&&!f.Vt()&&m(a,d);var e=a.xa,h=a.U,l=a.R;a=a.A;for(var k in b){var g=b[k].length,q=g*h;l[k]=new Float32Array(q);for(var r=0;r<h;r++)for(q=0;q<g;q++)l[k][r*g+q]=b[k][q]}b=N.Ib("CLONE_"+d+"_SUBMESHES");b.U=h*d;b.xa=new Uint32Array(e.length*d);for(r=0;r<d;r++)for(g=
e.length*r,k=h*r,q=0;q<e.length;q++)b.xa[g+q]=e[q]+k;for(var u in l)for(e=l[u],q=e.length*d,g=C(e,h),b.R[u]=new Float32Array(q),r=0;r<d;r++)k=h*g*r,b.R[u].set(e,k);for(u in a[0])for(r=0;r<a.length;r++)for(e=a[r][u],q=e.length*d,g=C(e,h),b.A[r]=b.A[r]||{},b.A[r][u]=new Float32Array(q),q=0;q<d;q++)switch(l=c[q],k=h*g*q,u){case "a_position":w.transform_vectors(e,l,b.A[r][u],k);break;case "a_normal":w.transform_dir_vectors(e,l,b.A[r][u],k);break;case "a_tangent":w.transform_tangents(e,l,b.A[r][u],k);
break;default:throw"Wrong attribute name: "+u;}return b};a.Bt=x;a.CB=function(a){var b=a.U,c=a.A[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint32Array(4*a.xa.length);for(var f=0;f<b;f++)d[12*f]=c[3*f],d[12*f+1]=c[3*f+1],d[12*f+2]=c[3*f+2],d[12*f+3]=c[3*f],d[12*f+4]=c[3*f+1],d[12*f+5]=c[3*f+2],d[12*f+6]=c[3*f],d[12*f+7]=c[3*f+1],d[12*f+8]=c[3*f+2],d[12*f+9]=c[3*f],d[12*f+10]=c[3*f+1],d[12*f+11]=c[3*f+2],e[8*f]=-.5,e[8*f+1]=-.5,e[8*f+2]=-.5,e[8*f+3]=.5,e[8*f+4]=.5,e[8*f+5]=
.5,e[8*f+6]=.5,e[8*f+7]=-.5,a[6*f]=4*f+2,a[6*f+1]=4*f+1,a[6*f+2]=4*f,a[6*f+3]=4*f+2,a[6*f+4]=4*f,a[6*f+5]=4*f+3;c=N.Ib("HALO");c.A=[];c.A[0]={};c.U=4*b;c.A[0].a_position=d;c.R.a_halo_bb_vertex=e;c.xa=a;return c};a.LC=h;a.Ct=function(a,b,c){for(var d=[],e=0;e<a.submeshes.length;e++){var f=x(a,e,b,null,c,null);f.U&&d.push(f)}return 0==d.length?N.Ib("EMPTY"):1==d.length?d[0]:g(d)};a.lG=function(a,b,c){for(var d=a.If,e=t(a,"a_position"),f=a.Dm,h=f.QD,l=f.RD,f=f.mB,k=d,g=k.length/3,q=0;q<g;q++){var m=
k[3*q],r=k[3*q+1],u=k[3*q+2],n=e[3*m+1],z=e[3*m+2],v=e[3*r+1],x=e[3*r+2],L=e[3*u+1],U=e[3*u+2];h[3*q]=(e[3*m]+e[3*r]+e[3*u])/3;h[3*q+1]=(n+v+L)/3;h[3*q+2]=(z+x+U)/3}w.transform_vectors(h,b,l);b=l.length/3;for(e=0;e<b;e++)h=l[3*e]-c[0],k=l[3*e+1]-c[1],g=l[3*e+2]-c[2],f[e]=h*h+k*k+g*g;c=d;d=f.length;if(!(2>d))for(l=d,e=!1;1<l||e;)for(1<l&&(l=Math.floor(l/1.247330950103979)),e=!1,b=0;l+b<d;b++)0>f[b]-f[b+l]&&(e=f[b],f[b]=f[b+l],f[b+l]=e,e=c,h=b,k=b+l,g=e[3*h],q=e[3*h+1],m=e[3*h+2],e[3*h]=e[3*k],e[3*
h+1]=e[3*k+1],e[3*h+2]=e[3*k+2],e[3*k]=g,e[3*k+1]=q,e[3*k+2]=m,e=!0);d=c;J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,a.Ve);J.bufferData(J.ELEMENT_ARRAY_BUFFER,d,J.DYNAMIC_DRAW)};a.hw=A;a.Is=function(a,b,c){for(var d=b.length/3,e=a.length/3,f=[],h=Array(3),l=Array(3),k=Array(3),g=0;g<e;g++){for(var q=a[3*g],m=a[3*g+1],r=a[3*g+2],u=0;3>u;u++)h[u]=b[3*q+u],l[u]=b[3*m+u],k[u]=b[3*r+u];if(c)var u=B(h,l,k),n=B(l,k,h),t=Math.PI-u-n;else t=n=u=1;var z=f,v;v=h;var L=k,U=[],x=[],E=[];O.subtract(l,v,U);O.subtract(L,
v,x);O.cross(U,x,E);O.normalize(E,E);v=E;for(L=0;3>L;L++)U=3*m+L,x=3*r+L,z[3*q+L]=u*v[L],z[U]=n*v[L],z[x]=t*v[L]}if(c)for(var F in c)for(g=c[F],a=0;3>a;a++){b=3*g[0]+a;for(e=1;e<g.length;e++)h=3*g[e]+a,f[b]+=f[h];for(e=1;e<g.length;e++)h=3*g[e]+a,f[h]=f[b]}for(g=0;g<d;g++){c=g;F=f;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=F[e];O.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,F[e]=a[b]}return f};a.Js=function(a,b,c){for(var d={},e=b.length/3,f=0;f<e;f++){var h=String(b[3*f])+String(b[3*f+1])+String(b[3*
f+2]);d[h]=[]}e=a.length;for(f=0;f<e;f++)b=a[f],h=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),h in d&&d[h].push(b);return d};a.xp=function(a,b,c,d){var e=q(a,null,!1);if(c)var f=q(a,null,!0);var h=e.length,l=new Float32Array(h),k=K,g=F;for(a=0;a<h;a++){var m=e[a];k.set(m.subarray(0,3));g.set(m.subarray(3,6));Q.set(m.subarray(6));l[a]=Math.sqrt(u(k,g,Q))}k=new Float32Array(h);k[0]=l[0];for(a=1;a<h;a++)k[a]=k[a-1]+l[a];h=k[l.length-1];l=[];for(a=0;a<b;a++){var g=h*N.Fd(d),g=N.Rl(k,g,0,k.length-
1),m=c?f[g]:e[g],g=a,r=m,n=d,m=void 0,m=new Float32Array(3),t=r[0],z=r[1],v=r[2],x=r[3],E=r[4],L=r[5],U=r[6],w=r[7],B=r[8],r=N.Fd(n),n=N.Fd(n);1<r+n&&(r=1-r,n=1-n);var p=1-r-n,z=p*z+r*E+n*w,v=p*v+r*L+n*B;m[0]=p*t+r*x+n*U;m[1]=z;m[2]=v;l[g]=m}return l};a.EI=q;a.mp=z;a.hK=u;a.Pv=function(a,b,c){a=a.A[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.ts=function(a,b,c){var d=a.K[0].V;a=a.f.$f;for(var e=1;e<a.length;e++)a[e].name==
b&&(a[e].value=c);for(e=0;e<d.length;e++)if(!d[e].Tg&&d[e].Xd&&!d[e].Mg){c=d[e].S.Yb;b=d[e].S.od;J.bindBuffer(J.ARRAY_BUFFER,d[e].S.jg);var f=c.a_position,h=d[e],l=b,k=a;if(f){for(var g=f.offset,f=f.length+g,q=h.S.fa[0].mc.a_position,m=g;m<f;m++)l[m]=q[m-g];for(m=1;m<h.S.fa.length;m++){var q=h.S.fa[m].mc.a_position,u=k[m].value;if(u)for(var n=g;n<f;n++)l[n]+=u*q[n-g]}J.bufferSubData(J.ARRAY_BUFFER,4*g,l.subarray(g))}f=c.a_normal;h=d[e];l=b;k=a;if(f){g=f.offset;f=f.length+g;q=h.S.fa[0].mc.a_normal;
for(m=g;m<f;m++)l[m]=q[m-g];for(m=1;m<h.S.fa.length;m++)if(q=h.S.fa[m].mc.a_normal,u=k[m].value)for(n=g;n<f;n++)l[n]+=u*q[n-g];r(l,g,f,3,2);J.bufferSubData(J.ARRAY_BUFFER,4*g,l.subarray(g))}k=c.a_tangent;c=d[e];h=a;if(k){l=k.offset;k=k.length+l;f=c.S.fa[0].mc.a_tangent;for(g=l;g<k;g++)b[g]=f[g-l];for(g=1;g<c.S.fa.length;g++)if(f=c.S.fa[g].mc.a_tangent,m=h[g].value)for(q=l;q<k;q++)b[q]+=m*f[q-l];r(b,l,k,4,3);J.bufferSubData(J.ARRAY_BUFFER,4*l,b.subarray(l))}}};a.check_shape_keys=function(a){return a.f.Xd};
a.get_shape_keys_names=function(a){var b=[];if(a.f)for(var c=1;c<a.f.$f.length;c++)b.push(a.f.$f[c].name);return b};a.get_shape_key_value=function(a,b){if(a.f)for(var c=1;c<a.f.$f.length;c++)if(b==a.f.$f[c].name)return a.f.$f[c].value;return 0};a.Hp=function(a,b){var c=a.f.$f;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.qi=function(a){return a&&a.f&&a.f.ie?!0:!1}};b4w.module.__objects=function(a,p){function d(a){a.f.Rf=0;a=X.indexOf(a);-1!=a&&X.splice(a,1)}function b(a){if(a.fi)for(var b=a.K,c=0;c<b.length;c++)D.sG(b[c].Ga,a)}function c(a,b){for(var c=a.K,d=b.K,e=0;e<c.length;e++){for(var f=!1,h=0;h<d.length;h++)if(c[e].Ga==d[h].Ga){f=!0;break}f||m(b,c[e].Ga)&&N.Kl(b,c[e].Ga)}}function m(a,b){return!b.hs&&"SPEAKER"==a.type||!b.Py&&("LAMP"==a.type||"CAMERA"==a.type)?!1:!0}function e(a,b){if(a.dg_parent&&a.dg_parent.fs||a.parent&&a.parent.fs)return!0;switch(a.type){case "MESH":var c=
a.b4w_do_not_batch,d=a.b4w_collision,e=a.b4w_vehicle,f=a.b4w_floating,h=a.b4w_character,l=O.NC(a),k=w.Gs(a),g=0<a.data.b4w_shape_keys.length,q=a.b4w_dynamic_geometry;if(!(c=A.Hs(a,b)||c||d||e||g||f))a:{c=a.data;for(d=0;d<c.materials.length;d++)if("LENS_FLARES"===c.materials[d].name){c=!0;break a}c=!1}return c||l||h||k||q;case "EMPTY":return h=w.Gs(a),l=a.b4w_do_not_batch,k=Boolean(a.b4w_anchor),A.Hs(a,b)||h||l||k;default:return!0}}function t(a,b,c,d,e,f,h,l,g){for(var q=0;q<a.nodes.length;q++){var m=
a.nodes[q];if("VALUE"==m.type){var r=n(b,m.name);d.push(m.outputs[0].default_value);e.push(r,e.length/2)}else"RGB"==m.type?(r=n(b,m.name),m=m.outputs[0].default_value.slice(0,3),h.push(m[0],m[1],m[2]),l.push(r,l.length/2)):"GROUP"==m.type&&(r=m.node_group.node_tree,t(r,n(b,m.name),r.animation_data,d,e,f,h,l,g))}if(c)for((a=c.action)&&a.k.type==A.Ur&&k(a,b,f,e,g,l),c=c.nla_tracks,d=0;d<c.length;d++)for(h=c[d].strips,q=0;q<c[d].strips.length;q++)(a=h[q].action)&&a.k.type==A.Ur&&k(a,b,f,e,g,l)}function k(a,
b,c,d,e,f){var h=a.k.M,l;for(l in h){var k=n(b,l.match(/"(.*?)"/)[1]),h=g(d,k);null!=h?(k=n(a.name,l),c.push(k,h)):(h=g(f,k),null!=h&&(k=n(a.name,l),e.push(k,h)))}}function n(a,b){return a+"%join%"+b}function g(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function x(a,b){for(var c=a.f.ih,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function l(a,b){for(var c=a.f.hh,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function h(a,b,c){b=ia[b]||[];for(var d=
[],e=0;e<b.length;e++){var f=b[e];if(f.f.xc==c||-1==c)for(var h=f.K,l=0;l<h.length;l++)h[l].Ga==a&&d.push(f)}return d}function v(a,b,c,d){for(var e=null,f=0;f<b.length;f++){var h=b[f];if((c?h.ph:h.name)==a&&(h.f.xc==d||-1==d)&&(e=h,!N.get_dg_parent(e)))break}return e}function C(a){ia.ALL.push(a);ia[a.type]||(ia[a.type]=[]);ia[a.type].push(a);var b=a.f.cd;if(null!=b)for(var c=0;c<S.length;c++){var d=S[c];d.f.cd==b&&d.Qk.push(a)}}var A=p("__animation"),B=p("__batch"),q=p("__boundings"),z=p("__camera"),
u=p("__config"),r=p("__constraints"),f=p("__geometry"),E=p("__lights"),w=p("__nla"),N=p("__obj_util"),O=p("__particles"),K=p("__physics"),F=p("__print"),Q=p("__primitives"),J=p("__quat"),D=p("__scenes"),G=p("__sfx"),M=p("__transform"),I=p("__tsr"),y=p("__util"),V=p("__vec3"),T=p("__armature"),R=u.p,ha=u.Eb,ia={ALL:[]},aa=0,W=0,S=[],X=[],ca=new Float32Array(3),oa=new Float32Array(4);a.Un=0;a.Tn=1;a.tc=2;a.DATA_ID_ALL=-1;a.update=function(a){for(var b=ia.ALL,c=ia.ARMATURE,e=0;e<b.length;e++)for(var f=
b[e],h=f.K,l=0;l<h.length;l++){var k=h[l].Ga;if(k.k.outline){if(-1!=X.indexOf(f)){var g=f,q=a,m=0,r=g.gv;0==r.yn&&(r.yn=q);q-=r.yn;if(r.Kq&&q/r.bd>=r.Kq)d(g);else{q%=r.bd;if(q<r.vq)switch(r=q/(r.vq/5),q=Math.floor(r),q){case 0:m=(r-q)/2;break;case 1:m=(r-q)/2+.5;break;case 2:m=1;break;case 3:m=1-(r-q)/2;break;case 4:m=.5-(r-q)/2}g.f.Rf=m}}f.f.Rf&&D.HE(k)}}if(c)for(e=0;e<c.length;e++)a=c[e],a.oq&&(M.o(a),a.oq=!1)};a.apply_outline_anim=function(a,b,c,d){var e=a.gv;e.yn=0;e.vq=b;e.bd=c;e.Kq=d;-1==X.indexOf(a)&&
X.push(a)};a.clear_outline_anim=d;a.Fh=function(a,b){b.Ih=a.uuid;b.Ul=!0;var c=a.animation_data,d=a.data.animation_data;c&&c.action&&(c=c.action,(c.k.type==A.ux||c.k.type==A.sx&&"ARMATURE"==b.type||c.k.type==A.tx&&"LAMP"==b.type)&&b.actions.push(c));d&&d.action&&("SPEAKER"==b.type||"LAMP"==b.type)&&b.actions.push(d.action);"MESH"==b.type&&b.actions.push.apply(b.actions,A.kC(a));a.fs=b.ga=e(a,b);a.OH=!0;b.Ac=a.b4w_vehicle;b.is_character=a.b4w_character;b.$g=a.b4w_floating;b.qj=a.b4w_collision;b.Ka=
a.b4w_collision_id;b.cm=a.b4w_correct_bounding_offset;d=a.game;b.Sd={bn:d.physics_type,ll:d.use_ghost,Vw:d.use_sleep,le:d.mass,$w:d.velocity_min,Zw:d.velocity_max,Xo:d.damping,Pq:d.rotation_damping,xD:d.lock_location_x,yD:d.lock_location_y,zD:d.lock_location_z,AD:d.lock_rotation_x,BD:d.lock_rotation_y,CD:d.lock_rotation_z,Pj:d.collision_margin,Nj:d.collision_group,Qj:d.collision_mask,Gr:d.use_collision_bounds,Yl:d.collision_bounds_type,kl:d.use_collision_compound};if(d=a.b4w_vehicle_settings)b.Mc=
{name:d.name,Dc:d.part,RF:d.suspension_rest_length,or:d.suspension_compression,qr:d.suspension_stiffness,pr:d.suspension_damping,Pr:d.wheel_friction,Nq:d.roll_influence,iq:d.max_suspension_travel_cm,jk:d.force_max,Fj:d.brake_max,fj:d.steering_max,Di:d.max_speed_angle,$j:d.delta_tach_angle,Xk:d.speed_ratio,$k:d.steering_ratio,vk:d.inverse_control,Sg:d.floating_factor,Nh:d.water_lin_damp,Oh:d.water_rot_damp,ww:d.synchronize_position};if(d=a.b4w_floating_settings)b.gi={name:d.name,Dc:d.part,Sg:d.floating_factor,
Nh:d.water_lin_damp,Oh:d.water_rot_damp,ww:d.synchronize_position};if(d=a.b4w_character_settings)b.Rs={eH:d.walk_speed,ME:d.run_speed,IF:d.step_height,fD:d.jump_strength,gH:d.waterline};for(d=0;d<a.constraints.length;d++)c=a.constraints[d],"RIGID_BODY_JOINT"==c.type&&b.Aq.push({target:c.target.ja,hE:c.pivot_type,iE:c.pivot_x,jE:c.pivot_y,kE:c.pivot_z,ce:c.axis_x,de:c.axis_y,ee:c.axis_z,KG:c.use_limit_x,LG:c.use_limit_y,MG:c.use_limit_z,FG:c.use_angular_limit_x,GG:c.use_angular_limit_y,HG:c.use_angular_limit_z,
pD:c.limit_max_x,qD:c.limit_max_y,rD:c.limit_max_z,sD:c.limit_min_x,tD:c.limit_min_y,uD:c.limit_min_z,jD:c.limit_angle_max_x,kD:c.limit_angle_max_y,lD:c.limit_angle_max_z,mD:c.limit_angle_min_x,nD:c.limit_angle_min_y,oD:c.limit_angle_min_z});d=b.f=N.$h("MESH"===b.type?b.ga?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent.ja,"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.Ik=a.parent_bone)):a.dg_parent&&(b.parent=a.dg_parent.ja,b.Tf=!0);var c=a.location,f=a.scale[0];y.Fq(a.rotation_quaternion,
oa);M.set_translation(b,c);M.set_rotation(b,oa);M.set_scale(b,f);b.Hn=a.b4w_use_default_animation;b.Hl=A.qs(a.b4w_anim_behavior);a.b4w_object_tags&&(b.Qm={title:a.b4w_object_tags.title,description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});switch(a.type){case "ARMATURE":T.Fh(a,b);c=d.td;f=A.Mz(c);a.b4w_animation_mixing?(d.Fc=new Float32Array(f.sa),d.dd=new Float32Array(f.sa),d.Lc=new Float32Array(f.trans),d.ld=new Float32Array(f.trans)):(d.Fc=f.sa,d.dd=f.sa,d.Lc=f.trans,d.ld=
f.trans);for(var h in c){var l=c[h];1==l.Xl.length&&T.kG(l,!0,f.trans,f.sa)}d.Bq=f;d.Ad=0;d.zg=a.b4w_animation_mixing;break;case "MESH":d.km=a.b4w_do_not_render;d.Wh=B.Az(a.data.b4w_bounding_box);d.df=ha.outlining_overview_mode||a.b4w_selectable;d.Xm=a.b4w_selectable;d.Eb=ha.outlining_overview_mode||a.b4w_outlining;d.Wm=a.b4w_outlining;d.hv=ha.outlining_overview_mode||a.b4w_outline_on_select;d.Jd=a.b4w_billboard;d.oo=a.b4w_pres_glob_orientation;d.Dj="BASIC";d.Cj="SPHERICAL"==a.b4w_billboard_geometry;
h=d.Li;h.Mi=a.b4w_outline_settings.outline_duration;h.Ni=a.b4w_outline_settings.outline_period;h.Oi=a.b4w_outline_settings.outline_relapses;d.df&&(d.Zl=y.Jt(aa),aa++);for(h=0;h<a.data.b4w_vertex_anim.length;h++)c=a.data.b4w_vertex_anim[h],b.ac.push({name:c.name,L:c.frame_start,ea:c.frame_end,bI:c.averaging,cI:c.averaging_interval,Ry:c.allow_nla});b.f.ac=b.ac.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;h=b.f;if(a.data.b4w_shape_keys.length)for(h.Xd=!0,c=0;c<a.data.b4w_shape_keys.length;c++)f=
{},f.value=a.data.b4w_shape_keys[c].value,f.name=a.data.b4w_shape_keys[c].name,h.$f.push(f);else h.Xd=!1;h=b.f;for(var c=a.data.materials,f=[],l=[],k=[],g=[],m=[],r=[],u=0;u<c.length;u++){var n=c[u],v=n.node_tree;v&&t(v,n.name,v.animation_data,f,l,k,g,m,r)}h.Ye=f;h.ih=l;h.Om=k;h.$c=g;h.hh=m;h.Pm=r;d.Ic=a.b4w_shadow_cast;d.kc=a.b4w_shadow_receive;d.Jc=a.b4w_shadow_cast_only&&d.Ic;d.qc=a.b4w_reflexible;d.gc=a.b4w_reflexible_only&&d.qc;d.Gc=a.b4w_reflective;d.pe=a.b4w_reflection_type;d.He=a.b4w_caustics;
d.qd=a.b4w_wind_bending;d.rl=a.b4w_wind_bending_angle;h=B.hH(a.b4w_wind_bending_angle,d.Wh,a.scale[0]);d.ze=h;d.mf=a.b4w_wind_bending_freq;d.Le=a.b4w_detail_bending_freq;d.Ke=a.b4w_detail_bending_amp;d.Fe=a.b4w_branch_bending_amp;d.Xg=!1;d.Xe=a.b4w_main_bend_stiffness_col;h=a.b4w_detail_bend_colors;d.fc={};d.fc.Fu=h.leaves_stiffness_col;d.fc.Eu=h.leaves_phase_col;d.fc.iv=h.overall_stiffness_col;d.bi=a.b4w_do_not_cull;d.jm=a.b4w_disable_fogging;d.ie=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";
h=a.data.materials[0];d.lk=h.physics.friction;d.gk=h.physics.elasticity;d.Bk=0;d.Lf=1E4;d.gh=a.b4w_lod_transition;d.Lm=!0;break;case "CAMERA":z.Pz(a,b);z.uz(b);break;case "LAMP":E.gD(a,b);break;case "SPEAKER":b.C=G.NA();d=!1;for(h=0;h<b.K.length;h++)if(b.K[h].Ga.b4w_enable_audio){d=!0;break}d&&G.Fh(a,b);break;case "EMPTY":d.Ub=q.Id(),h=q.sl(),d.ud=h,a.field&&(b.fi={type:a.field.type,qw:a.field.strength}),a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,ai:a.b4w_anchor.detect_visibility,nm:a.b4w_anchor.element_id,
OD:a.b4w_anchor.max_width})}C(b)};a.wG=function(a,b){var d=b.f;if(b.parent){!b.Tf&&b.Sd.kl&&b.parent.Sd.kl&&(b.qj=!1);var e=b.Sd;b.Ac||b.$g||K.is_character(b)||b.qj&&!e.ll&&0<e.le&&("DYNAMIC"==e.bn||"RIGID_BODY"==e.bn)?(e=b.Tf?I.copy(d.h,I.create()):d.h,I.multiply(b.parent.f.h,e,d.h),M.set_translation(b,I.get_trans_view(d.h)),M.set_scale(b,I.get_scale(d.h)),M.set_rotation(b,I.get_quat_view(d.h))):b.Tf||!b.Ik?(e=I.copy(d.h,I.create()),r.Vy(b,b.parent,e)):(e=I.copy(d.h,I.create()),r.Wy(b,b.parent,b.Ik,
e))}if("ARMATURE"==b.type)for(var e=a.pose.bones,f=0;f<e.length;f++){var h=e[f],l=h.constraints;if(l)for(var k=0;k<l.length;k++){var g=l[k];"COPY_TRANSFORMS"!=g.type||g.subtarget||g.mute||r.fz(b,g.target.ja,h.name,y.cs,y.bs)}}if("MESH"==b.type)var q=A.Qt(a);if(q){l=q.ja;e=l.f.Bq;f=b.f;h=a.data;b.Ll=l;h=h.vertex_groups;if(h.length){var l=l.f.td,k=0,g={},m;for(m in l){var u=y.keysearch("name",m,h);u&&(g[m]={cx:u.index,uf:l[m].uf,ap:k++})}f.Yh=g;m=k;h=A.Xt();f.Ze=m;m>2*h?(f.vi=!1,F.error('too many bones for "'+
a.name+'" / '+f.Ze+" bones (max "+h+" with blending, "+2*h+" without blending). Skinning will be disabled.")):f.vi=!0}m=A.DB(e.trans,e.sa,d.Yh);q.b4w_animation_mixing?(d.Fc=new Float32Array(m.sa),d.dd=new Float32Array(m.sa),d.Lc=new Float32Array(m.trans),d.ld=new Float32Array(m.trans)):(d.Fc=m.sa,d.dd=m.sa,d.Lc=m.trans,d.ld=m.trans);d.eo=new Float32Array(4);d.co=J.create();d.Bq=m;d.Ad=0}if(d.Gc)if(d=b.f,"CUBE"==d.pe)d.vd=W++;else if("PLANE"==d.pe){a:{q=a.constraints;for(m=0;m<q.length;m++)if(e=q[m],
"LOCKED_TRACK"==e.type&&"REFLECTION PLANE"==e.name){if(e.target.ja){q=e.target.ja;break a}F.warn('Reflection plane target "'+e.target.name+'" for object: "'+b.name+"\" is not present on the scene. Using object's Z-axis.")}q=null}q||(q=y.nj("%reflection%"),q=N.Uj(q,"EMPTY"),m=N.$h("EMPTY"),q.f=m,c(b,q),r.ss(q,b,[0,0,0],null,1),C(q));m=null;for(e=0;e<S.length;e++)if(S[e]==q){m=e;break}null==m&&(m=S.length,S.push(q));q.f.cd=m;d.cd=m;q.Qk.push(b)}};a.Lw=b;a.pI=c;a.Yz=m;a.xG=function(a){for(var b=0;b<
a.length;b++){var c=a[b];!c.f||"DYNAMIC"!=c.f.type&&"CAMERA"!=c.f.type||M.o(c);c.Hn&&A.fv(c)&&(A.apply_def(c),c.G.length&&A.play(c,null,A.SLOT_ALL))}};a.get_meta_tags=function(a){return y.qa(a.Qm)};a.cleanup=function(){W=aa=0;S=[];X.length=0;ia={ALL:[]}};a.copy=function(a,b,d){var e=b,h=N.get_dg_parent(a);b=h?N.Kt(h.name,b):b;if(v(b,ia.ALL,!1,-1)){for(var h=1,l;;){l="."+(3>String(h).length?("000"+String(h)).slice(-3):String(h));if(!v(b+l,ia.ALL,!1,-1))break;h++}F.error('Object "'+b+'" already exists. Name was replaced by "'+
b+l+'".');e+=l;b+=l}e=N.Uj(b,a.type,e);e.Ul=a.Ul;e.ga=a.ga;e.yk=a.yk;e.Hn=a.Hn;e.f=N.yf(a.f);e.Qm=N.yf(a.Qm);c(a,e);e.Sh=N.Mo(a.Sh);e.parent=N.Mo(a.parent);e.Tf=a.Tf;e.Ik=a.Ik;!a.n||a.Ac||a.is_character||a.$g||(e.qj=a.qj,e.n=N.yf(a.n));e.Ka=a.Ka;e.cm=a.cm;e.Sd=N.yf(a.Sd);b=[];for(h=0;h<a.K.length;h++){var k=e.K[h];l=a.K[h].V;if(d){for(var k=k.V,g=0;g<l.length;g++)l[g].Tg||(k.push(N.yf(l[g])),b.push(l[g].S));for(g=0;g<l.length;g++)if(l[g].Tg){var q=N.yf(l[g]);k.push(q);for(var m=0;m<b.length;m++)b[m]==
l[g].S&&(q.S=k[m].S)}for(g=0;g<k.length;g++)k[g].S&&f.Mw(k[g].S),k[g].Ki=e.Ih,B.fG(k[g],B.Nz(e.f))}else k.V=N.Mo(l)}N.Rq(e,!1);C(e);e.f.Rp=!0;e.f.Zl=y.Jt(aa);aa++;return e};a.eJ=x;a.aJ=l;a.update_boundings=function(a){for(var b=a.f,c=a.K[0].V,d,e,h,l,k,g,m=0;m<c.length;m++){var r=c[m];if("MAIN"==r.type){var r=r.S.od,u=c[m].S.Yb,n=u.a_position.offset,u=u.a_position.length+n;d=l=r[n];e=k=r[n+1];h=g=r[n+2];for(var t=n;t<u;t+=3){var n=r[t],z=r[t+1],v=r[t+2];d=Math.max(n,d);e=Math.max(z,e);h=Math.max(v,
h);l=Math.min(n,l);k=Math.min(z,k);g=Math.min(v,g)}}}var qa={max_x:parseFloat(d.toFixed(3)),max_y:parseFloat(e.toFixed(3)),max_z:parseFloat(h.toFixed(3)),min_x:parseFloat(l.toFixed(3)),min_y:parseFloat(k.toFixed(3)),min_z:parseFloat(g.toFixed(3))},T=d-l,x=e-k,E=h-g;l=.5*(d+l);var Y=.5*(e+k),F=.5*(h+g),w=l,p=F;k=Math.max(T,Math.max(x,E))/2;g=Math.max(T,E)/2;var Z=[l/(T?T:1),Y/(x?x:1),F/(E?E:1)],wa=.5;if(b.Jd)n=Math.max(Math.abs(qa.max_x),Math.abs(qa.min_x)),z=Math.max(Math.abs(qa.max_y),Math.abs(qa.min_y)),
v=Math.max(Math.abs(qa.max_z),Math.abs(qa.min_z)),k=Math.sqrt(n*n+z*z+v*v),g=Math.sqrt(n*n+z*z),qa.max_x=qa.max_y=qa.max_z=k,qa.min_x=qa.min_y=qa.min_z=-k,l=new Float32Array([0,0,0]),E=new Float32Array([k,k,k]),x=new Float32Array([0,0,0]);else{for(m=0;m<c.length;m++)if(r=c[m],"MAIN"==r.type)for(r=r.S.od,u=c[m].S.Yb,n=u.a_position.offset,u=u.a_position.length+n,t=n;t<u;t+=3){var n=r[t],z=r[t+1],v=r[t+2],y=Math.sqrt((l-n)*(l-n)+(Y-z)*(Y-z)+(F-v)*(F-v));if(y>k){var K=l-k*(n-l)/y,A=Y-k*(z-Y)/y,y=F-k*
(v-F)/y;l=(K+n)/2;Y=(A+z)/2;F=(y+v)/2;k=Math.sqrt((l-n)*(l-n)+(Y-z)*(Y-z)+(F-v)*(F-v))}A=Math.sqrt((w-n)*(w-n)+(p-v)*(p-v));A>g&&(K=w-g*(n-w)/A,y=p-g*(v-p)/A,w=(K+n)/2,p=(y+v)/2,g=Math.sqrt((w-n)*(w-n)+(p-v)*(p-v)));n/=T?T:1;z/=x?x:1;v/=E?E:1;y=Math.sqrt((Z[0]-n)*(Z[0]-n)+(Z[1]-z)*(Z[1]-z)+(Z[2]-v)*(Z[2]-v));y>wa&&(K=Z[0]-wa*(n-Z[0])/y,A=Z[1]-wa*(z-Z[1])/y,y=Z[2]-wa*(v-Z[2])/y,Z[0]=(K+n)/2,Z[1]=(A+z)/2,Z[2]=(y+v)/2,wa=Math.sqrt((Z[0]-n)*(Z[0]-n)+(Z[1]-z)*(Z[1]-z)+(Z[2]-v)*(Z[2]-v)))}m=T?T*Z[0]:d;
e=x?x*Z[1]:e;h=E?E*Z[2]:h;T*=wa;x*=wa;E*=wa;l=new Float32Array([l,Y,F]);E=new Float32Array([T,x,E]);x=new Float32Array([m,e,h]);g=parseFloat(g.toFixed(3))}b.Ub=qa;B.cF(b,g,g,qa);qa=q.em(k,l);b.ud=qa;qa=q.dm([E[0],0,0],[0,E[1],0],[0,0,E[2]],x);b.tf=qa;M.o(a);if(R.wireframe_debug)for(m=0;m<c.length;m++)if("WIREFRAME"===c[m].type&&c[m].Mg){a=Q.wp(1,qa.H);f.Pv(a,[qa.ce[0],qa.de[1],qa.ee[2]],qa.H);f.xn(a,1,!0);a.R.a_polyindex=f.mp(a);B.eG(c[m],a);break}};a.wa=h;a.zC=function(a,b){for(var c=ia.ALL||[],
d=[],e=0;e<c.length;e++){var f=c[e];if((f.f.xc==b||-1==b)&&f.Ul)for(var h=f.K,l=0;l<h.length;l++)h[l].Ga==a&&d.push(f)}return d};a.get_all_objects=function(a){var b=ia.ALL;if(-1==a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.f.xc==a&&c.push(e)}return c};a.wF=function(a){var b=h(a,"LAMP",-1);if(b.length==a.k.LJ){for(var c=[],d=0;d<b.length;d++){var e=b[d],e=N.Sa(e,a);c[e.dh]=d}for(d=0;d<c.length-1;d++)for(e=d+1;e<c.length;e++){var f=b[c[d]].Fa,l=b[c[e]].Fa;if(l.pj&&l.Hh&&(!f.pj||!f.Hh)||
!f.pj&&(l.pj||!f.Hh&&l.Hh))f=c[d],c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)e=b[c[d]],N.Sa(e,a).dh=d,D.Gn(b[c[d]],a)}};a.cG=function(a){for(var b=h(a,"LAMP",-1),c=h(a,"MESH",-1),d=0;d<c.length;d++)for(var e=N.Sa(c[d],a).V,f=0;f<e.length;f++){var l=e[f];"MAIN"==l.type&&(B.gG(l,b,a),B.Fb(l))}};a.cu=function(){for(var a=[],b=ia.MESH,c=0;c<b.length;c++){var d=b[c];d.f.df&&a.push(d)}return a};a.Wb=function(b,c,d,e){var f=null,h=ia.ALL;switch(b){case a.Un:f=v(c,h,!0,d);break;case a.Tn:a:{for(b=0;b<h.length;b++)if(f=
h[b],f.ph==d&&(f.f.xc==e||-1==e)){var l=N.get_dg_parent(f);if(l&&l.ph==c)break a}f=null}break;case a.tc:a:{for(e=0;e<h.length;e++){b=h[e];for(var f=c.length-1,l=b,k=!0;0<=f&&k;)k=l&&l.ph==c[f]&&(l.f.xc==d||-1==d),l&&(l=N.get_dg_parent(l)),f--;if(k&&!l){f=b;break a}}f=null}}return f};a.pick_object=function(b,c){var d=D.oi();if(!d)return F.error("No active scene"),null;var e=D.gE(d,b,c);if(!e)return null;for(var d=h(d,"MESH",-1),f=0;f<d.length;f++){var l=d[f].f,k=l.Zl;if(k&&3>Math.abs(255*k[0]-e[0])&&
3>Math.abs(255*k[1]-e[1])&&3>Math.abs(255*k[2]-e[2]))return l.Eb&&l.hv&&(ha.outlining_overview_mode?a.apply_outline_anim(d[f],ha.Mi,ha.Ni,ha.Oi):(e=l.Li,a.apply_outline_anim(d[f],e.Mi,e.Ni,e.Oi))),d[f]}return null};a.set_wind_params=function(a,c){for(var d=h(a,"EMPTY",-1),e=0;e<d.length;e++){var f=d[e];if(f.fi&&"WIND"===f.fi.type)var l=f}if(!l)return F.error("There is no wind on the scene"),0;"number"==typeof c.wind_dir&&(V.set(-Math.PI/2,c.wind_dir/180*Math.PI,0,ca),y.euler_to_quat(ca,oa),M.set_rotation(l,
oa),b(l));"number"==typeof c.wind_strength&&(l.fi.qw=c.wind_strength,b(l));D.Fr(a)};a.remove_object=function(a){r.Zz(a)&&r.remove(a);var b=ia.ALL,c=ia[a.type],d=b.indexOf(a);a=c.indexOf(a);-1!=d&&b.splice(d,1);-1!=a&&c.splice(a,1)};a.$D=C;a.aE=function(a){return ia[a.type]&&-1<ia[a.type].indexOf(a)};a.set_nodemat_rgb=function(a,b,c,d,e){b=b.join("%join%");var f=l(a,b);null!=f?(a.f.$c[3*f]=c,a.f.$c[3*f+1]=d,a.f.$c[3*f+2]=e):F.error('The RGB node "'+b+'" was not found in the object "'+a.name+'".')};
a.set_nodemat_value=function(a,b,c){b=b.join("%join%");var d=x(a,b);null!=d?a.f.Ye[d]=c:F.error('The Value node "'+b+'" was not found in the object "'+a.name+'".')}};b4w.module.__obj_util=function(a,p){function d(a){if(!(a instanceof Object))return a;var b=null,c=null,e=null;a.Z&&(b=a.Z,a.Z=null);a.$b&&(c=a.$b,a.$b=null);a.fa&&(e=a.fa,a.fa=null);var l;l=a.constructor;switch(l){case Float32Array:case Uint32Array:case Uint16Array:l=new l(a);break;case Array:l=new l(a.length);for(var h=0;h<a.length;h++)l[h]=d(a[h]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:l=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:l=null;break;case Function:l=
a;break;default:for(h in l=new l,a)l[h]=d(a[h])}b&&(l.Z=b,a.Z=b);c&&(l.$b=c,a.$b=c);e&&(l.fa=e,a.fa=e);return l}function b(a,b){for(var c=a.K,d=0;d<c.length;d++){var e=c[d];if(e.Ga==b)return e}return null}function c(a){return a.Tf?a.parent:a.parent?c(a.parent):null}p("__mat4");p("__print");p("__quat");var m=p("__tsr"),e=p("__util"),t=p("__vec4");new Float32Array(4);new Float32Array(4);new Float32Array(4);m.create();m.create();a.$h=function(a){return{type:a,xc:0,KC:[0,0],h:m.Oo(),kb:new Float32Array(3),
Ea:new Float32Array(3),si:0,ti:0,Rp:!1,Zl:null,Rf:0,sr:!1,Tw:!1,Ia:0,ol:1,nl:1,pl:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Me:null,aG:!1,N:null,r:null,Wa:null,tb:null,Xb:null,xt:!0,pu:0,X:null,Yq:null,Li:{Mi:1,Ni:1,Oi:0},vd:null,cd:null,pc:new Float32Array(4),lk:0,gk:0,Bk:0,gh:0,km:!1,Ic:!1,kc:!1,Jc:!1,qc:!1,gc:!1,Gc:!1,pe:"",He:!1,qd:!1,jm:!1,ie:!1,Pb:!1,bi:!1,Xg:!1,Lm:!1,df:!1,Xm:!1,Eb:!1,Wm:!1,hv:!1,Im:!1,is_visible:!1,qp:!1,rl:0,ze:0,mf:0,Le:0,Ke:0,Fe:0,Xe:"",fc:null,Ql:!1,Jd:!1,oo:!1,
Dj:"",Cj:!1,Ad:0,time:0,Jr:0,Xw:0,Ze:0,kk:!1,ac:!1,Xd:!1,$f:[],vi:!1,zg:!1,sf:1,bo:0,ao:1,En:new Int8Array([-1,-1]),sn:[],Su:[],bw:[],Fc:null,dd:null,Lc:null,ld:null,td:null,Yh:null,Bq:null,eo:null,co:null,Ye:null,ih:null,Om:null,$c:null,hh:null,Pm:null,Wh:null,Ub:null,lo:null,jo:null,ko:null,wb:null,ud:null,Vb:null,tf:null,Bg:null,Lf:1E4}};a.Uj=function(a,b,c){c||(c=a);return{name:a,Ih:e.vp(),ph:c,type:b,Ul:!1,ga:!1,yk:!1,Hn:!1,f:null,Va:null,C:null,Fa:null,Ll:null,anchor:null,fi:null,Qm:null,K:[],
ac:[],Kd:[],Lo:[],G:[],Qk:[],Ed:[],Sh:[],Ud:null,Yf:[],parent:null,Tf:!1,Ik:"",qj:!1,Ka:"",cm:"AUTO",Ac:!1,is_character:!1,$g:!1,n:null,l:null,zd:null,Mc:null,gi:null,Rs:null,Aq:[],Sd:{bn:"NO_COLLISION",ll:!1,Vw:!1,le:0,$w:0,Zw:0,Xo:0,Pq:0,xD:!1,yD:!1,zD:!1,AD:!1,BD:!1,CD:!1,Pj:0,Nj:0,Qj:0,Gr:!1,Yl:"BOX",kl:!1},gv:{yn:0,vq:0,bd:0,Kq:0},Hl:0,actions:[],oq:!1}};a.Mo=function(a){return a instanceof Array?a.slice():a};a.yf=d;a.ga=function(a){return a.ga};a.Sp=function(a){return"MESH"==a.type&&a.ga};a.Kl=
function(a,b){a.K.push({Ga:b,Gm:!1,V:[],Uf:null,zf:null,Zq:[],dh:0,ev:!1})};a.Jl=function(a,c,d){b(a,c).V.push(d)};a.RJ=function(a,b){for(var c=a.K,d=0;d<c.length;d++)if(c[d].Ga==b){c.splice(d,1);break}};a.Sa=b;a.Ow=function(a,b){for(var c=0;c<a.length;c++)t.copy(b,a[c].f.pc)};a.Rq=function(a,b,c){for(var d=0;d<a.K.length;d++){var e=a.K[d];c&&e.Ga!=c||(e.Gm=b)}};a.wm=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.Fa.Mt)return c}return null};a.Kt=function(a,b){return a+"*"+b};a.get_parent=
function(a){return a.Tf?null:a.parent};a.get_dg_parent=c;a.zp=function(a,b){for(var d=[],e=0;e<b.length;e++){var l=b[e];c(l)==a&&d.push(l)}return d};a.is_mesh=function(a){return"MESH"===a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.is_speaker=function(a){return"SPEAKER"===a.type};a.is_camera=function(a){return"CAMERA"===a.type};a.is_lamp=function(a){return"LAMP"===a.type};a.is_empty=function(a){return"EMPTY"===a.type}};b4w.module.__particles=function(a,p){function d(){throw"_rand() undefined";}function b(a,b,c,d,e,k,q){var m=a.im,u=a.Nd,r=a.time;a=a.vv;for(var f=b?4:1,n=0;n<m.length;n+=f){var w=m[n];if(r>a&&r>=w&&w>a||r<a&&(w>a||r>=w))for(w=0;8>w;w++)u[8*n+w]=e[w];for(w=0;8>w;w++)g[w]=u[8*n+w];w=x;w[0]=c[3*n];w[1]=c[3*n+1];w[2]=c[3*n+2];t.transform_vec3(w,g,w);k[3*n]=w[0];k[3*n+1]=w[1];k[3*n+2]=w[2];var p=x;p[0]=d[3*n];p[1]=d[3*n+1];p[2]=d[3*n+2];t.transform_dir_vec3(p,g,p);q[3*n]=p[0];q[3*n+1]=p[1];q[3*n+2]=p[2];
if(b)for(w=1;4>w;w++)k[3*(n+w)]=k[3*n],k[3*(n+w)+1]=k[3*n+1],k[3*(n+w)+2]=k[3*n+2],q[3*(n+w)]=p[0],q[3*(n+w)+1]=p[1],q[3*(n+w)+2]=p[2]}}function c(a){a?(k.GF(a),d=function(){return k.uE()}):d=function(){return Math.random()}}p("__config");var m=p("__geometry");p("__scenes");var e=p("__time"),t=p("__tsr"),k=p("__util"),n=p("__vec3"),g=new Float32Array(8),x=new Float32Array(3);a.Ii=function(a){a=a.K;for(var b=0;b<a.length;b++)for(var c=a[b].V,d=0;d<c.length;d++)if(c[d].za)return!0;return!1};a.uq=function(a){a=
a.K;for(var b=0;b<a.length;b++)for(var c=a[b].V,d=0;d<c.length;d++){var e=c[d].za;if(e&&"EMITTER"==e.wq)return!0}return!1};a.Jz=function(a){return 0<a.particle_systems.length};a.Iz=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.NC=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.RC=function(a,b,c){var d=a.za={name:b.name,
wq:b.settings.type,time:0,vv:-1,Ir:!1,L:0,ea:0,Cw:0,$p:0,Hu:0,cyclic:!1,le:0,pq:0,fu:0,Rg:0,Uc:0,ox:0,size:0,ps:0,os:0,aw:0,$s:0,$v:new Float32Array(8),Zs:new Float32Array(16),Qi:null,qv:null,$u:null,av:null,im:null,bp:null,Nd:null};d.L=b.settings.frame_start;d.ea=b.settings.frame_end;d.Cw=(d.ea-d.L)/e.Rb();d.$p=b.settings.lifetime;d.Hu=d.$p/e.Rb();d.cyclic=b.settings.b4w_cyclic?1:0;d.le=b.settings.mass;d.pq=b.settings.normal_factor;d.fu=9.81*b.settings.effector_weights.gravity;d.Rg=b.settings.b4w_fade_in/
e.Rb();d.Uc=b.settings.b4w_fade_out/e.Rb();d.ox=b.settings.effector_weights.wind;d.Ir="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var k,g;a.Wg?(a=c.halo.size,k=c.halo.hardness,30>k?(k=.5,g=.9):40>k?(k=.1,g=1):50>k?(k=0,g=.8):(k=0,g=.5)):(a=b.settings.particle_size,g=k=1);d.size=a;d.ps=k;d.os=g;a=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(a[0]&&a[0].use_map_size&&a[0].texture&&"BLEND"==a[0].texture.type&&a[0].texture.use_color_ramp){a=a[0].texture.color_ramp.elements;k=Math.min(2*a.length,
b.length);for(g=0;g<k;g+=2){var q=a[g/2];b[g]=q.position;b[g+1]=(q.color[0]+q.color[1]+q.color[2])/3}d.aw=a.length}d.$v.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){a=b[0].texture.color_ramp.elements;k=Math.min(4*a.length,c.length);for(g=0;g<k;g+=4)q=a[g/4],c[g]=q.position,c[g+1]=q.color[0],c[g+2]=q.color[1],c[g+3]=q.color[2];d.$s=a.length}d.Zs.set(c)};a.XB=function(a,
h,g,t){var x=a.za,p=g.settings.count,q=g.settings.frame_start/e.Rb(),z=g.settings.frame_end/e.Rb(),u=g.settings.lifetime/e.Rb(),r=g.settings.lifetime_random,f=g.settings.emit_from,E=g.settings.factor_random,w=g.settings.angular_velocity_mode,N=g.settings.angular_velocity_factor,O=g.settings.b4w_randomize_emission,K=g.settings.b4w_cyclic,F=!a.Wg;c(g.seed);h=m.Ct(h,["a_position","a_normal"],null);switch(f){case "VERT":g=h.A[0].a_position;h=h.A[0].a_normal;for(var Q=g.length/3,f=[],J=0;J<p;J++){var D=
Math.round((Q-1)*d());f.push(D);F&&(f.push(D),f.push(D),f.push(D))}Q=[];for(J=0;J<f.length;J++)Q.push(g[3*f[J]]),Q.push(g[3*f[J]+1]),Q.push(g[3*f[J]+2]);g=new Float32Array(Q);Q=[];for(J=0;J<f.length;J++)Q.push(h[3*f[J]]),Q.push(h[3*f[J]+1]),Q.push(h[3*f[J]+2]);f=new Float32Array(Q);break;case "FACE":g=[];f=[];J=[];k.Em(0,J);Q=m.xp(h,p,!1,J);k.Em(0,J);h=m.xp(h,p,!0,J);for(J=0;J<Q.length;J++)g.push(Q[J][0],Q[J][1],Q[J][2]),F&&(g.push(Q[J][0],Q[J][1],Q[J][2]),g.push(Q[J][0],Q[J][1],Q[J][2]),g.push(Q[J][0],
Q[J][1],Q[J][2])),f.push(h[J][0],h[J][1],h[J][2]),F&&(f.push(h[J][0],h[J][1],h[J][2]),f.push(h[J][0],h[J][1],h[J][2]),f.push(h[J][0],h[J][1],h[J][2]));g=new Float32Array(g);f=new Float32Array(f);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}f=[g,f];h=f[0];f=f[1];x.Qi=new Float32Array(h);x.$u=new Float32Array(f);x.qv=new Float32Array(h.length);x.av=new Float32Array(f.length);g=[];z=(z-q)/p;for(Q=0;Q<p;Q++)J=O?z*Q+10*z*(.5-d()):z*Q,
K||(J+=q),g.push(J),F&&(g.push(J),g.push(J),g.push(J));q=new Float32Array(g);x.im=new Float32Array(q);x.bp=new Float32Array(q);x.Nd=new Float32Array(8*q.length);for(O=0;O<8*q.length;O++)for(K=0;8>K;K++)x.Nd[8*O+K]=t[K];x.Ir&&b(x,F,h,f,t,h,f);t=k.Ib("EMITTER_PARTICLES");x=k.Ld();x.a_position=h;x.a_normal=f;t.A[0]=x;if(F){a.Ne=m.wl;a=[];for(x=0;x<p;x++)a.push(4*x,4*x+2,4*x+1,4*x,4*x+3,4*x+2);a=new Uint16Array(a);t.xa=a;a=t.R;x=[];for(O=0;O<p;O++)x.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);x=new Float32Array(x);
a.a_p_bb_vertex=x}else a.Ne=m.Vr,t.xa=new Uint16Array(0);t.U=h.length/3;t.R.a_p_delay=q;a=t.R;x=[];r*=u;for(q=0;q<p;q++)O=r*d(),x.push(u-O),F&&(x.push(u-O),x.push(u-O),x.push(u-O));u=new Float32Array(x);a.a_p_lifetime=u;u=t.R;r=[];for(a=0;a<p;a++){x=[d()-.5,d()-.5,d()-.5];n.normalize(x,x);r.push(E*x[0]);r.push(E*x[1]);r.push(E*x[2]);switch(w){case "NONE":r.push(0);break;case "SPIN":case "VELOCITY":r.push(N);break;case "RAND":r.push(2*N*(d()-.5));break;default:throw"Undefined velocity factor";}if(F)for(x=
r.slice(-4),q=0;12>q;q++)r.push(x[q%4])}p=new Float32Array(r);u.a_p_vels=p;return t};a.rG=function(a,c){for(var d=0;d<c.length;d++){var e=c[d],k=c[d].za;if(k){var g=e.S;if(!k.Ir)break;var q=k.qv,n=k.av;b(k,!e.Wg,k.Qi,k.$u,a.f.h,q,n);m.HD(g);m.Fn(g,"a_position",3,q);m.Fn(g,"a_normal",3,n)}}};a.hF=function(a,b,c){a=a.K;for(var d=0;d<a.length;d++)for(var e=a[d].V,k=0;k<e.length;k++){var g=e[k].za;g&&g.name==b&&(g.vv=g.time,g.time=c)}};a.pE=function(a){for(var b=a.U,c=a.A[0].a_position,d=a.R.a_texcoord,
e=[],k=[],g=0;g<b;g++)k.push(c[3*g]),k.push(c[3*g+1]),e.push(c[3*g+2]);e=new Float32Array(e);k=new Float32Array(k);a.R.a_lf_dist=e;a.R.a_lf_bb_vertex=k;a.R.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.K;for(var d=0;d<a.length;d++)for(var e=a[d].V,k=0;k<e.length;k++){var g=e[k].za;g&&g.name==b&&(g.size=c)}};a.set_normal_factor=function(a,b,c){a=a.K;for(var d=0;d<a.length;d++)for(var e=a[d].V,k=0;k<e.length;k++){var g=e[k].za;g&&g.name==b&&(g.pq=c)}};a.set_factor=function(a,b,c){a=a.K;for(var d=
0;d<a.length;d++)for(var e=a[d].V,k=0;k<e.length;k++){var g=e[k],n=g.za;if(n&&n.name==b){var u=n.im;if(1==c)n=u;else if(0==c)for(var r=!g.Wg,f=r?4:1,n=n.bp,t=0;t<n.length;t+=f)n[t]=1E4,r&&(n[t+1]=n[t],n[t+2]=n[t],n[t+3]=n[t]);else for(var x=1/c,n=n.bp,f=(r=!g.Wg)?4:1,p=0,t=0;t<n.length;t+=f)t>=p?(n[t]=u[t],p+=x):n[t]=1E4,r&&(n[t+1]=n[t],n[t+2]=n[t],n[t+3]=n[t]);m.Fn(g.S,"a_p_delay",1,n)}}};a.DG=function(a,b,c){a=a.K;for(var d=0;d<a.length;d++)for(var e=a[d].V,k=0;k<e.length;k++){var g=e[k].za;if(g)for(var m=
0;m<8*g.im.length;m++)g.Nd[8*m]=b[0],g.Nd[8*m+1]=b[1],g.Nd[8*m+2]=b[2],g.Nd[8*m+3]=b[3],g.Nd[8*m+4]=c[0],g.Nd[8*m+5]=c[1],g.Nd[8*m+6]=c[2],g.Nd[8*m+7]=c[3]}}};b4w.module.__primitives=function(a,p){function d(a,b,c,d){for(var e=[],m=[],n=[],t=[],q=2*c/(a-1),z=2*d/(b-1),u=0;u<a;u++)for(var r=-c+u*q,f=0;f<b;f++)if(m.push(r,0,-d+f*z),n.push(0,1,0),t.push(u/(a-1),f/(b-1)),u&&f){var E=u*b+f,w=E-1,p=(u-1)*b+f,O=p-1;e.push(E,w,p);e.push(w,O,p)}a=k.Ld();a.a_position=new Float32Array(m);a.a_normal=new Float32Array(n);n=k.Ib("GRID_PLANE");n.A[0]=a;n.R.a_texcoord=new Float32Array(t);n.xa=new Uint32Array(e);n.U=m.length/3;return n}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],d=[],e=0;e<b;e+=4){var n=a[e+1],t=a[e+2],p=a[e+3];m(a[e],d);m(n,d);m(t,d);m(p,d);c.push(e,e+1,e+2);c.push(e,e+2,e+3)}a=k.Ld();a.a_position=new Float32Array(d);b=k.Ib("FROM_QUADS");b.A[0]=a;b.xa=new Uint32Array(c);b.U=d.length/3;return b}function c(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function m(a,b){b.push(a[0],a[1],a[2])}var e=p("__config"),t=p("__geometry");p("__print");var k=p("__util"),n=e.p;a.SI=function(a){for(var b=k.Ib("LINE"),c=[],d=0;d<2*a;d++)c.push(d);
d=k.Ld();d.a_point=new Float32Array(c);b.A[0]=d;b.xa=new Uint32Array(c);b.U=2*a;return b};a.TI=function(a,b){var c=d(2,2,a,b);c.name="PLANE";return c};a.RI=d;a.bC=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==B-1)||1==b%2&&(0==a||a==p-1)?!0:!1}var e=c/=Math.pow(2,a-1),m=c,p=b+1,B=b+1;b=[];c=[];for(var q=0,z=0,u=-1,r=[],f=0;f<a;f++){for(var E=2*e/(p-1),w=2*m/(B-1),N=[],O=[],K=0,F=0;F<p;F++){for(var Q=-e+F*E,J=[],D=0;D<B;D++){var G=-m+D*w;if(Q>-q&&Q<q&&G>-z&&G<z)J.push(-1),K++;else{for(var M=
null,I=0;I<r.length;I+=3)if(Q==r[I]&&G==r[I+1]){M=r[I+2];break}I=null!==M?M:u+1;d(F,D)?(J.push(-2),K++):(null==M&&(0==D||D==B-1||0==F||F==p-1?(M=f==a-1?E:2*E,N.push(Q,G,I)):M=E,c.push(Q,M,G),u++),J.push(I));if(F&&D)if(1==F)if(d(F-1,D)){if(1<D){var G=I-1,M=O[F-1][D+1],y=M-1;b.push(I,G,y)}else M=O[F-1][D+1],y=M-1;b.push(I,y,M)}else d(F,D)||(G=I-1,M=O[F-1][D],b.push(I,G,M));else if(F==p-1){if(!d(F,D))if(D==B-1)G=I-1,M=O[F-1][D-1],y=O[F-2][D],b.push(I,G,M),b.push(I,M,y);else{var G=I-1,M=O[F-1][D],y=M-
1,V=M+1;b.push(I,G,y);b.push(I,y,M);b.push(I,M,V);2==D&&(V=O[F-2][D-2],b.push(G,V,y))}}else 1==D?d(F,D-1)?(G=O[F-1][D],M=O[F-1][D-1],b.push(I,M,G)):(G=J[D-1],M=O[F-1][D],y=O[F-2][D-1],b.push(I,G,M),b.push(G,y,M)):D==B-1?d(F,D)||(G=J[D-1],M=O[F-1][D-1],y=O[F-2][D],b.push(I,G,M),b.push(I,M,y)):-1!=O[F-1][D]&&-1!=O[F-1][D-1]&&-1!=J[D-1]?(G=J[D-1],M=O[F-1][D],y=O[F-1][D-1],b.push(I,G,M),b.push(G,y,M),D==B-2&&d(F,D+1)&&(V=O[F-1][D+1],b.push(I,M,V))):D==B-2&&d(F,D+1)&&(M=O[F-1][D],V=O[F-1][D+1],b.push(I,
M,V))}}O.push(J)}r=N;q=e;z=m;e*=2;m*=2}2E4>q&&(a=-(2*q)/(p-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-q,a,-z),c.push(-q,a,z),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(q,a,-z),c.push(q,a,z),I=u+1,b.push(I+3,I+2,I+1,I+2,I+0,I+1,I+6,I+4,I+2,I+4,I+0,I+2,I+5,I+7,I+1,I+7,I+3,I+1,I+5,I+4,I+7,I+7,I+4,I+6));a=k.Ld();a.a_position=new Float32Array(c);e=k.Ib("multigrid_plane");e.A[0]=a;e.xa=new Uint32Array(b);e.U=c.length/3;n.nx&&(t.xn(e,1,!0),a.a_polyindex=t.mp(e));return e};a.QI=function(a){var b=
a.length;if(b%3)throw"Wrong array";for(var c=[],d=[],e=0;e<b;e+=3){var n=a[e+1],t=a[e+2];m(a[e],d);m(n,d);m(t,d);c.push(e,e+1,e+2)}a=k.Ld();a.a_position=new Float32Array(d);b=k.Ib("FROM_TRIANGLES");b.A[0]=a;b.xa=new Uint32Array(c);b.U=d.length/3;return b};a.OI=b;a.YB=function(a){a=k.YG(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};
a.Jb=function(){var a=k.Ib("FULLSCREEN_TRI"),b=k.Ld();b.a_position=new Float32Array([0,0,1,0,0,1]);a.A[0]=b;a.xa=new Uint32Array([0,1,2]);a.U=3;return a};a.ZB=function(){var a=k.Ib("FULLSCREEN_QUAD"),b=k.Ld();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.A[0]=b;a.xa=new Uint32Array([0,2,1,1,2,3]);a.U=4;return a};a.UB=function(){var a=k.Ib("BILLBOARD"),b=k.Ld();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.A[0]=b;a.xa=new Uint32Array([0,2,1,0,3,2]);a.U=4;return a};a.VB=function(){var a=
k.Ib("CUBEMAP_BOARD"),b=k.Ld();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.A[0]=b;a.xa=new Uint32Array([0,2,1,0,3,2]);a.U=4;return a};a.wp=function(a,b){var d=k.Ib("UV_SPHERE"),e,n,p=[],A=[],B=[];for(n=0;8>=n;n++)for(e=0;16>=e;e++){var q=e/16,z=n/8;A.push(-a*Math.cos(2*q*Math.PI)*Math.sin(z*Math.PI)+b[0],a*Math.cos(z*Math.PI)+b[1],a*Math.sin(2*q*Math.PI)*Math.sin(z*Math.PI)+b[2])}for(n=q=0;8>n;n++)for(e=0;16>e;e++){var z=c(A,17*n+e+1),u=c(A,17*n+e),r=c(A,17*(n+1)+e),f=c(A,17*(n+1)+e+1);
Math.abs(z[1])==a+b[1]?(m(z,p),m(r,p),m(f,p),B.push(q,q+1,q+2),q+=3):Math.abs(r[1])==a+b[1]?(m(z,p),m(u,p),m(r,p),B.push(q,q+1,q+2),q+=3):(m(z,p),m(u,p),m(r,p),m(f,p),B.push(q,q+1,q+2),B.push(q,q+2,q+3),q+=4)}e={};e.a_position=p;A=t.Js(B,A,p);e.a_normal=t.Is(B,p,A);e.a_tangent=[];d.R.a_influence=[];d.R.a_color=[];d.R.a_texcoord=[];d.A[0]=e;d.xa=B;d.U=p.length/3;return d};a.Lt=function(a){var b=k.Ib("INDEX"),c=k.Ld();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.A[0]=c;b.xa=new Uint16Array(0);
b.U=a;return b}};b4w.module.__prerender=function(a,p){function d(a,b){var d=a.Rd;d.is_visible=!1;var e=b.j,g="SHADOW_CAST"==b.type?e.Mu:t.get_trans_view(e.h),m;if(!(m=!d||d.Xg)){var q=d.Vb.H;m=d.Lf;g=Math.sqrt((q[0]-g[0])*(q[0]-g[0])+(q[1]-g[1])*(q[1]-g[1])+(q[2]-g[2])*(q[2]-g[2]));q=d.gh*d.Vb.Ya;m=!(g>=d.Bk&&g<m+q)}if(m)return!1;d.is_visible=!0;(m="OUTLINE_MASK"==b.type&&!Boolean(d.Rf))||(e=e.mk,d.bi?m=!1:("STATIC"===d.type?(m=d.Vb,d=m.H,d=k.BF(d,e,m.Ya)):(m=d.Bg,d=m.H,d=k.tB(d,e,m.ce,m.de,m.ee)),m=d));return m?
!1:"WIREFRAME"==b.type?a.D.wireframe_mode==c.WM_DEBUG_SPHERES?a.D.Mg:!a.D.Mg:!0}var b=p("__config"),c=p("__debug"),m=p("__geometry"),e=p("__renderer"),t=p("__tsr"),k=p("__util"),n=p("__vec3"),g=b.p,x="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Cq=function(a){if(-1<x.indexOf(a.type)){for(var b=!1,c=a.q,k=0;k<c.length;k++){var p=c[k];if("MAIN_CUBE_REFLECT"==a.type)for(var B=0;6>
B;B++)a.j.mk=a.To[B],p.ep[B]=d(p,a),p.ep[B]&&(b=!0);else p.yb=d(p,a),p.yb&&(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||"MAIN_GLOW"===a.type||b?a.yb=!0:(a.yb&&e.clear(a),a.yb=!1)}}if("MAIN_BLEND"==a.type&&g.alpha_sort&&a.q){b=t.get_trans_view(a.j.h);c=n.dist(b,a.rx)>g.alpha_sort_threshold;for(k=0;k<a.q.length;k++)if(B=a.q[k],p=B.Rd,p.qp||c){var q=B.D;if(q&&q.Ua&&q.pf!=m.Be){q=q.S;if(!q||!B.yb)continue;(B=q.Dm)&&B.type==m.es&&m.lG(q,p.h,b)}p.qp=!1}c&&
n.copy(b,a.rx)}}};b4w.module.__print=function(a){function p(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var d=1;d<a.length;d++)c.push(a[d]);return c}function d(){e++;var a=p(arguments,"B4W ERROR");console.error.apply(console,a)}function b(a){a in k||(k[a]=a,d([a]))}function c(a,c){b(a+"() is deprecated, use "+c+"() instead.")}var m=!1,e=0,t=0,k={};a.iF=function(a){m=a};a.fq=function(){console.log.apply(console,arguments)};a.log=function(){if(m){var a=p(arguments,
"B4W LOG");console.log.apply(console,a)}};a.error=d;a.Pg=b;a.W=c;a.Qe=function(a,d){switch(1<d.length){case !0:b(a+"() is deprecated, use "+d.slice(0,-1).join("(), ")+"() or "+d[d.length-1]+"() instead.");break;case !1:c(a,d[0])}};a.warn=function(){t++;var a=p(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=p(arguments,"B4W INFO");console.info.apply(console,a)};a.xB=function(){e++;var a=p(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.yB=function(){t++;
var a=p(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){m&&console.time.apply(console,arguments)};a.timeEnd=function(){m&&console.timeEnd.apply(console,arguments)};a.group=function(){m&&console.group.apply(console,arguments)};a.groupCollapsed=function(){m&&console.groupCollapsed.apply(console,arguments)};a.groupEnd=function(){m&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.HC=
function(){return t};a.rC=function(){return e};a.clear_errors_warnings=function(){e=t=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function d(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",c("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,c("node material",a,"alpha"));"darkness"in a||(a.darkness=1,c("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,c("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,c("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in
a||(a.diffuse_intensity=1,c("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",c("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,c("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,c("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,c("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,c("node material",a,"specular_toon_size"));
"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,c("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,c("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",c("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,c("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,c("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,c("node material",
a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,c("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}}}
function b(a){if(a=a.nla_tracks)for(var b=0;b<a.length;b++)for(var d=a[b],e=0;e<d.strips.length;e++){var h=d.strips[e];"action"in h||(h.action=null,c("strip",h,"action"));"action_frame_start"in h||(h.action_frame_start=0,c("strip",h,"action_frame_start"));"action_frame_end"in h||(h.action_frame_end=h.frame_end-h.frame_start,c("strip",h,"action_frame_end"));"repeat"in h||(h.repeat=1,c("strip",h,"repeat"));"use_reverse"in h||(h.use_reverse=!1,c("strip",h,"use_reverse"));"scale"in h||(h.scale=1,c("strip",
h,"scale"))}}function c(a,b,c){c=c+">>"+a;c in A||(A[c]={lr:[],Iv:"undefined",type:a});A[c].lr.push(b.name)}function m(a,b,c){c=c+">>"+a;c in A||(A[c]={lr:[],Iv:"deprecated",type:a});A[c].lr.push(b.name)}function e(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=l.Gg(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=l.Mj(d[c]);e.submeshes.push(f)}return e}var t=p("__boundings"),k=
p("__curve"),n=p("__mat4"),g=p("__print"),x=p("__quat"),l=p("__util"),h=p("__vec3"),v=p("__vec4"),C=[5,4],A={};a.Ts=function(a){return-1!=l.ax(a,C)};a.Xz=function(a){A={};var e=a.worlds;if(0==e.length){g.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var h={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},fog_settings:{use_fog:!1,
intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};e.push(h)}for(var e=a.worlds,k=0;k<e.length;k++){h=e[k];"use_sky_blend"in h||(c("world",h,"use_sky_blend"),h.use_sky_blend=!1);"use_sky_paper"in h||(c("world",h,"use_sky_paper"),h.use_sky_paper=!1);"use_sky_real"in h||(c("world",h,"use_sky_real"),h.use_sky_real=!1);"b4w_sky_settings"in h&&"rayleigh_brightness"in h.b4w_sky_settings||
(c("world",h,"rayleigh_brightness"),h.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in h||(c("world",h,"fog_settings"),h.fog_settings={use_fog:!1,intensity:0,depth:25,start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},
"b4w_fog_color"in h&&(h.fog_settings.use_custom_color=!0,h.fog_settings.color=h.b4w_fog_color),"b4w_fog_density"in h&&0<h.b4w_fog_density&&(h.fog_settings.depth=1/h.b4w_fog_density));"render_sky"in h.b4w_sky_settings||(c("world",h,"render_sky"),h.b4w_sky_settings.render_sky=!1);for(var r=h.texture_slots,h=0;h<r.length;h++){var f=r[h];"blend_type"in f||(f.blend_type="MIX",c("world_texture_slot",f,"blend_type"));"use_map_blend"in f||(f.use_map_blend=!1,c("world_texture_slot",f,"use_map_blend"));"use_map_horizon"in
f||(f.use_map_horizon=!0,c("world_texture_slot",f,"use_map_horizon"));"use_map_zenith_up"in f||(f.use_map_zenith_up=!1,c("world_texture_slot",f,"use_map_zenith_up"));"use_rgb_to_intensity"in f||(f.use_rgb_to_intensity=!1,c("world_texture_slot",f,"use_rgb_to_intensity"));"invert"in f||(f.invert=!1,c("world_texture_slot",f,"invert"));"color"in f||(f.color=[1,0,1],c("world_texture_slot",f,"color"));"blend_factor"in f||(f.blend_factor=0,c("world_texture_slot",f,"blend_factor"));"horizon_factor"in f||
(f.horizon_factor=1,c("world_texture_slot",f,"horizon_factor"));"zenith_up_factor"in f||(f.zenith_up_factor=0,c("world_texture_slot",f,"zenith_up_factor"));"zenith_down_factor"in f||(f.zenith_down_factor=0,c("world_texture_slot",f,"zenith_down_factor"));"default_value"in f||(f.default_value=1,c("world_texture_slot",f,"default_value"))}}h=a.scenes;for(k=0;k<h.length;k++)r=h[k],f=r.world,"timeline_markers"in r||(r.timeline_markers=null,c("scene",r,"timeline_markers")),"b4w_reflection_quality"in r||
(r.b4w_reflection_quality="MEDIUM",c("scene",r,"b4w_reflection_quality")),"b4w_use_nla"in r||(r.b4w_use_nla=!1,c("scene",r,"b4w_use_nla")),"fps"in r||(r.fps=24,c("scene",r,"fps")),"b4w_nla_cyclic"in r||(r.b4w_nla_cyclic=!1,c("scene",r,"b4w_nla_cyclic")),"b4w_logic_nodes"in r||(r.b4w_logic_nodes=[],c("scene",r,"b4w_logic_nodes")),"b4w_detect_collisions"in r&&(m("scene",r,"b4w_detect_collisions"),delete r.b4w_detect_collisions),"audio_doppler_speed"in r||(r.audio_doppler_speed=343.3),"audio_doppler_factor"in
r||(r.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in r||(r.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},c("scene",r,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in r||(r.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in r||(r.b4w_enable_bloom=!1,c("scene",r,"b4w_enable_bloom")),"b4w_enable_motion_blur"in r||(r.b4w_enable_motion_blur=!1,c("scene",r,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in r||(r.b4w_enable_color_correction=
!1,c("scene",r,"b4w_enable_color_correction")),"b4w_antialiasing_quality"in r||(r.b4w_antialiasing_quality="MEDIUM",c("scene",r,"b4w_antialiasing_quality")),"b4w_tags"in r||(r.b4w_tags={title:"",description:""},c("scene",r,"b4w_tags")),"b4w_enable_object_selection"in r||(r.b4w_enable_object_selection="AUTO",c("scene",r,"b4w_enable_object_selection")),"b4w_enable_outlining"in r||(r.b4w_enable_outlining="AUTO",c("scene",r,"b4w_enable_outlining")),"b4w_enable_glow_materials"in r||(r.b4w_enable_glow_materials=
"AUTO",c("scene",r,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in r||(r.b4w_enable_anchors_visibility="AUTO",c("scene",r,"b4w_enable_anchors_visibility")),"b4w_outline_color"in r||(r.b4w_outline_color=[1,1,1],c("scene",r,"b4w_outline_color")),"b4w_outline_factor"in r||(r.b4w_outline_factor="b4w_glow_factor"in r?r.b4w_glow_factor:1,c("scene",r,"b4w_outline_factor")),"b4w_shadow_settings"in r||(c("scene",r,"b4w_shadow_settings"),e=f.b4w_shadow_settings,r.b4w_shadow_settings=e?e:{csm_resolution:2048,
self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),e=r.b4w_shadow_settings,"csm_resolution"in e||(c("scene",r,"b4w_shadow_settings.csm_resolution"),e.csm_resolution=2048),"self_shadow_polygon_offset"in e||(c("scene",r,"b4w_shadow_settings.self_shadow_polygon_offset"),e.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in e||
(c("scene",r,"b4w_shadow_settings.self_shadow_normal_offset"),e.self_shadow_normal_offset=.01),"b4w_enable_csm"in e||(c("scene",r,"b4w_shadow_settings.b4w_enable_csm"),e.b4w_enable_csm=!1),"csm_num"in e||(c("scene",r,"b4w_shadow_settings.csm_num"),e.csm_num=1),"csm_first_cascade_border"in e||(c("scene",r,"b4w_shadow_settings.csm_first_cascade_border"),e.csm_first_cascade_border=10),"first_cascade_blur_radius"in e||(c("scene",r,"b4w_shadow_settings.first_cascade_blur_radius"),e.first_cascade_blur_radius=
3),"csm_last_cascade_border"in e||(c("scene",r,"b4w_shadow_settings.csm_last_cascade_border"),e.csm_last_cascade_border=100),"last_cascade_blur_radius"in e||(c("scene",r,"b4w_shadow_settings.last_cascade_blur_radius"),e.last_cascade_blur_radius=1.5),"fade_last_cascade"in e||(c("scene",r,"b4w_shadow_settings.fade_last_cascade"),e.fade_last_cascade=!0),"blend_between_cascades"in e||(c("scene",r,"b4w_shadow_settings.blend_between_cascades"),e.blend_between_cascades=!0),"b4w_ssao_settings"in r||(c("scene",
r,"b4w_ssao_settings"),e=f.b4w_ssao_settings,r.b4w_ssao_settings=e?e:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),e=r.b4w_ssao_settings,"dist_factor"in e||(c("scene",r,"b4w_ssao_settings.dist_factor"),e.dist_factor=0),"samples"in e||(c("scene",r,"b4w_ssao_settings.samples"),e.samples=16),"hemisphere"in e||(c("scene",r,"b4w_ssao_settings.hemisphere"),e.hemisphere=!1),"blur_depth"in e||(c("scene",r,"b4w_ssao_settings.blur_depth"),e.blur_depth=!1),"blur_discard_value"in
e||(c("scene",r,"b4w_ssao_settings.blur_discard_value"),e.blur_discard_value=1),"b4w_bloom_settings"in r||(c("scene",r,"b4w_bloom_settings"),e=f.b4w_bloom_settings,r.b4w_bloom_settings=e?e:{key:.2,blur:4,edge_lum:1}),"key"in r.b4w_bloom_settings||(c("scene",r,"b4w_bloom_settings.key"),r.b4w_bloom_settings.key=.2),"blur"in r.b4w_bloom_settings||(c("scene",r,"b4w_bloom_settings.blur"),r.b4w_bloom_settings.blur=4),"edge_lum"in r.b4w_bloom_settings||(c("scene",r,"b4w_bloom_settings.edge_lum"),r.b4w_bloom_settings.edge_lum=
1),"b4w_motion_blur_settings"in r||(c("scene",r,"b4w_motion_blur_settings"),e=f.b4w_motion_blur_settings,r.b4w_motion_blur_settings=e?e:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in r.b4w_motion_blur_settings||(c("scene",r,"b4w_motion_blur_settings.motion_blur_factor"),r.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in r.b4w_motion_blur_settings||(c("scene",r,"b4w_motion_blur_settings.motion_blur_decay_threshold"),r.b4w_motion_blur_settings.motion_blur_decay_threshold=
.01),"b4w_color_correction_settings"in r||(c("scene",r,"b4w_color_correction_settings"),e=f.b4w_color_correction_settings,r.b4w_color_correction_settings=e?e:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in r||(c("scene",r,"b4w_god_rays_settings"),e=f.b4w_god_rays_settings,r.b4w_god_rays_settings=e?e:{intensity:.7,max_ray_length:1,steps_per_pass:10}),"steps_per_pass"in r.b4w_god_rays_settings||(c("scene",r,"b4w_god_rays_settings.steps_per_pass"),r.b4w_god_rays_settings.steps_per_pass=
10),"b4w_glow_settings"in r||(c("scene",r,"b4w_glow_settings"),r.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},e=r.b4w_glow_settings,"b4w_render_glow_over_blend"in f&&(e.render_glow_over_blend=f.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in f&&(e.small_glow_mask_coeff=f.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in f&&(e.large_glow_mask_coeff=f.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in
f&&(e.small_glow_mask_width=f.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in f&&(e.large_glow_mask_width=f.b4w_large_glow_mask_width)),f=r.b4w_render_shadows,"AUTO"!=f&&"OFF"!=f&&"ON"!=f&&(r.b4w_render_shadows=f?"ON":"OFF"),f=r.b4w_render_reflections,"OFF"!=f&&"ON"!=f&&(r.b4w_render_reflections=f?"ON":"OFF"),f=r.b4w_render_refractions,"AUTO"!=f&&"OFF"!=f&&"ON"!=f&&(r.b4w_render_refractions=f?"ON":"OFF"),r.b4w_nla_script&&m("scene",r,"b4w_nla_script");r=a.meshes;for(k=0;k<r.length;k++){f=
r[k];f.b4w_bounding_box||(c("mesh",f,"b4w_bounding_box"),f.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});f.b4w_bounding_box_source||(c("mesh",f,"b4w_bounding_box_source"),f.b4w_bounding_box_source=f.b4w_bounding_box);f.uv_textures||(c("mesh",f,"uv_textures"),f.uv_textures=[]);f.b4w_bounding_sphere_center||(f.b4w_bounding_sphere_center=[0,0,0]);f.b4w_bounding_cylinder_center||(f.b4w_bounding_cylinder_center=[0,0,0]);f.b4w_bounding_ellipsoid_center||(f.b4w_bounding_ellipsoid_center=
[0,0,0]);f.b4w_bounding_ellipsoid_axes||(h=f.b4w_bounding_box,f.b4w_bounding_ellipsoid_axes=[(h.max_x-h.min_x)/2,(h.max_y-h.min_y)/2,(h.max_z-h.min_z)/2]);"b4w_shape_keys"in f||(f.b4w_shape_keys=[],c("mesh",f,"b4w_shape_keys"));for(var h=f,e=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],n=null,t=0;t<e.length;t++)h[e[t]]&&(n?(h[e[t]]=!1,g.warn('WARNING property "'+e[t]+'" of object "'+h.name+'" has been set to "false". Foreground property "'+
n+'" already exists.')):n=e[t]);for(h=0;h<f.b4w_vertex_anim.length;h++)e=f.b4w_vertex_anim[h],"allow_nla"in e||(c('mesh["b4w_vertex_anim"]',f,"allow_nla"),e.allow_nla=!0)}h=a.cameras;for(k=0;k<h.length;k++)r=h[k],r.type||(r.type="PERSP",c("camera",r,"type")),"b4w_eye_target_dist"in r&&(delete r.b4w_eye_target_dist,m("camera",r,"b4w_eye_target_dist")),"b4w_hover_zero_level"in r||(r.b4w_hover_zero_level=0,c("camera",r,"b4w_hover_zero_level")),"b4w_trans_velocity"in r||(r.b4w_trans_velocity=1,c("camera",
r,"b4w_trans_velocity")),"b4w_rot_velocity"in r||(r.b4w_rot_velocity=1,c("camera",r,"b4w_rot_velocity")),"b4w_zoom_velocity"in r||(r.b4w_zoom_velocity=.1,c("camera",r,"b4w_zoom_velocity")),"b4w_use_target_distance_limits"in r||(r.b4w_use_target_distance_limits=r.b4w_use_distance_limits||!1,c("camera",r,"b4w_use_target_distance_limits")),"b4w_use_zooming"in r||(r.b4w_use_zooming=r.b4w_use_distance_limits||!1,c("camera",r,"b4w_use_zooming")),"b4w_distance_min"in r||(r.b4w_distance_min=1,c("camera",
r,"b4w_distance_min")),"b4w_distance_max"in r||(r.b4w_distance_max=100,c("camera",r,"b4w_distance_max")),"b4w_horizontal_translation_min"in r||(r.b4w_horizontal_translation_min=-100,c("camera",r,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in r||(r.b4w_horizontal_translation_max=100,c("camera",r,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in r||(r.b4w_vertical_translation_min=-100,c("camera",r,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in
r||(r.b4w_vertical_translation_max=100,c("camera",r,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in r||(r.b4w_use_horizontal_clamping=!1,c("camera",r,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in r||(r.b4w_rotation_left_limit=-Math.PI,c("camera",r,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in r||(r.b4w_rotation_right_limit=Math.PI,c("camera",r,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in r||(r.b4w_horizontal_clamping_type="LOCAL",c("camera",
r,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in r||(r.b4w_use_vertical_clamping=!1,c("camera",r,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in r||(r.b4w_rotation_down_limit=-Math.PI/2,c("camera",r,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in r||(r.b4w_rotation_up_limit=Math.PI/2,c("camera",r,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in r||(r.b4w_vertical_clamping_type="LOCAL",c("camera",r,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in r||(r.b4w_hover_angle_min=
Math.PI/6,c("camera",r,"b4w_hover_angle_min")),"b4w_hover_angle_max"in r||(r.b4w_hover_angle_max=Math.PI/6,c("camera",r,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in r||(r.b4w_enable_hover_hor_rotation=!0,c("camera",r,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in r||(r.b4w_use_panning=!0,c("camera",r,"b4w_use_panning"));h=a.lamps;for(k=0;k<h.length;k++)r=h[k],"b4w_generate_shadows"in r||(r.b4w_generate_shadows=!1,c("lamp",r,"b4w_generate_shadows")),"b4w_dynamic_intensity"in r||
(r.b4w_dynamic_intensity=!1,c("lamp",r,"b4w_dynamic_intensity")),"use_diffuse"in r||(r.use_diffuse=!0,c("lamp",r,"use_diffuse")),"use_specular"in r||(r.use_specular=!0,c("lamp",r,"use_specular"));h=a.speakers;for(k=0;k<h.length;k++)r=h[k],"b4w_behavior"in r||(r.b4w_behavior=r.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in r||(r.b4w_disable_doppler=!1),"b4w_delay"in r||(r.b4w_delay=0),"b4w_delay_random"in r||(r.b4w_delay_random=0),"b4w_volume_random"in r||(r.b4w_volume_random=
0),"b4w_pitch_random"in r||(r.b4w_pitch_random=0),"b4w_fade_in"in r||(r.b4w_fade_in=0),"b4w_fade_out"in r||(r.b4w_fade_out=0),"b4w_loop"in r||(r.b4w_loop=!1),"b4w_loop_count"in r||(r.b4w_loop_count=0),"b4w_loop_count_random"in r||(r.b4w_loop_count_random=0),"b4w_playlist_id"in r||(r.b4w_playlist_id=""),r.animation_data&&b(r.animation_data);h=a.textures;for(k=0;k<h.length;k++)r=h[k],"b4w_anisotropic_filtering"in r||(r.b4w_anisotropic_filtering="OFF",c("texture",r,"b4w_anisotropic_filtering")),"b4w_water_foam"in
r||(r.b4w_water_foam=!1,c("texture",r,"b4w_water_foam")),"b4w_foam_uv_freq"in r||(r.b4w_foam_uv_freq=[1,1],c("texture",r,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in r||(r.b4w_foam_uv_magnitude=[1,1],c("texture",r,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in r||(r.b4w_parallax_steps=5,c("material",r,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in r||(r.b4w_parallax_lod_dist=10,c("material",r,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in r||(r.b4w_shore_dist_map=!1,c("texture",r,"b4w_shore_dist_map")),
"b4w_shore_boundings"in r||(r.b4w_shore_boundings=new Float32Array(4),r.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],c("texture",r,"b4w_shore_boundings")),"b4w_max_shore_dist"in r||(r.b4w_max_shore_dist=100,c("texture",r,"b4w_max_shore_dist")),"b4w_disable_compression"in r||(r.b4w_disable_compression=!1,c("texture",r,"b4w_disable_compression")),"b4w_source_type"in r||(r.b4w_source_type="",c("texture",r,"b4w_source_type")),"b4w_source_id"in r||(r.b4w_source_id="",c("texture",r,"b4w_source_id")),"b4w_source_size"in
r||(r.b4w_source_size=1024,c("texture",r,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in r||(r.b4w_enable_canvas_mipmapping=!0,c("texture",r,"b4w_enable_canvas_mipmapping")),"b4w_nla_video"in r||(r.b4w_nla_video=!1,c("texture",r,"b4w_nla_video"));e=a.materials;for(k=0;k<e.length;k++){n=e[k];"ALPHA_ANTIALIASING"==n.game_settings.alpha_blend&&(n.game_settings.alpha_blend="CLIP");"b4w_node_mat_type"in n&&m("material",n,"b4w_node_mat_type");"b4w_skydome"in n&&m("material",n,"b4w_skydome");"b4w_procedural_skydome"in
n&&m("material",n,"b4w_procedural_skydome");n.b4w_water&&("b4w_water_shore_smoothing"in n||(n.b4w_water_shore_smoothing=!1,c("material",n,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in n||(n.b4w_water_dynamic=!1,c("material",n,"b4w_water_dynamic")),"b4w_waves_height"in n||(n.b4w_waves_height=1,c("material",n,"b4w_waves_height")),"b4w_waves_length"in n||(n.b4w_waves_length=1,c("material",n,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in n||(n.b4w_water_dst_noise_scale0=.05,c("material",n,
"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in n||(n.b4w_water_dst_noise_scale1=.03,c("material",n,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in n||(n.b4w_water_dst_noise_freq0=1.3,c("material",n,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in n||(n.b4w_water_dst_noise_freq1=1,c("material",n,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in n||(n.b4w_water_dir_min_shore_fac=.4,c("material",n,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
n||(n.b4w_water_dir_freq=.5,c("material",n,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in n||(n.b4w_water_dir_noise_scale=.05,c("material",n,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in n||(n.b4w_water_dir_noise_freq=.07,c("material",n,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in n||(n.b4w_water_dir_min_noise_fac=.5,c("material",n,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in n||(n.b4w_water_dst_min_fac=.2,c("material",n,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
n||(n.b4w_water_waves_hor_fac=5,c("material",n,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in n||(n.b4w_water_absorb_factor=6,c("material",n,"b4w_water_absorb_factor")),"b4w_water_fog_color"in n||(n.b4w_water_fog_color=new Float32Array(3),n.b4w_water_fog_color=[.5,.7,.7],c("material",n,"b4w_water_fog_color")),"b4w_foam_factor"in n||(n.b4w_foam_factor=5,c("material",n,"b4w_foam_factor")),"b4w_generated_mesh"in n||(n.b4w_generated_mesh=!1,c("material",n,"b4w_generated_mesh")),"b4w_water_num_cascads"in
n||(n.b4w_water_num_cascads=5,c("material",n,"b4w_water_num_cascads")),"b4w_water_subdivs"in n||(n.b4w_water_subdivs=64,c("material",n,"b4w_water_subdivs")),"b4w_water_detailed_dist"in n||(n.b4w_water_detailed_dist=1E3,c("material",n,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in n||(n.b4w_water_enable_caust=!1,c("material",n,"b4w_water_enable_caust")),"b4w_water_caust_scale"in n||(n.b4w_water_caust_scale=.25,c("material",n,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in n||(n.b4w_water_caust_brightness=
.5,c("material",n,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in n||(n.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in n||(n.b4w_dynamic_grass_color="");"diffuse_intensity"in n||(n.diffuse_intensity=1,c("material",n,"diffuse_intensity"));"b4w_use_ghost"in n||(n.b4w_use_ghost=!1);"b4w_collision_margin"in n||(n.b4w_collision_margin=.04,c("material",n,"b4w_collision_margin"));"b4w_collision_group"in n||(n.b4w_collision_group=128,c("material",n,"b4w_collision_group"));"b4w_collision_mask"in
n||(n.b4w_collision_mask=127,c("material",n,"b4w_collision_mask"));"b4w_do_not_render"in n||(n.b4w_do_not_render=!1,c("material",n,"b4w_do_not_render"));"HALO"!=n.type||"b4w_halo_sky_stars"in n||(n.b4w_halo_sky_stars=!1,c("material",n,"b4w_halo_sky_stars"));"HALO"!=n.type||"b4w_halo_stars_blend_height"in n||(n.b4w_halo_stars_blend_height=10,c("material",n,"b4w_halo_stars_blend_height"));"HALO"!=n.type||"b4w_halo_stars_min_height"in n||(n.b4w_halo_stars_min_height=0,c("material",n,"b4w_halo_stars_min_height"));
"specular_shader"in n||(n.specular_shader="COOKTORR",c("material",n,"specular_shader"));"diffuse_shader"in n||(n.diffuse_shader="LAMBERT",c("material",n,"diffuse_shader"));"roughness"in n||(n.roughness=.5,c("material",n,"roughness"));"diffuse_fresnel"in n||(n.diffuse_fresnel=.1,c("material",n,"diffuse_fresnel"));"diffuse_fresnel_factor"in n||(n.diffuse_fresnel_factor=.5,c("material",n,"diffuse_fresnel_factor"));"specular_slope"in n||(n.specular_slope=.2,c("material",n,"specular_slope"));"specular_toon_size"in
n||(n.specular_toon_size=.5,c("material",n,"specular_toon_size"));"specular_toon_smooth"in n||(n.specular_toon_smooth=.1,c("material",n,"specular_toon_smooth"));"specular_alpha"in n||(n.specular_alpha=1,c("material",n,"specular_alpha"));"b4w_wettable"in n||(n.b4w_wettable=!1,c("material",n,"b4w_wettable"));"b4w_refractive"in n||(n.b4w_refractive=!1,c("material",n,"b4w_refractive"));"b4w_refr_bump"in n||(n.b4w_refr_bump=0,c("material",n,"b4w_refr_bump"));"b4w_shallow_water_col"in n||(n.b4w_shallow_water_col=
[0,.8,.3],c("material",n,"b4w_shallow_water_col"));"b4w_shore_water_col"in n||(n.b4w_shore_water_col=[0,.9,.2],c("material",n,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in n||(n.b4w_shallow_water_col_fac=1,c("material",n,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in n||(n.b4w_shore_water_col_fac=.5,c("material",n,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in n||(n.b4w_water_sss_strength=5.9,c("material",n,"b4w_water_sss_strength"));"b4w_water_sss_width"in n||(n.b4w_water_sss_width=
.45,c("material",n,"b4w_water_sss_width"));"b4w_render_above_all"in n||(n.b4w_render_above_all=!1,c("material",n,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in n||(n.b4w_water_norm_uv_velocity=.05,c("material",n,"b4w_water_norm_uv_velocity"));"specular_ior"in n||(n.specular_ior=1,c("material",n,"specular_ior"));"darkness"in n||(n.darkness=0,c("material",n,"darkness"));"diffuse_toon_size"in n||(n.diffuse_toon_size=0,c("material",n,"diffuse_toon_size"));"diffuse_toon_smooth"in n||(n.diffuse_toon_smooth=
0,c("material",n,"diffuse_toon_smooth"));r=n.texture_slots;for(h=0;h<r.length;h++)f=r[h],"blend_type"in f||(f.blend_type="MIX",c("texture_slot",f,"blend_type"));if(n.node_tree){r=n.node_tree.nodes;for(h=0;h<r.length;h++)d(r[h]);n.node_tree.animation_data&&b(n.node_tree.animation_data)}}f=a.node_groups;for(k=0;k<f.length;k++)for(r=f[k].node_tree.nodes,h=0;h<r.length;h++)d(r[h]);r=a.objects;for(k=0;k<r.length;k++){f=r[k];switch(f.type){case "MESH":"b4w_dynamic_geometry"in f||(f.b4w_dynamic_geometry=
!1);"b4w_reflexible"in f||(f.b4w_reflexible=!1);"b4w_reflexible_only"in f||(f.b4w_reflexible_only=!1);"b4w_reflective"in f||(f.b4w_reflective=!1);"b4w_reflection_type"in f||(f.b4w_reflection_type="PLANE",c("object",f,"b4w_reflection_type"));"b4w_wind_bending"in f||(f.b4w_wind_bending=!1,c("object",f,"b4w_wind_bending"));"b4w_wind_bending_angle"in f||(f.b4w_wind_bending_angle=10,f.b4w_wind_bending_freq=.25,c("object",f,"wind bending params"));"b4w_detail_bending_amp"in f||(f.b4w_detail_bending_amp=
.1,f.b4w_branch_bending_amp=.3,c("object",f,"detail bending params"));"b4w_detail_bending_freq"in f||(f.b4w_detail_bending_freq=1,c("object",f,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in f||(f.b4w_main_bend_stiffness_col="",c("object",f,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in f||(f.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},c("object",f,"b4w_detail_bend_colors"));"b4w_caustics"in f||(f.b4w_caustics=!1);"vertex_groups"in
f&&f.vertex_groups.length&&f.data&&0==f.data.vertex_groups.length&&(f.data.vertex_groups=f.vertex_groups,delete f.vertex_groups,c("object",f,"vertex_groups"));"b4w_vertex_anim"in f&&f.b4w_vertex_anim.length&&f.data&&0==f.data.b4w_vertex_anim.length&&(f.data.b4w_vertex_anim=f.b4w_vertex_anim,delete f.b4w_vertex_anim,c("object",f,"b4w_vertex_anim"));"b4w_do_not_render"in f||(f.b4w_do_not_render=!1);"use_ghost"in f.game||(f.game.use_ghost=!1);"use_sleep"in f.game||(f.game.use_sleep=!1);"velocity_min"in
f.game||(f.game.velocity_min=0);"velocity_max"in f.game||(f.game.velocity_max=0);"collision_group"in f.game||(f.game.collision_group=1);"collision_mask"in f.game||(f.game.collision_mask=255);"b4w_vehicle_settings"in f?f.b4w_vehicle_settings&&("steering_ratio"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.steering_ratio=10),"steering_max"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.steering_max=1),"inverse_control"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.inverse_control=!1),"force_max"in
f.b4w_vehicle_settings||(f.b4w_vehicle_settings.force_max=1500),"brake_max"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.brake_max=100),"speed_ratio"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.suspension_compression=
4.4),"suspension_stiffness"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in f.b4w_vehicle_settings||
(f.b4w_vehicle_settings.floating_factor=3),"floating_factor"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in f.b4w_vehicle_settings||(f.b4w_vehicle_settings.water_rot_damp=.9)):(f.b4w_vehicle_settings=null,c("object",f,"b4w_vehicle_settings"));"b4w_floating_settings"in f?f.b4w_floating_settings&&("floating_factor"in f.b4w_floating_settings||(f.b4w_floating_settings.floating_factor=
3),"water_lin_damp"in f.b4w_floating_settings||(f.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in f.b4w_floating_settings||(f.b4w_floating_settings.water_rot_damp=.8)):(f.b4w_floating_settings=null,c("object",f,"b4w_floating_settings"));"b4w_character_settings"in f?f.b4w_character_settings&&("walk_speed"in f.b4w_character_settings||(f.b4w_character_settings.walk_speed=4),"run_speed"in f.b4w_character_settings||(f.b4w_character_settings.run_speed=8),"step_height"in f.b4w_character_settings||
(f.b4w_character_settings.step_height=.25),"jump_strength"in f.b4w_character_settings||(f.b4w_character_settings.jump_strength=5),"waterline"in f.b4w_character_settings||(f.b4w_character_settings.waterline=0)):(f.b4w_character_settings=null,c("object",f,"b4w_character_settings"));"b4w_selectable"in f||(f.b4w_selectable=!1,c("object",f,"b4w_selectable"));"b4w_outlining"in f||(f.b4w_outlining=!1,c("object",f,"b4w_outlining"));"b4w_outline_on_select"in f||(f.b4w_outline_on_select=!1,c("object",f,"b4w_outline_on_select"));
"b4w_billboard"in f||(f.b4w_billboard=!1,c("object",f,"b4w_billboard"));"b4w_billboard_geometry"in f||(f.b4w_billboard_geometry="SPHERICAL",c("object",f,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in f||(f.b4w_pres_glob_orientation=!1,c("object",f,"b4w_pres_glob_orientation"));"b4w_outline_settings"in f||("b4w_glow_settings"in f?f.b4w_outline_settings=f.b4w_glow_settings:(f.b4w_outline_settings={},f.b4w_outline_settings.outline_duration=1,f.b4w_outline_settings.outline_period=1,f.b4w_outline_settings.outline_relapses=
0),c("object",f,"b4w_outline_settings"));"b4w_lod_transition"in f||(f.b4w_lod_transition=.01,c("object",f,"b4w_lod_transition"));"lod_levels"in f||(f.lod_levels=[],c("object",f,"lod_levels"));"b4w_animation_mixing"in f||(f.b4w_animation_mixing=!1,c("object",f,"b4w_animation_mixing"));break;case "EMPTY":"b4w_anchor"in f||(f.b4w_anchor=null,c("object",f,"b4w_anchor")),!f.b4w_anchor||"max_width"in f.b4w_anchor||(f.b4w_anchor.max_width=250)}"collision_margin"in f.game||(f.game.collision_margin=.04,c("object",
f,"collision_margin"));"b4w_anim_behavior"in f||(f.b4w_anim_behavior=f.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",c("object",f,"b4w_anim_behavior"));if(!("rotation_quaternion"in f)){h=[0,0,0,1];l.euler_to_quat(f.rotation_euler,h);var e=h,n=h[0],t=h[1],v=h[2];e[0]=h[3];e[1]=n;e[2]=t;e[3]=v;f.rotation_quaternion=h;c("object",f,"rotation_quaternion")}"webgl_do_not_batch"in f&&(f.b4w_do_not_batch=f.webgl_do_not_batch)&&m("object",f,"webgl_do_not_batch");"b4w_shadow_cast_only"in f||(f.b4w_shadow_cast_only=
!1,c("object",f,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in f||(f.b4w_correct_bounding_offset="AUTO",c("object",f,"b4w_correct_bounding_offset"));e=f.particle_systems;for(h=0;h<e.length;h++)n=e[h],t=n.settings,"use_rotation_dupli"in t||(t.use_rotation_dupli=!1,c("object",t,"use_rotation_dupli")),"use_whole_group"in t||(t.use_whole_group=!1,c("object",t,"use_whole_group")),n.transforms||(n.transforms=new Float32Array,c("particle_system",n,"transforms")),"b4w_billboard_align"in t||(t.b4w_billboard_align=
"VIEW",c("particle_settings",t,"b4w_billboard_align")),"b4w_dynamic_grass"in t||(t.b4w_dynamic_grass=!1,c("object",t,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in t||(t.b4w_dynamic_grass_scale_threshold=.01,c("object",t,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in t||(t.b4w_initial_rand_rotation=!1,c("particle_settings",t,"b4w_initial_rand_rotation")),"b4w_rotation_type"in t||(t.b4w_rotation_type="Z",c("particle_settings",t,"b4w_rotation_type")),"b4w_rand_rotation_strength"in
t||(t.b4w_rand_rotation_strength=1,c("particle_settings",t,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in t||(t.b4w_hair_billboard=!1,c("particle_settings",t,"b4w_hair_billboard")),"b4w_hair_billboard_type"in t||(t.b4w_hair_billboard_type="BASIC",c("particle_settings",t,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in t||(t.b4w_hair_billboard_jitter_amp=0,c("particle_settings",t,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in t||(t.b4w_hair_billboard_jitter_freq=
0,c("particle_settings",t,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in t||(t.b4w_hair_billboard_geometry="SPHERICAL",c("particle_settings",t,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in t||(t.b4w_wind_bend_inheritance="PARENT",c("particle_settings",t,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in t||(t.b4w_shadow_inheritance="PARENT",c("particle_settings",t,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in t||(t.b4w_reflection_inheritance="PARENT",
c("particle_settings",t,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in t||(t.b4w_vcol_from_name="",c("particle_settings",t,"b4w_vcol_from_name")),"b4w_vcol_to_name"in t||(t.b4w_vcol_to_name="",c("particle_settings",t,"b4w_vcol_to_name")),"b4w_coordinate_system"in t||(t.b4w_coordinate_system="LOCAL",c("particle_settings",t,"b4w_coordinate_system")),"b4w_allow_nla"in t||(t.b4w_allow_nla=!0,c("particle_settings",t,"b4w_allow_nla")),"b4w_enable_soft_particles"in t||(t.b4w_enable_soft_particles=
!1,c("particle_settings",t,"b4w_enable_soft_particles")),"b4w_particles_softness"in t||(t.b4w_particles_softness=1,c("particle_settings",t,"b4w_particles_softness"));"constraints"in f||(f.constraints=[],c("object",f,"constraints"));e=f.modifiers;for(h=0;h<e.length;h++){a:{n=e[h];switch(n.type){case "ARRAY":if(!("fit_type"in n)){g.error("WARNING Incomplete modifier "+String(n.type)+' for "'+f.name+'", reexport "'+a.b4w_filepath_blend+'" scene');n=!1;break a}}n=!0}n||(e.splice(h,1),h--)}"animation_data"in
f||(f.animation_data={action:null,nla_tracks:[]},c("object",f,"animation_data"));f.animation_data&&("action"in f.animation_data||(f.animation_data.action=null,g.warn("no action in animation data "+f.name)),"nla_tracks"in f.animation_data||(f.animation_data.nla_tracks=[],g.warn("no NLA in animation data "+f.name)),b(f.animation_data));"b4w_collision_id"in f||(f.b4w_collision_id="",c("material",f,"b4w_collision_id"));(0>f.scale[0]||0>f.scale[1]||0>f.scale[2])&&g.warn('negative scale for object "'+f.name+
'", can lead to some errors');h=f.scale;0==h[0]&&0==h[1]&&0==h[2]?h=!0:(e=Math.abs((h[1]-h[2])/h[1]),h=.005>Math.abs((h[0]-h[1])/h[0])&&.005>e);h||g.warn("non-uniform scale for object "+f.name)}for(var x in A)k=A[x],h=x.match(/.*?(?=>>|$)/i)[0],g.warn('Property "'+String(h)+'" is '+k.Iv+' for "'+k.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.Uz=function(a,b){"num_channels"in a||(a.num_channels=1,g.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};
a.oz=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=e(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var g=a[c];switch(g.type){case "ARRAY":for(var d=b,f=g,m=0,p=0,A=0,O=new Float32Array(16),g=[],K=1;K<f.count;K++){f.use_constant_offset&&(m+=f.constant_offset_displace[0],p+=f.constant_offset_displace[1],A+=f.constant_offset_displace[2]);if(f.use_relative_offset)var F=d.b4w_bounding_box,
m=m+(F.max_x-F.min_x)*f.relative_offset_displace[0],p=p+(F.max_y-F.min_y)*f.relative_offset_displace[1],A=A+(F.max_z-F.min_z)*f.relative_offset_displace[2];l.VF(m,p,A,O);for(var Q=F=e(d),J=O,D=0;D<Q.submeshes.length;D++){var C=Q.submeshes[D];l.Ri(C.position,J,C.position,0);l.ZG(C.normal,J,C.normal);l.SF(C.tangent,J,C.tangent)}g.push(F)}for(K=0;K<g.length;K++)for(f=d,m=g[K],p=0;p<f.submeshes.length;p++){A=f.submeshes[p];O=m.submeshes[p];F=A.base_length;Q=A.indices.length;A.base_length+=O.base_length;
for(var M in A)if("base_length"!=M)if("indices"==M)for(A[M]=l.$F(A[M],O[M]),J=Q;J<A.indices.length;J++)A.indices[J]+=F;else"vertex_colors"!=M&&(A[M]=l.IB(A[M],O[M]))}break;case "CURVE":for(var d=b,K=k.QA(g.object),f=new Float32Array(16),p=K.Jf?4:3,m=new Float32Array(p),p=new Float32Array(p),A=new Float32Array(3),O=new Float32Array(4),F=new Float32Array(4),Q=new Float32Array(3),J=new Float32Array(3),D=new Float32Array(3),C=new Float32Array(4),I=new Float32Array(4),y=0;y<d.submeshes.length;y++){var V=
d.submeshes[y],T=V.position,R=V.normal,V=V.tangent,ha;a:switch(ha=g.deform_axis,ha){case "POS_X":case "NEG_X":ha=0;break a;case "POS_Y":case "NEG_Y":ha=1;break a;case "POS_Z":case "NEG_Z":ha=2;break a;default:throw"Wrong deform axis value "+ha;}Q[0]=0;Q[1]=0;Q[2]=0;Q[ha]=1;for(var ia=k.EF(K),aa=0;aa<T.length/3;aa++){D[0]=T[3*aa];D[1]=T[3*aa+1];D[2]=T[3*aa+2];var W=D[ha],S=k.DF(K,W);k.FF(K,S,m);A[0]=m[0];A[1]=m[1];A[2]=m[2];k.CF(K,S,p);J[0]=p[0];J[1]=0;J[2]=p[2];h.normalize(J,J);x.rotationTo(Q,J,O);
0>W?(m[0]=J[0],m[1]=J[1],m[2]=J[2],h.scale(m,W,m),h.add(A,m,A)):W>ia&&(m[0]=J[0],m[1]=J[1],m[2]=J[2],h.scale(m,W-ia,m),h.add(A,m,A));n.fromRotationTranslation(O,A,f);K.Jf&&(x.setAxisAngle(Q,m[3],F),h.transformQuat(D,F,D));D[ha]=0;h.transformMat4(D,f,D);T[3*aa]=D[0];T[3*aa+1]=D[1];T[3*aa+2]=D[2];R.length&&(C[0]=R[3*aa],C[1]=R[3*aa+1],C[2]=R[3*aa+2],C[3]=0,v.transformMat4(C,f,C),R[3*aa]=C[0],R[3*aa+1]=C[1],R[3*aa+2]=C[2]);V.length&&(I[0]=V[3*aa],I[1]=V[3*aa+1],I[2]=V[3*aa+2],I[3]=0,v.transformMat4(I,
f,I),V[3*aa]=I[0],V[3*aa+1]=I[1],V[3*aa+2]=I[2])}}}t.vE(b)}return b};a.GA=function(){return{name:"DEFAULT",uuid:l.vp(),use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,
b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",
use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.vz=function(a,b){for(var c=b.b4w_logic_nodes,d=0;d<c.length;d++)for(var e=c[d],f=0;f<e.length;f++){var h=e[f],k={register1:"variable1",register2:"variable2",registerd:"variabled"},l;for(l in k)l in h&&(h[k[l]]=h[l]);switch(h.type){case "SELECT":for(k=0;k<a.length;k++){var m=a[k];m.name==h.object&&
(m.b4w_selectable=!0)}h.bools||(h.bools={});h.bools.not_wait||(h.bools.not_wait=!1);break;case "SWITCH_SELECT":for(var n in h.objects_paths){var m=h.objects_paths[n],t=m[0];if(1<m.length)for(k=1;k<m.length;k++)t+="*"+m[k];for(k=0;k<a.length;k++)m=a[k],m.name==t&&(m.b4w_selectable=!0)}break;case "SELECT_PLAY":g.warn('Logic nodes type "SELECT_PLAY" is deprecated, node will be muted. To fix this, reexport scene "'+b.name+'"');h.mute=!0;break;case "SHOW":case "HIDE":case "PLAY_ANIM":case "SET_SHADER_NODE_PARAM":case "INHERIT_MAT":for(n in h.objects_paths){m=
h.objects_paths[n];t=m[0];if(1<m.length)for(k=1;k<m.length;k++)t+="*"+m[k];for(k=0;k<a.length;k++)m=a[k],m.name==t&&(m.b4w_do_not_batch=!0)}break;case "PLAY":b.b4w_use_nla=!0}}}};b4w.module.__scenegraph=function(a,p){function d(a){a=pa.yf(a);a.Od=null;a.xb=null;a.wd=null;return a}function b(a,b){var d=[];H.ye(a,function(b,c,e){-1<d.indexOf(e)?H.FE(a,b,c,e,r(e)):d.push(e)});H.aa(a,function(c,e){for(var f=0;f<e.Aa.length;f++){var h=e.Aa[f];b||"MAIN_PLANE_REFLECT"!=e.type&&"MAIN_CUBE_REFLECT"!=e.type&&"MAIN_XRAY"!=e.type||(h.md=!0);-1<d.indexOf(h)?e.Aa[f]=r(h):d.push(h)}"ANTIALIASING"==e.type&&H.Wd(a,c,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.Aa.length;c++){var d=
b.Aa[c];d.ma=ba.t;d.la=ba.t}});b||H.Wd(a,c,function(a,b,c){"DEPTH"==c.from&&(c.md=!0)})});H.aa(a,function(b){var d={};c(a,b,d);for(var e in d){b=d[e];for(var f=b[0],h=0;h<b.length;h++)if(b[h].ma==ba.t){f=b[h];break}for(var k=b[0],h=0;h<b.length;h++)if(b[h].la==ba.t){k=b[h];break}for(var l=b[0],h=0;h<b.length;h++)if(!b[h].md){l=b[h];break}for(h=0;h<b.length;h++)b[h].ma=f.ma,b[h].la=k.la,b[h].md=l.md}})}function c(a,b,d){H.Wd(a,b,function(b,e,f){f.pb&&f.from==f.to&&(d[f.from]=d[f.from]||[],-1==d[f.from].indexOf(f)&&
d[f.from].push(f),c(a,b,d))});H.gg(a,b,function(a,b,c){c.pb&&(d[c.from]=d[c.from]||[],-1==d[c.from].indexOf(c)&&d[c.from].push(c))});b=H.La(a,b);if("MOTION_BLUR"==b.type)for(var e=0;e<b.Aa.length;e++){var f=b.Aa[e];d[f.from].push(f)}}function m(a){var b=H.zr(a),c=[];H.aa(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":var f=[];break;default:f=c}for(var h=0;h<d.Aa.length;h++){var l=d.Aa[h],g=n(f,l,e(l));l.va=g;d.we[h]=
g}for(h=0;h<d.we.length;h++)g=d.we[h],k(f,g);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":f=[]}H.gg(b,a,function(c,d,h){if(!h.va){if((c=t(b,a,h.from))&&h.pb&&!h.va){d=f;for(var k=c,l=0;l<d.length;l++){var g=d[l];g.vr===k&&g.Ok++}}else c=n(f,h,e(h));h.va=c}});H.Wd(b,a,function(a,b,c){k(f,c.va)});H.gg(b,a,function(a,b,c){c.va&&"NONE"==c.to&&k(f,c.va)})})}function e(a){a=Da.Gg(a);delete a.to;delete a.pb;delete a.va;return JSON.stringify(a)}
function t(a,b,c){var d=null;H.Wd(a,b,function(a,b,e){if(e.pb&&e.from==e.to&&e.from==c&&e.va)return d=e.va,!0});H.gg(a,b,function(a,b,e){if(e.pb&&e.from==c&&e.va)return d=e.va,!0});return d}function k(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.vr===b&&d.Ok&&d.Ok--}}function n(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.Ok){d=f;break}}if(d&&!sa.ED)return d.Ok++,d.vr;b=g(b);a.push({id:c,Ok:1,vr:b});return b}function g(a){var b=a.Zi*a.size;switch(a.from){case "COLOR":if(a.md){var c=
ba.Vj("COLOR_RB",a.lh?ba.Cl:ba.Bl);ba.resize(c,b,b)}else c=ba.Vj("COLOR",ba.tg),ba.resize(c,b,b),ba.Uk(c,a.ma,a.la);return c;case "DEPTH":return a.md?(c=ba.Vj("DEPTH_RB",a.lh?ba.Al:ba.zl),ba.resize(c,b,b)):(c=ba.Vj("DEPTH_TEX",ba.Qh),ba.resize(c,b,b),ba.Uk(c,a.ma,a.la)),c;case "CUBEMAP":return c=ba.xA(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.from;}}function x(a,b){var c=!1;H.ye(a,function(d,e,f){if(f&&(d=H.La(a,d),e=H.La(a,e),b(f,!1,d,e)))return c=!0});c||H.aa(a,function(a,
c){for(var d=0;d<c.Aa.length;d++)if(b(c.Aa[d],!0,c,null))return!0})}function l(a){H.aa(a,function(b,c){if("SINK"!=c.type){var d=c.j;H.gg(a,b,function(a,b,c){c.pb&&c.va&&(ea.on(d,c.from,c.va),c.from==c.to&&b.j&&ea.on(b.j,c.from,c.va))});for(var e=0;e<c.Aa.length;e++){var f=c.Aa[e];f.pb&&f.from==f.to&&ea.on(d,f.from,c.we[e])}!d.xb&&!d.wd||d.Od||(d.Od=qa.CE(d.xb,d.wd))}});H.aa(a,function(b,c){if("RESOLVE"==c.type||"COPY"==c.type){var d=ja(a,c);c.j.rp=d[0].j.Od}})}function h(a){var b=null,c=0;H.aa(a,
function(a,d){if(d.type==Y.QF){if(c==Y.PF)return b=d,!0;c++}});return b}function v(a,b){var c=H.ne(a,b),d=E("NONE"),e=H.u(a,d),f=H.tk(a)[0];H.ye(a,function(b,c){c==f&&H.Gv(a,b,f,b,e)});H.ye(a,function(e,f,h){if(e==c)return H.m(a,b,d,u(Y.sF,"u_color",h.size,h.Zi,h.gl)),!0});H.dc(a,e,f,u("SCREEN","NONE",.5,.5,!0))}function C(a,b){var c=["SHADOW_CAST","GRASS_MAP","MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"],d=b.X,e=H.tk(a)[0],f,h;H.Wd(a,e,function(b,c){if(va(a,c,"MAIN_OPAQUE"))return f=b,h=c,!0});for(var k=
H.wn(a,f,H.vl),l=[],g=[],k=H.clone(k,function(b){var e;-1<c.indexOf(b.type)?(g.push(b),e=b):(e=z(b),-1<d.indexOf(b.j)&&(ea.Ou(b.j,ea.Ob),ea.Ou(e.j,ea.Tb),d.push(e.j)),b=H.ne(a,b),H.Wd(a,b,function(a,b,d){-1<c.indexOf(b.type)&&l.push([b,e,d])}));return e},function(a){return r(a,!0)}),m=0;m<g.length;m++)H.qe(k,H.ne(k,g[m]));H.Eo(k);var m=oa(),n=H.u(a,m);H.Gv(a,f,e,n,e);H.m(a,h,m,u("COLOR","u_sampler_left",1,1,!0));H.iz(k,a,[H.tk(k)[0],n,u("COLOR","u_sampler_right",1,1,!0)]);for(m=0;m<l.length;m++)H.m(a,
l[m][0],l[m][1],l[m][2])}function A(a,b){a.Um=b;a.aq=new Float32Array(3*b);a.Nm=new Float32Array(3*b);a.Mm=new Float32Array(3*b);a.bq=new Float32Array(0==b%2?2*b:2*b+2)}function B(a,b,c){var d=q("SHADOW_CAST");d.Ro=a;d.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.bh){case "SPOT":case "POINT":d.j=ea.Hb(ea.bc);ea.pn(d.j,180*b.gf/Math.PI,.1,2*b.distance);break;default:d.j=ea.Hb(ea.ug)}A(d,c);return d}function q(a){a={type:a,fb:"",Ua:!1,jv:!1,fo:!1,Sm:!1,Yj:0,Zj:0,Zo:[],time:0,j:null,
Xj:null,To:[],q:[],Aa:[],we:[],lf:new Float32Array(3),rx:new Float32Array(3),zc:new Float32Array(3),lc:new Float32Array(4),sm:new Float32Array(4),Rc:new Float32Array(16),dw:0,Df:0,Um:0,aq:null,Nm:null,Mm:null,bq:null,Hf:new Float32Array(3),rg:new Float32Array(3),ew:new Float32Array(4),uw:new Float32Array([0,0,0]),nr:new Float32Array(3),vw:new Float32Array(4),cw:new Float32Array(3),Ek:0,fp:0,xk:!1,af:new Float32Array(3),ng:0,Cb:null,Kn:!1,ag:new Float32Array(2),bg:new Float32Array(2),Yi:0,Ci:0,zo:0,
Zd:null,pg:0,Ph:0,og:0,He:!1,Ns:0,Os:new Float32Array(2),Ms:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,$i:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,dj:0,cj:0,bj:0,mw:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,Bi:0,hn:0,
hj:0,Ro:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,Ww:null,sh:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,po:0,lp:0,mb_decay_threshold:0,mb_factor:0,Tu:0,cn:"",dD:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,wr:new Float32Array(2),gb:new Float32Array(2),yb:!0,enqueue:!0,Ba:!0,Da:!0,ec:!0,ya:!0,jf:1};a.gb[0]=1;a.gb[1]=1;return a}function z(a){var b=Da.qa(a);b.j=d(a.j);return b}function u(a,b,c,d,e){return{from:a,
to:b,size:c,Zi:d,gl:e,pb:!0,va:null,lh:!1,md:!1,ma:ba.Nc,la:ba.Nc}}function r(a,b){if(b){var c=a.va;a.va=null}a.va&&Da.O("Failed to clone slink with attached texture");var d=Da.Gg(a);b&&(a.va=c,d.va=c);return d}function f(){var a=q("GRASS_MAP");a.j=ea.Hb(ea.qf);return a}function E(a){var b=q("POSTPROCESSING");b.Ba=!1;b.Da=!1;b.ec=!1;b.j=ea.Hb(ea.Nb);b.cn=a;switch(a){case "NONE":b.gb[0]=1;b.gb[1]=1;break;case "GRAYSCALE":b.gb[0]=1;b.gb[1]=1;break;case "X_BLUR":b.gb[0]=1;b.gb[1]=0;break;case "Y_BLUR":b.gb[0]=
0;b.gb[1]=1;break;case "X_GLOW_BLUR":b.gb[0]=1;b.gb[1]=0;break;case "Y_GLOW_BLUR":b.gb[0]=0;b.gb[1]=1;break;case "X_EXTEND":b.gb[0]=1;b.gb[1]=0;break;case "Y_EXTEND":b.gb[0]=0;b.gb[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function w(a){var b=q("BLOOM_BLUR");b.Ba=!1;b.Da=!1;b.ec=!1;b.j=ea.Hb(ea.Nb);b.cn=a;switch(a){case "X_BLUR":b.gb[0]=1;b.gb[1]=0;break;case "Y_BLUR":b.gb[0]=0;b.gb[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}return b}function N(a,
b){var c=q("GLOW_COMBINE");c.Ba=!1;c.Da=!1;c.ec=!1;c.small_glow_mask_coeff=b.Gf.small_glow_mask_coeff;c.large_glow_mask_coeff=b.Gf.large_glow_mask_coeff;c.small_glow_mask_width=b.Gf.small_glow_mask_width;c.large_glow_mask_width=b.Gf.large_glow_mask_width;c.j=a;return c}function O(a,b,c,d,e,f,h,k,l){var g=q("MAIN_"+a);if("OPAQUE"===a)g.Ba=!0,g.Da=c,g.Ua=!1;else if("BLEND"===a)g.Ba=!1,g.Da=!1,g.Ua=!0;else if("XRAY"===a)g.Ba=!1,g.Da=!0,g.Ua=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)g.Ba=!0,
g.Da=!0,g.Ua=!1;else if("GLOW"===a)g.Ba=!0,g.Da=!1,g.Ua=!1;else throw"wrong main subscene type";g.Ua&&k&&(g.self_shadow_normal_offset=k.self_shadow_normal_offset);g.j=b;if(a=h.cr)g.ew.set([a.Dz,a.PC,a.kH,a.jH]),g.cw.set(a.color),g.dw=a.Ha;g.Hf.set(h.Hf);g.rg.set(h.rg);g.Df=h.Df;g.lc=f.lc;g.sm=f.sm;d&&(g.Cb=d,d.lc&&(g.Zd=new Float32Array(d.lc)),g.pg=d.waves_height,g.Ph=d.waves_length,g.og=d.og,d.He&&l&&(g.He=!0,g.Ns=d.Rz,g.Os.set(d.Sz),g.Ms=d.Qz),d.rn&&(g.Kn=!0,f=d.qF,g.ag[0]=(f[0]+f[1])/2,g.ag[1]=
(f[2]+f[3])/2,g.bg[0]=f[0]-f[1],g.bg[1]=f[2]-f[3],g.Yi=d.Yi,g.Ci=d.Ci));A(g,e);return g}function K(){var a=q("RESOLVE");a.j=ea.Hb(ea.Nb);return a}function F(a,b,c){var d=q("COLOR_PICKING");b&&(d.type+="_XRAY",d.Ba=!1,d.Da=!0);d.enqueue=!1;d.j=a;A(d,c);return d}function Q(a){var b=q("WIREFRAME");b.yb=!1;b.Ba=!1;b.Da=!1;b.j=a;return b}function J(a){var b=q("ANCHOR_VISIBILITY");b.Ba=!0;b.Da=!1;b.j=a;return b}function D(a,b){var c=q("DEPTH");c.j=a;A(c,b);return c}function G(a){var b=q("DEPTH_PACK");b.Ba=
!1;b.Da=!1;b.j=a;return b}function M(a,b,c){var d=q("SSAO");d.Ba=!1;d.Da=!1;d.ec=!1;d.j=a;d.lc=b.lc;d.Zd=new Float32Array(b.lc);d.dj=c.radius_increase;d.ssao_hemisphere=c.OC;d.cj=c.influence;d.bj=c.dist_factor;d.mw=c.NE;return d}function I(a,b){var c=q("SSAO_BLUR");c.Ba=!1;c.Da=!1;c.ec=!1;c.j=a;c.ssao_blur_depth=b.Gz;c.ssao_blur_discard_value=b.Fs;return c}function y(a){var b=q("ANTIALIASING");b.Ba=!1;b.Da=!1;b.ec=!1;b.jf=1/a.Hc;b.SB=a.js;b.j=ea.Hb(ea.Nb);return b}function V(a,b){var c=q(a);c.Ba=
"SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;c.Da=!1;c.ec=!1;c.jf=1/b.Hc;c.j=ea.Hb(ea.Nb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(c.eD=new Float32Array(4));return c}function T(a,b,c,d){var e=q("COMPOSITING");e.Ba=!1;e.Da=!1;e.ec=!1;e.j=ea.Hb(ea.Nb);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function R(a,b){var c=q("MOTION_BLUR");c.Ba=!1;c.Da=!1;c.ec=!1;c.j=ea.Hb(ea.Nb);c.fo=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function ha(a){var b=q("DOF");
b.Ba=!1;b.Da=!1;b.ec=!1;b.j=a;b.jf=b.j.dof_power;return b}function ia(a,b){var c=q("OUTLINE_MASK");c.ec=!1;c.j=a;A(c,b);return c}function aa(a){var b=q("OUTLINE");Ia.outlining_overview_mode?b.af.set(Ia.af):b.af.set(a.af);b.Ek=a.Ek;b.lp=5;b.po=3;b.ec=!1;b.j=ea.Hb(ea.Nb);return b}function W(a,b,c,d,e,f,h){var k=q("GOD_RAYS");k.Ba=!1;k.Da=!1;k.ec=!1;k.Hf=new Float32Array([1,1,1]);k.rg=new Float32Array([1,1,1]);k.Df=1;k.jv=d;k.ng=b;k.hn=e;k.Bi=c;k.hj=h;k.j=a;A(k,f);return k}function S(a,b){var c=q("GOD_RAYS_COMBINE");
c.Ba=!1;c.Da=!1;c.ec=!1;c.j=ea.Hb(ea.Nb);c.god_rays_intensity=a;A(c,b);return c}function X(a,b){var c=q("SKY");c.enqueue=!1;c.Ba=!1;c.Da=!1;c.ec=!1;var d=ea.Hb(ea.Nb);d.width=Sa.fm;d.height=Sa.fm;c.j=d;c.Xj=Da.WB();A(c,a);c.Hf=new Float32Array([1,1,1]);c.rg=new Float32Array([1,1,1]);c.Df=1;c.$i.set(b.$i);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=
b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ca(){var a=q("COPY");a.Ba=!1;a.Da=!1;a.j=ea.Hb(ea.Nb);return a}function oa(){var a=q("ANAGLYPH");a.Ba=!1;a.Da=!1;a.j=ea.Hb(ea.Nb);return a}function fa(){var a=q("LUMINANCE");a.Ba=!1;a.Da=!1;a.j=ea.Hb(ea.Nb);return a}function ma(){var a=
q("AVERAGE_LUMINANCE");a.Ba=!1;a.Da=!1;a.j=ea.Hb(ea.Nb);return a}function L(a,b,c,d){var e=q("LUMINANCE_TRUNCED");e.Ba=!1;e.Da=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;A(e,c);return e}function U(a){var b=q("BLOOM");b.Ba=!1;b.Da=!1;b.j=ea.Hb(ea.Nb);b.bloom_blur=a;return b}function ga(){var a=q("SINK");a.enqueue=!1;return a}function P(a,b,c){if(b.type===c)return!0;b=na(a,b);for(var d=0;d<b.length;d++)if(P(a,b[d],c))return!0;return!1}function va(a,b,c){if(b.type===c)return!0;b=ja(a,b);for(var d=0;d<
b.length;d++)if(va(a,b[d],c))return!0;return!1}function ja(a,b){var c=H.ne(a,b);if(c==H.Yr)throw"Subscene not in graph";for(var d=[],e=H.Lp(a,c),f=0;f<e;f++){var h=H.rk(a,c,f);h!=c&&d.push(H.La(a,h))}return d}function na(a,b){var c=H.ne(a,b);if(c==H.Yr)throw"Subscene not in graph";for(var d=[],e=H.Qf(a,c),f=0;f<e;f++){var h=H.Ff(a,c,f);h!=c&&d.push(H.La(a,h))}return d}function da(a){var b=[],c=[];x(a,function(a){a.va&&-1==b.indexOf(a.va)&&(b.push(a.va),c.push(a.va,b.length-1))});return c}function ua(a,
b){var c;c=""+(a.from+"\\n");c+="NONE"!=a.to?a.to+"\\n":"";c+="(";if(a.gl){var d=a.Zi;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.from){c+=" ";if(a.md)c+="RR";else{var d=a.ma,e=a.la,f="";d==ba.t?f+="L":d==ba.Nc&&(f+="N");e==ba.t?f+="L":e==ba.Nc&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.va&&(c+=" "+b[d+1])}return c+")\\n"}var ea=p("__camera"),ra=p("__config"),ta=p("__debug"),H=p("__graph"),pa=p("__obj_util"),qa=p("__renderer"),ba=p("__textures"),
ya=p("__tsr"),Da=p("__util"),Y=ra.$o,sa=ra.p,Ia=ra.Eb,Sa=ra.Ui;a.eA=function(a){switch(a.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "NONE":return!1;default:return!0}};a.ZF=x;a.KA=function(a,c,e){function k(b){var e=d(Oa);c.X.push(e);e=O(b,e,!1,A,da,nb,Pa,Hb,a.Dh);H.u(g,e);var f=La&&"RESOLVE"==n[0].type?Ja:n[0];H.m(g,f,e,hb);"XRAY"==b?(b=u("DEPTH","DEPTH",1,1,!0),La&&(b.lh=!0,b.md=!0),e.Aa.push(b)):H.m(g,f,e,Kb);Wa&&(H.m(g,Wa,e,rb),H.m(g,
Wa,e,zb));for(b=0;b<t.length;b++)H.m(g,t[b],e,qa[b]);mc&&H.m(g,mc,e,vb);if(z.length)for(f=z.length,b=0;b<f;b++)H.m(g,z[b],e,x[b]);if(p.length)for(b=0;b<p.length;b++)H.m(g,p[b],e,Ia[b]);wb&&H.m(g,wb,e,u("COLOR","u_refractmap",1,1,!0));return e}var g=H.create(),n=[],q=[],t=[],qa=[],z=[],x=[],p=[],Ia=[],da=a.hD,A=a.Cb,P=a.shore_smoothing,ra=a.tF,ua=a.te,Vc=a.pi,va=a.LD,oa=a.Si,pa=a.Fz,Jc=a.kh,Nc=a.Zh,Lb=a.antialiasing,Pa=a.Qr,nb=a.qx,Hb=a.jc,zc=a.PD,uc=a.Tz,Oc=a.IC,Xc=a.cE,hd=a.ci,$b=a.jB,Kc=a.rc,Ab=
Boolean(e.length),La=1<sa.nc,hb=u("COLOR","COLOR",1,1,!0),Kb=u("DEPTH","DEPTH",1,1,!0);if(La){r(Kb);var Ac=r(Kb);hb.lh=!0;hb.md=!0;Kb.lh=!0;Kb.md=!0}var Oa=c.X[0];if(Hb){ea.Dr(Oa,Hb);for(var ac=Hb.csm_num,ab=0;ab<ac;ab++){var Ua=B(ab,Hb,da);H.u(g,Ua);t.push(Ua);var lb=Hb.csm_resolution,Aa=Ua.j;c.Yq.push(Aa);Aa.width=lb;Aa.height=lb;Ua.Ba=!1;qa.push(u("DEPTH","u_shadow_map"+ab,lb,1,!1));(ta.$z()||sa.Dt)&&Ua.Aa.push(u("COLOR","COLOR",lb,1,!1))}}if(oa&&oa.cv&&!Ab)for(ab=0;ab<oa.cv;ab++){Aa=ea.Hb(ea.bc);
Aa.width=a.Lg;Aa.height=a.Lg;ea.pn(Aa,90,.1,100);ea.Zf(Aa,Aa.Pa);var Ga=O("CUBE_REFLECT",Aa,!1,A,da,nb,Pa,null,a.Dh);Ga.Xj=Da.$B();for(var Ba=0;6>Ba;Ba++)Ga.To.push(ea.AA());H.u(g,Ga);var Ha=u("CUBEMAP","u_cube_reflection",a.Lg,1,!1);Ha.ma=ba.t;Ha.la=ba.t;var Bc=u("DEPTH","DEPTH",a.Lg,1,!1);Ia.push(Ha);Ga.Aa.push(Bc);p.push(Ga);oa.zf.push(Ga)}if(oa&&0<oa.Iq.length&&!Ab)for(Ba=0;Ba<oa.Iq.length;Ba++){var Aa=d(Oa),Wb=oa.Iq[Ba];ya.get_trans_view(Wb.f.h);ya.get_quat_view(Wb.f.h);Aa.pc=new Float32Array(4);
c.X.push(Aa);Ga=O("PLANE_REFLECT",Aa,!1,A,da,nb,Pa,null,a.Dh);H.u(g,Ga);Ha=u("COLOR","u_plane_reflection",1,a.Kk,!0);Ha.ma=ba.t;Ha.la=ba.t;Bc=u("DEPTH","DEPTH",1,a.Kk,!0);x.push(Ha);Ga.Aa.push(Bc);z.push(Ga);oa.Uf.push(Ga)}if(a.Pb){var Wa=f();H.u(g,Wa);lb=Sa.ym;Wa.j.width=lb;Wa.j.height=lb;var rb=u("DEPTH","u_grass_map_depth",lb,1,!1);rb.ma=ba.t;rb.la=ba.t;var zb=u("COLOR","u_grass_map_color",lb,1,!1);zb.ma=ba.t;zb.la=ba.t}else zb=rb=Wa=null;if($b&&Hb){var Cc=d(Oa);c.X.push(Cc);var eb=D(Cc,da);H.u(g,
eb);eb.self_shadow_normal_offset=Hb.self_shadow_normal_offset;for(ab=0;ab<t.length;ab++)Ua=t[ab],H.m(g,Ua,eb,qa[ab]);var Dc=u("COLOR","u_color",1,1,!0),Ec=u("DEPTH","u_depth",1,1,!0);if(ua){var ob=d(Oa);c.X.push(ob);var Rb=a.HF,Fc=M(ob,nb,Rb);H.u(g,Fc);var Gc=u("COLOR","u_ssao_mask",1,1,!0);H.m(g,eb,Fc,Dc);H.m(g,eb,Fc,Ec);var Bb=d(Oa);c.X.push(Bb);var Cb=I(Bb,Rb);H.u(g,Cb);var Ta=u("COLOR","u_shadow_mask",1,1,!0);H.m(g,Fc,Cb,Gc);H.m(g,eb,Cb,Ec)}La&&eb.Aa.push(u("DEPTH","DEPTH",1,1,!0));Wa&&(H.m(g,
Wa,eb,rb),H.m(g,Wa,eb,zb))}else eb=null;var Ja=O("OPAQUE",Oa,La||!eb||sa.us,A,da,nb,Pa,null,a.Dh);H.u(g,Ja);if(La){var Xa=K();H.u(g,Xa);q.push(Xa);var nc=u("COLOR","RESOLVE",1,1,!0);nc.lh=!0;nc.md=!0;var Mb=u("DEPTH","RESOLVE",1,1,!0);Mb.lh=!0;Mb.md=!0;H.m(g,Ja,Xa,nc);H.m(g,Ja,Xa,Mb);eb&&(Gc?H.m(g,Cb,Ja,Ta):Hb?H.m(g,eb,Ja,u("COLOR","u_shadow_mask",1,1,!0)):Da.O("Internal error"))}else q.push(Ja),eb&&(H.m(g,eb,Ja,Kb),Gc?H.m(g,Cb,Ja,Ta):Hb?H.m(g,eb,Ja,u("COLOR","u_shadow_mask",1,1,!0)):Da.O("Internal error"));
Wa&&(H.m(g,Wa,Ja,rb),H.m(g,Wa,Ja,zb));if(z.length)for(var Nb=z.length,Ba=0;Ba<Nb;Ba++)H.m(g,z[Ba],Ja,x[Ba]);if(p.length)for(Ba=0;Ba<p.length;Ba++)H.m(g,p[Ba],Ja,Ia[Ba]);n=q;q=[];if(!Ab&&a.mA){Aa=d(Oa);c.X.push(Aa);var Sb=F(Aa,!1,da);H.u(g,Sb);if(a.nf){Aa=d(Oa);c.X.push(Aa);var sb=F(Aa,!0,da);H.u(g,sb);H.m(g,Sb,sb,u("COLOR","COLOR",1,1,!0));H.m(g,Sb,sb,u("DEPTH","DEPTH",1,1,!0))}}else Sb=null;if(va.rc&&!Ab)if(La)wb=Xa;else{var wb=ca();H.u(g,wb);H.m(g,n[0],wb,u("COLOR","COPY",1,1,!0))}else wb=null;
if($b&&(va.rc&&Kc||P||ra)){var vc=d(Oa);c.X.push(vc);var mc=G(vc);H.u(g,mc);H.m(g,La?Xa:Ja,mc,u("DEPTH","u_depth",1,1,!0));var vb=u("COLOR","u_scene_depth",1,1,!0);vb.ma=ba.Nc;vb.la=ba.Nc}else mc=null;if(a.xm){var Ob=k("BLEND");q.push(Ob);n=q;q=[]}if(a.Ue){var pb=d(Oa);c.X.push(pb);var Qa=O("GLOW",pb,!1,A,da,nb,Pa);H.u(g,Qa);H.m(g,La?Xa:Ja,Qa,La?Ac:Kb);var Fa=E("X_GLOW_BLUR");Fa.fb="GLOW_MASK_SMALL";Fa.jf=a.Gf.small_glow_mask_width;var Ya=u("COLOR","u_color",1,1,!0);Ya.ma=ba.t;Ya.la=ba.t;H.u(g,Fa);
H.m(g,Qa,Fa,Ya);var fb=E("Y_GLOW_BLUR");fb.fb="GLOW_MASK_SMALL";fb.jf=a.Gf.small_glow_mask_width;var xa=u("COLOR","u_color",1,.5,!0);xa.ma=ba.t;xa.la=ba.t;H.u(g,fb);H.m(g,Fa,fb,xa);var Db=E("X_GLOW_BLUR");Db.fb="GLOW_MASK_LARGE";Db.jf=a.Gf.large_glow_mask_width;var Za=u("COLOR","u_color",1,.5,!0);Za.ma=ba.t;Za.la=ba.t;H.u(g,Db);H.m(g,fb,Db,Za);var bc=E("Y_GLOW_BLUR");bc.fb="GLOW_MASK_LARGE";bc.jf=a.Gf.large_glow_mask_width;var Ra=u("COLOR","u_color",1,.25,!0);Ra.ma=ba.t;Ra.la=ba.t;H.u(g,bc);H.m(g,
Db,bc,Ra);var yb=d(Oa);c.X.push(yb);var mb=N(yb,a);H.u(g,mb);var Tb=u("COLOR","u_src_color",1,1,!0);if(a.xm)if(La){var bb=K();H.u(g,bb);H.m(g,Ob,bb,nc);H.m(g,Ob,bb,Mb);H.m(g,bb,mb,Tb)}else H.m(g,Ob,mb,Tb);else H.m(g,La?Xa:Ja,mb,Tb);H.m(g,a.xm?Ob:Ja,mb,Kb);var Xb=u("COLOR","u_glow_mask_small",1,.5,!0);Xb.ma=ba.t;Xb.la=ba.t;H.m(g,fb,mb,Xb);var cc=u("COLOR","u_glow_mask_large",1,.25,!0);cc.ma=ba.t;cc.la=ba.t;H.m(g,bc,mb,cc);n=[mb];q=[]}a.xm||(Ob=k("BLEND"),q.push(Ob),n=q,q=[]);if(a.nf){var jc=k("XRAY");
q.push(jc);n=q;q=[]}if(sa.wireframe_debug){Aa=d(Oa);c.X.push(Aa);var Pb=Q(Aa);q.push(Pb);H.u(g,Pb);H.m(g,n[0],Pb,hb);H.m(g,n[0],Pb,Kb);Wa&&(H.m(g,Wa,Pb,rb),H.m(g,Wa,Pb,zb));n=q;q=[]}if(La){var Va=K();H.u(g,Va);q.push(Va);H.m(g,n[0],Va,nc);H.m(g,n[0],Va,Mb);n=q;q=[]}var gb=n.slice(0);if(!Ab&&a.Sy){Aa=d(Oa);c.X.push(Aa);var Eb=J(Aa);H.u(g,Eb);H.m(g,n[0],Eb,La?Ac:Kb)}if(Vc&&$b&&!Ab){var cb=Oc.Bi,Yb=Oc.Op,Fb=Oc.hj,Ma=n[0],Ib=A?1:0,dc=u("DEPTH","u_input",1,1,!0);dc.ma=ba.t;dc.la=ba.t;var Jb=u("COLOR",
"u_input",1,.25,!0);Jb.ma=ba.t;Jb.la=ba.t;var tb=cb/Fb,ib=d(Oa);c.X.push(ib);var oc=W(ib,Ib,cb,!0,tb,da,Fb);H.u(g,oc);H.m(g,Ma,oc,dc);var tb=cb/Fb*.5,Hc=d(Oa);c.X.push(Hc);var ec=W(Hc,Ib,cb,!1,tb,da,Fb);H.u(g,ec);H.m(g,oc,ec,Jb);var tb=cb/Fb*.25,kc=d(Oa);c.X.push(kc);var wc=W(kc,Ib,cb,!1,tb,da,Fb);H.u(g,wc);H.m(g,ec,wc,Jb);var Zb=S(Yb,da);q.push(Zb);H.u(g,Zb);H.m(g,Ma,Zb,u("COLOR","u_main",1,1,!0));H.m(g,wc,Zb,u("COLOR","u_god_rays",1,1,!0));n=q;q=[]}if(pa&&!Ab){var Ma=n[0],fc=fa();H.u(g,fc);H.m(g,
Ma,fc,u("COLOR","u_input",1,1,!0));var gc=ma();H.u(g,gc);gc.j.width=sa.fk?2:1;gc.j.height=sa.fk?2:1;var pc=u("COLOR","u_input",1,.25,!0);pc.ma=ba.t;pc.la=ba.t;var qb=u("COLOR","u_luminance",1,.25,!0);qb.ma=ba.t;qb.la=ba.t;H.m(g,fc,gc,pc);var xc=pa.key,db=pa.qB,$a=d(Oa);c.X.push($a);var Pc=L(xc,db,da,$a);H.u(g,Pc);H.m(g,Ma,Pc,u("COLOR","u_main",1,1,!0));H.m(g,fc,Pc,qb);H.m(g,gc,Pc,u("COLOR","u_average_lum",1,1,!1));var lc=u("COLOR","u_color",1,.25,!0);lc.ma=ba.t;lc.la=ba.t;Fa=w("X_BLUR");H.u(g,Fa);
H.m(g,Pc,Fa,lc);fb=w("Y_BLUR");H.u(g,fb);H.m(g,Fa,fb,lc);var Ub=U(pa.blur);H.u(g,Ub);var dd=u("COLOR","u_bloom",1,.25,!0);dd.ma=ba.t;dd.la=ba.t;H.m(g,fb,Ub,dd);H.m(g,Ma,Ub,u("COLOR","u_main",1,1,!0));q.push(Ub);n=q;q=[]}if(Jc&&!Ab){var jd=n[0],Lc=R(zc.mb_decay_threshold,zc.mb_factor);q.push(Lc);H.u(g,Lc);H.m(g,jd,Lc,u("COLOR","u_mb_tex_curr",1,1,!0));Lc.Aa.push(u("COLOR","u_mb_tex_accum",1,1,!0));n=q;q=[]}if(hd&&$b&&!Ab){var Ma=n[0],yc=d(Oa);c.X.push(yc);lc=u("COLOR","u_color",1,1,!0);lc.ma=ba.t;
lc.la=ba.t;var qc=E("X_BLUR");H.u(g,qc);H.m(g,Ma,qc,lc);var hc=E("Y_BLUR");H.u(g,hc);H.m(g,qc,hc,lc);var Yc=gb[0],Qc=ha(yc);yc.dof_distance=c.dof_distance;yc.Me=c.Me;yc.dof_front=c.dof_front;yc.dof_rear=c.dof_rear;yc.dof_power=c.dof_power;yc.dof_on=1;q.push(Qc);H.u(g,Qc);H.m(g,Ma,Qc,u("COLOR","u_sharp",1,1,!0));H.m(g,hc,Qc,u("COLOR","u_blurred",1,1,!0));H.m(g,Yc,Qc,u("DEPTH","u_depth",1,1,!0));n=q;q=[]}if(!Ab&&a.outline){var Ma=n[0],ed=d(Oa);c.X.push(ed);var fd=ia(ed,da);H.u(g,fd);var Rc=E("X_EXTEND"),
Gb=u("COLOR","u_color",1,1,!0),nd=u("COLOR","u_outline_mask",1,1,!0);Rc.xk=!0;H.u(g,Rc);H.m(g,fd,Rc,Gb);var rc=u("COLOR","u_color",1,.5,!0);rc.ma=ba.t;rc.la=ba.t;var Zc=E("Y_EXTEND");Zc.xk=!0;H.u(g,Zc);H.m(g,Rc,Zc,rc);qc=E("X_BLUR");qc.xk=!0;H.u(g,qc);H.m(g,Zc,qc,rc);var $c=u("COLOR","u_color",1,.25,!0);$c.ma=ba.t;$c.la=ba.t;var ad=u("COLOR","u_outline_mask_blurred",1,.25,!0);ad.ma=ba.t;ad.la=ba.t;hc=E("Y_BLUR");hc.xk=!0;H.u(g,hc);H.m(g,qc,hc,$c);var sc=aa(Xc);H.u(g,sc);H.m(g,Ma,sc,u("COLOR","u_outline_src",
1,1,!0));H.m(g,fd,sc,nd);H.m(g,hc,sc,ad);q.push(sc);n=q;q=[]}if(Nc&&!Ab){var Ma=n[0],gd=T(uc.brightness,uc.contrast,uc.exposure,uc.saturation);H.u(g,gd);H.m(g,Ma,gd,u("COLOR","u_color",1,1,!0));q.push(gd);n=q;q=[]}if(Lb){Ma=n[0];if(sa.smaa){var Sc=u("COLOR","u_color",1,1,!0);Sc.ma=ba.t;Sc.la=ba.t;var bd=V("SMAA_EDGE_DETECTION",a);H.u(g,bd);H.m(g,Ma,bd,Sc);var Tc=V("SMAA_BLENDING_WEIGHT_CALCULATION",a);H.u(g,Tc);H.m(g,bd,Tc,Sc);var cd=u("COLOR","u_search_tex",1,1,!1),pd=u("COLOR","u_area_tex",1,1,
!1);cd.ma=ba.t;cd.la=ba.t;pd.ma=ba.t;pd.la=ba.t;Tc.Aa.push(cd);Tc.Aa.push(pd);var od=V("SMAA_NEIGHBORHOOD_BLENDING",a);H.u(g,od);H.m(g,Ma,od,Sc);var qd=u("COLOR","u_blend",1,1,!0);qd.ma=ba.t;qd.la=ba.t;H.m(g,Tc,od,qd);q.push(od)}else{var rd=y(a);H.u(g,rd);var sd=u("COLOR","u_color",1,1,!0);sd.ma=ba.t;sd.la=ba.t;H.m(g,Ma,rd,sd);q.push(rd)}n=q;q=[]}q.push(n[0]);var Ad=H.ne(g,n[0]);if("MOTION_BLUR"==n[0].type||"RESOLVE"==n[0].type)var td=!0;else td=!1,H.Wd(g,Ad,function(a,b,c){if(c.from==c.to)return td=
!0});if(td){var ud=E("NONE");H.u(g,ud);H.m(g,n[0],ud,u("COLOR","u_color",1,1,!0));n=q;q=[];q.push(ud)}Sb&&(sb?q.push(sb):q.push(Sb));Eb&&q.push(Eb);if(!Ab&&a.un.procedural_skydome){var wd=X(da,a.un);H.u(g,wd);q.push(wd)}var Uc=ga();H.u(g,Uc);for(ab=0;ab<q.length;ab++){var kd=q[ab];switch(kd.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":H.m(g,kd,Uc,u("COLOR","NONE",1,1,!0));H.m(g,kd,Uc,u("DEPTH","NONE",1,1,!0));break;case "SKY":H.m(g,kd,Uc,u("CUBEMAP","u_sky",Sa.fm,1,!1));break;case "ANCHOR_VISIBILITY":H.m(g,
kd,Uc,u("COLOR","NONE",1,1,!0));break;default:if(Ab){var xd=e[0].k,ld=u("COLOR","OFFSCREEN",1,1,!0);ld.va=xd;H.m(g,q[ab],Uc,ld);for(Ba=1;Ba<e.length;Ba++){var yd=e[Ba].k,vd=ca();H.u(g,vd);H.m(g,q[ab],vd,u("COLOR","COPY",1,1,!0));ld=u("COLOR","OFFSCREEN",1,yd.Bh/xd.Bh,!0);ld.va=yd;H.m(g,vd,Uc,ld)}}else H.m(g,q[ab],Uc,u("SCREEN","NONE",1,1,!0))}}Xa&&!na(g,Xa).length&&(H.qe(g,H.ne(g,Xa)),H.Eo(g));a.anaglyph_use&&!Ab&&C(g,c);if(Y.enabled){var zd=h(g);zd&&v(g,zd)}b(g,$b);m(g);l(g);Hb&&H.aa(g,function(a,
b){if("DEPTH"==b.type||"MAIN_BLEND"==b.type||"MAIN_XRAY"==b.type)for(var c=0,d=ja(g,b),e=0;e<d.length;e++){var f=d[e];"SHADOW_CAST"==f.type&&(f=f.j,b.eE=f.rb/(f.rb-f.ub),b.Ww=f.lg,b.sh=b.sh||[],b.sh[c]=f.lb,c++)}});return g};a.rJ=q;a.fd=function(a,b,c){var d=a.jf;a.wr[0]=b*a.gb[0]*d;a.wr[1]=c*a.gb[1]*d};a.ic=function(a,b){a.jf=b};a.HI=function(a){var b=null;H.aa(a,function(a,c){return c.j&&null===c.j.Od?(b=c,!0):!1});return b};a.Qa=function(a,b,c){a=ja(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];
return null};a.iJ=P;a.kJ=va;a.wC=ja;a.$I=na;a.bb=function(a,b){var c=null;H.aa(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.bB=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=da(a);H.aa(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.cn.replace(/_/g," ")+")");if(d.j){for(var f=f+"\\n",h=0;h<c.length;h+=2){var g=
d.j.xb;c[h]==g&&(f=ba.ui(g)?f+("CR"+c[h+1]+" "):f+("C"+c[h+1]+" "))}for(h=0;h<c.length;h+=2)g=d.j.wd,c[h]==g&&(f=ba.ui(g)?f+("DR"+c[h+1]):f+("D"+c[h+1]))}d.Aa.length&&(f+="\\n-----\\n");for(h=0;h<d.Aa.length;h++)f+=ua(d.Aa[h],c);h="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(h+",bold")+'"];\n')});H.ye(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+ua(e,c)+'" style="'+(e.pb?"solid":"dotted")+'"];\n'});return b+="}"};
a.LA=function(a){a=H.UF(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function d(){return{name:"",type:0,source:"",er:"",width:0,height:0,Ko:1,Gl:!0,Bh:1024,wt:!1,Ge:null,Bb:0,Oa:null,pd:null,zk:!1,kf:-1,ba:null,Gi:0,Se:0,L:0,Ra:0,ki:0,me:!1,bf:1,Zb:null,Uq:0,Tq:0,Ah:-1,Vq:!1,Vi:-1,Nn:!1,IG:!1,Gh:!1,Jn:!1,repeat:!0}}function b(b,e,f,h){var g=b.type,k=new Uint8Array([204,204,204,255]),l=d();switch(g){case "DATA_TEX2D":case "IMAGE":var m=y.createTexture(),n=y.TEXTURE_2D;y.bindTexture(n,m);y.texImage2D(n,0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,
k);b.image&&"MOVIE"==b.image.source&&(l.zk=!0,l.L=b.frame_start,l.Ra=b.frame_offset,l.ki=b.frame_duration,l.IG=b.use_auto_refresh,l.Gh=b.use_cyclic,l.Gi=b.movie_length,l.Jn=b.b4w_nla_video,0!=l.Ra&&w.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":m=y.createTexture();n=y.TEXTURE_2D;y.bindTexture(n,m);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(f=O.keysearch("name",
b.b4w_source_id,f)))l.Bh=b.b4w_source_size,f.$d=f.$d||[],f.$d.push(b),y.texImage2D(n,0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":m=y.createTexture();n=y.TEXTURE_CUBE_MAP;y.bindTexture(n,m);f="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var q=0;6>q;q++)y.texImage2D(y["TEXTURE_CUBE_MAP_"+f[q]],0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,k);break;case "BLEND":return null;default:return w.error('texture "'+b.name+'" has unsupported type "'+
g+'"'),null}"NONE"==g&&(!b.b4w_enable_canvas_mipmapping||"CANVAS"!=b.b4w_source_type)||"DATA_TEX2D"==g||"IMAGE"==g&&"MOVIE"==b.image.source?y.texParameteri(n,y.TEXTURE_MIN_FILTER,y.LINEAR):y.texParameteri(n,y.TEXTURE_MIN_FILTER,V[F.bl]);y.texParameteri(n,y.TEXTURE_MAG_FILTER,y.LINEAR);k=n;f=b.b4w_anisotropic_filtering;"DEFAULT"===f&&(f=e);"OFF"!==f&&F.Il&&(e=E.hC())&&(f=parseFloat(f.split("x")[0]),y.texParameterf(k,e.TEXTURE_MAX_ANISOTROPY_EXT,f));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(l.repeat=
!1,y.texParameteri(n,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(n,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE)):(y.texParameteri(n,y.TEXTURE_WRAP_S,y.REPEAT),y.texParameteri(n,y.TEXTURE_WRAP_T,y.REPEAT));l.type=a.tg;l.width=1;l.height=1;l.Oa=m;l.Bb=n;"CANVAS"==b.b4w_source_type&&"NONE"==g?(g=b.b4w_source_id,m=b.b4w_source_size,l.wt=b.b4w_enable_canvas_mipmapping,l.er=g,l.source="CANVAS",n=document.createElement("canvas"),n.width=m,n.height=m,l.Ge=n.getContext("2d"),h in M||(M[h]={}),M[h][g]=l,c(l)):"SCENE"==
b.b4w_source_type&&"NONE"==g?(l.er=b.b4w_source_id,l.source="SCENE"):(l.source=g,y.generateMipmap(n),y.bindTexture(n,null));l.name=b.name;return b.k=l}function c(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Bb;y.bindTexture(b,a.Oa);var c=l(a),d=h(a),e=v(a),f=a.Ge.canvas;y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!0);y.texImage2D(b,0,d,c,e,f);y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!1);a.wt&&y.generateMipmap(b);y.bindTexture(b,null);a.width=f.width;a.height=f.height}function m(a){var b=a.Bb;y.bindTexture(b,
a.Oa);y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!0);4!=a.ba.length?a.me?k(a,a.ba,a.width*a.bf,a.height*a.bf,!1):y.texImage2D(b,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,a.ba):y.texImage2D(b,0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,a.ba);y.bindTexture(b,null)}function e(a){var b=a.Bb;y.bindTexture(b,a.Oa);y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!0);a.me?k(a,a.Zb[a.Ah],a.width*a.bf,a.height*a.bf,!1):y.texImage2D(b,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,a.Zb[a.Ah]);y.bindTexture(b,null)}function t(){J||(J=document.createElement("canvas"));
return J}function k(a,b,c,d,e){e||(n(y.TEXTURE_2D),y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,b));y.bindTexture(y.TEXTURE_2D,null);K.oB(a,c,d,G,D)}function n(a){G||(G=y.createFramebuffer());y.bindTexture(a,null);D||(D=y.createTexture());y.bindTexture(a,D);y.texParameteri(a,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE);y.texParameteri(a,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE);y.texParameteri(a,y.TEXTURE_MAG_FILTER,y.LINEAR);y.texParameteri(a,y.TEXTURE_MIN_FILTER,y.LINEAR)}function g(a){a.ba.MJ=function(){m(a)}}
function x(a){return O.Lj(a)?O.clamp(Math.pow(2,parseInt(a).toString(2).length),2,F.zb):a}function l(b){switch(b.type){case a.tg:b=y.RGBA;break;case a.Dl:b=y.RGB;break;case a.xj:b=y.RGBA;break;case a.yj:b=y.RGB;break;case a.Qh:b=y.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function h(b){switch(b.type){case a.tg:b=F.sc?y.RGBA8:y.RGBA;break;case a.Dl:b=F.sc?y.RGB8:y.RGB;break;case a.xj:b=F.sc?y.RGBA8:y.RGBA;break;case a.yj:b=F.sc?y.RGB8:y.RGB;break;case a.Qh:b=F.sc?y.DEPTH_COMPONENT24:
y.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function v(b){switch(b.type){case a.tg:b=y.UNSIGNED_BYTE;break;case a.Dl:b=y.UNSIGNED_BYTE;break;case a.xj:b=y.FLOAT;break;case a.yj:b=y.FLOAT;break;case a.Qh:b=y.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function C(a){return a&&a.name&&a.pd?!0:!1}function A(a,b){if(b in I&&a in I[b]){var c=I[b][a];c.ba?c.ba.play():c.Zb&&(c.Vq=!0);return!0}return!1}function B(a,b){if(b in I&&a in I[b]){var c=I[b][a];c.ba?c.ba.pause():
c.Zb&&(c.Vq=!1);return!0}return!1}function q(a,b){if(b in I&&a in I[b]){var c=I[b][a];c.ba?c.ba.currentTime=c.Ra/c.Se:c.Zb&&(c.Ah=u(c,c.Ra),e(c));return!0}return!1}function z(a){return a.ba?!a.ba.paused:a.Zb?a.Vq:!1}function u(a,b){return Math.round(b*a.Uq/a.Gi)}var r=p("__config"),f=p("__dds"),E=p("__extensions"),w=p("__print"),N=p("__time"),O=p("__util"),K=p("__renderer"),F=r.p,Q=r.C,J=null,D=null,G=null;a.Nc=0;a.t=0;a.Ly=0;a.Jy=0;a.Ky=0;a.Iy=0;a.tg=10;a.Dl=20;a.xj=30;a.yj=40;a.Qh=50;a.Bl=60;a.zl=
70;a.Cl=80;a.Al=90;var M={},I={},y=null,V;a.gd=function(b){V=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.Nc=b.NEAREST;a.t=b.LINEAR;a.Ly=b.NEAREST_MIPMAP_NEAREST;a.Jy=b.LINEAR_MIPMAP_NEAREST;a.Ky=b.NEAREST_MIPMAP_LINEAR;a.Iy=b.LINEAR_MIPMAP_LINEAR;y=b};a.lC=function(a,b){return b in M&&a in M[b]?M[b][a].Ge:null};a.pG=function(a,b){return b in M&&a in M[b]?(c(M[b][a]),!0):!1};a.Vj=function(b,c){var e=d();e.name=b;e.type=c;e.source="NONE";if(c==
a.Bl||c==a.zl||c==a.Cl||c==a.Al)e.pd=y.createRenderbuffer();else{var f=y.TEXTURE_2D,h=y.createTexture();y.bindTexture(f,h);y.texParameteri(f,y.TEXTURE_MAG_FILTER,y.LINEAR);y.texParameteri(f,y.TEXTURE_MIN_FILTER,y.LINEAR);y.texParameteri(f,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE);y.texParameteri(f,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE);y.bindTexture(f,null);e.Bb=f;e.Oa=h}return e};a.xA=function(b){var c=y.createTexture(),e=y.TEXTURE_CUBE_MAP;y.bindTexture(e,c);y.texParameteri(e,y.TEXTURE_MAG_FILTER,y.LINEAR);
y.texParameteri(e,y.TEXTURE_MIN_FILTER,y.LINEAR);y.texParameteri(e,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE);y.texParameteri(e,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),h=0;6>h;h++)y.texImage2D(y[f[h]],0,y.RGBA,b,b,0,y.RGBA,y.UNSIGNED_BYTE,null);y.bindTexture(e,null);e=d();e.name="CUBEMAP";e.type=a.tg;e.source="NONE";e.width=
3*b;e.height=2*b;e.Ko=1;e.Oa=c;e.Bb=y.TEXTURE_CUBE_MAP;return e};a.Uk=function(a,b,c){if(!C(a)){var d=a.Bb;y.bindTexture(d,a.Oa);b&&y.texParameteri(d,y.TEXTURE_MIN_FILTER,b);c&&y.texParameteri(d,y.TEXTURE_MAG_FILTER,c);y.bindTexture(d,null)}};a.XI=function(b){if(C(b))return{min:a.Nc,FD:a.Nc};var c=b.Bb;y.bindTexture(c,b.Oa);b=y.getTexParameter(c,y.TEXTURE_MIN_FILTER);var d=y.getTexParameter(c,y.TEXTURE_MAG_FILTER);y.bindTexture(c,null);return{min:b,FD:d}};a.resize=function(b,c,d){c=Math.max(c,F.fk?
2:1);d=Math.max(d,F.fk?2:1);if(b.width!=c||b.height!=d){switch(b.type){case a.Bl:y.bindRenderbuffer(y.RENDERBUFFER,b.pd);y.renderbufferStorage(y.RENDERBUFFER,y.RGB565,c,d);y.bindRenderbuffer(y.RENDERBUFFER,null);break;case a.zl:y.bindRenderbuffer(y.RENDERBUFFER,b.pd);y.renderbufferStorage(y.RENDERBUFFER,y.DEPTH_COMPONENT16,c,d);y.bindRenderbuffer(y.RENDERBUFFER,null);break;case a.Cl:y.bindRenderbuffer(y.RENDERBUFFER,b.pd);y.renderbufferStorageMultisample(y.RENDERBUFFER,F.nc,y.RGBA8,c,d);y.bindRenderbuffer(y.RENDERBUFFER,
null);break;case a.Al:y.bindRenderbuffer(y.RENDERBUFFER,b.pd);y.renderbufferStorageMultisample(y.RENDERBUFFER,F.nc,y.DEPTH_COMPONENT24,c,d);y.bindRenderbuffer(y.RENDERBUFFER,null);break;default:var e=b.Bb;y.bindTexture(e,b.Oa);var f=l(b),g=h(b),k=v(b);y.texImage2D(e,0,g,c,d,0,f,k,null);y.bindTexture(e,null)}c>F.zb||d>F.zb?w.error('Slink texture "'+b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+F.zb+"x"+F.zb+"."):(b.width=c,b.height=d)}};a.TA=b;a.Qw=m;a.Pw=e;a.hl=function(a,b,c,d,e){var h=
a.source,l=a.Oa,m=a.Bb,q=1,r=1;y.bindTexture(m,l);if(4==b.length){var u=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==h)if(u)y.texImage2D(m,0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){r=f.du(b);u=O.Lj(r.width)||O.Lj(r.height);if(r.width>F.zb||r.height>F.zb){w.error('Texture "'+d+'" has unsupported size: '+r.width+"x"+r.height+". Max available: "+F.zb+"x"+F.zb+".");return}q=r.width;r=r.height;u&&(a.me=!0,n(m),q=x(q*a.bf),r=x(r*a.bf));f.EG(y,E.au(),
b,!0);a.me&&(k(a,null,q,r,!0),y.bindTexture(m,l),y.generateMipmap(m));a.width=q;a.height=r;a.Ko=f.nC(b)}else{y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!0);a.zk?F.Tk?(q=b[0].width,r=b[0].height):(q=b.videoWidth,r=b.videoHeight):(q=b.width,r=b.height);a.width=q;a.height=r;if(q>F.zb||q>F.zb)w.warn('Texture "'+d+'" has unsupported size: '+q+"x"+r+". Max available: "+F.zb+"x"+F.zb+". Reduced image size will be used."),a.bf=Math.min(F.zb/q,F.zb/r),a.me=!0;a.zk&&(F.Tk?(e in I||(I[e]={}),I[e][a.name]=a,a.Zb=b,
a.Uq=b.length,a.Se=a.Tq*a.Gi/b.length,b=b[0]):(e in I||(I[e]={}),I[e][a.name]=a,a.ba=b,a.ba.loop=a.Gh,a.Se=b.duration?a.Gi/b.duration:N.Rb(),Q.tt||(b.playbackRate=N.Rb()/a.Se,Q.Vs&&2<b.playbackRate&&(b.playbackRate=2)),g(a)));q=x(a.width*a.bf);r=x(a.height*a.bf);a.me?(d=t(),l=d.getContext("2d"),d.width=q,d.height=r,l.drawImage(b,0,0,a.width,a.height,0,0,q,r),y.texImage2D(m,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,d)):O.Lj(a.width)||O.Lj(a.height)?(k(a,b,q,r,!1),a.me=!0):y.texImage2D(m,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,
b);l=a.Oa;y.bindTexture(m,l);a.zk||y.generateMipmap(m);y.bindTexture(m,null);a.width=q;a.height=r}else if("ENVIRONMENT_MAP"==h)if(r=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],u){for(q=0;6>q;q++)y.texImage2D(y["TEXTURE_CUBE_MAP_"+r[q][0]],0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!1);if(b.width%3||b.height%2){w.error('Cubemap texture "'+d+'" has unsupported size: '+
b.width+"x"+b.height+". The width must be multiple of three and the height - multiple of two.");return}q=b.width/3;if(q>F.Ai)w.warn('Cubemap texture "'+d+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+3*F.Ai+"x"+2*F.Ai+". Reduced image size will be used."),d=x(F.Ai/q*q),a.me=!0;else if(d=x(q),3*d>F.zb||2*d>F.zb)a.me=!0;if(a.me||F.Jv)for(l=d,u=0;6>u;u++)c=r[u],e=t(),e.width=l,e.height=l,h=e.getContext("2d"),"POSITIVE_Y"==c[0]||"NEGATIVE_Y"==c[0]?(h.translate(0,l),h.scale(1,-1)):
(h.translate(l,0),h.scale(-1,1)),h.drawImage(b,c[1]*q,c[2]*q,q,q,0,0,l,l),y.texImage2D(y["TEXTURE_CUBE_MAP_"+c[0]],0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,e);else{r=b;b=d;n(y.TEXTURE_2D);y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,r);y.bindTexture(y.TEXTURE_2D,null);for(r=0;6>r;r++)y.texImage2D(y.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,y.RGBA,b,b,0,y.RGBA,y.UNSIGNED_BYTE,null);y.bindTexture(a.Bb,null);y.bindFramebuffer(y.FRAMEBUFFER,G);for(r=0;6>r;r++)K.nB(a,y.TEXTURE_CUBE_MAP_POSITIVE_X+r,b,q,D,r);
y.bindFramebuffer(y.FRAMEBUFFER,null);y.bindTexture(a.Bb,a.Oa);y.texParameteri(a.Bb,y.TEXTURE_MIN_FILTER,V[F.bl]);y.texParameteri(a.Bb,y.TEXTURE_MAG_FILTER,y.LINEAR)}a.width=3*d;a.height=2*d;y.generateMipmap(m)}else"DATA_TEX2D"==h&&(y.texImage2D(m,0,y.RGBA,b.width,b.height,0,y.RGBA,y.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);y.bindTexture(m,null)};a.iB=function(a){y.deleteTexture(a)};a.wi=function(a){return a&&a.name&&(a.Oa||a.pd)?!0:!1};a.ui=C;a.wJ=function(b){return b.type==a.xj||
b.type==a.yj?!0:!1};a.DC=function(b){var c=0;switch(b.type){case a.tg:case a.Dl:c=4;break;case a.xj:case a.yj:c=16;break;case a.Qh:c=3;break;case a.Bl:case a.zl:c=2;break;case a.Cl:c=4*F.nc;break;case a.Al:c=3*F.nc}return c};a.dC=function(a){var c=null,c={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(c,null,a,0);c.image={filepath:null};return c};a.cleanup=function(){if(!F.Tk)for(var a in I)for(var b in I[a])I[a][b].ba.pause(),I[a][b].ba.src="",
I[a][b].ba.load();M={};I={}};a.pause=function(){for(var a in I)for(var b in I[a]){var c=I[a][b];z(c)&&(B(b,a),c.Nn=!0)}};a.reset=function(){for(var a in I)for(var b in I[a])q(b,a),I[a][b].Nn=!1};a.play=function(a){for(var b in I)for(var c in I[b]){var d=I[b][c];if(!a||d.Nn)A(c,b),d.Nn=!1}};a.Lr=function(a,b){return b in I&&a in I[b]?I[b][a].Jn:!1};a.play_video=A;a.pause_video=B;a.reset_video=q;a.VE=function(a,b,c){c in I&&a in I[c]&&(a=I[c][a],a.ba?a.ba.currentTime=b/a.Se:a.Zb&&(a.Ah=b,e(a)))};a.gx=
z;a.hx=function(a){return a.ba||a.Zb?a.ba?2<=a.ba.readyState:!0:0};a.dx=function(a){return a.ba||a.Zb?a.ba?Math.round(a.ba.currentTime*a.Se):a.Ah:0};a.fx=function(a){return a.ba||a.Zb?a.ba?a.Ra:u(a,a.Ra):0};a.aH=function(a){if(!a.ba&&!a.Zb)return 0;var b=Math.min(a.ki,a.Gi-a.Ra);return a.ba?a.Ra+b:u(a,a.Ra+b)};a.nn=function(a,b){return Math.round(N.Rb()/a.Se*a.Tq*b)};a.ex=function(a){return Math.min(a.ki,a.Gi-a.Ra)};a.$G=u};b4w.module.__assets=function(a,p){function d(){return C.VC()?p(C.oc.Vl).data:null}function b(){var a={El:null,Qy:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.El=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=d();b&&a.El in b&&(a.status=200,b[a.El]&&(a.response=a.Qy(b[a.El])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function c(b){for(var c=0,d=0;d<b.length;d++){var h=b[d];20===h.state&&c++;if(c>=f.ND)break;if(10===h.state)switch(h.state=20,c++,h.type){case a.AT_ARRAYBUFFER:m(h,"arraybuffer");break;case a.AT_JSON:m(h,"json");break;case a.AT_TEXT:m(h,"text");break;case a.AT_AUDIOBUFFER:e(h);break;case a.AT_IMAGE_ELEMENT:t(h);
break;case a.AT_AUDIO_ELEMENT:k(h);break;case a.ul:n(h);break;case a.tl:g(h);break;default:z.O("Wrong asset type: "+h.type)}}}function m(c,e){var f=d(),h=f&&c.url in f?new b:new XMLHttpRequest;if("GET"==c.ed)h.open("GET",c.url,!0);else if("POST"==c.ed)switch(h.open("POST",c.url,!0),c.uh){case a.Rr:h.setRequestHeader("Content-type","text/plain");break;case a.Pn:h.setRequestHeader("Content-type","application/json")}"text"==e?(h.overrideMimeType("text/plain"),h.responseType="text"):"json"==e?(h.overrideMimeType("application/json"),
h.responseType="text"):h.responseType=e;h.onreadystatechange=function(){if(40!=c.state&&4==h.readyState){if(200==h.status||0==h.status){var a=h.response;if(a){if("json"==e&&"string"==typeof a)try{a=JSON.parse(a)}catch(b){B.error(b+" (parsing JSON "+c.url+")");c.Gb(null,c.id,c.type,c.url,c.eb);return}c.Gb(a,c.id,c.type,c.url,c.eb)}else B.error("empty responce when trying to get "+c.url),c.Gb(null,c.id,c.type,c.url,c.eb)}else B.error(h.status+" when trying to get "+c.url),c.Gb(null,c.id,c.type,c.url,
c.eb);c.state=30}};h.addEventListener("progress",function(a){a.lengthComputable&&c.yv(a.loaded/a.total)},!1);h.send(c.Vf)}function e(a){"GET"!=a.ed&&z.O("Unsupported request type for audio buffer");var c=d(),e=c&&a.url in c?new b:new XMLHttpRequest;e.open("GET",a.url,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?q.fB(b,function(b){a.Gb(b,a.id,a.type,a.url,a.eb);a.state=30},function(){a.Gb(null,a.id,
a.type,a.url,a.eb);B.error("failed to decode "+a.url);a.state=30}):(a.Gb(null,a.id,a.type,a.url,a.eb),B.error("empty responce when trying to get "+a.url),a.state=30)}else a.Gb(null,a.id,a.type,a.url,a.eb),B.error(e.status+" when trying to get "+a.url),a.state=30};e.send(a.Vf)}function t(a){"GET"!=a.ed&&z.O("Unsupported request type for image element");var b=document.createElement("img");r.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.Gb(b,a.id,a.type,a.url,a.eb),a.state=
30)};b.addEventListener("error",function(){40!=a.state&&(a.Gb(null,a.id,a.type,a.url,a.eb),B.error("could not load image: "+a.url),a.state=30)},!1);var c=d();if(c&&a.url in c)if(c[a.url]){var e=l(a.url);b.src="data:"+e+";base64,"+c[a.url]}else A.Tp()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url}function k(a){"GET"!=a.ed&&z.O("Unsupported request type for audio element");var b=document.createElement("audio");
if(r.allow_cors||r.dt)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.Gb(b,a.id,a.type,a.url,a.eb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.Gb(null,a.id,a.type,a.url,a.eb),B.error("could not load sound: "+a.url),a.state=30)},!1);var c=d();if(c&&a.url in c)if(c[a.url]){var e=h(a.url);b.src="data:"+e+";base64,"+c[a.url];40!=a.state&&(a.Gb(b,a.id,a.type,a.url,a.eb),a.state=30)}else A.Tp()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",
!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url,r.ah&&b.load();r.lq&&(b.autoplay=!0,b.pause());setTimeout(function(){b.vF=1},5E3)}function n(a){function b(){40!=a.state&&(a.Gb(null,a.id,a.type,a.url),B.error("could not load video: "+a.url,a.eb),a.state=30)}"GET"!=a.ed&&z.O("Unsupported request type for video element");var c=document.createElement("video");c.muted=!0;if(r.allow_cors||r.ah)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){c.removeEventListener("error",
b,!1);40!=a.state&&(a.Gb(c,a.id,a.type,a.url,a.eb),a.state=30)},!1);c.addEventListener("error",b,!1);var e=d();if(e&&a.url in e)if(e[a.url]){var f=v(a.url);c.src="data:"+f+";base64,"+e[a.url];40!=a.state&&c.addEventListener("loadeddata",function(){a.Gb(c,a.id,a.type,a.url,a.eb);a.state=30},!1)}else A.Tp()?(e=document.createEvent("CustomEvent"),e.initCustomEvent("error",!1,!1,null)):e=new CustomEvent("error"),c.dispatchEvent(e);else c.src=a.url,r.ah&&c.load();r.lq&&(c.autoplay=!0,c.pause());setTimeout(function(){c.vF=
1},1E4)}function g(c){function e(a){c.Gb(a,c.id,c.type,c.url,c.eb);c.state=30}"GET"!=c.ed&&z.O("Unsupported request type for seq video element");var f=d(),h=f&&c.url in f?new b:new XMLHttpRequest;if(null==c.uh&&null==c.Vf)h.open("GET",c.url,!0);else switch(h.open("POST",c.url,!0),c.uh){case a.Rr:h.setRequestHeader("Content-type","text/plain");break;case a.Pn:h.setRequestHeader("Content-type","application/json")}h.responseType="arraybuffer";h.onreadystatechange=function(){if(40!=c.state&&4==h.readyState)if(200==
h.status||0==h.status){var a=h.response;a?x(a,e):(c.Gb(null,c.id,c.type,c.url,c.eb),B.error("empty responce when trying to get "+c.url),c.state=30)}else c.Gb(null,c.id,c.type,c.url,c.eb),B.error(h.status+" when trying to get "+c.url),c.state=30};h.addEventListener("progress",function(a){a.lengthComputable&&c.yv(a.loaded/a.total)},!1);h.send(c.Vf)}function x(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],Es:[],Se:c[4]},h=20,g=0;g<e;g++){var k=c[h/4],l=new Blob([d.subarray(h+
4,h+4+k)],{type:"image/jpg"}),m=document.createElement("img");m.src=window.URL.createObjectURL(l);f.images.push(m);f.Es.push(l);h+=k+8-k%4}m.onload=function(){for(var a=0;a<f.images.length;a++)window.URL.revokeObjectURL(f.images[a].src);delete f.Es;b(f)}}function l(a){var b="image";switch(z.Ap(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function h(a){var b="audio";switch(z.Ap(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";
break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function v(a){var b="video";switch(z.Ap(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var C=p("__config"),A=p("__compat"),B=p("__print"),q=p("__sfx"),z=p("__util"),u=p("__version"),r=C.p,f=C.be;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.ul=70;a.tl=80;a.Pn=a.AT_JSON;a.Rr=a.AT_TEXT;var E=[],w=0,N={};
a.Yk=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.cJ=function(a){if(N[a])return N[a];var b=f.Dq?a+u.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return N[a]=b;z.O("Error XHR: responce is empty, GET "+a)}else z.O("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<E.length;a++)E[a].state=40;E=[];w=0;N={}};
a.enqueue=function(a,b,e,h){for(var g=0;g<a.length;g++){var k=a[g],k={id:k.id,type:k.type,url:k.url,ed:k.ed?k.ed:"GET",uh:k.uh?k.uh:null,Vf:k.Vf?k.Vf:null,eb:k.eb?k.eb:null,state:10,Gb:b||function(){},kv:e||function(){},yv:h||function(){},lv:w};if(f.Dq){var l=d();l&&k.url in l||(k.url+=u.timestamp())}E.push(k)}c(E);w++};a.update=function(){c(E);for(var a=E,b=0,d=!0,e=0;e<a.length;e++){var f=a[e];f.lv===a[b].lv?30!==f.state&&(d=!1):(d&&(a[e-1].kv(),d=e-b,a.splice(b,d),e-=d),b=e,d=30===a[e].state?!0:
!1);e===a.length-1&&d&&(a[e].kv(),a.splice(b))}}};b4w.module.__loader=function(a,p){function d(c,d,e,f){var h=q,g=C.create(),k;for(k in d){var m=b(d[k]);(f&&m.jb||!c&&m.Ab)&&l(m);C.u(g,m)}for(k in d)for(m=d[k],m.name=k,c=0;c<m.F.length;c++)C.m(g,d[m.F[c]],m,null);d=b({name:"out",Xa:a.wx,qb:function(a,b,c,d,e){b.Ma&&(h.jr=!0);v(b)||(b.status=2);b.Lu(b.id,!0);e(b,c);A.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},mb:5});if(e)e=C.tk(g);else{k=C.clone(g);do{e=C.tk(k);m=[];for(c=0;c<e.length;c++){f=e[c];var n=C.La(k,f);n.ib&&m.push(f)}for(c=
0;c<m.length;c++)C.qe(k,m[c]);m.length&&C.Eo(k)}while(m.length)}C.u(g,d);for(c=0;c<e.length;c++)f=e[c],n=C.La(g,f),d.F.push(n.name),C.m(g,n,d,null);return g}function b(a){a.ib=a.ib||!1;a.Xa||0===a.Xa||(a.Xa=a.uc);a.F=a.F||[];a.wk=a.wk||!1;a.br=a.br||!1;a.mb=a.mb||0;a.jb=a.jb||!1;a.Ab=a.Ab||!1;a.status=0;a.FJ=0;a.dq=0;a.Ij=a.Ij||null;return a}function c(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var h=b[e];C.La(a.ue,h).wk&&(C.gg(a.ue,h,function(d){var e=!0;C.Wd(a.ue,d,function(a,b){if(!b.wk)return e=
!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-1;0<=e;e--)b.splice(d[e],1);return c}function m(a){function b(c,d){var e=C.La(a.ue,c),f=C.La(a.ue,d),h=f.Xa-e.Xa;0==h&&(h=e.ib-f.ib);return h}var d=[],e=a.hf,h=!1;do{var g=c(a,e);d.push.apply(d,e);0<g.length&&(h=!0);e=g}while(0<g.length);h&&d.sort(b);a.hf=d;return a.hf.length}function e(a,b,c){if(b.br)return b.wk=!0,k(a,b),!1;if(!b.qb&&!b.wf&&!b.Hj)return k(a,b),!1;if(0==b.status&&(b.status++,b.qb))return b.qb(c,a,
b,b.Ij,k,n),!0;if(1==b.status){if(b.wf)return b.wf(c,a,b,b.Ij,k,n),!0;b.status++}return 2==b.status&&(b.status++,b.Hj)?(b.Hj(c,a,b,b.Ij,k,n),!0):!1}function t(a){if(0==a.vn)return 100;var b=0;C.aa(a.ue,function(c,d){a.do_not_load_resources&&d.jb||(b+=d.dq*d.mb)});return B.trunc(100*b/a.vn)}function k(a,b){b.wk=!0;b.status=3;g(a,b,1)}function n(a,b,c){1>c?g(a,b,c):b.status++}function g(a,b,c){var d=q;if(b.qb||b.wf||b.Hj)if(b.dq=c,b=t(a),a.lt!=b||1==c)a.ir(b,performance.now()-a.Dw),a.lt=b,d.gq=!0}function x(a,
b){var c=null;C.aa(a.ue,function(a,d){if(d.name==b)return c=d,1});return c}function l(a){a.br=!0;a.dq=1}function h(a){a.ir=null;a.Jo=null;a.ue=null;a.hf=null}function v(a){return a&&(3==a.status||4==a.status)}var C=p("__graph"),A=p("__print"),B=p("__util");a.uc=0;a.sg=1;a.wx=2;var q=null;a.bu=function(){return q};a.MA=function(){var a={xe:[],Wo:0,Fl:0,jr:!1,gq:!1};return q=a};a.UA=function(a,b,c,e,h,g,k,l){var m=q,n=m.xe.length,t={id:n,Ma:0==n,status:0,Re:b,Cs:"",Lu:c||function(){},Ku:l||!1,lK:g,
Dw:0,lt:0,vn:0,Lq:!1,ir:e||function(){},Jo:h||function(){},ue:null,hf:null,Ip:!1,Gp:!1,Mp:!1};a=d(t.Ma,a,g,k);t.ue=a;b=[];c=C.AC(a);for(e=0;e<c.length;e++)b.push(c[e]);t.hf=b;C.aa(a,function(a,b){!(b.qb||b.wf||b.Hj)||t.do_not_load_resources&&b.jb||(t.vn+=b.mb)});m.xe.push(t);m.Fl++;return t.id};a.AG=function(b){var c=q;if(c&&0!=q.Fl)if(c.gq)c.gq=!1;else{var d=performance.now();do{var f=c.xe[c.Wo],g=b[f.id];if(!v(f))if(0==f.status&&(f.status=1,f.Dw=performance.now(),f.ir(0,0)),m(f)){var k=f,l=k.hf.length;
do{var n=C.La(k.ue,k.hf[0]),t=e(k,n,g);n.Xa==a.sg&&(k.Lq=!0);n=k.hf.shift();k.hf.push(n);l--}while(!t&&0!=l)}else k=c,l=f,l.Jo(g,l),l.status=3,k.Fl--,h(l);c.jr&&(c.Wo=(c.Wo+1)%c.xe.length);if(f.Lq){f.Lq=!1;break}}while(16>performance.now()-d)}};a.ks=function(a){var b=q;a.Jo(null,a);a.status=3;b.Fl--;h(a);a.status=4;a.Ma&&(b.jr=!0);a.Lu(a.id,!1)};a.cK=n;a.tn=function(a,b){var c=x(a,b);null!==c&&l(c)};a.TF=v;a.is_primary_loaded=function(a){var b=q;if(!b)return!1;a|=0;return b.xe[a]&&(3==b.xe[a].status||
2==b.xe[a].status)};a.JC=function(){A.error("Debug mode isn't enabled. Can not retrieve the graph.")};a.cleanup=function(){q=null}};b4w.module.__logic_nodes=function(a,p){function d(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];if(-2==c.state){for(var f=0;f<c.mn;f++)if(h.get_sensor_value(a,b,f))for(var k=0;k<c.ln.length;k++)if(c.ln[k]==f){e.mh==c.Bw?(x.is_play(e.P)&&(c.state=-1),d.Hd.Xc||(c.state=1,c.Vk=c.Iu[k])):(c.state=1,c.Vk=c.Iu[k]);return}c.state=0}}}function b(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];for(var f=0;f<c.mn;f++)if(h.get_sensor_value(a,b,f)&&f==c.Qv){if(x.is_play(e.P)&&e.mh==c.Bw)c.state=-1;
else if(!d.Hd.Xc||c.$a.no_wait)c.state=1;return}c.state=0}}function c(a,b,c){switch(b.state){case 1:g.error("Unknown node type: "+a.type);break;case 2:c.da=a.oa}}function m(a){var b=l.get("url_params");if(b&&a in b)return Number(b[a]);b=location.href.toString();if(-1==b.indexOf("?"))return 0;for(var b=b.split("?")[1].split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if(1<d.length&&d[0]==a)return Number(d[1])}return 0}function e(a){return k.Wb(k.tc,a.gp,0)}function t(a,b){var d=a.b4w_logic_nodes,
e=b.Yc;b.state=1;for(var f=0;f<d.length;f++){var h={B:[],Hd:{Ga:a,da:0,Xc:!1,xr:f,vb:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}}};e.push(h);for(var k=e[e.length-1],g=d[f],l=0;l<g.length;l++){var m=g[l],m={type:m.type,label:m.label,oa:m.slot_idx_order,Vk:m.slot_idx_jump,L:m.frame_range[0],ea:m.frame_range[1],MB:m.frame_range_mask?m.frame_range_mask[0]:!0,KB:m.frame_range_mask?m.frame_range_mask[1]:!0,state:-1,mn:-1,Qv:-1,oA:m.condition,Ln:m.variable1,Mn:m.variable2,sq:m.number1,bv:m.number2,Kh:m.variabled,
url:m.url,dE:m.param_name,bE:m.operation,mute:m.mute,gp:m.object,obj:null,Db:{},sd:m.anim_name,mv:m.parse_resp_list,Cc:m.objects_paths,rq:m.nodes_paths,Ef:m.floats,$a:m.bools,ig:m.variables,hq:m.materials_names,Yv:m.shader_nd_type,Jg:m.common_usage_names,Rv:m.send_req_vars_list,Bw:k,xv:V[m.type]?V[m.type]:c,en:!1,zn:0,cl:0,ab:null,ln:null,Iu:m.links};k.B.push(m)}for(g=0;g<k.B.length;g++)m=k.B[g],m.xv(m,b,h.Hd,0,0)}var d=a.timeline_markers,n;for(n in d)b.Wk.push(d[n]);b.Wk.sort(function(a,b){return a-
b});b.state=2;Q.push(b)}var k=p("__objects"),n=p("__scenes"),g=p("__print"),x=p("__nla"),l=p("__config"),h=p("__controls"),v=p("__util"),C=p("__animation"),A=p("__assets"),B=p("__batch"),q=p("__geometry"),z=p("__time"),u=p("__camera"),r=p("__vec3");p("__vec4");var f=p("__physics"),E=p("__transform"),w=p("__sfx");p("__constraints");var N=p("__mat3"),O=p("__mat4"),K=p("__tsr"),F=p("__quat"),Q=[],J=new Float32Array(4),D=new Float32Array(3),G=new Float32Array(3),M=new Float32Array(2),I=new Float32Array(9),
y=new Float32Array(16),V={ENTRYPOINT:function(a,b,c){switch(b.state){case 2:c.da=a.oa}},HIDE:function(a,b,c){switch(b.state){case 1:a.obj=e(a);break;case 2:n.Jj(a.obj,!0),c.da=a.oa}},SHOW:function(a,b,c){switch(b.state){case 1:a.obj=e(a);break;case 2:n.Jj(a.obj,!1),c.da=a.oa}},PAGEPARAM:function(a,b,c){switch(b.state){case 2:c.vb[a.Kh]=m(a.dE),c.da=a.oa}},SWITCH_SELECT:function(a,b,c){switch(b.state){case 1:a:{c=b.Yc[c.xr];var e=k.cu();a.ln=[];for(var f in a.Cc){var l=k.Wb(k.tc,a.Cc[f],0),m=e.indexOf(l);
if(-1==m){g.error("logic script error: non-selectable object:",a.Cc[f][a.Cc[f].length-1]);break a}a.ln.push(m)}a.state=-1;a.mn=e.length;f=[];for(m=0;m<e.length;m++)f.push(h.create_selection_sensor(e[m],!0));h.create_sensor_manifold(l,"LOGIC_NODES_SWITCH_SELECT_"+a.label,h.CT_SHOT,f,h.pt,d(),[a,b,c])}break;case 2:if(-1==a.state){b=b.Yc[c.xr].B;for(l=0;l<b.length;l++)e=b[l],"SWITCH_SELECT"==e.type&&(e.state=-1);a.state=-2}-1<a.state&&(c.da=a.state?a.Vk:a.oa,a.state=-1)}},SELECT:function(a,c,d){switch(c.state){case 1:d=
c.Yc[d.xr];var f=e(a),l=k.cu(),m=l.indexOf(f);if(-1==m)g.error("logic script error: non-selectable object:",a.gp[a.gp.length-1]);else{a.state=-1;a.mn=l.length;a.Qv=m;for(var m=[],n=0;n<l.length;n++)m.push(h.create_selection_sensor(l[n],!0));h.create_sensor_manifold(f,"LOGIC_NODES_SELECT_"+a.label,h.CT_SHOT,m,h.pt,b(),[a,c,d])}break;case 2:if(-1<a.state){d.da=a.state?a.Vk:a.oa;a.state=-1;break}a.$a.not_wait&&(d.da=a.oa)}},PLAY:function(a,b,c,d){switch(b.state){case 1:x.kr();a.state=-1;a.$a.not_wait||
(a.$a.not_wait=!1);break;case 2:switch(a.state){case -1:if(x.is_play(b.P))if(b.Uo==b.mh&&c.Xc)break;else{var e=b.mh;if(e){e.Hd.da=e.B[e.Hd.da].oa;e.B[e.Hd.da].state=-1;for(var e=b.mh.B,f=0;f<e.length;f++){var h=e[f];"PLAY"==h.type&&(h.state=-1)}}}c.Xc=!a.$a.not_wait;b.mh=b.Uo;a.state=0;a.MB&&(x.fF(a.L),x.Tv(d));if(a.KB)x.Uv(a.ea);else{d=x.get_frame(d);for(var k in b.Wk)if(d<b.Wk[k])break;x.Uv(b.Wk[k])}x.pv(null);a.$a.not_wait&&(c.da=a.oa,a.state=-1,c.Xc=!1);break;case 0:x.is_play()||(c.da=a.oa,a.state=
-1,c.Xc=!1);break;case 1:c.da=a.oa;a.state=-1;b.mh=null;c.Xc=!1;break;default:v.O("Unknown state of "+a.name),a.state=-1}}},REDIRECT:function(a,b){switch(b.state){case 2:window.location.href=a.url,b.state=3}},MATH:function(a,b,c){switch(b.state){case 2:b=-1==a.Ln?a.sq:c.vb[a.Ln];var d=-1==a.Mn?a.bv:c.vb[a.Mn];switch(a.bE){case "ADD":c.vb[a.Kh]=b+d;break;case "MUL":c.vb[a.Kh]=b*d;break;case "SUB":c.vb[a.Kh]=b-d;break;case "DIV":0==d&&v.O("Division by zero in Logic script");c.vb[a.Kh]=b/d;break;case "RAND":c.vb[a.Kh]=
Math.random()*(d-b)+b}c.da=a.oa}},CONDJUMP:function(a,b,c){switch(b.state){case 2:b=-1==a.Ln?a.sq:c.vb[a.Ln];var d=-1==a.Mn?a.bv:c.vb[a.Mn],e=!1;switch(a.oA){case "EQUAL":b==d&&(e=!0);break;case "NOTEQUAL":b!=d&&(e=!0);break;case "LESS":b<d&&(e=!0);break;case "GREATER":b>d&&(e=!0);break;case "LEQUAL":b<=d&&(e=!0);break;case "GEQUAL":b>=d&&(e=!0)}c.da=e?a.Vk:a.oa}},REGSTORE:function(a,b,c){switch(b.state){case 2:c.vb[a.Kh]=a.sq,c.da=a.oa}},PLAY_ANIM:function(a,b,c){var d=C.SLOT_ALL;""==!a.sd&&(d=C.SLOT_0);
switch(b.state){case 1:a.obj=e(a);(c=a.Jg.param_anim_behavior)||(c="FINISH_STOP");a.cl=C.qs(c);break;case 2:switch(C.is_play(a.obj,d)||0!=a.state||(a.state=1),a.state){case -1:for(var f in b.Yc){var h=b.Yc[f].Hd.da;-1!=h&&(h=b.Yc[f].B[h],"PLAY_ANIM"==h.type&&h!=a&&0==h.state&&h.obj==a.obj&&(h.state=1))}if(""==a.sd)C.apply_def(a.obj),C.set_behavior(a.obj,a.cl,d);else{a:{for(f=b=0;8>f;f++)if((h=a.obj.G[f])&&h.De&&h.De==a.sd)if(0==b)b=1;else{b=!1;break a}b=1==b?!0:!1}b||(C.apply(a.obj,a.sd,d),C.set_behavior(a.obj,
a.cl,d))}a.$a.not_wait||(c.Xc=!0);C.play(a.obj,null,d);a.state=0;a.$a.not_wait&&(c.da=a.oa,a.state=-1);break;case 0:break;case 1:a.$a.not_wait||(c.Xc=!1);c.da=a.oa;a.state=-1;break;default:v.O("Unknown state of "+a.name),a.state=-1}}},SELECT_PLAY:function(a,b,c){switch(b.state){case 2:c.da=a.oa}},SEND_REQ:function(a,b,c){function d(a,b,c,e,f){for(var h in a)for(var k in f[0].mv)h==f[0].mv[k]&&(f[1][h]=a[h]);f[0].state=1}switch(b.state){case 2:switch(a.state){case -1:a.state=0;if("GET"==a.Jg.request_type)A.enqueue([{id:a.url,
type:A.AT_JSON,url:a.url,eb:[a,c.vb]}],d,null,null);else if("POST"==a.Jg.request_type){b={};for(var e=0;e<a.Rv.length;e++){var f=a.Rv[e];b[f]=c.vb[f]}A.enqueue([{id:a.url,type:A.AT_JSON,url:a.url,ed:"POST",uh:A.Pn,Vf:JSON.stringify(b),eb:[a,c.vb]}],d,null,null)}break;case 1:a.state=-1,c.da=a.oa}}},INHERIT_MAT:function(a,b,c){switch(b.state){case 1:for(b=0;2>b;b++)a.Db["id"+b]=k.Wb(k.tc,a.Cc["id"+b],0);break;case 2:B.inherit_material(a.Db.id0,a.hq.id0,a.Db.id1,a.hq.id1),c.da=a.oa}},SET_SHADER_NODE_PARAM:function(a,
b,c){switch(b.state){case 1:a.Cc.id0&&(a.Db.id0=k.Wb(k.tc,a.Cc.id0,0),a.rq.id0.unshift(a.hq.id0));break;case 2:"ShaderNodeRGB"==a.Yv&&k.set_nodemat_rgb(a.Db.id0,a.rq.id0,a.$a.id0?c.vb[a.ig.id0]:a.Ef.id0,a.$a.id1?c.vb[a.ig.id1]:a.Ef.id1,a.$a.id2?c.vb[a.ig.id2]:a.Ef.id2),"ShaderNodeValue"==a.Yv&&k.set_nodemat_value(a.Db.id0,a.rq.id0,a.$a.id0?c.vb[a.ig.id0]:a.Ef.id0),c.da=a.oa}},DELAY:function(a,b,c,d,e){switch(b.state){case 2:-1==a.state?(a.state=0,a.zn=0,c.Xc=!0):0==a.state&&(a.zn+=e,(a.$a.dl?c.vb[a.ig.dl]:
a.Ef.dl)<a.zn&&(a.state=-1,c.da=a.oa,c.Xc=!1))}},APPLY_SHAPE_KEY:function(a,b,c){switch(b.state){case 1:b=a.Db.id0=k.Wb(k.tc,a.Cc.id0,0);c=a.Jg.sk;q.check_shape_keys(b)?q.Hp(b,c)||(g.error("Wrong key name:",c),a.mute=!0):(g.error("No shape keys in object:",b.name),a.mute=!0);break;case 2:q.ts(a.Db.id0,a.Jg.sk,a.$a.skv?c.vb[a.ig.skv]:a.Ef.skv),c.da=a.oa}},OUTLINE:function(a,b,c){switch(b.state){case 1:b=a.Db.id0=k.Wb(k.tc,a.Cc.id0,0);b&&b.f&&b.f.Eb||(g.error("Can't evaluate 'Outline' logic node: wrong object"),
a.mute=!0);break;case 2:b=a.Db.id0;switch(a.Jg.outline_operation){case "PLAY":var d=b.f.Li;k.apply_outline_anim(b,d.Mi,d.Ni,d.Oi);break;case "STOP":k.clear_outline_anim(b);break;case "INTENSITY":b.f.Rf=a.$a["in"]?c.vb[a.ig["in"]]:a.Ef["in"]}c.da=a.oa}},MOVE_CAMERA:function(a,b,c){function d(a,b,c,e){switch(u.get_move_style(a)){case u.MS_TARGET_CONTROLS:u.set_trans_pivot(a,b,c);break;case u.MS_EYE_CONTROLS:case u.MS_STATIC:E.set_tsr(a,e);break;case u.MS_HOVER_CONTROLS:r.sub(c,b,D),r.normalize(D,D),
u.set_hover_pivot(a,c),c=b=0,G[0]=D[0],G[1]=0,G[2]=D[2],b=r.dot(G,D),c=Math.acos(b/(r.length(G)*r.length(D))),b=D[2]?Math.atan(D[0]/D[2]):0<D[0]?0:Math.PI,0<D[2]&&0<D[0]?M[1]=-(Math.PI+M[1]):0<D[2]&&0>D[0]?M[1]=-(Math.PI+M[1]):0>D[2]&&0>D[0]?(M[0]+=Math.PI,b=-(Math.PI-b)):0>D[2]&&0<D[0]&&(M[0]+=Math.PI,b-=Math.PI),u.rotate_hover_camera(a,b+Math.PI,-c,!0,!0)}E.o(a);f.sync_transform(a)}function e(a,b,c,d){O.lookAt(b,c,v.AXIS_Y,y);O.invert(y,y);O.rotateX(y,Math.PI/2,y);N.fromMat4(y,I);F.fromMat3(I,J);
F.normalize(J,J);a=K.get_scale(a.f.h);K.set_sep(b,a,J,d)}switch(b.state){case 1:a.Db.ca=k.Wb(k.tc,a.Cc.id0,0);a.Db.tr=k.Wb(k.tc,a.Cc.id1,0);a.Db.ta=k.Wb(k.tc,a.Cc.id2,0);a.state=-1;a.ab={Gw:new Float32Array(3),Fw:new Float32Array(3),Qp:new Float32Array(3),ur:new Float32Array(3),Aw:new Float32Array(3),Pp:new Float32Array(3),Iw:new Float32Array(8),Cn:new Float32Array(8),ru:new Float32Array(8)};break;case 2:var h=a.Db.ca;b=K.get_trans_view(a.Db.tr.f.h);var g=K.get_trans_view(a.Db.ta.f.h);switch(a.state){case -1:var l=
a.$a.dur?c.vb[a.ig.dur]:a.Ef.dur;if(0==l){e(h,b,g,a.ab.Cn);d(h,b,g,a.ab.Cn);c.da=a.oa;break}c=K.get_trans_view(h.f.h);r.copy(c,a.ab.Gw);var m=u.get_move_style(h);m==u.MS_HOVER_CONTROLS?r.copy(h.f.Ea,a.ab.ur):m==u.MS_STATIC||m==u.MS_EYE_CONTROLS?(K.copy(h.f.h,a.ab.Iw),e(h,b,g,a.ab.Cn)):r.copy(h.f.kb,a.ab.ur);r.copy(b,a.ab.Fw);r.copy(g,a.ab.Aw);a.state=0;l=z.animate(0,1,1E3*l,function(b){m==u.MS_STATIC||m==u.MS_EYE_CONTROLS?K.interpolate(a.ab.Iw,a.ab.Cn,v.smooth_step(b),a.ab.ru):(a.ab.Pp=r.lerp(a.ab.ur,
a.ab.Aw,v.smooth_step(b),a.ab.Pp),a.ab.Qp=r.lerp(a.ab.Gw,a.ab.Fw,v.smooth_step(b),a.ab.Qp));d(h,a.ab.Qp,a.ab.Pp,a.ab.ru);1==b&&(a.state=1)});break;case 1:z.clear_animation(l),a.state=-1,c.da=a.oa}}},SET_CAMERA_MOVE_STYLE:function(a,b,c){switch(b.state){case 1:a.cl=u.UD(a.Jg.camera_move_style);break;case 2:b=n.ni(c.Ga),u.set_move_style(b,a.cl),E.o(b),f.sync_transform(b),c.da=a.oa}},SPEAKER_PLAY:function(a,b,c){switch(b.state){case 1:a.obj=k.Wb(k.tc,a.Cc.id0,0);void 0==a.$a.not_wait&&(a.$a.not_wait=
!0);break;case 2:switch(w.is_playing(a.obj)||0!=a.state||(a.state=1),a.state){case -1:for(var d in b.Yc){var e=b.Yc[d].Hd.da;-1!=e&&(e=b.Yc[d].B[e],"SPEAKER_PLAY"==e.type&&e!=a&&0==e.state&&e.obj==a.obj&&(e.state=1))}a.$a.not_wait||(c.Xc=!0);w.play_def(a.obj);a.state=0;break;case 0:a.$a.not_wait&&(c.da=a.oa,a.state=-1);break;case 1:a.$a.not_wait||(c.Xc=!1);c.da=a.oa;a.state=-1;break;default:v.O("Unknown state of "+a.name),a.state=-1}}},SPEAKER_STOP:function(a,b,c){switch(b.state){case 1:a.obj=k.Wb(k.tc,
a.Cc.id0,0);break;case 2:w.stop(a.obj),c.da=a.oa}},STOP_ANIM:function(a,b,c){switch(b.state){case 1:a.obj=e(a);break;case 2:C.stop(a.obj,C.SLOT_ALL),a.$a.rst&&C.set_first_frame(a.obj,C.SLOT_ALL),c.da=a.oa}},STOP_TIMELINE:function(a,b,c,d){switch(b.state){case 2:a.$a.rst&&x.Tv(d),x.kr(),c.da=a.oa}}};a.QC=function(a,b){var c={xc:b,OE:a.name,state:0,mh:null,Ga:a,Uo:null,Yc:[],Wk:[]};a.PH=c;t(a,c)};a.update=function(a,b){var c=x.CC();if(!(0>=c))for(var d=0;d<Q.length;d++)for(var e=d,f=a,h=b,k=c,g=Q[e],
l=0;l<Q[e].Yc.length;l++){g.Uo=Q[e].Yc[l];var m=Q[e].Yc[l],n=g,q=f,t=h,r=k,u=m.B;if(u.length){for(var v=0;v<u.length;v++)u[v].en=!1;for(v=0;v<u.length;v++){if(0<=m.Hd.da)var p=u[m.Hd.da];else break;if(p.en)break;if(p.mute)if("ENTRYPOINT"==p.type)break;else m.Hd.da=p.oa,p.en=!0;else p.xv(p,n,m.Hd,q,t,r),p.en=!0}}}};a.cleanup=function(){Q=[]}};b4w.module.__nla=function(a,p){function d(){return{type:"CLIP",L:0,ea:0,cf:!1,paused:!1,sd:"",Bj:"",cc:0,wg:0,zj:0,At:0,zt:0,Uw:!1,scale:1,repeat:1}}function b(a,c){if(a.animation_data){var d=a.animation_data.nla_tracks;if(d)for(var e=0;e<d.length;e++)c.push(d[e])}d=a.nodes;for(e=0;e<d.length;e++){var h=d[e];h.node_group&&(h=h.node_group.node_tree)&&b(h,c)}}function c(a,b){var c=Math.round(a)-b.L;b.Gh&&(c%=b.ki,0>c&&(c+=b.ki));return b.Ra+c}function m(a,b,c,d){b=(b-d)*q.Rb()+a.Ra;b>a.L&&(b-=a.L,a.cyclic&&
c&&(b%=a.ea-a.L+1),b+=a.L);return b}function e(a,b){a=z.clamp(a,b.L,b.ea);var c=a-b.L,d=(b.ea-b.L)/b.repeat,c=c/d&&0==c%d?b.zj:b.wg+c%d/b.scale;b.Uw&&(c=b.zj-c+b.wg);return c}function t(a,b){for(var c=[],e=0;e<a.length;e++){var h=a[e].strips;if(h)for(var k=0;k<h.length;k++){var g=h[k],l=d();l.type=g.type;l.L=g.frame_start;l.ea=g.frame_end;l.cc=b;l.wg=g.action_frame_start;l.zj=g.action_frame_end;l.Uw=g.use_reverse;l.scale=g.scale;l.repeat=g.repeat;g.action&&(l.sd=g.action.name,l.Bj=g.action.uuid);
c.push(l)}}return c}function k(a){return("SPEAKER"==a.type||"LAMP"==a.type)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}function n(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c=c.use_nodes&&d)a:{if(d.animation_data&&(c=d.animation_data.nla_tracks)&&c.length){c=!0;break a}d=d.nodes;for(c=0;c<d.length;c++);c=!1}if(c)return!0}return!1}function g(a,b){var c=C.get_active();c.P&&(c.P.Ra-=m(c.P,
b,!0,r)-a,c.P.ii=!0)}var x=p("__animation");p("__camera");p("__controls");p("__config");p("__lights");p("__loader");var l=p("__objects"),h=p("__obj_util"),v=p("__print"),C=p("__scenes"),A=p("__sfx"),B=p("__textures"),q=p("__time"),z=p("__util"),u=[],r=-1;a.Fh=function(a,c){var e;e=null;for(var g=c.K.length-1;0<=g;g--){var l=c.K[g];if(l.Ga.b4w_use_nla&&(e=l,l.Ga.hs))break}if(e){e.ev=!0;var m=0;if((g=a.animation_data)&&g.nla_tracks.length){var n=g.nla_tracks;if(h.is_armature(c)||h.is_camera(c)||h.is_mesh(c)||
h.is_empty(c)||h.is_lamp(c)||h.is_speaker(c))n=t(n,m),n.length&&(c.Ed=c.Ed.concat(n),m++)}k(a)&&(n=a.data.animation_data.nla_tracks,n=t(n,m),n.length&&(c.Ed=c.Ed.concat(n),m++));if(h.is_mesh(c))for(l=a.data.materials,g=0;g<l.length;g++){var q=l[g];if(q.use_nodes&&q.node_tree&&(n=[],b(q.node_tree,n),n=t(n,m),n.length)){for(var q=m,r=n,u=x.Nt(),v=[],p=0,I=0;I<r.length;I++){var y=r[I];""!=y.Bj?y=z.keysearch("uuid",y.Bj,u):(y=y.sd,y=z.keysearch("name",y,u)||z.keysearch("name",y+"_B4W_BAKED",u));if(y){var y=
y.fcurves,B=[],A;for(A in y)B.push(A);v.push(B)}}for(I=0;I<v.length;I++){u=!1;for(y=0;y<I;y++)if(z.sz(v[I],v[y])){r[I].cc=r[y].cc;u=!0;break}u||(r[I].cc=m+p++)}m=q+p;c.Ed=c.Ed.concat(n)}}for(g=0;g<a.particle_systems.length;g++)l=a.particle_systems[g],A=l.settings,"EMITTER"==A.type&&A.b4w_allow_nla&&(A=d(),A.type="CLIP",A.L=e.Ga.frame_start,A.ea=e.Ga.frame_end+1,A.sd=l.name,A.cc=m,A.wg=A.L,A.zj=A.ea,c.Ed.push(A),m++);l=m+1;for(g=0;g<c.ac.length;g++)n=c.ac[g],n.Ry&&(m=l,A=d(),A.type="CLIP",A.L=e.Ga.frame_start,
A.ea=e.Ga.frame_end+1,A.sd=n.name,A.cc=m,A.wg=A.L,A.zj=A.ea,c.Ed.push(A))}};a.zG=function(a,b,c){a.P||(a.P={L:a.frame_start,ea:a.frame_end,Ra:0,Ak:-1,Mk:a.frame_end,Nk:a.frame_start,rj:null,cyclic:b,Db:[],Z:[],OE:a.name,Kf:!1,ii:!1,Mq:!0});b=a.P;for(var e=l.zC(a,c),h=0;h<e.length;h++){var g=e[h];if(g.Ed.length){for(var k=0;k<g.K.length;k++){var m=g.K[k];m.Ga==a&&m.ev&&b.Db.push(g)}for(var k=g.Ed,m=b,n=g.name,q=0;q<k.length;q++){var r=k[q],t=n+" ["+r.L+":"+r.ea+"]",x=Math.max(m.L,r.L);r.wg+=x-r.L;
r.L=x;r.ea=Math.min(m.ea+1,r.ea);r.L>r.ea?(v.warn("NLA: out of scene range: "+t),k.splice(q,1),q--):r.sd||"CLIP"!=r.type||(v.warn('NLA: no action in strip for object "'+n+'".'),k.splice(q,1),q--)}g=g.Ed;k=b;for(m=0;m<g.length;m++){n=g[m];q=k.L;r=k.ea+1;for(t=0;t<g.length;t++)x=g[t],n.cc==x.cc&&(x.ea<=n.L&&(q=n.L),x.L>=n.ea&&(r=Math.min(r,x.L)));n.At=q;n.zt=r}}}a=a.k.tj;for(h=0;h<a.length;h++)e=a[h].k,e.Jn&&(e.ba||e.Zb)&&e.kf==c&&(g=d(),g.type="VIDEO",e.Gh?(g.L=0,g.ea=b.ea):(g.L=z.clamp(e.L,0,b.ea),
g.ea=z.clamp(e.L+e.ki,0,b.ea)),g.sd=a[h].name,b.Z.push(e));u.push(b)};a.start=function(){r=0};a.CC=function(){return r};a.ZI=function(a){return a.P?a.P.Ra:null};a.UJ=function(a,b){return a.P?(a.P.Ra=b,!0):!1};a.update=function(a,b){if(!(0>r)){0==r&&(r=a);for(var d=0;d<u.length;d++){var h=u[d];h.Kf&&(h.Ra-=q.Rb()*b);var k=m(h,a,!0,r);if((!h.Kf||h.ii)&&k>=h.Mk)if(h.cyclic){var k=h,l=a;k.rj&&k.rj();g(k.Nk,l);k.Mq=!0;k=m(k,l,!0,r)}else{var l=h,n=k;l.Kf=!0;l.Ra-=n-l.Mk;l.rj&&l.rj()}if(!h.Kf||h.ii){for(var l=
h,n=k,t=0;t<l.Db.length;t++){for(var v=l.Db[t],p=v.Ed,C=0;C<p.length;C++){var M=p[C];"SOUND"==M.type&&n<l.Ak-1E-6&&(M.cf=!1)}for(C=0;C<p.length;C++)switch(M=p[C],M.type){case "CLIP":if(M.At<=n&&n<M.zt&&!M.cf){var I=v,y=M;""!=y.Bj?x.mz(I,y.Bj,y.cc):x.apply(I,y.sd,y.cc);x.set_behavior(I,x.AB_FINISH_STOP,y.cc);var V=e(y.L,y);x.set_frame(I,V,y.cc);for(I=0;I<p.length;I++)p[I]!=M&&p[I].cc==M.cc&&(p[I].cf=!1);M.cf=!0}M.cf&&(I=v,y=e(n,M),V=x.get_current_frame_float(I,M.cc),1E-6<Math.abs(y-V)&&x.set_frame(I,
y,M.cc));break;case "SOUND":(n<l.Ak-1E-6||l.Ak<M.L)&&M.L<=n&&n<M.ea&&!M.cf&&(A.play(v,(M.L-n)/q.Rb(),(M.ea-M.L)/q.Rb()),M.cf=!0),l.Ak<M.ea&&M.ea<=n&&M.cf&&(M.cf=!1)}}l=a;n=h;t=k;for(v=0;v<n.Z.length;v++)if(p=n.Z[v],p.ba||p.Zb){C=B.dx(p);M=p;I=z.clamp(c(t,M),M.Ra,M.Ra+B.ex(M)-1);M.Zb&&(I=B.$G(M,I),I==M.Uq&&I--);M=I;I=B.fx(p);V=y=!1;if(n.ii||n.Mq)V=!0;if(!n.Kf){var T;T=c(t,p);T=p.Ra<=T&&T<=p.Ra+B.ex(p);var R=B.gx(p);p.Gh&&M==I&&(V=!0);R||C==M||(V=!0);T&&!R?B.play_video(p.name,p.kf):T&&R?y=!0:!T&&R&&
(p.ba&&C<M?y=!0:B.pause_video(p.name,p.kf))}V?(B.VE(p.name,M,p.kf),p.Zb&&(p.Vi=B.nn(p,l))):y&&B.hx(p)&&(p.ba?B.Qw(p):(C=B.nn(p,l),C!=p.Vi&&(p.Ah=M,B.Pw(p)),p.Vi=C))}h.Ak=k}h.ii=!1;h.Mq=!1}}};a.gI=m;a.cleanup=function(){u.length=0;r=-1};a.Gs=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||k(a)||n(a)?!0:!1};a.set_frame=g;a.get_frame=function(a){var b=C.get_active();return b.P?m(b.P,a,!0,r):-1};a.kr=function(){var a=C.get_active();a.P&&(a.P.Kf=!0);for(var a=a.P.Z,b=0;b<a.length;b++){var c=
a[b];B.pause_video(c.name,c.kf)}};a.pv=function(a){var b=C.get_active();b.P&&(b.P.Kf=!1,b.P.rj=a?a:null)};a.get_frame_start=function(){var a=C.get_active();return a.P?a.P.L:-1};a.get_frame_end=function(){var a=C.get_active();return a.P?a.P.ea:-1};a.is_play=function(){var a=C.get_active();return a.P?!a.P.Kf:!1};a.check_nla=function(){var a=C.get_active();return a.P?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=C.get_active();return a.P?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,
b){var c=C.get_active();if(c.P)c.P.Nk=a,c.P.Mk=b;else return!1};a.Uv=function(a){var b=C.get_active();b.P&&(b.P.Mk=a)};a.fF=function(a){var b=C.get_active();b.P&&(b.P.Nk=a)};a.reset_range=function(){var a=C.get_active();if(a.P)a=a.P,a.Nk=a.L,a.Mk=a.ea;else return!1};a.set_cyclic=function(a){var b=C.get_active();if(b.P)b.P.cyclic=a;else return!1};a.clear_callback=function(){var a=C.get_active();a.P&&(a.P.rj=null)};a.Tv=function(a){var b=C.get_active().P;b&&(b.Ra=-(a-r)*q.Rb()+b.Nk,b.ii=!0)}};b4w.module.__camera=function(a,p){function d(a){var b=a.f,c=a.f,d=W.get_trans_view(c.h),e=W.get_quat_view(c.h),e=S.quat_to_dir(e,S.AXIS_MY,L),f=ja;f.set(S.AXIS_Y);f[3]=0;e=S.line_plane_intersect(f,-c.pu,d,e,c.Ea);f=k(a,fa)[1];if(!e||Math.abs(f)<oa)R.warn("Active hover camera view vector and the supporting plane are parallel to each other. Hover pivot will be set based on the camera position."),c.Ea[0]=d[0],c.Ea[1]=0,c.Ea[2]=d[2],h(a,d,c.Ea),I.correct_up(a,S.AXIS_Y,!0);c=k(a,fa);d=aa.Ji(a,a.f.Ea);
b.Wa||(b.Wa={min:d,max:d});b.r||(b.r={down:c[1],up:c[1]});b=S.vf(c[1],b.r.up,b.r.down);0<c[1]&&R.warn("Active hover camera has wrong orientation");b?r(a,0,b):E(a)}function b(b){b=b.f;switch(b.Ia){case a.MS_TARGET_CONTROLS:var c=W.get_trans_view(b.h);b.si=X.dist(c,b.kb);b.ti=b.X[0].top;break;case a.MS_HOVER_CONTROLS:c=W.get_trans_view(b.h),b.si=X.dist(c,b.Ea),b.ti=b.X[0].top}}function c(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,
0,0,0]),ub:new Float32Array([0,0,0,0]),rb:new Float32Array([0,0,0,0])}}function m(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function e(b){var d={type:b,name:"",Zi:1,width:0,height:0,Od:null,rp:null,xb:null,wd:null,Pa:0,Wc:0,ub:0,rb:0,left:0,right:0,top:0,bottom:0,h:new Float32Array(9),Ja:new Float32Array(16),fI:new Float32Array(16),lb:new Float32Array(16),
Yd:new Float32Array(16),ix:new Float32Array(16),sE:new Float32Array(16),re:new Float32Array(16),lg:W.Oo(),Zv:W.Oo(),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Me:null,dof_on:0,Mu:new Float32Array(3),mk:c(),al:0,ve:0,pc:null,Wj:null,So:null,it:new Float32Array(4),an:new Float32Array(4)};if(b==a.Nb)return d;switch(b){case a.bc:g(d,40,.1,1E3);break;case a.rd:g(d,2.5,.1,1E3);break;case a.Ae:break;case a.qf:break;case a.ug:break;case a.Ob:case a.Tb:throw"Stereo camera may only be created from perspective one";
default:throw"Unknown camera type";}return d}function t(b,c,d){if(b.type!=a.Ob&&b.type!=a.Tb)throw"set_stereo_params(): wrong camera type";b.al=c;b.ve=d;w(b,b.Pa);if(ia.pa()&&(c=ia.get_active(),b=c.k.jc))for(c=ia.ni(c).f.X,d=0;d<c.length;d++)Q(c[d],b)}function k(a,b){var c=W.get_quat_view(a.f.h);return n(c,b)}function n(a,b){var c=S.quat_to_dir(a,S.AXIS_Y,L),d=S.quat_to_dir(a,S.AXIS_Z,U),e=-Math.asin(c[1]/X.length(c)),c=Math.abs(e)>Math.PI/4?X.scale(d,-S.sign(e),ga):X.scale(c,-S.sign(d[1]),ga),h=
Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=S.sign(e)*Math.PI-e);d=h;0>c[2]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function g(b,c,d,e,h){switch(b.type){case a.bc:case a.Ob:case a.Tb:b.Wc=c;b.Pa=1;break;case a.rd:b.top=c;b.Pa=1;break;case a.Ae:delete b.Wc;b.Wc=c;b.Pa=h/c;break;case a.qf:b.top=c;b.Pa=h/c;break;default:R.error("set_frustum(): Unsupported camera type: "+b.type)}b.ub=d;b.rb=e}function x(b,c){var d=W.to_mat4(c.f.h,da);V.rotateX(d,-Math.PI/2,d);V.invert(d,b.Ja);if(b.pc){var d=
b.pc[0],e=b.pc[1],h=b.pc[2],f=b.pc[3],g=da;g[0]=1-2*d*d;g[1]=-2*d*e;g[2]=-2*d*h;g[3]=0;g[4]=-2*d*e;g[5]=1-2*e*e;g[6]=-2*e*h;g[7]=0;g[8]=-2*d*h;g[9]=-2*e*h;g[10]=1-2*h*h;g[11]=0;g[12]=-2*d*f;g[13]=-2*e*f;g[14]=-2*h*f;g[15]=1;V.multiply(b.Ja,g,b.Ja);W.from_mat4(b.Ja,b.lg);w(b,b.Pa,!0);d=ja;e=da;V.invert(b.Ja,e);V.transpose(e,e);ca.transformMat4(b.pc,e,d);e=na;e[0]=(S.sign(d[0])+b.lb[8])/b.lb[0];e[1]=(S.sign(d[1])+b.lb[9])/b.lb[5];e[2]=-1;e[3]=(1+b.lb[10])/b.lb[14];ca.scale(d,2/(d[0]*e[0]+d[1]*e[1]+
d[2]*e[2]+d[3]*e[3]),d);b.lb[2]=d[0];b.lb[6]=d[1];b.lb[10]=d[2]+1;b.lb[14]=d[3]}b.type==a.Ob?b.Ja[12]+=b.ve/2:b.type==a.Tb&&(b.Ja[12]-=b.ve/2);W.from_mat4(b.Ja,b.lg);O(b);N(b);W.copy(c.f.h,b.h)}function l(b,c,d,e){V.lookAt(c,d,e,b.Ja);b.type==a.Ob?b.Ja[12]+=b.ve/2:b.type==a.Tb&&(b.Ja[12]-=b.ve/2);W.from_mat4(b.Ja,b.lg);O(b);N(b);W.set_trans(c,b.h)}function h(a,b,c){c=X.subtract(c,b,L);X.normalize(c,c);c=S.Nv(S.AXIS_MY,c,P);aa.set_rotation(a,c);aa.set_translation(a,b)}function v(a){var b=a.f.X,c=a.f.Yq;
if(!b)throw"Wrong object";for(var d=a.f,e=0;e<c.length;e++){var h=c[e];X.copy(W.get_trans_view(a.f.h),h.Mu)}for(e=0;e<b.length;e++)if(h=b[e],x(h,a),S.pm(h.Yd,h.mk),h.Me)if(h.dof_on){var c=W.get_trans_view(d.h),f=aa.get_translation(h.Me,L),c=X.dist(c,f);h.dof_distance=c}else h.dof_distance=0}function C(b){b=b.f;if(b.Ia==a.MS_TARGET_CONTROLS){var c=W.get_quat_view(b.h),c=S.quat_to_dir(c,S.AXIS_Z,L);b.sr=0<c[1]}}function A(b){var c=b.f,d=c.N;!d||c.Ia!=a.MS_EYE_CONTROLS&&c.Ia!=a.MS_TARGET_CONTROLS||(d.camera_space&&
(b=k(b,fa),d.left+=b[0],d.right+=b[0]),d.left=S.angle_wrap_0_2pi(d.left),d.right=S.angle_wrap_0_2pi(d.right),d.yi=S.angle_wrap_0_2pi(d.yi),d.Ti=S.angle_wrap_0_2pi(d.Ti))}function B(b){var c=b.f,d=c.r;if(d)switch(c.Ia){case a.MS_EYE_CONTROLS:case a.MS_TARGET_CONTROLS:d.camera_space&&(b=k(b,fa),d.up+=b[1],d.down+=b[1]);d.up=S.angle_wrap_periodic(d.up,-Math.PI,Math.PI);d.down=S.angle_wrap_periodic(d.down,-Math.PI,Math.PI);d.oj=S.angle_wrap_periodic(d.oj,-Math.PI,Math.PI);d.di=S.angle_wrap_periodic(d.di,
-Math.PI,Math.PI);break;case a.MS_HOVER_CONTROLS:d.up=S.angle_wrap_periodic(d.up,-Math.PI,Math.PI),d.down=S.angle_wrap_periodic(d.down,-Math.PI,Math.PI),d.up=S.clamp(d.up,-Math.PI/2,0),d.down=S.clamp(d.down,-Math.PI/2,0)}}function q(b){var c=b.f;if(T.is_camera(b)){var d=c.X;if(d[0].type===a.rd){switch(c.Ia){case a.MS_TARGET_CONTROLS:var e=W.get_trans_view(c.h),e=X.dist(e,c.kb),c=e/c.si*c.ti;break;case a.MS_HOVER_CONTROLS:e=W.get_trans_view(c.h);e=X.distance(e,c.Ea);c=e/c.si*c.ti;break;default:c=d[0].top}for(e=
0;e<d.length;e++){var h=d[e];h.top=c;w(h,h.Pa)}v(b)}}}function z(a,b,c,d,e){var h=a.f,f=b,g=c;if(d||e)a=k(a,ma),d&&(f=b-a[0]),e&&(g=c-a[1]);if(f||g)b=ha.identity(P),f&&(f=ha.setAxisAngle(S.AXIS_Y,f,va),ha.multiply(b,f,b)),h=W.get_quat_view(h.h),g&&(f=S.quat_to_dir(h,S.AXIS_X,L),g=ha.setAxisAngle(f,g,va),ha.normalize(g,g),ha.multiply(b,g,b)),ha.multiply(b,h,h)}function u(a,b,c,d,e){var h=a.f,g=b,l=c;if(d||e){var m=k(a,ma);d&&(g=b-m[0]);e&&(l=c-m[1])}f(a,a.f.kb,g,l);a=k(a,ma);a=S.angle_wrap_periodic(a[1],
-Math.PI,Math.PI);h.sr=Math.abs(a)>Math.PI/2}function r(a,b,c,d,e){var h=a.f,g=b,l=c;if(d||e){var m=k(a,ma);d&&(g=b-m[0]);e&&(l=c-m[1])}h.xt||(g=0);f(a,h.Ea,g,l);l&&E(a)}function f(a,b,c,d){var e=a.f;if(c||d){var h=ha.identity(P);c&&(c=ha.setAxisAngle(S.AXIS_Y,c,va),ha.multiply(h,c,h));F(a);a=W.get_quat_view(e.h);d&&(c=S.quat_to_dir(a,S.AXIS_X,L),d=ha.setAxisAngle(c,d,va),ha.normalize(d,d),ha.multiply(h,d,h));e=W.get_trans_view(e.h);S.KE(e,b,h,e);ha.multiply(h,a,a)}}function E(a){var b=a.f,c=k(a,
fa)[1],d=a.f;a=d.r;d=d.Wa;a.down-a.up?(c=(a.down-c)/(a.down-a.up),c=Math.max(c,0)):c=0;c=c*(d.max-d.min)+d.min;a=W.get_trans_view(b.h);d=W.get_quat_view(b.h);d=S.quat_to_dir(d,S.AXIS_MY,L);X.normalize(d,d);X.scale(d,c,d);X.subtract(b.Ea,d,a)}function w(b,c,d){switch(b.type){case a.bc:if(!c)throw"No aspect ratio";b.Pa=c;case a.Ae:V.perspective(S.gn(b.Wc),b.Pa,b.ub,b.rb,b.lb);break;case a.rd:if(!c)throw"No aspect ratio";b.Pa=c;case a.qf:c=b.top*b.Pa;V.ortho(-c,c,-b.top,b.top,b.ub,b.rb,b.lb);break;case a.ug:V.ortho(b.left,
b.right,b.bottom,b.top,b.ub,b.rb,b.lb);break;case a.Ob:case a.Tb:if(!c)throw"No aspect ratio";b.Pa=c;var e=Math.tan(b.Wc*Math.PI/360);c=b.ub*e;var h=b.Pa*b.al*e;b.type==a.Ob?(e=h-b.ve/2,h+=b.ve/2):(e=h+b.ve/2,h-=b.ve/2);e=-(b.ub/b.al*e);h*=b.ub/b.al;V.frustum(e,h,-c,c,b.ub,b.rb,b.lb);b.left=e;b.right=h;break;case a.Nb:return;default:throw"Wrong camera type: "+b.type;}d||(O(b),N(b))}function N(a){V.copy(a.Ja,a.re);a.re[12]=0;a.re[13]=0;a.re[14]=0;a.re[15]=1;V.multiply(a.lb,a.re,a.re);V.invert(a.re,
a.re)}function O(a){V.copy(a.Ja,a.Yd);V.multiply(a.lb,a.Yd,a.Yd);V.invert(a.Yd,a.ix)}function K(b,c,d,e,h){e||(e=new Float32Array(24));c||(c=b.ub);d||(d=b.rb);var f,g,k,l,m,n,q,r;switch(b.type){case a.Nb:throw"Extraction from NONE camera is not possible";case a.bc:case a.Ae:f=c*Math.tan(b.Wc*Math.PI/360);l=-f;g=f*b.Pa;k=-g;m=d/c*f;r=-m;n=m*b.Pa;q=-n;break;case a.rd:case a.qf:k=b.top*b.Pa;f=m=b.top;g=n=k;l=r=-b.top;k=q=-k;break;case a.ug:f=m=b.top;g=n=b.right;l=r=b.bottom;k=q=b.left;break;case a.Ob:case a.Tb:m=
c/b.ub;f=c*Math.tan(b.Wc*Math.PI/360);l=-f;g=b.right*m;k=b.left*m;q=d/c;m=f*q;r=-m;n=g*q;q*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=l;e[2]=-c;e[3]=g;e[4]=l;e[5]=-c;e[6]=g;e[7]=f;e[8]=-c;e[9]=k;e[10]=f;e[11]=-c;e[12]=q;e[13]=r;e[14]=-d;e[15]=q;e[16]=m;e[17]=-d;e[18]=n;e[19]=m;e[20]=-d;e[21]=n;e[22]=r;e[23]=-d;h&&(c=da,V.invert(b.Ja,c),S.Ri(e,c,e,0));return e}function F(b){return T.is_camera(b)&&b.f&&b.f.Ia==a.MS_HOVER_CONTROLS}function Q(a,b){if(b.enable_csm){var c=b.csm_num;
if(!a.Wj){var d=b.csm_num;a.Wj=Array(d);for(var e=0;e<d;e++)a.Wj[e]=new Float32Array(3);a.So=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.ub:J(b,a,d-1),h=J(b,a,d),e=K(a,e,h,ua),e=M.uC(e);a.Wj[d].set(e.H);a.So[d]=e.Ya;a.it[d]=X.length(e.H);a.an[d]=D(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.an[0]=b.first_cascade_blur_radius}function J(a,b,c){var d=a.csm_num,e=S.clamp(a.csm_first_cascade_border,b.ub,b.rb);a=S.clamp(a.csm_last_cascade_border,b.ub,b.rb);return S.clamp(D(e,
a,d,c),b.ub,b.rb)}function D(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}function G(a,b){b||(b=new Float32Array(3));var c=W.get_trans_view(a.f.h);X.copy(c,b);return b}var M=p("__boundings");p("__config");var I=p("__constraints"),y=p("__container");p("__mat3");var V=p("__mat4"),T=p("__obj_util"),R=p("__print"),ha=p("__quat"),ia=p("__scenes"),aa=p("__transform"),W=p("__tsr"),S=p("__util"),X=p("__vec3"),ca=p("__vec4");p("__physics");a.Nb=10;a.bc=
20;a.rd=30;a.Ae=40;a.qf=50;a.ug=60;a.Ob=70;a.Tb=80;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var oa=Math.PI/180/2,fa=new Float32Array(2),ma=new Float32Array(2),L=new Float32Array(3),U=new Float32Array(3),ga=new Float32Array(3),P=new Float32Array(4),va=new Float32Array(4),ja=new Float32Array(4),na=new Float32Array(4);new Float32Array(16);var da=new Float32Array(16),ua=new Float32Array(24);a.Pz=function(c,h){var f=h.f,k=c.data;switch(k.type){case "PERSP":var l=e(a.bc);
if(k.angle_y)var n=k.angle_y/Math.PI*180;g(l,n,k.clip_start,k.clip_end);break;case "ORTHO":l=e(a.rd),g(l,k.ortho_scale/2,k.clip_start,k.clip_end)}l.name=h.name;f.aG=!1;f.Ia=m(k.b4w_move_style);f.dof_distance=k.dof_distance;n=k.dof_object;f.Me=n?n.ja:null;f.dof_front=k.b4w_dof_front;f.dof_rear=k.b4w_dof_rear;f.dof_power=k.b4w_dof_power;f.xt=k.b4w_enable_hover_hor_rotation;f.pu=k.b4w_hover_zero_level;f.X=[l];f.Yq=[];f.ol=k.b4w_trans_velocity;f.nl=k.b4w_rot_velocity;f.pl=k.b4w_zoom_velocity;f.Ia==a.MS_TARGET_CONTROLS&&
(f.kb.set(k.b4w_target),C(h));k=h.f;n=k.Ia;if(n===a.MS_TARGET_CONTROLS||n===a.MS_EYE_CONTROLS||n===a.MS_HOVER_CONTROLS){var q=c.data,r=null,t=null,u=null,v=null,x=null;n===a.MS_TARGET_CONTROLS||n===a.MS_EYE_CONTROLS?(q.b4w_use_panning&&(k.Tw=q.b4w_use_panning),q.b4w_use_horizontal_clamping&&(r={left:q.b4w_rotation_left_limit,yi:q.b4w_rotation_left_limit,right:q.b4w_rotation_right_limit,Ti:q.b4w_rotation_right_limit,camera_space:"LOCAL"==q.b4w_horizontal_clamping_type}),q.b4w_use_vertical_clamping&&
(t={down:q.b4w_rotation_down_limit,di:q.b4w_rotation_down_limit,up:q.b4w_rotation_up_limit,oj:q.b4w_rotation_up_limit,camera_space:"LOCAL"==q.b4w_vertical_clamping_type}),n===a.MS_TARGET_CONTROLS&&q.b4w_use_target_distance_limits&&q.b4w_distance_min<=q.b4w_distance_max&&(u={min:q.b4w_distance_min,max:q.b4w_distance_max})):n===a.MS_HOVER_CONTROLS&&(q.b4w_use_horizontal_clamping&&q.b4w_horizontal_translation_min<=q.b4w_horizontal_translation_max&&(v={min:q.b4w_horizontal_translation_min,max:q.b4w_horizontal_translation_max}),
q.b4w_use_vertical_clamping&&q.b4w_vertical_translation_min<=q.b4w_vertical_translation_max&&(x={min:q.b4w_vertical_translation_min,max:q.b4w_vertical_translation_max}),q.b4w_use_zooming&&(q.b4w_hover_angle_min<=q.b4w_hover_angle_max?t={down:q.b4w_hover_angle_min,up:q.b4w_hover_angle_max}:R.error("Wrong angle limits for the HOVER camera. Disabling angle limits."),q.b4w_distance_min<=q.b4w_distance_max?u={min:q.b4w_distance_min,max:q.b4w_distance_max}:R.error("Wrong distance limits for the HOVER camera. Disabling distance limits.")));
k.N=r;k.r=t;k.Wa=u;k.Xb=v;k.tb=x;k=h.f;switch(k.Ia){case a.MS_EYE_CONTROLS:k.N&&(k.N.left*=-1,k.N.right*=-1);break;case a.MS_TARGET_CONTROLS:k.r&&(k.r.down*=-1,k.r.up*=-1);break;case a.MS_HOVER_CONTROLS:k.tb&&(n=-k.tb.min,k.tb.min=-k.tb.max,k.tb.max=n),k.r&&(k.r.down*=-1,k.r.up*=-1)}A(h);B(h)}f.Ia===a.MS_HOVER_CONTROLS&&d(h);l.type==a.rd&&b(h)};a.pJ=d;a.qJ=b;a.AA=c;a.UD=m;a.Hb=e;a.hI=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.xb);case "DEPTH":return Boolean(a.wd);case "SCREEN":return!Boolean(a.xb)&&
!Boolean(a.wd);default:throw"Wrong attachment type: "+b;}};a.on=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.xb=c;break;case "DEPTH":a.wd=c;break;case "SCREEN":a.xb=null;a.wd=null;break;default:throw"Wrong attachment type: "+b;}};a.VI=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.xb;case "DEPTH":return a.wd;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Ou=function(b,c){if(b.type!=a.bc||c!=a.Ob&&c!=a.Tb)throw"make_stereo(): wrong camera type";b.type=
c;t(b,6,.065)};a.gF=t;a.get_camera_angles=k;a.Rt=n;a.get_camera_angles_char=function(a,b){k(a,b);b[0]=S.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.UI=function(a,b){var c=W.get_quat_view(a.f.h),d=S.quat_to_dir(c,S.AXIS_MY,L),e=Math.asin(d[1]/X.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?S.quat_to_dir(c,S.AXIS_MZ,U):S.quat_to_dir(c,S.AXIS_Z,U)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.pn=g;a.XE=function(b,
c,d,e,h,f,k){switch(b.type){case a.ug:b.left=c;b.right=d;b.bottom=e;b.top=h;b.ub=f;b.rb=k;break;default:R.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.f.Ia};a.jF=x;a.WJ=l;a.Xq=function(a,b,c){var d=L;d[0]=0;d[1]=-1;d[2]=0;X.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=U;e[0]=0;e[1]=0;e[2]=-1;X.transformQuat(e,c,e);l(a,b,d,e)};a.set_look_at=h;a.oG=v;a.nG=function(b){var c=b.f,d=b.f;if(d.Ia===a.MS_TARGET_CONTROLS||d.Ia===
a.MS_EYE_CONTROLS){if(d.N){var e=d.N.left,h=d.N.right,f=k(b,fa);(f=d.Ia==a.MS_TARGET_CONTROLS?S.vf(f[0],e,h):S.vf(f[0],h,e))&&(d.Ia==a.MS_TARGET_CONTROLS?u(b,f,0):z(b,f,0))}d.r&&(e=d.r.down,h=d.r.up,f=k(b,fa),(f=d.Ia==a.MS_TARGET_CONTROLS?S.vf(f[1],h,e):S.vf(f[1],e,h))&&(d.Ia==a.MS_TARGET_CONTROLS?u(b,0,f):z(b,0,f)));if(d.Ia===a.MS_TARGET_CONTROLS&&d.Wa){var f=b.f,e=W.get_trans_view(f.h),h=X.subtract(e,f.kb,L),g=X.length(h);g>f.Wa.max?(X.scale(h,f.Wa.max/g,h),X.add(f.kb,h,e)):g<f.Wa.min&&(g=W.get_quat_view(f.h),
g=S.quat_to_dir(g,S.AXIS_MY,U),X.scale(g,100*f.Wa.min,g),X.add(h,g,h),X.scale(h,-f.Wa.min/X.length(h),h),X.add(f.kb,h,e))}}d.Ia===a.MS_HOVER_CONTROLS&&(d=b.f,d.Xb&&(e=S.clamp(d.Ea[0],d.Xb.min,d.Xb.max)-d.Ea[0],d.Ea[0]+=e,f=W.get_trans_view(d.h),f[0]+=e),d.tb&&(e=S.clamp(d.Ea[2],d.tb.min,d.tb.max)-d.Ea[2],d.Ea[2]+=e,f=W.get_trans_view(d.h),f[2]+=e),d=b.f,f=k(b,fa)[1],(d=S.vf(f,d.r.up,d.r.down))&&r(b,0,d));q(b);switch(c.Ia){case a.MS_TARGET_CONTROLS:d=W.get_trans_view(c.h);f=W.get_quat_view(c.h);I.LE(d,
f,c.kb);I.correct_up(b,S.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.Va||I.correct_up(b,S.AXIS_Y)}C(b)};a.Er=C;a.rv=A;a.sv=B;a.yG=q;a.rotate_eye_camera=z;a.rotate_target_camera=u;a.rotate_hover_camera=r;a.xJ=function(b){switch(b.type){case a.bc:case a.rd:case a.Ob:case a.Tb:return!0;default:return!1}};a.Ot=function(b){b=b.f.X[0];switch(b.type){case a.bc:case a.Ae:case a.Ob:case a.Tb:return Math.PI*b.Wc/180;default:return R.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.Zf=w;a.yo=N;a.Ls=
O;a.BB=K;a.uz=function(a){a=a.f;var b=M.Id();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Ub=b;var c=M.em(1,[0,0,0]);a.ud=c;a.jo=M.et(1,b);a.lo=M.gt(1,b);a.ko=M.ft(1,b)};a.is_static_camera=function(b){return T.is_camera(b)&&b.f&&b.f.Ia==a.MS_STATIC};a.is_target_camera=function(b){return T.is_camera(b)&&b.f&&b.f.Ia==a.MS_TARGET_CONTROLS};a.is_eye_camera=function(b){return T.is_camera(b)&&b.f&&b.f.Ia==a.MS_EYE_CONTROLS};a.is_hover_camera=F;a.is_ortho_camera=function(b){return T.is_camera(b)&&
b.f&&b.f.X[0].type==a.rd};a.Dr=Q;a.YA=J;a.project_point=function(b,c,d){b=b.f.X[0];switch(b.type){case a.bc:case a.Ae:case a.rd:case a.qf:case a.Ob:case a.Tb:var e=ja;e.set(c);e[3]=1;ca.transformMat4(e,b.Yd,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;y.bH(d[0],d[1],d,b);2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return R.error("Non-compatible camera"),d}};a.sC=function(a){return a.f.X[0]};a.vm=function(b,c){switch(b.type){case a.bc:case a.Ae:case a.Ob:case a.Tb:var d=
Math.tan(S.gn(b.Wc)/2);switch(c){case "LEFT":return-d*b.Pa;case "RIGHT":return d*b.Pa;case "TOP":return d;case "BOTTOM":return-d}break;case a.rd:case a.qf:switch(c){case "LEFT":return-b.top*b.Pa;case "RIGHT":return b.top*b.Pa;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.ug:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:S.O("Unknown camera type")}};a.cD=function(b){switch(b.type){case a.rd:case a.qf:case a.ug:return!0;
default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.bc:case a.Ae:case a.Ob:case a.Tb:var d=S.gn(b.Wc);return c?d*b.Pa:d;default:return 0}};a.set_trans_pivot=function(a,b,c){a=a.f;W.set_trans(b,a.h);X.copy(c,a.kb)};a.hover_set_vertical_limits=function(a,b){var c=a.f;c.r=c.r||{};c.r.down=b.down;c.r.up=b.up;B(a);E(a)};a.apply_distance_limits=function(b,c){var d=b.f;c?(d.Wa=d.Wa||{},d.Wa.min=c.min,d.Wa.max=c.max,b.f.Ia==a.MS_HOVER_CONTROLS&&E(b)):d.Wa=null};a.set_hover_pivot=function(a,b){var c=
a.f,d=X.subtract(b,c.Ea,L),e=W.get_trans_view(c.h),d=X.add(d,e,d);aa.set_translation(a,d);X.copy(b,c.Ea)};a.get_eye=G;a.set_move_style=function(c,e){c.f.Ia=e;c.f.N=null;c.f.r=null;c.f.Wa=null;c.f.Xb=null;c.f.tb=null;b(c);switch(e){case a.MS_HOVER_CONTROLS:d(c);break;case a.MS_TARGET_CONTROLS:var h=G(c,L),f=W.get_quat_view(c.f.h),f=S.quat_to_dir(f,S.AXIS_MY,U),h=X.scaleAndAdd(h,f,10,f);X.copy(h,c.f.kb)}}};b4w.module.__lights=function(a,p){function d(a){m.scale(a.color,a.Pe,a.Rj)}p("__print");var b=p("__tsr"),c=p("__util"),m=p("__vec3"),e=new Float32Array(3);new Float32Array(3);a.gD=function(a,k){var n=a.data,g=k.Fa={name:"",type:n.type,tv:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),Rj:new Float32Array(3),qt:0,gf:0,Zk:0,Mt:!1,Uu:!1,vt:!1,pj:!0,Hh:!0,Pe:1,distance:25,GI:"INVERSE_SQUARE"};g.name=k.name;g.pj=n.use_diffuse;g.Hh=n.use_specular;var x=b.get_quat_view(k.f.h),
x=c.quat_to_dir(x,c.AXIS_Y,e);m.normalize(x,x);g.direction.set(x);g.color[0]=n.color[0];g.color[1]=n.color[1];g.color[2]=n.color[2];g.Pe=g.qt=n.energy;d(g);g.distance=n.distance;if("POINT"===g.type||"SPOT"===g.type)g.distance=n.distance;"SPOT"===g.type?(g.Zk=n.spot_blend,g.gf=n.spot_size):"POINT"===g.type&&(g.gf=Math.PI/2);g.Mt=n.b4w_generate_shadows;g.vt=n.b4w_dynamic_intensity};a.Sv=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];d(a)};a.aF=function(a,b){a.Zk=b};a.$E=function(a,b){a.distance=
b};a.bF=function(a,b){a.gf=b};a.Wq=function(a,b){a.Pe=b;d(a)};a.uG=function(a){if("LAMP"!=a.type)throw"Wrong light object";var d=a.Fa;if(d){a=b.get_quat_view(a.f.h);c.quat_to_dir(a,c.AXIS_Y,d.direction);m.normalize(d.direction,d.direction);if("SUN"==d.type){a=Math.acos(m.dot(d.tv,c.ds));var e=Math.acos(m.dot(d.direction,c.ds));d.Uu=Math.floor(a/.025)!=Math.floor(e/.025)?!0:!1}m.copy(d.direction,d.tv)}}};b4w.module.__scenes=function(a,p){function d(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.$d||!c.$d.length)return c}return null}function b(){if(!Lb)throw"No active scene available";return Lb}function c(a,b,c){if(!Ca.ak||!m(a,b,c))return null;a=a.b4w_shadow_settings;c={};a.csm_resolution>Ca.zb?(c.csm_resolution=Ca.zb,Ka.error("Shadow map texture has unsupported size. Changed to "+Ca.zb+".")):c.csm_resolution=a.csm_resolution;c.self_shadow_polygon_offset=a.self_shadow_polygon_offset;c.self_shadow_normal_offset=
a.self_shadow_normal_offset;c.enable_csm=a.b4w_enable_csm;if(b=za.wm(b)||b[0])c.bh=b.Fa.type,c.gf=b.Fa.gf,c.distance=b.Fa.distance,"SPOT"!=c.bh&&"POINT"!=c.bh||!c.enable_csm||(Ka.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),c.enable_csm=!1);c.enable_csm?(c.csm_num=a.csm_num,c.csm_first_cascade_border=a.csm_first_cascade_border,c.first_cascade_blur_radius=a.first_cascade_blur_radius,c.csm_last_cascade_border=a.csm_last_cascade_border,c.last_cascade_blur_radius=
a.last_cascade_blur_radius,c.fade_last_cascade=a.fade_last_cascade,c.blend_between_cascades=a.blend_between_cascades):(c.csm_num=1,c.csm_first_cascade_border=a.csm_first_cascade_border,c.first_cascade_blur_radius=a.first_cascade_blur_radius,c.csm_last_cascade_border=a.csm_last_cascade_border,c.last_cascade_blur_radius=a.last_cascade_blur_radius,c.fade_last_cascade=!1,c.blend_between_cascades=!1);return c}function m(a,b,c){if(Ca.Wi)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;
var d=!1,e=!1;a=Ca.te&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var h=c[b];h.b4w_shadow_cast&&(d=!0);h.b4w_shadow_receive&&(e=!0);if((a||d)&&e)return!0}return!1}function e(a){for(var b=0;b<a.length;b++)if("SUN"==a[b].Fa.type)return!0;return!1}function t(a){if(!Ca.shore_smoothing)return!1;a=fa(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function k(a){for(var b=0;b<a.length;b++)for(var c=a[b].particle_systems,d=
0;d<c.length;d++){var e=c[d].settings;if(e.b4w_enable_soft_particles&&0<e.b4w_particles_softness)return!0}return!1}function n(a){for(var b=fa(a),c=[],d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var h={},f=0;f<a.length;f++)for(var g=a[f],k=g.data.materials,l=0;l<k.length;l++)k[l]==e&&(h.og=g.location[1]);h.lc=e.b4w_water_fog_color.slice(0);h.lc.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(h.ek=!0,h.waves_height=e.b4w_waves_height,h.waves_length=e.b4w_waves_length,h.dst_noise_scale0=e.b4w_water_dst_noise_scale0,
h.dst_noise_scale1=e.b4w_water_dst_noise_scale1,h.dst_noise_freq0=e.b4w_water_dst_noise_freq0,h.dst_noise_freq1=e.b4w_water_dst_noise_freq1,h.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,h.dir_freq=e.b4w_water_dir_freq,h.dir_noise_scale=e.b4w_water_dir_noise_scale,h.dir_noise_freq=e.b4w_water_dir_noise_freq,h.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,h.dst_min_fac=e.b4w_water_dst_min_fac,h.waves_hor_fac=e.b4w_water_waves_hor_fac):(h.ek=!1,h.waves_height=0,h.waves_length=0);h.He=e.b4w_water_enable_caust;
h.Rz=e.b4w_water_caust_scale;h.Qz=e.b4w_water_caust_brightness;h.Sz=new Float32Array([.3,.7]);h.rn=null;e=e.texture_slots;for(f=0;f<e.length;f++)g=e[f].texture,!0===g.b4w_shore_dist_map&&(h.rn=g.image,h.Yi=g.image.size[0],h.qF=g.b4w_shore_boundings,h.Ci=g.b4w_max_shore_dist);c.push(h)}}if(0<c.length){h=c[0];if(!h.ek)for(d=0;d<c.length;d++)c[d].ek&&(h=c[d]);return h}return null}function g(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);
"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.rc=!0)}}}var c={rc:!1};a=fa(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.rc=!0);e.node_tree&&b(e.node_tree)}return c}function x(a,b){if(Ca.Pk)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;for(var c=[],d=0,e=0;e<b.length;e++){var h=b[e];h.f.Gc&&"CUBE"==h.f.pe&&d++;if(h.Qk.length){for(var f=null,g=0;g<c.length;g++)if(c[g]==h){f=g;break}null==f&&c.push(h)}}return{Iq:c,cv:d,zf:[],Uf:[]}}function l(a,b){var c=
a.b4w_sky_settings,d={};d.AE=c.render_sky;d.procedural_skydome=c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;d.$i=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=c.scatter_strength;d.rayleigh_strength=c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=c.rayleigh_collection_power;d.mie_collection_power=c.mie_collection_power;d.mie_distribution=
c.mie_distribution;d.qc=c.reflexible;d.gc=c.reflexible_only;!b&&c.procedural_skydome&&Ka.warn("There is no sun on the scene. Procedural sky won't be rendered");return d}function h(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.OC=a.hemisphere;b.Gz=a.blur_depth;b.Fs=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.NE=a.samples;return b}function v(a){if(!(Ca.Sl&&a.b4w_enable_bloom&&a.k.Dh))return null;var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.qB=
a.edge_lum;b.key=a.key;return b}function C(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;return b}function A(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function B(a){var b={};a=a.b4w_god_rays_settings;b.Op=a.intensity;b.Bi=a.max_ray_length;b.hj=a.steps_per_pass;return b}function q(a){var b={};b.af=a.b4w_outline_color;
b.Ek=a.b4w_outline_factor;return b}function z(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}function u(a,b){var c=a.light_settings,d={};d.Df=c.environment_energy;d.Hr=c.use_environment_light;d.hp=c.environment_color;d.Hf=a.horizon_color.slice(0);d.rg=a.zenith_color.slice(0);d.TG=a.use_sky_paper;d.SG=a.use_sky_blend;
d.UG=a.use_sky_real;d.fw=null;d.cr=null;d.ip=null;if(d.Hr&&"SKY_TEXTURE"==d.hp&&(!b.procedural_skydome||!b.use_as_environment_lighting)){for(var c=null,e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_environment_lighting){c=a.texture_slots[e];break}c?d.ip=c:(Ka.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),d.Hr=!1)}for(e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_skydome){c=
a.texture_slots[e];d.fw=c;d.cr={Dz:c.blend_factor,PC:c.horizon_factor,kH:c.zenith_up_factor,jH:c.zenith_down_factor,color:c.color,Ha:c.default_value,invert:c.invert,RG:c.use_rgb_to_intensity,Ez:c.blend_type,NG:c.use_map_blend,OG:c.use_map_horizon,QG:c.use_map_zenith_up,PG:c.use_map_zenith_down};break}return d}function r(a){var b=a.fog_settings,c={};c.JG=b.use_fog;c.Op=b.intensity;c.depth=b.depth;c.start=b.start;c.height=b.height;c.EB=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);
a=c.color;c.lc=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.sm=new Float32Array([c.Op,c.depth,c.start,c.height]);return c}function f(a){if(!Ca.Pb)return!1;for(var b=!1,c=!1,d=0;d<a.length;d++){for(var e=a[d],h=e.data.materials,f=0;f<h.length;f++)h[f].b4w_terrain&&(b=!0);e=e.particle_systems;for(f=0;f<e.length;f++)h=e[f].settings,"HAIR"==h.type&&h.b4w_dynamic_grass&&(c=!0);if(b&&c)return!0}return!1}function E(a,b){if(Mc.outlining_overview_mode)return!0;if(Ca.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;
case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].ja.f.df)return!0;return!1}else return!1}function w(a,b){if(Mc.outlining_overview_mode)return!0;if(Ca.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].ja.f.Eb)return!0;return!1}else return!1}function N(a,b){if(Ca.Ue)switch(a.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,
e=0;e<d.length;e++)if(Z.Ss(d[e]))return!0;return!1}else return!1}function O(a,b){if(Ca.rc)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.rc}else return!1}function K(a){for(var b=0;b<a.length;b++)for(var c=a[b].data.materials,d=0;d<c.length;d++){var e=c[d],h=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h)return!0}return!1}function F(a,b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=
0;c<b.length;c++){var d=b[c].ja;if(d.anchor&&d.anchor.ai)return!0}return!1}}function Q(a,b,c){var d=sa.ne(a,b);sa.Wd(a,d,function(a,b,d){if(d.pb){switch(d.from){case "COLOR":case "CUBEMAP":a=b.j.xb;break;case "DEPTH":a=b.j.wd;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";
if(a.pd)throw"Batch texture can't use renderbuffer";ka.Us(c.Sb,d.to)&&H.Vh(c,a,d.to)}}});for(a=0;a<b.Aa.length;a++){var d=b.Aa[a],e=b.we[a];switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":break;default:if(e.pd)throw"Batch texture can't use renderbuffer";ka.Us(c.Sb,d.to)&&H.Vh(c,e,d.to)}}}function J(a,b){return{yb:!0,ep:[!0,!0,!0,!0,!0,!0],Rd:a,D:b}}function D(a,b,c,d,e,h){function f(a,b){return a==b?0:a>b?1:-1}for(var g=b.f,
k=za.Sa(b,e).V,l=0;l<k.length;l++){var m=k[l];m.Jc||m.gc||"MAIN"!=m.type&&"NODES_GLOW"!=m.type&&"PARTICLES"!=m.type||!("OPAQUE"==m.fb&&"OPAQUE"==d||"BLEND"==m.fb&&"BLEND"==d||"XRAY"==m.fb&&"XRAY"==d||"NODES_GLOW"==m.type&&"GLOW"==d)||(h||(G(m,a,b,c,d,e),H.Fb(m),M(m)),a.q.push(J(g,m)),Q(c,a,m),I(m))}a.q.sort(function(a,b){return a.D&&b.D?-f(a.D.Ua,b.D.Ua)||-f(a.D.yg,b.D.yg)||f(a.D.oh,b.D.oh):0})}function G(a,b,c,d,e,h){var f=c.f,g=za.Sa(c,h),k="NO_SHADOWS";if((c=la.bb(d,"SHADOW_CAST"))&&a.kc){switch(e){case "OPAQUE":k=
"SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":k="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":k="NO_SHADOWS";break;case "DEPTH":k="SHADOW_MASK_GENERATION";break;default:throw"Wrong subscene type";}H.ws(a,h.k.jc,c)}c=a.nb;ka.I(c,"SHADOW_USAGE",k);a.Pb&&(k=la.bb(d,"GRASS_MAP"))&&y(a,k,f);if("DEPTH"!=a.type&&"COLOR_ID"!=e||a.ri)if(e=b.Um,ka.I(c,"NUM_LIGHTS",e),ka.I(c,"NUM_LFACTORS",0==e%2?e/2:Math.floor(e/2)+1),ka.I(c,"REFLECTION_PASS",0),ka.I(c,"SSAO_ONLY",0),ka.I(c,
"INVERT_FRONTFACING",0),b.Cb&&b.Zd?ka.I(c,"WATER_EFFECTS",1):ka.I(c,"WATER_EFFECTS",0),b.Cb&&b.He&&f.He?(ka.I(c,"CAUSTICS",1),ka.I(c,"CAUST_SCALE",ka.s(b.Ns)),ka.I(c,"CAUST_SPEED",ka.s(b.Os,2)),ka.I(c,"CAUST_BRIGHT",ka.s(b.Ms))):ka.I(c,"CAUSTICS",0),b.Cb&&(ka.I(c,"WAVES_HEIGHT",ka.s(b.pg)),ka.I(c,"WAVES_LENGTH",ka.s(b.Ph)),ka.I(c,"WATER_LEVEL",ka.s(b.og))),f=g.zf,g=g.Uf,-1!==a.$b.indexOf("u_mirrormap")?ka.I(c,"REFLECTION_TYPE","REFL_MIRRORMAP"):a.Gc&&f?(f=f.j.xb,H.Vh(a,f,"u_cube_reflection"),ka.I(c,
"REFLECTION_TYPE","REFL_CUBE")):a.Gc&&g?(f=g.j.xb,H.Vh(a,f,"u_plane_reflection"),ka.I(c,"REFLECTION_TYPE","REFL_PLANE")):ka.I(c,"REFLECTION_TYPE","REFL_NONE"),(g=la.bb(d,"SKY"))?a.wv?(f=g.j.xb,H.Vh(a,f,"u_sky")):Ca.dn?(a.Rc=g.Rc,ka.I(c,"PROCEDURAL_FOG",1)):ka.I(c,"PROCEDURAL_FOG",0):ka.I(c,"PROCEDURAL_FOG",0),f=h.k.Qr,f.Hr&&(ka.I(c,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==f.hp?(f=f.ip?H.jC(f.ip,!1):g.j.xb,ka.I(c,"SKY_TEXTURE",1),H.Vh(a,f,"u_sky_texture")):"SKY_COLOR"==f.hp&&ka.I(c,"SKY_COLOR",1)),
f=h.k.qx,f.JG&&(ka.I(c,"USE_FOG",1),ka.I(c,"FOG_TYPE",f.EB)),a.Jq?(Ca.ak&&ka.I(c,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.ri||"NODES_GLOW"==a.type?(ka.I(c,"REFRACTIVE",1),h.k.rc?ka.I(c,"USE_REFRACTION",1):ka.I(c,"USE_REFRACTION",0)):h.k.rc?ka.I(c,"REFRACTIVE",1):ka.I(c,"REFRACTIVE",0)):(ka.I(c,"REFRACTIVE",0),ka.I(c,"USE_REFRACTION",0),ka.I(c,"USE_REFRACTION_CORRECTION",0)),a.ng&&(Ca.shore_smoothing&&a.On&&la.bb(d,"DEPTH")?ka.I(c,"SHORE_SMOOTHING",1):ka.I(c,"SHORE_SMOOTHING",0),a.water_dynamic&&
b.Cb&&b.pg?ka.I(c,"DYNAMIC",1):ka.I(c,"DYNAMIC",0)),"PARTICLES"==a.type&&(ka.I(c,"SIZE_RAMP_LENGTH",a.za.aw),ka.I(c,"COLOR_RAMP_LENGTH",a.za.$s)),!a.Tg)for(a=a.Z,b=0;b<a.length;b++)if(f=a[b],"SCENE"==f.source)for(d=0;d<Pa.length;d++)for(c=Pa[d],g=Pa[d].$d,e=0;e<g.length;e++)g[e].k==f&&sa.m(nb,c,h,null)}function M(a){var b=a.Sb.attributes,c=a.S.Yb,d;for(d in b)c[d]||Ea.O('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=ka.EC(a.Sb.Mr),10<b&&("MAIN"==a.type&&Ka.warn("Varying limit exceeded for main shader - "+
b+', materials: "'+a.Zc.join(", ")+'"'),"MAIN"==a.type&&a.ri||"NODES_GLOW"==a.type))d=c=0,a.Jh&&(c=Ea.qk(a.Jh)),a.Mb&&(d=Ea.qk(a.Mb)),Ka.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.Zc.join(", ")+'"')}function I(a){8<a.Z.length&&Ka.warn(a.type,"too many textures used - "+a.Z.length+' (max 8), materials "'+a.Zc.join(", ")+'"')}function y(a,b,c){a.zc=b.zc;var d=b.zc[0],e=b.zc[1],h=b.zc[2];c=c.Ub;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);h=0==h?c:Math.max(h,
c);b.zc[2]=h;b=b.j;qa.pn(b,h/2,-e,-d,h/2);qa.Zf(b);d=a.Cp||0;d=0==d?c:Math.max(d,c);a.Cp=d}function V(a){ca(a);var b=U(a,"MAIN_OPAQUE"),c=!0,d=a.k.jc;sa.aa(a.k.sb,function(a,e){"SHADOW_CAST"===e.type&&(R(e,b.j,e.q,d,c),c=!1)})}function T(a){sa.aa(a.k.sb,function(a,b){"OUTLINE"===b.type&&(b.fp=1)})}function R(a,b,c,d,e){if(0!=c.length){var h=a.j,f=Na.get_trans_view(b.h);Na.set_trans(f,h.h);ub.copy(b.lg,h.Zv);if("SUN"===d.bh||"HEMI"===d.bh){f=Kc;pa.Id(f);for(var g=0;g<c.length;g++){var k=c[g].Rd;0==
g?pa.bm(k.wb,f):pa.yt(f,k.wb)}c=pa.AB(f,hd);Ea.Ri(c,h.Ja,c);if(d.enable_csm){d=ub.copy(b.Wj[a.Ro],uc);f=Sa.invert(b.Ja,Xc);Ea.Ri(d,f,d);Ea.Ri(d,h.Ja,d);a=b.So[a.Ro];if(e)for(La=0,hb=-Infinity,e=2;e<c.length;e+=3)La=Math.min(La,c[e]),hb=Math.max(hb,c[e]);e=Kc;e.max_x=d[0]+a;e.max_y=d[1]+a;e.max_z=hb;e.min_x=d[0]-a;e.min_y=d[1]-a;e.min_z=La}else{a=e=Kc;b=$b;b.set(c);c=Hb/9;d=Sa.identity(Xc);Sa.rotate(d,c,Ea.AXIS_MZ,d);g=f=-1;for(k=0;10>k;k++){var l=pa.Bz(b,Ab),m=(l.max_x-l.min_x)*(l.max_y-l.min_y);
if(-1==f||m<f)f=m,g=k,pa.bm(l,a);Ea.Ri(b,d,b)}a=g*c;0<a&&(b=Sa.identity(Xc),Sa.rotate(b,a,Ea.AXIS_MZ,b),Sa.multiply(b,h.Ja,h.Ja),Na.from_mat4(h.Ja,h.lg));a=e.max_x-e.min_x;b=e.max_y-e.min_y;a&&b&&(c=Math.abs(a-b)/2,2<a/b?(e.max_y+=c,e.min_y-=c):2<b/a&&(e.max_x+=c,e.min_x-=c));e.max_x+=.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005}qa.XE(h,e.min_x,e.max_x,e.min_y,e.max_y,-e.max_z,-e.min_z);qa.Zf(h);Ea.pm(h.Yd,h.mk)}else"SPOT"!==d.bh&&"POINT"!==d.bh||qa.Zf(h,h.Pa)}}function ha(a,
b,c,d,e){for(var h=b.f,f=za.Sa(b,d).V,g=0;g<f.length;g++){var k=f[g];"COLOR_ID"==k.type&&(e||(G(k,a,b,c,"COLOR_ID",d),H.Fb(k),M(k)),"COLOR_PICKING"==a.type&&"COLOR_ID"==k.fb||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==k.fb)&&(e||(H.ua(k,"USE_OUTLINE",0),H.Fb(k),M(k)),a.q.push(J(h,k)))}}function ia(a,b,c,d,e){d||(e.Pb&&(d=la.bb(c,"GRASS_MAP"))&&y(e,d,b),H.Fb(e),M(e));a.q.push(J(b,e));Q(c,a,e);I(e)}function aa(a,b){W(a,b);for(var c=0;c<a.K.length;c++)for(var d=wa.wa(a.K[c].Ga,"ALL",-1),e=0;e<d.length;e++)d[e].parent==
a&&aa(d[e],b)}function W(a,b){a.f.Xg=b;if(za.is_lamp(a))for(var c=0;c<a.K.length;c++)for(var d=a.K[c],e=L(d.Ga,Ic),h=0;h<e.length;h++)X(a,d,e[h])}function S(a,b){for(var c=L(b,Ic),d=a.Fa,e=a.f,h=za.Sa(a,b),f=h.dh,g=Na.get_trans_view(e.h),e=Na.get_quat_view(e.h),k=0;k<c.length;k++){var l=c[k];l.Nm.set(g,3*f);l.aq.set(d.direction,3*f);l.Mm.set(d.Rj,3*f);switch(d.type){case "SUN":l.vw.set(e);l.uw=d.Rj;"SKY"===l.type?(l.Sm=d.Uu,ub.copy(d.direction,l.nr),oa(b,l)):ub.copy(d.direction,l.nr);break;case "HEMI":case "POINT":case "SPOT":break;
default:Ka.error("Unknown light type: "+d.type+'".')}X(a,h,l);for(var m=0;m<l.q.length;m++){var n=l.q[m].D;n.xi&&H.ZE(n,a)}}c=U(b,"MAIN_OPAQUE").j;h=h.Zq;d=b.k.jc;for(k=0;k<h.length;k++)l=h[k],qa.Xq(l.j,g,e),R(l,c,l.q,d,!0)}function X(a,b,c){var d=a.f;a=a.Fa;b=b.dh;var e=zc;e[0]=a.pj&&!d.Xg?1:0;e[1]=a.Hh&&!d.Xg?1:0;c.bq.set(e,2*b);c.ya=!0}function ca(a){a=wa.wa(a,"LAMP",wa.DATA_ID_ALL);if(a=za.wm(a)||a[0])for(var b=a.f,c=Na.get_trans_view(b.h),b=Na.get_quat_view(b.h),d=0;d<a.K.length;d++)for(var e=
a.K[d].Zq,h=0;h<e.length;h++)qa.Xq(e[h].j,c,b)}function oa(a,b){jb.dk(b);if(b.Sm)for(var c=L(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var e=c[d].q,h=0;h<e.length;h++){var f=e[h];f.yb&&(f=f.D,H.Vz(f)&&jb.iG(f))}}function fa(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].data,e=0;e<d.materials.length;e++){var h=d.materials[e];-1==b.indexOf(h)&&b.push(h)}return b}function ma(a,b,c){for(var d=a.k,e=a.vg.f.X,h=0;h<e.length;h++){var f=e[h];qa.Zf(f,b/c);d.jc&&qa.Dr(f,
d.jc)}d.jc&&(d.Tm=!0,U(a,"DEPTH").ya=!0,U(a,"MAIN_BLEND").ya=!0);var g=d.sb;la.ZF(g,function(d,e,h){if(d.gl){var f=d.Zi*b,k=d.Zi*c;if(e)for(e=0;e<h.Aa.length;e++)h.Aa[e]==d&&kb.resize(d.va,f,k);else switch(kb.wi(d.va)&&kb.resize(d.va,f,k),d=h.j,d.width=f,d.height=k,h.type){case "DOF":ga(a,{dof_power:h.j.dof_power,dof_on:h.j.dof_on});break;case "GLOW_COMBINE":va(a,{small_glow_mask_width:h.small_glow_mask_width,large_glow_mask_width:h.large_glow_mask_width});break;case "BLOOM":P(a,{bloom_blur:h.bloom_blur});
break;case "OUTLINE":h=la.Qa(g,h,"POSTPROCESSING");f=la.Qa(g,h,"POSTPROCESSING");k=la.Qa(g,f,"POSTPROCESSING");d=la.Qa(g,k,"POSTPROCESSING");la.fd(h,1/b,1/c);la.fd(f,1/b,1/c);la.fd(k,1/b,1/c);la.fd(d,1/b,1/c);break;default:la.fd(h,1/b,1/c)}}})}function L(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];sa.aa(a.k.sb,function(a,b){b.type==e&&c.push(b)})}return c}function U(a,b){return la.bb(a.k.sb,b)}function ga(a,b){var c=U(a,"DOF");if(!c)return Ka.error("DOF is not enabled on the scene. Check camera settings"),
0;var d=a.k.sb;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;var e=la.Qa(d,c,"POSTPROCESSING"),d=la.Qa(d,e,"POSTPROCESSING");la.ic(e,c.j.dof_power);la.fd(e,1/c.j.width,1/c.j.height);la.ic(d,c.j.dof_power);la.fd(d,1/c.j.width,1/c.j.height)}c.ya=!0}
function P(a,b){var c=U(a,"LUMINANCE_TRUNCED"),d=U(a,"BLOOM");if(!c||!d)return Ka.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.ya=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.ya=!0);if("number"==typeof b.bloom_blur){var e=a.k.sb,c=la.Qa(e,d,"BLOOM_BLUR"),e=la.Qa(e,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;la.ic(c,b.bloom_blur);la.fd(c,1/d.j.width,1/d.j.height);la.ic(e,b.bloom_blur);la.fd(e,1/d.j.width,1/d.j.height)}}
function va(a,b){var c=U(a,"GLOW_COMBINE");if(!c)return Ka.error("Glow is not enabled on the scene"),null;for(var d=a.k.sb,e=la.wC(d,c),h=0;h<e.length;++h){var f=e[h];if("POSTPROCESSING"===f.type&&"GLOW_MASK_LARGE"===f.fb)var g=f;if("POSTPROCESSING"===f.type&&"GLOW_MASK_SMALL"===f.fb)var k=f}e=la.Qa(d,g,"POSTPROCESSING");d=la.Qa(d,k,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.ya=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=
b.large_glow_mask_coeff,c.ya=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,la.ic(k,b.small_glow_mask_width),la.fd(k,1/c.j.width,1/c.j.height),k.ya=!0,la.ic(d,b.small_glow_mask_width),la.fd(d,1/c.j.width,1/c.j.height),d.ya=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,la.ic(g,b.large_glow_mask_width),la.fd(g,1/c.j.width,1/c.j.height),g.ya=!0,la.ic(e,b.large_glow_mask_width),la.fd(e,1/c.j.width,1/c.j.height),
e.ya=!0)}function ja(a,b){var c=U(Lb,"MAIN_OPAQUE");if(!c||!c.Cb)return Ka.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.pg,e=c.Ph,h=c.og,f=c.Cb;if(!d||!f.ek)return f.og;var g=ub.length(c.lf),k=c.time;g&&(k*=g);var l=zc;l[0]=20/e*(a-.25*k);l[1]=20/e*(b-.25*k);g=Ea.Ps(l);l[0]=17/e*(b+.1*k);l[1]=17/e*(a+.1*k);var l=Ea.Ps(l),g=g+l-1,m=f.dst_noise_scale0,l=f.dst_noise_scale1,n=f.dst_noise_freq0,q=f.dst_noise_freq1,r=zc;r[0]=m*(a+n*k);r[1]=m*(b+n*k);m=Ea.dr(r);r[0]=l*
(b-q*k);r[1]=l*(a-q*k);l=Ea.dr(r);l*=d*m;if(c.Kn)if(q=(a-c.ag[0])/c.bg[0],r=(c.ag[1]+b)/c.bg[1],q+=.5,r+=.5,1<q||0>q||1<r||0>r)d=l;else var q=Ea.Pt(Lb.k.$q,c.Yi,q,r),m=f.dir_freq,t=f.dir_noise_scale,u=f.dir_noise_freq,n=f.dir_min_noise_fac,r=f.dst_min_fac,c=e/c.Ci/Math.PI,t=[t/e*(a+u*k),t/e*(b+u*k)],e=Math.sqrt(q),d=d*Math.max(q,f.dir_min_shore_fac)*Math.sin(e/c+m*k)*Math.max(Ea.dr(t),n),f=Math.max(e,r),d=d*(1-f)+l*f,g=g*q;else d=l;return h+(d+.05*g)}function na(a,b){a.xk&&"POSTPROCESSING"==a.type&&
b.yb!=a.yb&&(a.yb=b.yb);b.yb||"OUTLINE"!=a.type||(a.fp=0)}function da(a,b,c,d){var e=sa.La(a,b);qa.on(e.j,c,d);e.fo=!0;sa.gg(a,b,function(b,e,h){h.pb&&h.from==c&&la.eA(h)&&ua(a,b,h.to,d)});sa.Wd(a,b,function(b,e,h){h.pb&&h.from==c&&h.from==h.to&&da(a,b,c,d)})}function ua(a,b,c,d){a=sa.La(a,b).q;for(b=0;b<a.length;b++)H.GE(a[b].D,d,c)}function ea(a){var b=U(a,"GRASS_MAP");if(b){var c=b.j,d=a.vg.f;a=Na.get_trans_view(d.h);var e=uc;e[0]=0;e[1]=-b.zc[2]/2;e[2]=0;b=Na.get_quat_view(d.h);ub.transformQuat(e,
b,e);e[0]+=a[0];e[1]=0;e[2]+=a[2];b=Oc;b[0]=0;b[1]=0;b[2]=0;b[3]=1;qa.Xq(c,e,b)}}function ra(a,b){sa.aa(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.Aa[0]||!d.we[0])throw"Wrong MOTION_BLUR subscene";var e=d.Aa[0],h=d.we[0];d.we[0]=d.j.xb;sa.gg(a,c,function(b,c,d){d.pb&&ua(a,b,d.to,h)});da(a,c,e.from,h);ua(a,c,e.to,d.we[0]);d.Tu=Math.exp(-b/d.mb_factor)}})}function ta(a){return a.k.lf}var H=p("__batch"),pa=p("__boundings"),qa=p("__camera");p("__compat");var ba=p("__config"),ya=p("__container");
p("__constraints");var Da=p("__debug"),Y=p("__geometry"),sa=p("__graph"),Ia=p("__hud");p("__lights");var Sa=p("__mat4"),Z=p("__nodemat"),wa=p("__objects"),za=p("__obj_util"),Qb=p("__physics"),ic=p("__prerender"),Vb=p("__primitives"),Ka=p("__print"),jb=p("__renderer"),la=p("__scenegraph"),tc=p("__sfx"),ka=p("__shaders"),kb=p("__textures"),Na=p("__tsr"),Ea=p("__util"),ub=p("__vec3"),Ca=ba.p,Mc=ba.Eb,xb=ba.Ui,Vc="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");
a.HH=Vc;var Ic="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED DEPTH SHADOW_CAST COLOR_PICKING COLOR_PICKING_XRAY OUTLINE_MASK".split(" "),md="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Wc="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),Jc=
"MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Nc=null,Lb=null,Pa=[],nb=null,Hb=Math.PI/2,zc=new Float32Array(2),uc=new Float32Array(3),Oc=new Float32Array(4),Xc=new Float32Array(16),hd=new Float32Array(24),$b=new Float32Array(24),Kc=pa.Id(),Ab=pa.Id(),La=0,hb=-Infinity;a.tI=function(){return{}};a.set_active=function(a){Lb=a;tc.TE(a)};a.rE=function(a,b){var c=a.k,d=la.LA(c.sb);if(a==b){ma(a,ya.GC(),ya.FC());for(var e=0;e<d.length;e++)a.k.xh.push(d[e])}else for(e=
a.$d[0],ma(a,e.k.Bh,e.k.Bh),e=0;e<d.length;e++)b.k.xh.push(d[e]);d=L(a,Wc);for(e=0;e<d.length;e++)d[e].lf.set(c.lf);for(e=0;e<c.xh.length;e++)"SHADOW_CAST"==c.xh[e].type&&jb.dk(c.xh[e])};a.oi=function(){Nc||(Nc=d(Pa));return Nc};a.qm=d;a.get_active=b;a.pa=function(){return Lb?!0:!1};a.ni=function(a){return a.vg};a.mi=function(){return Pa};a.Zt=function(){if(1==Pa.length)return Pa;for(var a=0;a<Pa.length;a++){var b=Pa[a].k.sb;sa.aa(b,function(b,c){for(var d=0;d<c.q.length;d++){for(var e=c.q[d].D.Z,
h=null,f=0;f<e.length;f++)if("SCENE"==e[f].source&&e[f].er==Pa[a].name&&"COPY"!=c.type){Ka.error('Texture-scene loop detected. A scene is rendered to texture "'+e[f].name+'" yet this texture belongs to the same scene.');sa.ne(nb,Pa[a]);h=c.q[d].D;break}h&&(h.Z=[],h.$b=[],H.hG(h,null),H.Fb(h))}})}for(var c=[],a=0;a<Pa.length;a++)if(b=Pa[a],!b.$d.length){b=sa.ne(nb,b);sa.uB(nb,b);b=sa.wn(nb,b,sa.vl);b=sa.zr(b);sa.aa(b,function(a,b){c.push(b)});break}return c};a.$y=function(a,b,d,m,p){a.$d=a.$d||[];
a.P=null;var Y=a.k,L=a.vg.f;Y.tj=[];var Ia=a.world;Y.hD=d.length;Y.Dh=e(d);Y.un=l(Ia,Y.Dh);Y.Qr=u(Ia,Y.un);Y.qx=r(Ia);Y.Sy=F(a,p);L.X[0].type!=qa.bc&&Ca.anaglyph_use?(Ka.warn("Anaglyph stereo is disabled for the non-perspective camera"),p=!1):p=Ca.anaglyph_use;Y.anaglyph_use=p;Y.Si=x(a,b);Y.Fz=v(a);Y.PD=C(a);Y.Tz=A(a);Y.IC=B(a);Y.cE=q(a);Y.Gf=z(a);Y.ci=Ca.ci&&(0<L.dof_distance||L.Me);Y.kh=Ca.kh&&a.b4w_enable_motion_blur;Y.Zh=Ca.Zh&&a.b4w_enable_color_correction;Y.antialiasing=Ca.antialiasing&&1==
Ca.nc&&"NONE"!=a.b4w_antialiasing_quality;Y.te=Ca.te&&a.b4w_enable_ssao;Y.pi=Ca.pi&&a.b4w_enable_god_rays&&Y.Dh;Y.jB=Ca.ak;Y.xm=a.b4w_glow_settings.render_glow_over_blend;Y.HF=h(a);p=g(m);Y.LD=p;Y.rc=O(a,p);Y.jc=c(a,d,m);Y.Cb=n(m);Y.nf=K(m);Y.tF=k(m);Y.shore_smoothing=t(m);Y.Pb=f(m);Y.mA=E(a,m);Y.outline=w(a,m);Y.Ue=N(a,m);switch(a.b4w_reflection_quality){case "LOW":Y.Lg=xb.jt;Y.Kk=xb.ov;break;case "MEDIUM":Y.Lg=xb.$A;Y.Kk=xb.mE;break;case "HIGH":Y.Lg=xb.ZA;Y.Kk=xb.lE;break;default:Y.Lg=xb.jt,Y.Kk=
xb.ov}if(ya.ZC())Ka.log("%cENABLE HIDPI MODE","color: #00a"),Y.js="AA_QUALITY_LOW",Y.Hc=1,Ca.nc=1;else if(1<Ca.nc)Ka.log("%cENABLE MSAA RENDERING: "+Ca.nc+"x","color: #00a"),Y.Hc=1;else{Y.js="AA_QUALITY_"+a.b4w_antialiasing_quality;switch(a.b4w_antialiasing_quality){case "LOW":Y.antialiasing&&(Y.Hc=1);break;case "MEDIUM":Ca.quality==ba.P_LOW||Ca.quality==ba.P_HIGH?Y.Hc=1:Ca.quality==ba.P_ULTRA&&(Y.Hc=1.33);break;case "HIGH":Ca.quality==ba.P_LOW?Y.Hc=1:Ca.quality==ba.P_HIGH?Y.Hc=1.33:Ca.quality==ba.P_ULTRA&&
(Y.Hc=2);break;case "NONE":Ca.quality==ba.P_LOW||Ca.quality==ba.P_HIGH?Y.Hc=1:Ca.quality==ba.P_ULTRA&&(Y.Hc=2)}Ca.quality==ba.P_CUSTOM&&(Y.Hc=1)}d=a.$d.sort(function(a,b){return b.k.Bh-a.k.Bh});Y.sb=la.KA(Y,L,d);Y.xh=[];Y.Tm=!1;Y.mq=!1;Y.nq=!1;Y.lf=new Float32Array(3);Pa.push(a);nb||(nb=sa.create());sa.u(nb,a);for(Y=0;Y<b.length;Y++)za.Rq(b[Y],!0,a);a=ya.get_container();ya.resize(a.clientWidth,a.clientHeight,!0)};a.az=function(a,b,c){for(var d=0;d<b.length;d++)b[d].k&&b[d].k.zk&&(b[d].k.kf=c,a.k.tj.push(b[d]))};
a.Wt=function(a){return a.k.sb};a.TB=function(a){sa.aa(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=H.Qo(c.cn);break;case "SSAO":d=H.RA(c);break;case "SSAO_BLUR":d=H.SA(c);break;case "DEPTH_PACK":d=H.yA();break;case "GOD_RAYS":la.Qa(a,c,"RESOLVE")||la.Qa(a,c,"WIREFRAME")||la.Qa(a,c,"MAIN_BLEND")||la.Qa(a,c,"GOD_RAYS");d=H.CA(c.jv,c.ng,c.hj);break;case "GOD_RAYS_COMBINE":la.Qa(a,c,"RESOLVE")||la.Qa(a,c,"WIREFRAME")||la.Qa(a,c,"MAIN_BLEND");la.Qa(a,c,"GOD_RAYS");d=H.DA();break;
case "MOTION_BLUR":d=H.HA();break;case "DOF":var d=H.zA(),e=la.Qa(a,c,"POSTPROCESSING"),h=la.Qa(a,e,"POSTPROCESSING");la.ic(e,c.j.dof_power);la.ic(h,c.j.dof_power);break;case "OUTLINE":var d=H.IA(),e=la.Qa(a,c,"POSTPROCESSING"),h=la.Qa(a,e,"POSTPROCESSING"),f=la.Qa(a,h,"POSTPROCESSING"),g=la.Qa(a,f,"POSTPROCESSING");la.ic(h,c.po);la.ic(e,c.po);la.ic(g,c.lp*c.Ek);la.ic(f,c.lp*c.Ek);break;case "GLOW_COMBINE":d=H.BA();break;case "COMPOSITING":d=H.wA();break;case "ANTIALIASING":d=H.sA(c);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=
H.PA(c.type);break;case "ANAGLYPH":d=H.qA();break;case "SKY":d=H.JA();break;case "LUMINANCE":d=H.EA();break;case "AVERAGE_LUMINANCE":d=H.tA();break;case "LUMINANCE_TRUNCED":d=H.FA();break;case "BLOOM_BLUR":d=H.uA();break;case "BLOOM":d=la.Qa(a,c,"BLOOM_BLUR");e=la.Qa(a,d,"BLOOM_BLUR");la.ic(d,c.bloom_blur);la.ic(e,c.bloom_blur);d=H.vA();break;case "VELOCITY":d=H.VA();break;case "ANCHOR_VISIBILITY":d=H.rA()}d&&(e=J(za.$h("NONE"),d),M(d),c.q.push(e),Q(a,c,d),I(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=
a.k.sb,e=b.f;!la.bb(d,"SHADOW_CAST")&&e.kc&&(e.kc=!1);var h=L(a,Vc);c&&Qb.J(b)&&Qb.append_object(b,a);for(e=0;e<h.length;e++){var f=h[e],g=b,k=d,l=a,m=c;switch(f.type){case "MAIN_OPAQUE":D(f,g,k,"OPAQUE",l,m);break;case "MAIN_BLEND":D(f,g,k,"BLEND",l,m);break;case "MAIN_XRAY":D(f,g,k,"XRAY",l,m);break;case "MAIN_GLOW":D(f,g,k,"GLOW",l,m);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var n=g.f,q=za.Sa(g,l).V,r=0;r<q.length;r++){var t=q[r];if(("MAIN"==t.type||"PARTICLES"==t.type)&&"REFLECT"==
t.fb){if("MAIN_PLANE_REFLECT"==f.type){var u;a:{u=l.k.Si.Uf;for(var Y=0;Y<u.length;Y++)if(u[Y]==f){u=Y;break a}u=null}if(u==n.cd)continue}else{a:{if(l.k.Si)for(u=l.k.Si.zf,Y=0;Y<u.length;Y++)if(u[Y]==f){u=Y;break a}u=null}if(u==n.vd)continue}m||(G(t,f,g,k,"REFLECT",l),u=t.nb,ka.I(u,"WATER_EFFECTS",0),ka.I(u,"INVERT_FRONTFACING",1),ka.I(u,"REFLECTION_PASS",1),ka.I(u,"TEXTURE_NORM",0),H.Fb(t),M(t));f.q.push(J(n,t))}}break;case "DEPTH":n=za.Sa(g,l).V;for(q=0;q<n.length;q++)r=n[q],"DEPTH"!=r.type||r.Jc||
!r.kc||"DEPTH"!=r.fb&&"NODES"!=r.fb||(m||(G(r,f,g,k,"DEPTH",l),H.Fb(r),M(r)),f.q.push(J(g.f,r)),Q(k,f,r),I(r));break;case "SHADOW_CAST":n=!1;q=g.f;g=za.Sa(g,l).V;r=la.bb(k,"GRASS_MAP");for(t=0;t<g.length;t++)u=g[t],"DEPTH"==u.type&&"SHADOW_CAST"==u.fb&&(n=!0,m||(Y=f.Um,H.ua(u,"NUM_LIGHTS",Y),H.ua(u,"NUM_LFACTORS",0==Y%2?Y/2:Math.floor(Y/2)+1),ka.I(u.nb,"SHADOW_USAGE","SHADOW_CASTING"),u.Pb&&r&&y(u,r,q),H.ua(u,"SHADOW_TEX_RES",ka.s(l.k.jc.csm_resolution)),H.Fb(u),M(u)),f.q.push(J(q,u)));n&&(g=l.k.jc,
l=la.bb(k,"MAIN_OPAQUE"),R(f,l.j,f.q,g,!0));break;case "COLOR_PICKING":ha(f,g,k,l,m);break;case "COLOR_PICKING_XRAY":ha(f,g,k,l,m);break;case "OUTLINE_MASK":k=g.f;g=za.Sa(g,l).V;for(l=0;l<g.length;l++)n=g[l],"COLOR_ID"==n.type&&"OUTLINE"==n.fb&&(m||(H.ua(n,"USE_OUTLINE",1),H.Fb(n),M(n)),f.q.push(J(k,n)));break;case "GRASS_MAP":k=g.f;g=za.Sa(g,l).V;for(l=0;l<g.length;l++)n=g[l],"GRASS_MAP"==n.type&&(m||(H.Fb(n),M(n)),f.q.push(J(k,n)),n=f.j,u=k.wb,q=f.zc[0],r=f.zc[1],t=f.zc[2],0==q&&0==r?(q=u.min_y,
r=u.max_y):(q=Math.min(q,u.min_y),r=Math.max(r,u.max_y)),u=1E-4*(r-q),f.zc[0]=q-u,f.zc[1]=r+u,qa.pn(n,t/2,-r,-q,t/2),qa.Zf(n));break;case "WIREFRAME":for(n=g.f,g=za.Sa(g,l).V,l=0;l<g.length;l++)q=g[l],"WIREFRAME"==q.type&&ia(f,n,k,m,q)}}for(e=0;e<b.K.length;e++)for(c=b.K[e].V,d=0;d<c.length;d++)null==c[d].Sb&&c.splice(d--,1);break;case "LAMP":S(b,a)}za.Rq(b,!0,a)};a.Sq=function(a){a.k.Tm=!0};a.oC=function(a,b){for(var c=a.k.jc,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=qa.YA(c,b,e);return d};
a.RH=ia;a.Qs=aa;a.Jj=W;a.is_hidden=function(a){return a.f.Xg};a.yE=function(a,b,c){b=b.f;a=L(a,Vc);for(var d=0;d<a.length;d++)for(var e=a[d].q,h=e.length-1;0<=h;h--){var f=e[h];f.Rd==b&&(f.D&&c&&Y.Ws(f.D.S),e.splice(h,1))}};a.tG=function(a,b){for(var c=a.Fa,d=za.Sa(a,b).dh,e=L(b,Ic),h=0;h<e.length;h++){var f=e[h];f.Mm.set(c.Rj,3*d);f.ya=!0}};a.Gn=S;a.cleanup=function(){for(var a=0;a<Pa.length;a++){var b=Pa[a];sa.aa(b.k.sb,function(a,b){if("SINK"!=b.type){var c=b.j;jb.BE(c.Od,c.xb,c.wd,c.width,c.height);
for(var c=b.q,d=0;d<c.length;d++){var e=c[d].D;e&&H.lA(e)}}});b.k.sb=[];b.k.xh=[]}Lb=Nc=null;Pa.length=0;nb=null};a.Nu=function(a,b,c){a=qa.BB(a,a.ub,a.rb,null,!0);var d=Vb.YB(a);a=za.$h("DYNAMIC");a.wb=a.Ub={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.Vb=a.ud=pa.Cz();var e=a.Vb.Ya;a.Bg=a.tf=pa.dm([e,0,0],[0,e,0],[0,0,e],a.Vb.H);c=H.OA(d,c);b.q.push(J(a,c))};a.bJ=function(a){return[a.frame_start,a.frame_end]};a.Wv=function(a,b,c){ya.nF(a,b,c);Lb&&ma(Lb,a,b)};a.XJ=ma;a.tw=
L;a.ia=U;a.get_environment_colors=function(a){a=L(a,Ic)[0];var b=a.Hf,c=a.rg,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Df,d,e]};a.set_environment_colors=function(a,b,c,d){a=L(a,Ic);for(var e=0;e<a.length;e++){var h=a[e];isNaN(b)||(h.Df=b);c&&h.Hf.set(c);d&&h.rg.set(d);h.ya=!0}};a.get_sky_params=function(a){if(a=U(a,"SKY")){var b={};b.color=Array(3);ub.copy(a.$i,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;
b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=U(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),
"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.$i.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=
b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.ya=!0,c.Sm=!0,oa(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=L(a,md)[0].lc;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=
function(a,b){for(var c=L(a,md),d=0;d<c.length;d++){var e=c[d];e.lc.set(b);e.ya=!0}};a.get_ssao_params=function(a){var b=U(a,"SSAO");a=U(a,"SSAO_BLUR");if(!b)return null;var c=b.q[0].D,d={};d.ssao_quality=H.Qb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.Fs=a.ssao_blur_discard_value;d.radius_increase=b.dj;d.influence=b.cj;d.dist_factor=b.bj;d.ssao_only=b.ssao_only;d.ssao_white=H.Qb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=
U(a,"SSAO"),d=U(a,"SSAO_BLUR");if(!c)return Ka.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=c.q[0].D;H.ua(e,"SSAO_QUALITY",b.ssao_quality);H.Fb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.q[0].D,H.ua(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),H.Fb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.q[0].D,H.ua(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),H.Fb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==
typeof b.dj&&(c.dj=b.dj);"number"==typeof b.cj&&(c.cj=b.cj);"number"==typeof b.bj&&(c.bj=b.bj);if("number"==typeof b.ssao_only){c=U(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var h=0;h<c.q.length;h++)e=c.q[h].D,H.ua(e,"SSAO_ONLY",b.ssao_only),H.Fb(e,!0)}"number"==typeof b.ssao_white&&(e=c.q[0].D,H.ua(e,"SSAO_WHITE",b.ssao_white),H.Fb(e,!0));c.ya=!0;d.ya=!0};a.get_dof_params=function(a){a=U(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;
b.dof_power=a.j.dof_power;b.Me=a.j.Me;return b};a.set_dof_params=ga;a.get_god_rays_params=function(a){var b=L(a,["GOD_RAYS"]);a=U(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].Bi;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=H.Qb(b[0].q[0].D,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=L(a,["GOD_RAYS"]),d=U(a,"GOD_RAYS_COMBINE");if(!c||!d)return Ka.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&
(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,h=0;h<c.length;h++)c[h].Bi=e,c[h].hn=e/c[h].hj/(h+1),c[h].ya=!0;if("number"==typeof b.god_rays_steps)for(var f=ka.s(b.god_rays_steps,1),e=c[0].Bi,h=0;h<c.length;h++){c[h].hj=f;c[h].hn=e/f/(h+1);c[h].ya=!0;var g=c[h].q[0].D;H.ua(g,"STEPS_PER_PASS",f);H.Fb(g,!0)}d.ya=!0};a.get_bloom_params=function(a){var b=U(a,"LUMINANCE_TRUNCED");a=U(a,"BLOOM");if(!b||!a)return null;var c=
{};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=P;a.get_glow_material_params=function(a){a=U(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=va;a.get_wind_params=function(a){a=ta(a);var b=ub.length(a);if(0==
b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.QE=function(a){a.k.mq=!0};a.get_water_surface_level=ja;a.get_water_mat_params=function(a,b){var c=U(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.pg,b.waves_length=c.Ph,c.Zd)){b.water_fog_density=c.Zd[3];var d=b.water_fog_color=[];d[0]=c.Zd[0];d[1]=c.Zd[1];d[2]=c.Zd[2]}};a.set_water_params=function(a,b){var c=U(a,"MAIN_OPAQUE");if(!c||!c.Cb)return Ka.error("set_water_params() - no water parameters on the scene"),
null;c=c.Cb;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=
b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.ek=b.water_dynamic);for(var d=L(a,Jc),e=0;e<d.length;e++){var h=d[e];"number"==typeof b.water_fog_density&&c.lc&&(h.Zd[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&
c.lc&&h.Zd.set(b.water_fog_color);"number"==typeof b.waves_height&&(h.pg=b.waves_height);"number"==typeof b.waves_length&&(h.Ph=b.waves_length);h.ya=!0}};a.get_shore_dist=function(a,b){var c=U(Lb,"MAIN_OPAQUE");if(!c.Kn)return 100;var d=c.Ci,e=c.og,h=(a[0]-c.ag[0])/c.bg[0],f=(c.ag[1]+a[2])/c.bg[1],h=h+.5,f=f+.5;if(1<h||0>h||1<f||0>f)e=1;else return c=d*Ea.Pt(Lb.k.$q,c.Yi,h,f),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,c){for(var d=b().vg.f,e=0;e<Pa.length;e++){var h=Pa[e],f=h.k.sb,g=h.k;
if(g.Cb)var k=Na.get_trans_view(d.h),l=k[1]-ja(k[0],k[2]);for(k=0;k<g.tj.length;k++){var m=g.tj[k].k,n=m.ba,q=m.Zb;if(!(h.b4w_use_nla&&m.Jn||!n&&!q)&&kb.gx(m)){var r=kb.dx(m),t=kb.fx(m);n&&Ca.ah&&(t-=5);var u=kb.aH(m);r>=u&&m.Gh||r<t?(kb.reset_video(m.name,m.kf),q&&(m.Vi=kb.nn(m,a))):r>=u&&!m.Gh?kb.pause_video(m.name,m.kf):kb.hx(m)&&(n?kb.Qw(m):(n=kb.nn(m,a),n!=m.Vi&&(kb.Pw(m),m.Ah++),m.Vi=n))}}sa.aa(f,function(b,c){-1<Wc.indexOf(c.type)&&(c.time=a);g.Cb&&(c.zo=l)})}for(e=0;e<Pa.length;e++)if(h=Pa[e],
g=h.k,f=g.sb,d=g.xh,d.length)for(g.Tm&&(V(h),g.Tm=!1),g.mq&&(ea(h),g.mq=!1),g.nq&&(T(h),g.nq=!1),g.kh&&ra(f,c),h=la.bb(f,"OUTLINE_MASK"),k=0;k<d.length;k++)f=d[k],ic.Cq(f),h&&na(f,h),jb.dk(f);Ca.show_hud_debug_info&&Ia.rF(Pa,c)};a.HE=function(a){a.k.nq=!0};a.yp=function(a){var b=[];sa.aa(a.k.sb,function(a,c){b.push(c)});return b};a.get_cam_water_depth=function(){var a=U(Lb,"MAIN_BLEND"),b=Lb;return a||b.k.Cb?a.zo:null};a.get_object_data_id=function(a){return a.f.xc};a.Fr=function(a){sa.aa(a.k.sb,
function(a,b){b.ya=!0})};a.lF=function(a,b){a.yb=b!=Da.WM_NONE;for(var c=0;c<a.q.length;c++)a.q[c].D.wireframe_mode=b;a.Ua=b==Da.WM_TRANSPARENT_WIREFRAME;a.ya=!0};a.kF=function(a,b){for(var c=0;c<a.q.length;c++)a.q[c].D.wireframe_edge_color=b,a.ya=!0};a.sG=function(a,b){var c=b.fi,d=a.k.lf;if(c&&"WIND"==c.type&&d){var e=Na.get_quat_view(b.f.h);Ea.quat_to_dir(e,Ea.AXIS_Y,d);ub.normalize(d,d);ub.scale(d,c.qw,d);c=L(a,Wc);for(e=0;e<c.length;e++)c[e].lf.set(d)}};a.gE=function(a,b,c){var d=U(a,"COLOR_PICKING");
if(d)return b=ya.Bo(b,c,zc,d.j),ic.Cq(d),jb.dk(d),(a=U(a,"COLOR_PICKING_XRAY"))?(ic.Cq(a),jb.dk(a),d=a.j):d=d.j,b[1]=d.height-b[1],jb.Fv(d.Od,b[0],b[1]);Ka.error("Object Selection is not available on the scene");return null};a.set_outline_color=function(a){var c=b();if(c=U(c,"OUTLINE"))c.af.set(a),c.ya=!0};a.gJ=ta;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.Kw=function(a,b){var c=uc;ub.negate(b,
c);for(var d=0;6>d;d++){var e=a.Xj[d],h=a.To[d],f=a.j;Sa.translate(Ea.xx[d],c,e);Sa.multiply(f.lb,e,f.Yd);Ea.pm(f.Yd,h)}};a.Nw=function(a,b,c){Ea.WF(b,c,Ea.AXIS_Y,a.j.pc)};a.wz=function(a,b,c){var d=a.k.jc,e=a.k.Si;c=za.wm(c)||c[0];for(var h=0;h<b.length;h++){var f=b[h],g=za.Sa(f,a);if(e)if(null!=f.f.cd){var k=e.Uf;if(k.length){var l=f.f.cd;g.Uf=k[l]}}else null!=f.f.vd&&(k=e.zf,k.length&&(l=f.f.vd,g.zf=k[l]));d&&f==c&&(g.Zq=L(a,["SHADOW_CAST"]))}};a.marker_frame=function(a,b){return a.timeline_markers[b]}};b4w.module.__physics=function(a,p){function d(a,b){for(var c=a.Kd,e=0;e<c.length;e++)c[e].Sd.kl&&b.push(c[e]),d(c[e],b)}function b(a,b,c){for(var d=a.ob.q,e=0;e<d.length;e++)for(var h=d[e].n,f=0;f<h.wc.length;f++){var g=h.wc[f];"ANY"!=g.Ka&&c!=g.Ka||u(g,a,b)}}function c(a,b,c){if(G.Gm(a))switch(b){case G.Gx:var d=m(a);d.ob.px=!0;G.w(a,G.ny,Date.now()-performance.now(),W.Qd,W.xo?S.Gt:0);break;case G.Hx:I.fq("URANIUM:",c.slice(1));break;case G.Cx:I.error(c);break;case G.Dx:D.fbmsg.apply(this,c.slice(1));
break;case G.Mx:var h=e(c.v);if(h){a=c.trans;d=c.quat;b=c.ke;var f=c.ae,h=h.n;h.gm=c.time;R.set_sep(a,1,d,h.Vo);ia.copy(b,h.ke);ia.copy(f,h.ae)}break;case G.Jx:(a=e(c.Co))&&R.set_sep(c.trans,1,c.quat,a.l.Lk[c.Eq]);break;case G.Ex:if(d=e(c[1]))a=c[4],d=d.zd.Tl[c[2]],T.set_translation(d,c[3]),T.set_rotation(d,a),T.o(d);break;case G.Nx:if(h=e(c[1]))h.l.speed=c[2];break;case G.yx:d=m(a);t(d,c.Cg,c.Dg,c.result,null,null,0);break;case G.Ax:d=m(a);t(d,c.Cg,c.Dg,c.result,c.Ig,c.coll_norm,c.coll_dist);break;
case G.zx:if(h=e(c[1]))a=h.n,a.Hg&&a.Hg(c[2]);break;case G.Xr:case G.Kx:d=m(a);if(a=d.ob.Wf[c.id])if(d=e(c.Xh),b==G.Xr)b=a.callback,b(a.id,c.hit_fract,d,c.hit_time);else{b=c.hit_fract;var f=c.hit_time,h=c.hit_pos,g=a.callback;h?g(a.id,b,d,f,h,c.hit_norm):g(a.id,b,d,f)}break;case G.Lx:E(id);break;case G.Ix:a=oa.indexOf(a);console.log("Physics #"+a+" Ping: OUT "+(c[2]-c[1]).toFixed(3)+" ms, IN "+(performance.now()-c[2]).toFixed(3)+" ms, ALL "+(performance.now()-c[1]).toFixed(3)+" ms");break;case G.Fx:ca=
c[1];break;case G.Bx:a=oa.indexOf(a);console.log("Worker: #"+String(a));console.log(c[1]);break;default:I.error("Wrong message: "+b)}}function m(a){for(var b=0;b<oa.length;b++)if(oa[b]==a)return fa[b]}function e(a){return ma[a]||null}function t(a,b,c,d,h,f,g){a=a.ob.q;for(var l=0;l<a.length;l++)for(var m=a[l].n,n=0;n<m.wc.length;n++){for(var q=m.wc[n],r=q.Sf,t=!1,u=0;u<r.length;u++){var v=r[u];if(v[0]===b&&v[1]===c){q.Fk[u]=d;t=!0;break}}t&&(r=k(q),h&&q.qo!=b&&(t=h,u=f,v=g,t[0]+=u[0]*v,t[1]+=u[1]*
v,t[2]+=u[2]*v,u[0]*=-1,u[1]*=-1,u[2]*=-1),q.callback(r,r?q.qo==b?e(c):e(b):null,h,f,g))}}function k(a){a=a.Fk;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function n(){ga.body++;return ga.body}function g(a){if("ANY"==a)return 0;var b=U.indexOf(a);return-1==b?(U.push(a),U.length-1):b}function x(a){return{v:a,le:0,Hm:!1,cg:!0,Ac:!1,is_character:!1,XC:!1,am:null,Ka:"",Oj:0,nI:{},wc:[],Hg:null,gm:0,Vo:new Float32Array([0,0,0,1,0,0,0,1]),ke:new Float32Array(3),ae:new Float32Array(3),Wl:new Float32Array(3),
Gj:new Float32Array(4)}}function l(a,b){switch(a){case "BOX":var c=b.Ub;break;case "CYLINDER":c=b.lo;break;case "CONE":c=b.ko;break;case "SPHERE":c=b.ud;break;case "CAPSULE":c=b.jo}return c}function h(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);
"object"===typeof a.H&&(b.center=a.H);"number"===typeof a.Ya&&(b.radius=a.Ya);"number"===typeof a.height&&(b.height=a.height);return b}function v(a,b,c,d,e){var h=R.get_trans_view(a.f.h),f=R.invert(b.f.h,ja),g=new Float32Array(3);R.transform_vec3(h,f,g);switch(b.l.type){case 10:b=b.Mc;a=a.f.Ub;G.w(e,G.Rx,c,g,b.RF,b.Nq,(a.max_y-a.min_y)/2,d);break;case 20:G.w(e,G.Qx,c,g,a.eK)}}function C(a){return a.n&&a.n.am}function A(a,b,c,d,e,h,f,g,k,l){var m;ga.Va++;m=ga.Va.toString(16);var n=b.n.v;G.w(B(n),G.Yx,
m,a,g,n,c,d,e.n.v,h,f,k,l);b.n.am=m}function B(a){for(var b=0;b<fa.length;b++)for(var c=fa[b].ob.q,d=0;d<c.length;d++)if(c[d].n.v==a)return oa[b];return null}function q(a){var b=a.n;if(b=b?0===b.le?!0:!0===b.Hm?!0:!1===b.cg?!0:"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type?!0:!1:!1)var b=R.get_trans_view(a.f.h),c=R.get_quat_view(a.f.h),b=b[0]!=a.n.Wl[0]||b[1]!=a.n.Wl[1]||b[2]!=a.n.Wl[2]||c[0]!=a.n.Gj[0]||c[1]!=a.n.Gj[1]||c[2]!=a.n.Gj[2]||c[3]!=a.n.Gj[3];if(b){var b=a.n,d=a.f,c=R.get_trans_view(d.h),d=
R.get_quat_view(d.h);ia.copy(c,b.Wl);y.copy(d,b.Gj);var e=G.Yt(G.yl);e.v=b.v;e.trans=c;"DYNAMIC"==b.type?y.identity(e.quat):e.quat=d;G.w(B(b.v),G.yl)}a=a.Kd;for(b=0;b<a.length;b++)q(a[b])}function z(a,b,c,d,e){e=e||new Float32Array(3);a=R.get_quat_view(a.f.h);e[0]=b;e[1]=c;e[2]=d;ia.transformQuat(e,a,e)}function u(a,b,c){var d=a.Sf,e=a.Fk,h=a.qo,f=[],g=a.Ka;if(!f)throw"At least one destination required";for(var k=0;k<b.ob.q.length;k++){var l=b.ob.q[k];if("ANY"==g||l.n.Ka==g)l=l.n.v,f&&-1==f.indexOf(l)&&
f.push(l)}for(b=0;b<f.length;b++)g=f[b],h<g&&!r(d,h,g)?(d.push([h,g]),e.push(!1)):h>g&&!r(d,g,h)&&(d.push([g,h]),e.push(!1));G.w(c,G.Px,h);G.w(c,G.Xx,d,a.ge)}function r(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function f(a){a.n&&a.n.Hg&&(a=a.n,G.w(B(a.v),G.jy,a.v),a.Hg=null)}function E(a){var b=N(a),c=w(a).ob;c.Wf[a]&&(delete c.Wf[a],c.Hq.splice(c.Hq.indexOf,1),G.w(b,G.sy,a))}function w(a){for(var b=0;b<fa.length;b++){var c=fa[b];if(c.ob.Wf[a])return c}return null}
function N(a){for(var b=0;b<fa.length;b++)if(fa[b].ob.Wf[a])return oa[b];return null}function O(a,b,c){if(b.gj){a=a.n.v;var d=b.ei*b.jk,e=b.Ej*b.Fj,h=-b.ej*b.fj*2*Math.PI/b.$k;b.vk&&(h*=-1);switch(b.type){case 10:G.w(c,G.Fy,a,d,e,h);break;case 20:G.w(c,G.Ey,a,d,e,h)}}}function K(a){return a.Ac&&"CHASSIS"==a.Mc.Dc}function F(a){return a.Ac&&"HULL"==a.Mc.Dc}function Q(a){return a.$g&&"MAIN_BODY"==a.gi.Dc}var J=p("__config");p("__constraints");var D=p("__debug"),G=p("__ipc");p("__mat4");var M=p("__obj_util"),
I=p("__print"),y=p("__quat");p("__renderer");var V=p("__scenes"),T=p("__transform"),R=p("__tsr"),ha=p("__util"),ia=p("__vec3"),aa=p("__version"),W=J.n,S=J.p,X=J.be,ca=0,oa=[],fa=[],ma={},L=[],U=[],ga={body:0,Va:0,Cv:0},P=new Float32Array(3);new Float32Array(4);var va=new Float32Array(4);new Float32Array(16);var ja=R.create(),na=R.create();a.SC=function(a){a.ob={px:!1,q:[],Wf:{},Hq:[]};var b=W.il;X.Dq&&(b+=aa.timestamp());I.log("%cLOAD PHYSICS","color: #0a0",W.ml?"Using Separate Worker Thread,":"Using Same Thread,",
"Max FPS: "+W.Qd);I.log("%cPHYSICS PATH","color: #0a0",b);var d=G.WA(b,!W.ml);G.yz(d,c);oa.push(d);fa.push(a);W.ping&&setInterval(function(){G.w(d,G.py,performance.now())},1E3)};a.gA=function(a){return a.ob?a.ob.px:!0};a.cleanup=function(){for(var a=0;a<oa.length;a++)G.terminate(oa[a]);oa.length=0;fa.length=0;ma={};L.length=0;U.length=0;for(var b in ga)ga[b]=0};a.append_object=function(a,c){if(!a.f)throw"No object render: "+a.name;var e;a:{for(var f=0;f<fa.length;f++)if(fa[f]==c){e=oa[f];break a}e=
void 0}var k=[];a.Sd.kl&&d(a,k);var m=c.ob.q;if(K(a)||F(a)||a.is_character||Q(a)||a.qj){var q,r=a,t=e,u=r.f,p=r.Sd,Y=p.bn,z=n();if("CAMERA"==r.type)var Ia=p.Gr?p.Yl:"BOX",U=l(Ia,u),Z=u.lk,w=u.gk,Z=.5,w=0;else"EMPTY"==r.type?(Ia="EMPTY",U=null,w=Z=0):(Ia=p.Gr?p.Yl:"BOX",U=l(Ia,u),Z=u.lk,w=u.gk);var B=R.get_trans_view(u.h),P=R.get_quat_view(u.h),ga=p.ll,E=p.Vw,J=p.le,D=p.$w,N=p.Zw,T=p.Xo,ka=p.Pq,W=r.Ka,S=g(W),aa=p.Pj,ub=p.Nj,X=p.Qj,ia=u.ud.Ya,ca=h(U),Vc=r.cm,Ic;var md=Ia;if(k.length){var Wc=[],Jc={};
Jc.quat=new Float32Array([0,0,0,1]);Jc.trans=new Float32Array(3);Jc.worker_bounding=ca;Jc.bounding_type=md;Wc.push(Jc);var Nc=R.invert(u.h,ja),Lb=R.get_quat_view(u.h);y.invert(Lb,va);for(var Pa=0;Pa<k.length;Pa++){var nb={},Hb=k[Pa],zc=Hb.Sd.Yl,uc=new Float32Array(4),Oc=new Float32Array(3),Xc=R.get_trans_view(Hb.f.h),hd=R.get_quat_view(Hb.f.h);R.transform_vec3(Xc,Nc,Oc);y.multiply(va,hd,uc);nb.trans=Oc;nb.quat=uc;nb.bounding_type=zc;nb.worker_bounding=h(l(zc,Hb.f));Wc.push(nb)}Ic=Wc}else Ic=[];G.w(t,
G.Ux,z,B,P,Y,ga,E,J,D,N,T,ka,S,aa,ub,X,Ia,ca,ia,Z,w,Ic,Vc);ma[z]=r;L.push(r);var $b=x(z);$b.type=Y;$b.le=J;$b.Hm=ga;$b.Ka=W;$b.Oj=S;q=$b;a.n=q;var Kc={D:null,n:q};m.push(Kc);b(c,e,q.Ka)}else for(var Ab=M.Sa(a,c).V,La=0;La<Ab.length;La++){var hb=Ab[La],Kb;if(Kb="PHYSICS"==hb.type){var Ac;a:{for(var Oa=c.ob.q,ac=0;ac<Oa.length;ac++){var ab=Oa[ac].D;if(ab&&ab.id==hb.id){Ac=!0;break a}}Ac=!1}Kb=!Ac}if(Kb)if(hb.jd.U)if(hb.ng&&c.k.Cb){var Ua=hb,lb=c,Aa=e,Ga=V.ia(lb,"MAIN_OPAQUE");G.w(Aa,G.cy,Ga.og);if(Ga.Cb&&
Ua.fH){var Ba={};Ba.dst_noise_scale0=Ua.dst_noise_scale0;Ba.dst_noise_scale1=Ua.dst_noise_scale1;Ba.dst_noise_freq0=Ua.dst_noise_freq0;Ba.dst_noise_freq1=Ua.dst_noise_freq1;Ba.dir_min_shore_fac=Ua.dir_min_shore_fac;Ba.dir_freq=Ua.dir_freq;Ba.dir_noise_scale=Ua.dir_noise_scale;Ba.dir_noise_freq=Ua.dir_noise_freq;Ba.dir_min_noise_fac=Ua.dir_min_noise_fac;Ba.dst_min_fac=Ua.dst_min_fac;Ba.waves_hor_fac=Ua.waves_hor_fac;var Ha=Ga.pg,Bc=Ga.Ph;Ga.Kn?G.w(Aa,G.Zr,Ba,Ga.bg[0],Ga.bg[1],Ga.ag[0],Ga.ag[1],Ga.Ci,
Ha,Bc,Ga.Yi,lb.k.$q):G.w(Aa,G.Zr,Ba,0,0,0,0,0,Ha,Bc,0,null)}}else{var Wb;if(hb.ll){var Wa=a,rb=hb,zb=e,Cc=n(),eb=rb.jd,Dc=eb.A[0].a_position,Ec=eb.xa||null,ob=rb.Ka,Rb=g(ob),Fc=rb.Pj,Gc=rb.Nj,Bb=rb.Qj,Cb=R.get_trans_view(Wa.f.h);G.w(zb,G.$x,Cc,Dc,Ec,Cb,Rb,Fc,Gc,Bb);var Ta=x(Cc);Ta.Hm=!0;Ta.Ka=ob;Ta.Oj=Rb;Wb=Ta}else{var Ja=a,Xa=hb,nc=e,Mb=n(),Nb=Xa.jd,Sb=Nb.A[0].a_position,sb=Nb.xa||null,wb=R.get_trans_view(Ja.f.h),vc=Xa.lk,mc=Xa.gk,vb=Xa.Ka,Ob=g(vb);G.w(nc,G.by,Mb,Sb,sb,wb,vc,mc,Ob,Xa.Pj,Xa.Nj,Xa.Qj);
var pb=x(Mb);pb.Ka=vb;pb.Oj=Ob;Wb=pb}q=Wb;Kc={D:hb,n:q};m.push(Kc);b(c,e,q.Ka)}else I.error("Object "+a.name+" has collision material with no assigned vertices")}if(K(a)||F(a)){var Qa=a,Fa=e,Ya=Qa.n.v;K(Qa)?(Qa.l.type=10,G.w(Fa,G.Vx,Ya,Qa.l.or,Qa.l.qr,Qa.l.pr,Qa.l.Pr,Qa.l.iq)):F(Qa)&&(Qa.l.type=20,G.w(Fa,G.Tx,Ya,Qa.l.Sg,Qa.l.Nh,Qa.l.Oh));if(Qa.l.wh){var fb=Qa.l.wh;switch(Qa.l.type){case 10:v(fb[1],Qa,Ya,!0,Fa);v(fb[0],Qa,Ya,!0,Fa);v(fb[3],Qa,Ya,!1,Fa);v(fb[2],Qa,Ya,!1,Fa);break;case 20:for(var xa=
0;xa<fb.length;xa++)v(fb[xa],Qa,Ya,!1,Fa)}}O(a,a.l,e)}else if(a.is_character){var Db=e,Za=a.f,bc=a.n,Ra=Za.Ub.max_y-Za.Ub.min_y,yb=bc.v,mb=a.Rs,Tb=mb.eH,bb=mb.ME,Xb=mb.IF,cc=mb.fD,jc=mb.gH,Pb=ha.lB(a);G.w(Db,G.Wx,yb,Pb,Ra,Tb,bb,Xb,cc,jc);bc.is_character=!0}else if(Q(a)){var Va=a,gb=e,Eb=Va.n.v;G.w(gb,G.Zx,Eb,Va.zd.Sg,Va.zd.Nh,Va.zd.Oh);if(Va.zd.Tl)for(var cb=Va.zd.Tl,Yb=0;Yb<cb.length;Yb++){var Fb=cb[Yb],Ma=R.get_trans_view(Fb.f.h),Ib=R.invert(Va.f.h,ja),dc=new Float32Array(3);R.transform_vec3(Ma,
Ib,dc);G.w(gb,G.Sx,Eb,dc,Fb.Hz)}Va.n.XC=!0}for(La=0;La<L.length;La++)if(a=L[La],a.n){var Jb=a;if(!C(Jb))for(var tb=0;tb<Jb.Aq.length;tb++){var ib=Jb.Aq[tb],oc=ib.target,Hc=ib.hE;if(oc.n){var ec=new Float32Array([ib.iE,ib.jE,ib.kE]),kc,wc=new Float32Array([ib.ce,ib.de,ib.ee]);kc=ha.euler_to_quat(wc,new Float32Array(4));var Zb=R.identity(ja),Zb=R.set_trans(ec,Zb),Zb=R.set_quat(kc,Zb),fc=R.multiply(Jb.f.h,Zb,ja),gc=R.invert(oc.f.h,na),pc=R.multiply(gc,fc,gc),qb=R.get_trans_view(pc),xc=R.get_quat_view(pc),
db=ib,$a={};$a.use_limit_x=db.KG;$a.use_limit_y=db.LG;$a.use_limit_z=db.MG;$a.use_angular_limit_x=db.FG;$a.use_angular_limit_y=db.GG;$a.use_angular_limit_z=db.HG;$a.limit_max_x=db.pD;$a.limit_min_x=db.sD;$a.limit_max_y=db.qD;$a.limit_min_y=db.tD;$a.limit_max_z=db.rD;$a.limit_min_z=db.uD;$a.limit_angle_max_x=db.jD;$a.limit_angle_min_x=db.mD;$a.limit_angle_max_y=db.kD;$a.limit_angle_min_y=db.nD;$a.limit_angle_max_z=db.lD;$a.limit_angle_min_z=db.oD;A(Hc,Jb,ec,kc,oc,qb,xc,$a,null,null)}}}};a.GB=e;a.update=
function(a,b){for(var c=0;c<oa.length;c++){var d=oa[c],e=a;d&&G.vu(d)&&G.w(d,G.Gy,e,b);for(var h=0;h<L.length;h++){var f=L[h],g=f.n;if(g.cg&&g.gm){var k=G.vu(d)?e-g.gm:performance.now()/1E3-g.gm,k=Math.min(k,10/W.Qd),k=k-1/W.Qd;S.WD&&(k=0);var l=ja;R.TC(g.Vo,k,g.ke,g.ae,ja);T.set_tsr(f,l);T.o(f);q(f);if(f.l)for(var g=f,k=g.l.wh,l=g.f.h,m=ja,n=0;n<k.length;n++){var r=k[n];R.multiply(l,g.l.Lk[n],m);T.set_tsr(r,m);T.o(r)}f.l&&f.l.gj&&(m=f,k=m.l,g=k.gj)&&(n=m.l.nw,R.multiply(m.f.h,m.l.ow,g.f.h),l=P,R.transform_dir_vec3(n,
m.f.h,l),m=va,y.setAxisAngle(l,-k.ej*k.fj*2*Math.PI,m),k=R.get_quat_view(g.f.h),y.multiply(m,k,k),T.o(g));f.l&&f.l.hr&&(m=f,k=m.l,g=k.hr)&&(n=m.l.jw,R.multiply(m.f.h,m.l.kw,g.f.h),l=P,R.transform_dir_vec3(n,m.f.h,l),m=va,n=Math.abs(k.speed)*k.Xk,n>k.Di&&(n=k.Di),y.setAxisAngle(l,-n,m),k=R.get_quat_view(g.f.h),y.multiply(m,k,k),y.normalize(k,k),T.o(g));f.l&&f.l.rr&&(l=f,g=l.l,f=g.rr)&&(m=l.l.xw,R.multiply(l.f.h,l.l.yw,f.f.h),k=P,R.transform_dir_vec3(m,l.f.h,k),l=va,y.setAxisAngle(k,-Math.abs(g.ei)*
g.$j,l),g=R.get_quat_view(f.f.h),y.multiply(l,g,g),y.normalize(g,g),T.o(f))}}G.oE(d);d=V.ia(fa[c],"MAIN_OPAQUE");d.Cb&&0<d.Cb.waves_height&&(e=ia.length(d.lf),G.w(oa[c],G.Dy,d.time*e))}};a.fC=function(){return fa[0]};a.pause=function(){for(var a=0;a<oa.length;a++)G.w(oa[a],G.oy)};a.resume=function(){for(var a=0;a<oa.length;a++)G.w(oa[a],G.ty)};a.enable_simulation=function(a){a=a.n;if(!a)throw"No object physics";if(!a.cg){var b=a.v,c=B(b);a.cg=!0;G.w(c,G.my,b)}};a.disable_simulation=function(a){a=
a.n;if(!a)throw"No object physics";if(a.cg){var b=a.v,c=B(b);a.cg=!1;G.w(c,G.ly,b)}};a.kn=function(a){return Boolean(a.ob)};a.J=function(a){return Boolean(a.n)};a.has_dynamic_physics=function(a){return(a=a.n)&&a.cg&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.le&&0==a.Hm?!0:!1};a.has_simulated_physics=function(a){return(a=a.n)&&a.cg?!0:!1};a.set_gravity=function(a,b){var c=a.n.v;G.w(B(c),G.Cy,c,b)};a.MC=C;a.apply_constraint=A;a.clear_constraint=function(a){a=a.n;G.w(B(body_a),G.ry,a.am);a.am=null};
a.pull_to_constraint_pivot=function(b,c,d,e,h,f){c=R.set_sep(c,1,d,ja);h=R.set_sep(h,1,f,na);R.invert(c,c);R.multiply(h,c,c);T.get_tsr(e,h);R.multiply(h,c,c);T.set_tsr(b,c);T.o(b);e=R.get_trans_view(b.f.h);h=R.get_quat_view(b.f.h);a.set_transform(b,e,h)};a.set_transform=function(a,b,c){var d=a.n,e=R.get_trans_view(a.f.h);a=R.get_quat_view(a.f.h);R.set_sep(e,1,a,d.Vo);e=G.Yt(G.yl);e.v=d.v;e.trans=b;e.quat=c;G.w(B(d.v),G.yl)};a.sync_transform=q;a.apply_velocity=function(a,b,c,d){z(a,b,c,d,P);a=a.n.v;
b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(P[0]),h=Math.abs(P[1]),f=Math.abs(P[2]);P[0]=e?P[0]/e*Math.max(e,b):0;P[1]=h?P[1]/h*Math.max(h,c):0;P[2]=f?P[2]/f*Math.max(f,d):0;G.w(B(a),G.as,a,P[0],P[1],P[2])};a.apply_velocity_world=function(a,b,c,d){a=a.n.v;G.w(B(a),G.as,a,b,c,d)};a.apply_force=function(a,b,c,d){z(a,b,c,d,P);a=a.n.v;G.w(B(a),G.dy,a,P[0],P[1],P[2])};a.apply_torque=function(a,b,c,d){z(a,b,c,d,P);a=a.n.v;G.w(B(a),G.fy,a,P[0],P[1],P[2])};a.set_character_move_dir=function(a,
b,c){a=a.n.v;G.w(B(a),G.wy,a,b,c)};a.set_character_move_type=function(a,b){var c=a.n.v;G.w(B(c),G.xy,c,b)};a.set_character_walk_velocity=function(a,b){var c=a.n.v;G.w(B(c),G.By,c,b)};a.set_character_run_velocity=function(a,b){var c=a.n.v;G.w(B(c),G.zy,c,b)};a.set_character_fly_velocity=function(a,b){var c=a.n.v;G.w(B(c),G.uy,c,b)};a.character_jump=function(a){a=a.n.v;G.w(B(a),G.hy,a)};a.character_rotation_inc=function(a,b,c){a=a.n.v;G.w(B(a),G.iy,a,b,c)};a.set_character_rotation=function(a,b,c){a=
a.n.v;G.w(B(a),G.yy,a,b,c)};a.set_character_rotation_h=function(a,b){var c=a.n.v;G.w(B(c),G.vy,c,b)};a.set_character_rotation_v=function(a,b){var c=a.n.v;G.w(B(c),G.Ay,c,b)};a.append_collision_test=function(a,b,c,d){var e=a.n,h=e.v;b=b||"ANY";for(var f=0;f<e.wc.length;f++)if(a=e.wc[f],a.Ka==b&&a.callback==c)return;a={qo:h,ge:d||!1,Ka:b,callback:c,Sf:[],Fk:[]};e.wc.push(a);b=B(h);u(a,m(b),b)};a.remove_collision_test=function(a,b,c){a=a.n;for(var d=B(a.v),e=m(d),h=0;h<a.wc.length;h++){var f=a.wc[h];
if(f.Ka==b&&f.callback==c){if(k(f)){var g=ia.set(0,0,0,P);f.callback(!1,null,g,g,0)}a.wc.splice(h,1);h--;for(var g=d,f=f.Sf,l=e.ob.q,n=0;n<l.length;n++)for(var q=l[n].n,r=0;r<q.wc.length;r++)for(var t=q.wc[r],u=0;u<t.Sf.length;u++)for(var v=t.Sf[u],p=0;p<f.length;p++){var x=f[p];v[0]==x[0]&&v[1]==x[1]&&(f.splice(p,1),p--)}f.length&&G.w(g,G.$r,f)}}};a.apply_collision_impulse_test=function(a,b){a.n&&a.n.Hg&&f(a);var c=a.n;G.w(B(c.v),G.ey,c.v);c.Hg=b};a.clear_collision_impulse_test=f;a.append_ray_test=
function(a,b,c,d,e,h,f,k,l){var n;ga.Cv++;n=ga.Cv;d=d||"ANY";a={id:n,v:a?a.n.v:0,from:new Float32Array(b),to:new Float32Array(c),Ka:d,Oj:g(d),As:h,Lz:f,ge:k,Cm:l,callback:e};b=B(a.v)||oa[0];c=m(b).ob;n=a.id;c.Wf[n]=a;c.Hq.push(a);G.w(b,G.ay,a.id,a.v,a.from,a.to,a.Oj,a.As,a.Lz,a.ge,a.Cm);return n};a.remove_ray_test=E;a.change_ray_test_from_to=function(a,b,c){var d=N(a),e=w(a).ob.Wf[a];e&&!e.As&&(e.from.set(b),e.to.set(c),G.w(d,G.gy,a,b,c))};a.wu=function(a){return w(a).ob.Wf[a]?!0:!1};a.vehicle_throttle=
function(a,b){var c=a.l;c.ei=b;O(a,c,B(a.n.v))};a.vehicle_steer=function(a,b){var c=a.l;c.ej=b;O(a,c,B(a.n.v))};a.vehicle_brake=function(a,b){var c=a.l;c.Ej=b;O(a,c,B(a.n.v))};a.is_vehicle_chassis=K;a.is_vehicle_hull=F;a.WC=function(a){if(!a.Ac)return!1;a=a.Mc.Dc;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.UC=function(a){return a.Ac?"BOB"==a.Mc.Dc?!0:!1:!1};a.YC=function(a){return a.$g?"BOB"==a.gi.Dc?!0:!1:!1};a.yu=function(a){return a.Ac&&
"STEERING_WHEEL"==a.Mc.Dc?!0:!1};a.xu=function(a){return a.Ac&&"SPEEDOMETER"==a.Mc.Dc?!0:!1};a.zu=function(a){return a.Ac&&"TACHOMETER"==a.Mc.Dc?!0:!1};a.get_vehicle_speed=function(a){return a.l.speed};a.iH=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=function(a){return a.is_character};a.yJ=Q;a.tC=function(){return ca};a.eB=function(){for(var a=0;a<oa.length;a++)G.w(oa[a],
G.ky)};a.xE=function(a){var b=L.indexOf(a);-1==b&&I.error("Object "+a.name+" doesn't have bounding physics");for(var c=a.n.v,d=B(c),e=m(d),h=e.ob.q,g=[],l=0;l<h.length;l++)for(var n=h[l].n,q=0;q<n.wc.length;q++)for(var r=n.wc[q],t=0;t<r.Sf.length;t++){var u=r.Sf[t],v=r.Fk[t];if(u[0]==c||u[1]==c)r.Sf.splice(t,1),r.Fk.splice(t,1),t--,v&&!k(r)&&(v=ia.set(0,0,0,P),r.callback(!1,null,v,v,0)),g.push(u)}g.length&&G.w(d,G.$r,g);a.n&&a.n.Hg&&f(a);delete ma[c];L.splice(b,1);a=e.ob.q;for(b=0;b<a.length;b++)a[b].n.v==
c&&(a.splice(b,1),b--);G.w(d,G.qy,c)}};b4w.module.__data=function(a,p){function d(a,b){jb[b.id]=null;la[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=P.du(a));d=a.width;a=a.height;pa.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(tc)&&c&&pa.warn("image",b,"is not from app root.")}function c(a,b,c,d,e,h){d=b.Re;if(!d)throw"Nothing requested";ma.enqueue([{id:d,type:ma.AT_JSON,url:d}],function(d,h,f,g){if(d){pa.log("%cLOAD METADATA","color: #616",g);h=wa.pw(d.b4w_format_version);
switch(wa.ax(h,za.jh)){case -1:h[0]<za.jh[0]?wa.O("JSON version is too old relative to B4W engine: "+wa.kg(h)+", required: "+wa.kg(za.jh)+". Reexport scene with the latest B4W addon to fix it."):pa.warn("JSON version is a bit old relative to B4W engine: "+ +wa.kg(h)+", required: "+wa.kg(za.jh)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");break;case 1:h[0]>za.jh[0]?wa.O("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):
pa.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}za.eq=h;for(var k in d)a[k]=d[k];b.Ma&&(ka=ya.qm(a.scenes));(d=a.binaries[0].binfile)?b.Cs=d:(ja.tn(b,"load_binaries"),ja.tn(b,"prepare_bindata"));za.ah||ja.tn(b,"mobile_media_start");za.antialiasing&&za.smaa||ja.tn(b,"load_smaa_textures");if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)k=a.b4w_export_errors[d],(b.Ma&&"PRIMARY"==k.type||"ALL"==k.type)&&
pa.xB(k.text);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)k=a.b4w_export_warnings[d],(b.Ma&&"PRIMARY"==k.type||"ALL"==k.type)&&pa.yB(k.text);e(b,c)}else ja.ks(b)},null,function(a){h(b,c,a)})}function m(a,b,c,d,e,h){d=S(b.Re)+b.Cs;if(!d)throw"Binary data is missing";ma.enqueue([{id:d,type:ma.AT_ARRAYBUFFER,url:d}],function(d,h,f,g){d?(pa.log("%cLOAD BINARY","color: #616",g),a.bin_data=d,d=k(d),h=wa.pw(a.b4w_format_version),d[0]!=h[0]&&wa.O("BIN version does not match to JSON version: "+
wa.kg(d)+", required: "+wa.kg(za.jh)+". Couldn't load the scene. Reexport scene to fix it."),d[1]!=h[1]&&pa.warn("BIN version does not match to JSON version: "+ +wa.kg(d)+", required: "+wa.kg(za.jh)+". Some compatibility issues can occur. Reexport scene to fix it."),e(b,c)):ja.ks(b)},null,function(a){h(b,c,a)})}function e(a,b,c,d,e){Y.dA()&&e(b,c)}function t(a,b,c,d,e){d=a.bin_data;var h=a.binaries[0],f=a.objects,g=a.meshes;a=a.actions;for(var l=wa.aA(),m=k(d),m=5<=m[0]&&4<m[1]?12:0,q=["indices"],
r=["normal","tangent"],t=["color","group"],u=["position","texcoord","texcoord2"],v=0;v<g.length;v++)for(var p=g[v].submeshes,Y=0;Y<p.length;Y++)for(var x in p[Y]){var qa=p[Y][x][1];if(-1!=q.indexOf(x)){var L=4*p[Y][x][0]+h["int"]+m,z=p[Y],Ia=x,y=d;if(l)var sa=new Uint32Array(y,L,qa);else for(var sa=new Uint32Array(qa),y=new DataView(y),F=0;F<qa;F++)sa[F]=y.getUint32(L+4*F,!0);z[Ia]=sa}else if(-1!=u.indexOf(x))L=4*p[Y][x][0]+h["float"]+m,p[Y][x]=n(d,L,qa,l);else if(-1!=r.indexOf(x)){L=2*p[Y][x][0]+
h["short"]+m;z=p[Y];Ia=x;y=d;sa=new Float32Array(qa);y=new DataView(y);for(F=0;F<qa;F++)sa[F]=y.getInt16(L+2*F,!0)/32767;z[Ia]=sa}else if(-1!=t.indexOf(x)){L=2*p[Y][x][0]+h.ushort+m;z=p[Y];Ia=x;y=d;sa=new Float32Array(qa);y=new DataView(y);for(F=0;F<qa;F++)sa[F]=y.getUint16(L+2*F,!0)/65535;z[Ia]=sa}}for(x=0;x<f.length;x++)for(g=f[x].particle_systems,q=0;q<g.length;q++)r=g[q],r.transforms=n(d,4*r.transforms[0]+h["float"]+m,r.transforms[1],l);for(f=0;f<a.length;f++){x=a[f];g=x.fcurves;q=x.frame_range;
t=q[0];u=q[1];v=fa.iC(t,u);q=null;0>v&&(v=0);var Y=p=!1,U;for(U in g)p|=-1<U.indexOf("rotation_euler"),Y|=-1<U.indexOf("rotation_quaternion");r=[];for(U in g)if(p&&Y&&-1<U.indexOf("rotation_euler"))delete g[U];else{var qa=g[U],Sa;for(Sa in qa)L=qa[Sa],z=n(d,h["float"]+4*L.bin_data_pos[0]+m,L.bin_data_pos[1],l),Ia=new Float32Array(v),null===q&&(q=new Int8Array(v)),fa.qz(L,z,Ia,q,t,u),L.Pc=Ia;-1<U.indexOf("rotation_euler")&&(fa.FB(g[U]),r.push(U))}for(t=0;t<r.length;t++)u=r[t],v=u.replace("euler","quaternion"),
g[v]=g[u],delete g[u];x.Ny=q}e(b,c)}function k(a){var b=new Uint8Array(a,0,4),c=(new Uint32Array(a,4,1))[0];a=(new Uint32Array(a,8,1))[0];for(var d=0;d<b.length;d++)if("B4WB"[d]!=String.fromCharCode(b[d])){c=5;a=4;break}return[c,a]}function n(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function g(a,b,c,d,e){var h=a.cameras,f=a.groups,g=a.materials,k=a.meshes,m=a.node_groups,n=a.objects,q=a.particles,
r=a.scenes,t=a.speakers,v=a.lamps,p=a.textures,Y=a.worlds;m||(pa.warn('"node_groups" datablock undefined. reexport main scene.'),m=a.node_groups=[]);for(var L="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),y={},F=0;F<L.length;F++)for(var U=a[L[F]],Sa=0;Sa<U.length;Sa++){var ba=U[Sa];y[ba.uuid]=ba}for(var I=0;I<r.length;I++){for(var A=r[I],w=A.objects,Z=0;Z<w.length;Z++)u(w,Z,y);A.camera&&u(A,"camera",
y);A.world&&u(A,"world",y)}for(I=0;I<f.length;I++)for(var B=f[I].objects,Z=0;Z<B.length;Z++)u(B,Z,y);for(I=0;I<n.length;I++){var P=n[I];P.dupli_group&&u(P,"dupli_group",y);P.parent&&u(P,"parent",y);P.dg_parent&&u(P,"dg_parent",y);if(P.animation_data){var ga=P.animation_data;ga.action&&u(ga,"action",y);if(ga.nla_tracks)for(Z=0;Z<ga.nla_tracks.length;Z++)for(var C=ga.nla_tracks[Z],K=0;K<C.strips.length;K++)C.strips[K].action&&u(C.strips[K],"action",y)}switch(P.type){case "MESH":if(!P.data)throw"mesh not found for object "+
P.name;u(P,"data",y);for(var E=!1,J=P.modifiers,Z=0;Z<J.length;Z++){var G=J[Z];"ARMATURE"==G.type?(E&&pa.warn('Object "'+P.name+'" has more than one armature modifiers. Only the first one will be used.'),E=!0,u(G,"object",y)):"CURVE"==G.type&&u(G,"object",y)}var Q=P.particle_systems;if(Q)for(Z=0;Z<Q.length;Z++)u(Q[Z],"settings",y);break;case "ARMATURE":u(P,"data",y);for(var za=P.pose.bones,V=P.data.bones,Z=0;Z<za.length;Z++){var M=za[Z];M.bone=V[M.bone];var va=M.constraints;if(va)for(K=0;K<va.length;K++){var N=
va[K];N.target&&u(N,"target",y)}for(var ja=M.parent_recursive,K=0;K<ja.length;K++)ja[K]=za[ja[K]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":u(P,"data",y)}if(va=P.constraints)for(Z=0;Z<va.length;Z++)N=va[Z],N.target&&u(N,"target",y);var Qb=P.lod_levels;if(Qb)for(Z=0;Z<Qb.length;Z++){var T=Qb[Z];T.object&&u(T,"object",y)}}for(I=0;I<k.length;I++)for(var O=k[I].materials,Z=0;Z<O.length;Z++)u(O,Z,y);for(I=0;I<g.length;I++){for(var R=g[I],Ka=R.texture_slots,Z=0;Z<Ka.length;Z++)u(Ka[Z],
"texture",y);var Vb=R.node_tree;Vb&&z(Vb,y)}for(I=0;I<m.length;I++)(Vb=m[I].node_tree)&&z(Vb,y);for(I=0;I<p.length;I++){var oa=p[I],na=oa.type;"IMAGE"!=na&&"ENVIRONMENT_MAP"!=na||u(oa,"image",y)}for(I=0;I<h.length;I++){var da=h[I];da.dof_object&&u(da,"dof_object",y)}for(I=0;I<t.length;I++){var tc=t[I];tc.sound&&u(tc,"sound",y);if(tc.animation_data&&(ga=tc.animation_data,ga.action&&u(ga,"action",y),ga.nla_tracks))for(Z=0;Z<ga.nla_tracks.length;Z++)for(C=ga.nla_tracks[Z],K=0;K<C.strips.length;K++)C.strips[K].action&&
u(C.strips[K],"action",y)}for(I=0;I<q.length;I++){for(var ma=q[I],Ka=ma.texture_slots,Z=0;Z<Ka.length;Z++)u(Ka[Z],"texture",y);ma.dupli_group&&u(ma,"dupli_group",y);ma.dupli_object&&u(ma,"dupli_object",y)}for(I=0;I<v.length;I++){var ub=v[I];if(ub.animation_data&&(ga=ub.animation_data,ga.action&&u(ga,"action",y),ga.nla_tracks))for(Z=0;Z<ga.nla_tracks.length;Z++)for(C=ga.nla_tracks[Z],K=0;K<C.strips.length;K++)C.strips[K].action&&u(C.strips[K],"action",y)}for(I=0;I<Y.length;I++)if(Ka=Y[I].texture_slots)for(Z=
0;Z<Ka.length;Z++)u(Ka[Z],"texture",y);qa.Xz(a);for(var W=a.textures,jb=b.Ma?a.scenes[0].b4w_anisotropic_filtering:ka.b4w_anisotropic_filtering,S=0;S<W.length;S++)b.Ma||"SCENE"!=W[S].b4w_source_type||(W[S].b4w_source_id=""),sa.TA(W[S],jb,a.scenes,b.id);for(var kb={},aa=a.objects,ua=0;ua<aa.length;ua++){var ea=aa[ua];if("MESH"===ea.type&&!ea.particle_systems.length)for(var Na=ea.data,X=Na.name,ia=Na.submeshes,ha=Na.materials,Ea=0;Ea<ia.length;Ea++)0!==ia[Ea].base_length||kb[X]||(ha[Ea]&&pa.warn('material "'+
ha[Ea].name+'" is not assigned to any face (object "'+ea.name+'").'),kb[X]=!0)}for(var ca=a.meshes,ta=0;ta<ca.length;ta++){var xb=ca[ta];xb.materials.length||xb.uv_textures.length&&pa.warn('mesh "'+xb.name+'" has a UV map but has no exported material.')}a.materials.push(qa.GA());for(var Mc=a.meshes,mb=wa.keysearch("name","DEFAULT",a.materials),Tb=0;Tb<Mc.length;Tb++){var bb=Mc[Tb];0==bb.materials.length&&bb.materials.push(mb)}for(var Xb=a.actions,cc=b.id,jc=0;jc<Xb.length;jc++){var Pb=Xb[jc];Pb.Oy=
cc;fa.Uy(Pb)}for(var Va=a.scenes,gb=0;gb<Va.length;gb++){for(var Eb=Va[gb],cb=[],Yb=[],Fb=Va[gb].objects,Ma=0;Ma<Fb.length;Ma++){var Ib=Fb[Ma];D(Fb,Ib,cb,Yb);var dc=Ib.dupli_group;if(dc)for(var Jb=dc.objects,tb=0;tb<Jb.length;tb++)D(Jb,Jb[tb],cb,Yb)}for(Ma=0;Ma<Yb.length;Ma++)for(var ib=Yb[Ma],oc=[Eb],Hc=0;Hc<oc.length;Hc++){for(var ec=oc[Hc].objects,kc=0;kc<ec.length;kc++){var wc=ec[kc].dupli_group;if(wc){var Zb=wc.objects,fc=Zb.indexOf(ib);-1<fc&&Zb.splice(fc,1)}}var fc=ec.indexOf(ib);-1<fc&&ec.splice(fc,
1)}for(Ma=0;Ma<cb.length;Ma++)wa.lz(cb[Ma][0],cb[Ma][1])}!b.Ma&&1<a.scenes.length&&(a.scenes=[ya.qm(a.scenes)],pa.warn("loading data contains multiple scenes.","Only the first one will be loaded."));var gc=b.Ma?ka:ya.qm(a.scenes);Ia.WE(ka.fps);1<a.scenes.length&&(a.scenes.splice(a.scenes.indexOf(ka),1),a.scenes.unshift(ka));for(var pc=0;pc<a.scenes.length;pc++){var qb=a.scenes[pc];qb.k={};qb.hs=qb==gc;qb.Py=b.Ma;ic.enabled&&qb.b4w_enable_physics&&(b.Ma||!H.kn(ka)&&qb==ya.qm(a))&&H.SC(qb);b.Ma?qb.b4w_enable_audio&&
Da.ys(qb):qb.b4w_enable_audio&&!ka.ka&&Da.ys(ka)}for(var xc=0;xc<a.scenes.length;xc++){var db=a.scenes[xc],$a,Pc=[];x(db.objects,"ALL",Pc);$a=Pc;db.b4w_use_logic_editor&&qa.vz($a,db);for(var lc=0;lc<$a.length;lc++){var Ub=$a[lc];ra.Yz(Ub,db,a)&&(Ub.vc||(Ub.vc=[]),Ub.vc.push(b.Ma?db:ka))}for(var dd=$a,jd=0;jd<dd.length;jd++){var Lc=dd[jd];if(Lc.vc)for(var yc=Lc.particle_systems,qc=0;qc<yc.length;qc++){var hc=yc[qc].settings;if("HAIR"==hc.type)if("OBJECT"==hc.render_type){var Yc=hc.dupli_object;Yc.vc||
(Yc.vc=Lc.vc.slice())}else if("GROUP"==hc.render_type)for(var Qc=hc.dupli_group,ed=0;ed<Qc.objects.length;ed++)Yc=Qc.objects[ed],Yc.vc||(Yc.vc=Lc.vc.slice())}}}for(var fd=a.scenes,Rc=[],Gb=0;Gb<fd.length;Gb++)l(fd[Gb].objects,0,b.Ma,Rc);la[b.id]=[];for(Gb=0;Gb<Rc.length;Gb++)for(var nd=Rc[Gb],rc=0;rc<nd.length;rc++)for(var Zc=nd[rc],$c=0;$c<Zc.length;$c++)la[b.id].push(Zc[$c]);for(var ad=a.particles,Gb=0;Gb<ad.length;Gb++){var sc=ad[Gb].dupli_object;sc&&(sc.gs=!0,la[b.id].push(sc));var gd=ad[Gb].dupli_group;
if(gd)for(var Sc=gd.objects,rc=0;rc<Sc.length;rc++)sc=Sc[rc],sc.gs=!0,la[b.id].push(sc)}for(var bd=la[b.id],Gb=bd.length-1;0<=Gb;Gb--)bd[Gb].vc||bd.splice(Gb,1);for(var Tc=la[b.id],xc=0;xc<Tc.length;xc++)if(Ub=Tc[xc],!b.Ma&&Ub.parent&&-1<Ca.indexOf(Ub.parent.type)&&(Ub.parent=""),"MESH"==Ub.type){var cd=qa.oz(Ub);cd&&(a.meshes.push(cd),Ub.data=cd)}e(b,c)}function x(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&x(e.objects,b,c)}}function l(a,b,c,d){d[b]=
d[b]||[];for(var e=d[b],h=0;h<a.length;h++){var f=a[h],g=ca(f);e[g]=e[g]||[];(c||-1==Ca.indexOf(f.type))&&-1==e[g].indexOf(f)&&e[g].push(f);(f=f.dupli_group)&&l(f.objects,b+1,c,d)}}function h(a,b,c){var d=[];a=la[a];for(var e=0;e<a.length;e++){var h=a[e];if(h.type==c||"ALL"==c)for(var f=0;f<h.vc.length;f++)b==h.vc[f]&&d.push(h)}return d}function v(a,b,c,d,e){var h=la[b.id];d=b.id;for(var f=0;f<h.length;f++){for(var g=h[f],k=ta.Uj(g.name,g.type,g.origin_name),l=0;l<g.vc.length;l++)ta.Kl(k,g.vc[l]);
g.ja=k;ra.Fh(g,k);k.f.xc=d;k.yk=g.gs||!1}d=ra.get_all_objects(b.id);for(f=0;f<h.length;f++)g=h[f],k=g.ja,da.Fh(g,k);if(b.Ma)for(f=b.id,g=0;g<a.scenes.length;g++)for(var k=a.scenes[g],l=0,m=ra.wa(k,"LAMP",f),n=0;n<m.length;n++)ta.Sa(m[n],k).dh=l++;for(f=0;f<h.length;f++)g=h[f],k=g.ja,k.yk||(ra.wG(g,k),Sa.o(k));for(a=0;a<h.length;a++)if(f=h[a],g=f.ja,ta.is_mesh(g)&&(k=f.lod_levels.length))for(l=g,m=0;m<k;m++)if(n=f.lod_levels[m].object){n=n.ja;n.f.gh=g.f.gh;l.f.Lf=f.lod_levels[m].distance;n.f.Bk=f.lod_levels[m].distance;
if(f.lod_levels[m+1])n.f.Lf=f.lod_levels[m+1].distance;else{n.f.Lm=!0;n.f.Lf=1E4;break}l.f.Lm=!1;l=n}else{l.f.Lm=!0;l.f.Lf=f.lod_levels[m].distance;break}for(h=0;h<d.length;h++)if(a=d[h],"MESH"==a.type&&(f=a.Ll)){var f=f.f,g=a.f.Yh,k=[],q;for(q in g)l=g[q],k.push(4*l.ap,4*l.uf);f.Su.push(k);f.sn.push(a.f)}h=q=-1;a=fa.Xt();for(f=0;f<d.length;f++)g=d[f],k=g.f,ta.is_mesh(g)&&k.vi&&(g=k.Ze,g>q&&(q=g),a>=g&&g>h&&(h=g));for(f=0;f<d.length;f++)g=d[f],k=g.f,ta.is_mesh(g)&&k.vi&&(k.kk=!0,q<a?k.Ze=q:k.Ze<=
a?k.Ze=h:(pa.warn('too many bones for "'+g.name+'" / '+k.Ze+" bones (max "+a+" with blending, "+2*a+" without blending). Blending between frames will be disabled."),k.Ze=q,k.kk=!1),k.kk=k.kk&&!Vb.Ht);for(q=0;q<d.length;q++)if(h=d[q],h.Ac)if(a=h.Mc,"CHASSIS"==a.Dc){h.l={};h.l.jk=a.jk;h.l.Fj=a.Fj;h.l.or=a.or;h.l.qr=a.qr;h.l.pr=a.pr;h.l.Pr=a.Pr;h.l.Nq=a.Nq;h.l.iq=a.iq;h.l.ei=0;h.l.Ej=1;h.l.ej=0;h.l.speed=0;h.l.wh=[];h.l.Lk=[];h.l.gj=null;g=(f=ta.get_dg_parent(h))?ta.zp(f,d):d;for(f=0;f<g.length;f++)k=
g[f],k.Ac&&(l=k.Mc,H.WC(k)&&a.name==l.name?(l=H.iH(k.Mc.Dc),h.l.wh[l]=k,h.l.Lk[l]=new Float32Array(8)):H.yu(k)&&a.name==l.name?(h.l.gj=k,h.l.fj=l.fj,h.l.$k=l.$k,h.l.vk=l.vk,l=Z.invert(h.f.h,Z.create()),k=Z.multiply(l,k.f.h,l),h.l.ow=k,l=new Float32Array([1,0,0]),Z.transform_dir_vec3(l,k,l),h.l.nw=l):H.xu(k)&&a.name==l.name?(h.l.hr=k,h.l.Xk=l.Xk,h.l.Di=l.Di,l=Z.invert(h.f.h,Z.create()),k=Z.multiply(l,k.f.h,l),h.l.kw=k,l=new Float32Array([1,0,0]),Z.transform_dir_vec3(l,k,l),h.l.jw=l):H.zu(k)&&a.name==
l.name&&(h.l.rr=k,h.l.$j=l.$j,l=Z.invert(h.f.h,Z.create()),k=Z.multiply(l,k.f.h,l),h.l.yw=k,l=new Float32Array([1,0,0]),Z.transform_dir_vec3(l,k,l),h.l.xw=l));if(4!=h.l.wh.length)throw"Not enough wheels for chassis "+h.name;}else if("HULL"==a.Dc)for(h.l={},h.l.wh=[],h.l.Lk=[],h.l.jk=a.jk,h.l.Fj=a.Fj,h.l.Sg=a.Sg,h.l.Nh=a.Nh,h.l.Oh=a.Oh,h.l.ei=0,h.l.Ej=1,h.l.ej=0,h.l.speed=0,h.l.gj=null,g=(f=ta.get_dg_parent(h))?ta.zp(f,d):d,f=0;f<g.length;f++)k=g[f],k.Ac&&(l=k.Mc,H.UC(k)&&a.name==l.name?(h.l.wh.push(k),
h.l.Lk.push(new Float32Array(8))):H.yu(k)&&a.name==l.name?(h.l.gj=k,h.l.fj=l.fj,h.l.$k=l.$k,h.l.vk=l.vk,l=Z.invert(h.f.h,Z.create()),k=Z.multiply(l,k.f.h,l),h.l.ow=k,l=new Float32Array([1,0,0]),Z.transform_dir_vec3(l,k,l),h.l.nw=l):H.xu(k)&&a.name==l.name?(h.l.hr=k,h.l.Xk=l.Xk,h.l.Di=l.Di,l=Z.invert(h.f.h,Z.create()),k=Z.multiply(l,k.f.h,l),h.l.kw=k,l=new Float32Array([1,0,0]),Z.transform_dir_vec3(l,k,l),h.l.jw=l):H.zu(k)&&a.name==l.name&&(h.l.rr=k,h.l.$j=l.$j,l=Z.invert(h.f.h,Z.create()),k=Z.multiply(l,
k.f.h,l),h.l.yw=k,l=new Float32Array([1,0,0]),Z.transform_dir_vec3(l,k,l),h.l.xw=l));for(q=0;q<d.length;q++)if(h=d[q],h.$g&&(a=h.gi,"MAIN_BODY"==a.Dc))for(h.zd={},h.zd.Sg=a.Sg,h.zd.Nh=a.Nh,h.zd.Oh=a.Oh,h.zd.Tl=[],f=(f=ta.get_dg_parent(h))?ta.zp(f,d):d,g=0;g<f.length;g++)k=f[g],k.$g&&(l=k.gi,H.YC(k)&&a.name==l.name&&(h.zd.Tl.push(k),k.Hz=k.gi.ww));e(b,c)}function C(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];f.vg=f.camera.ja}for(d=0;d<a.scenes.length;d++){var f=b.Ma?a.scenes[d]:ka,
g=b.Ma?ra.wa(f,"LAMP",b.id):ra.wa(f,"LAMP",0),k=ra.wa(f,"ALL",b.id),l=h(b.id,f,"MESH"),m=h(b.id,f,"EMPTY");b.Ma&&ya.$y(f,k,g,l,m);for(var n=0;n<m.length;n++)ra.Lw(m[n].ja);k=[];ya.set_active(f);L.aC(f,l,g,k);m=ya.Wt(f);if(b.Ma){n=f.k.un;if(n.AE||n.procedural_skydome)n=L.cC(f,n),k.push(n);ya.TB(m)}for(n=0;n<l.length;n++)L.ht(l[n].ja,m,f);for(n=0;n<k.length;n++)L.ht(k[n],m,f),ra.$D(k[n]);k=ra.wa(f,"ALL",b.id);ya.wz(f,k,g);for(n=0;n<k.length;n++)f=k[n],f.f.Xd&&ra.update_boundings(f)}ya.az(ka,a.textures,
b.id);b.Ma&&ka.k.tj.length&&(b.Ip=!0);d=a.materials;if(Qb.Yo&&za.Sw)for(a=0;a<d.length;a++){l=d[a];n=l.texture_slots;for(f=0;f<n.length;f++)if(k=n[f],m=k.texture,"IMAGE"==m.type||"ENVIRONMENT_MAP"==m.type)g=m.image,g.Oc||(-1<g.filepath.indexOf(".dds")?g.Oc=!0:(g.Oc=!m.b4w_disable_compression&&!k.use_map_normal&&"ENVIRONMENT_MAP"!=m.type&&!m.b4w_shore_dist_map&&"MOVIE"!=g.source,g.Oc&&(g.filepath+=".dds")));if(f=l.node_tree)for(l=f.nodes,f=0;f<l.length;f++)g=l[f],"TEXTURE"==g.type&&(n=g.texture)&&
(g=n.image)&&!g.Oc&&(g.Oc=n.k.Gl&&!n.b4w_disable_compression&&"MOVIE"!=g.source&&"ENVIRONMENT_MAP"!=n.type,g.Oc&&(g.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.Oc=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function A(a,b,c,d,e){d=a.groups;for(var h=a.objects,f={},g={},k={},l={},m=0;m<d.length;m++){var n=d[m];f[n.uuid]=n;k[n.uuid]=n}for(m=0;m<h.length;m++)n=h[m],g[n.uuid]=n,l[n.uuid]=n;a=a.scenes;for(m=0;m<a.length;m++)B(a[m].objects,null,l,k);for(var q in k)q in
f||d.push(k[q]);for(q in l)q in g||h.push(l[q]);e(b,c)}function B(a,b,c,d){for(var e=[],h=0;h<a.length;h++){var f=a[h],g=c[f.uuid];if(f=g.proxy){b&&-1==e.indexOf(f.uuid)&&e.push(f.uuid);for(var k=c[f.uuid],l=k.constraints,f=0;f<l.length;f++){var m=wa.Gg(l[f]);m.name+="_CLONE";g.constraints.push(m)}"b4w_proxy_inherit_anim"in g&&!g.b4w_proxy_inherit_anim||(g.animation_data&&(k.animation_data=wa.Gg(g.animation_data)),k.b4w_use_default_animation=g.b4w_use_default_animation,k.b4w_auto_skel_anim=g.b4w_auto_skel_anim,
k.b4w_anim_behavior=g.b4w_anim_behavior,k.b4w_cyclic_animation=g.b4w_cyclic_animation)}}for(h=0;h<e.length;h++)g=wa.vC(a,e[h]),-1<g&&a.splice(g,1);e={};if(b)for(h=0;h<a.length;h++)f=a[h],g=c[f.uuid],l=wa.Gg(g),g="origin_name"in g?g.origin_name:g.name,l.name=ta.Kt(b.name,g),l.origin_name=g,l.dg_parent={uuid:b.uuid},q(l),c[l.uuid]=l,e[f.uuid]=l.uuid,f.uuid=l.uuid;for(h=0;h<a.length;h++)f=a[h],g=c[f.uuid],g.dupli_group&&(f=g.dupli_group,l=d[f.uuid],k=wa.Gg(l),k.name=wa.nj(l.name+"_CLONE"),k.uuid=na.ou("Group"+
k.name),d[k.uuid]=k,f.uuid=k.uuid,B(k.objects,g,c,d));if(b)for(h=0;h<a.length;h++){f=a[h];g=c[f.uuid];g.parent&&g.parent.uuid in e?g.parent.uuid=e[g.parent.uuid]:g.parent&&(pa.warn("Object's \""+g.name+'" parent is not in dupli group. Disabling parenting.'),g.parent=null);l=g.constraints;for(f=0;f<l.length;f++)b=l[f],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);if(b=g.pose)for(d=b.bones,f=0;f<d.length;f++)if(l=d[f].constraints)for(k=0;k<l.length;k++)b=l[k],b.target&&b.target.uuid in
e&&(b.target.uuid=e[b.target.uuid]);b=g.modifiers;for(f=0;f<b.length;f++)d=b[f],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((g=g.lod_levels)&&g.length)for(f=0;f<g.length;f++)b=g[f],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var n in e)kb[n]=e[n]}function q(a){a.uuid=na.ou("Object"+a.name)}function z(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&u(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in kb&&(e.lamp.uuid=
kb[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&u(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var h=e[d];r(h,"from_node",c);r(h,"to_node",c);f(h,"from_socket",h.from_node.outputs);f(h,"to_socket",h.to_node.inputs)}if(c=a.animation_data)if(c.action&&u(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],h=0;h<e.strips.length;h++)e.strips[h].action&&u(e.strips[h],"action",b)}function u(a,b,c){(c=c[a[b].uuid])||pa.error("Dangling link found:",
b,a);a[b]=c}function r(a,b,c){c=wa.keysearch("name",a[b].name,c);a[b]=c}function f(a,b,c){c=wa.keysearch("identifier",a[b].identifier,c);a[b]=c}function E(a,c,d,e,h,f){e=S(c.Re);for(var g=a.images,k={},l=[],m=0;m<g.length;m++){var n=g[m],q=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var r=N(n,a.textures);if(!r.length)pa.warn("image ",n.name," has no users.");else if(!r[0].b4w_shore_dist_map){r=wa.Ck(e+n.filepath);if("FILE"===n.source){var t=n.Oc?ma.AT_ARRAYBUFFER:ma.AT_IMAGE_ELEMENT;Qb.jq&&za.In&&
(r=ma.Yk(r),"dds"==r[1]?(r=ma.Yk(r[0]),r=r[0]+".min50."+r[1]+".dds"):r=r[0]+".min50."+r[1])}else"MOVIE"===n.source&&(za.Tk?(r=ma.Yk(r),r=r[0]+".altconv.seq",t=ma.tl):(r=ma.Yk(r),t=Da.detect_video_container(r[1]),r=t!=r[1]?r[0]+".altconv."+t:r[0]+"."+t,t=ma.ul));l.push({id:q,type:t,url:r});k[q]=n}}}if(l.length){var u=0;ma.enqueue(l,function(e,h,g,m){if(e){if(g==ma.ul||g==ma.tl){if(g==ma.ul)var n=e.videoWidth,q=e.videoHeight;else n=e.images[0].width,q=e.images[0].height;pa.log("%cLOAD VIDEO "+n+"x"+
q,"color: #"+(2048<n||2048<q?"a00":1024<n||1024<q?"aa0":"0a0"),m);-1==m.indexOf(tc)&&pa.warn("video",m,"is not from app root.")}else b(e,m,!0);h=k[h];m=N(h,a.textures);for(n=0;n<m.length;n++){var q=m[n],r=q.image.filepath;g==ma.tl?(q.k.Tq=e.Se,sa.hl(q.k,e.images,h.Oc,r,c.id)):sa.hl(q.k,e,h.Oc,r,c.id)}}e=++u/l.length;f(c,d,e)},function(){pa.log("%cLOADED ALL IMAGES","color: #0a0");h(c,d)})}else h(c,d)}function w(a,b,c,d,e){a=ya.Zt();for(d=0;d<a.length;d++){var h=a[d];if(h.b4w_use_nla){var f=h.b4w_nla_cyclic;
h.b4w_use_logic_editor&&(f=!1);da.zG(h,f,b.id)}}e(b,c)}function N(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function O(a,b,c,d,e,h){a=S(b.Re);var f=[],g={};d=ra.get_all_objects(b.id);for(var k=0;k<d.length;k++){var l=d[k];if(K(l)){var m=l.C.Ih;"BACKGROUND_MUSIC"==Da.Bp(l)?(m=wa.vp(),b.Gp=!0):"NONE"!=Da.Bp(l)&&za.qu&&(b.Mp=!0);if(!(m in g)){g[m]=[];var n=wa.Ck(a+l.C.Re);switch(Da.iw(l)){case Da.Qn:var q=ma.AT_AUDIOBUFFER;break;case Da.Sr:q=ma.AT_AUDIO_ELEMENT}var n=
ma.Yk(n),r=Da.detect_audio_container(n[1]),n=r!=n[1]?n[0]+".altconv."+r:n[0]+"."+r;f.push({id:m,type:q,url:n})}g[m].push(l)}}if(f.length){var t=0;ma.enqueue(f,function(a,d,e,k){if(a)for(pa.log("%cLOAD SOUND","color: #0aa",k),-1==k.indexOf(tc)&&pa.warn("sound",k,"is not from app root."),d=g[d],e=0;e<d.length;e++)Da.CG(d[e],a);a=++t/f.length;h(b,c,a)},function(){pa.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)})}else e(b,c)}function K(a){return ta.is_speaker(a)&&Da.iw(a)!=Da.Tr}function F(a,b,c){a=
ra.wa(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];ta.is_speaker(d)&&(Da.is_cyclic(d)||c)&&Da.play_def(d)}}function Q(a,b){for(var c=a.k.tj,d=0;d<c.length;d++){var e=c[d].k;a.b4w_use_nla&&c[d].b4w_nla_video||!c[d].use_auto_refresh||b!=e.kf||(sa.reset_video(e.name,b),sa.play_video(e.name,b))}}function J(a,b,c,d,e){da.start();pa.log("%cSTART NLA","color: #0a0");e(b,c)}function D(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,h=0;h<e;h++){var f=b.lod_levels[h],g=f.object;
if(g){var k=wa.Mj(g);k.name=b.name+"_LOD_"+String(h+1);q(k);k.lod_levels=[];c.push([a,k]);d.push(g);f.object=k}}}function G(a,b,c,d,e){d=!0;for(var h=0;h<a.scenes.length;h++)if(!H.gA(a.scenes[h])){d=!1;break}d&&(e(b,c),pa.log("%cPHYSICS READY","color: #0a0"))}function M(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var h=a.scenes[d];if(b.Ma)var f=H.kn(h);else f=H.kn(ka)||H.kn(h),h=ka;if(ic.enabled&&f)for(f=0;f<Mc.length;f++)for(var g=ra.wa(h,Mc[f],b.id),k=0;k<g.length;k++){var l=g[k];l.f.xc==b.id&&(H.append_object(l,
h),b.Ku&&H.J(l)&&H.disable_simulation(l))}}e(b,c)}function I(a,c,d,e,h){var f={};e=[];for(var g=a.scenes,k=0;k<a.scenes.length;k++){var l=g[k];if(l.k.Cb&&(l=l.k.Cb.rn)&&"FILE"===l.source){var m=l.uuid,n=wa.Ck(S(c.Re)+l.filepath);e.push({id:m,type:l.Oc?ma.AT_ARRAYBUFFER:ma.AT_IMAGE_ELEMENT,url:n});f[m]=l}}e.length?ma.enqueue(e,function(d,e,h,k){if(d){b(d,k,!0);e=f[e];k=N(e,a.textures);for(h=0;h<k.length;h++){var l=k[h];sa.hl(l.k,d,e.Oc,l.image.filepath,c.id)}for(h=0;h<g.length;h++)if(k=g[h],k.k.Cb.rn===
e){var m=d,n=document.createElement("canvas"),l=e.size[0],q=e.size[1];n.width=l;n.height=q;n=n.getContext("2d");n.drawImage(m,0,0);m=n.getImageData(0,0,l,q).data;n=new Float32Array(4);n[0]=1/16581375;n[1]=1/65025;n[2]=1/255;n[3]=1;for(var l=l*q,q=new Float32Array(l),r=0;r<l;r++)q[r]=n[1]*m[4*r+2]+n[2]*m[4*r+3];k.k.$q=q}}},function(){h(c,d)}):h(c,d)}function y(a,c,d,e,h){e=a.scenes[0];a=[];for(var f=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],
g=0;g<f.length;g++){var k=ya.ia(e,f[g]);k&&a.push(k)}if(a.length){e=[];g=ma.AT_IMAGE_ELEMENT;e.push({id:"SEARCH_TEXTURE",type:g,Re:U.oc.smaa_search_texture_path});e.push({id:"AREA_TEXTURE",type:g,url:U.oc.smaa_area_texture_path});for(g=0;g<a.length;g++)if(f=a[g],"SMAA_BLENDING_WEIGHT_CALCULATION"==f.type){a=f.Aa;for(g=0;g<a.length;g++)if(f=a[g],"u_search_tex"==f.to)var l=f.va;else if("u_area_tex"==f.to)var m=f.va;break}e.length?ma.enqueue(e,function(a,d,e,h){a&&(b(a,h,!1),d="SEARCH_TEXTURE"==d?l:
m,d.source="IMAGE",d.aI=!0,sa.hl(d,a,-1!=h.indexOf(".dds")?1:0,h,c.id),sa.Uk(d,sa.t,sa.t))},function(){h(c,d)}):h(c,d)}else h(c,d)}function V(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];b.Ma||(e=ka);for(var h=ra.wa(e,"LAMP",b.id),f=0;f<h.length;f++){var g=h[f];g.f.xc==b.id&&d.Xn.push({Ga:e,obj:g})}h=ra.wa(e,"ALL",b.id);for(f=0;f<h.length;f++)g=h[f],"LAMP"!=g.type&&g.f.xc==b.id&&(b.Ku&&ta.is_mesh(g)&&ya.Jj(g,!0),d.Xn.push({Ga:e,obj:g}))}}function T(a,b,c,d,e,h){var f=d.Xn;e=d.dv;if(f.length){a=
f[e].obj;var g=f[e].Ga;e=ta.Sa(a,g);ya.append_object(g,a,!1);a.anchor&&oa.append(a);d=++d.dv/f.length;"LAMP"==a.type&&ra.wF(g);f=e.zf;if(null!=a.f.vd&&f){var k=Z.get_trans_view(a.f.h);ya.Kw(f,k)}f=a.Qk;f.length&&g.k.Si&&(g=Z.get_trans_view(a.f.h),a=Z.get_quat_view(a.f.h),e=e.Uf,ya.Nw(e,g,a),ta.Ow(f,e.j.pc))}else d=1;h(b,c,d)}function R(a,b,c,d,e){if(b.Ma){a=ya.oi();d=ya.Zt();for(var h=0;h<d.length;h++){var f=d[h];ya.rE(f,a);f.b4w_use_logic_editor&&ua.QC(f,b.id)}ya.set_active(a)}else ya.Fr(ka);a=ra.get_all_objects(b.id);
ra.xG(a);e(b,c)}function ha(a,b,c,d,e){if(b.Ma)for(d=0;d<a.scenes.length;d++)Q(a.scenes[d],b.id),F(a.scenes[d],b.id);else Q(ka,b.id),F(ka,b.id);e(b,c)}function ia(a,b,c,d,e){for(d=0;d<a.scenes.length;d++)a.scenes[d].camera=null;b.Ip||b.Gp||b.Mp?Na||aa(a,e,b,c):e(b,c)}function aa(a,b,c,d){var e=xb.parentElement;ub=e.style.zIndex;e.style.zIndex="999";Na=document.createElement("div");Na.style.position="relative";Na.style.height="88px";Na.style.width="88px";var h=Math.round(xb.offsetWidth/2-44);Na.style.top=
Math.round(xb.offsetHeight/2-44).toString()+"px";Na.style.left=h.toString()+"px";Na.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
Na.style.backgroundSize="88px";Ea=document.createElement("div");Ea.style.position="relative";Ea.style.height=xb.offsetHeight.toString()+"px";Ea.style.width=xb.offsetWidth.toString()+"px";Ea.style.background="rgba(0, 0, 0, 0.5)";Ea.style.zIndex="999";e.appendChild(Ea);Ea.appendChild(Na);Na.addEventListener("click",function(){c.Ip&&(sa.play(),sa.pause(),sa.reset());if(c.Gp){if(c.Ma)for(var e=0;e<a.scenes.length;e++)F(a.scenes[e],c.id,!0);else F(ka,c.id,!0);Da.pause()}c.Mp&&Da.nE();W();b(c,d)},!1)}function W(){if(Na){var a=
xb.parentElement;a.style.zIndex=ub;Ea.removeChild(Na);a.removeChild(Ea);Na=Ea=null;ub=0}}function S(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function X(a,b,c){fa.is_animated(b)&&fa.remove(b);ra.clear_outline_anim(b);ga.check_sensor_manifold(b)&&ga.remove_sensor_manifold(b);H.J(b)&&H.xE(b);ya.yE(a,b,c);ta.is_speaker(b)&&Da.yF(b);oa.is_anchor(b)&&oa.remove(b)}function ca(a){var b=fa.Qt(a);return(a=b&&b.parent==a?null:a.parent||b)?1+ca(a):0}var oa=p("__anchors"),fa=p("__animation"),
ma=p("__assets"),L=p("__batch");p("__camera");var U=p("__config"),ga=p("__controls"),P=p("__dds"),va=p("__extensions");p("__lights");var ja=p("__loader");p("__mat4");var na=p("__md5"),da=p("__nla"),ua=p("__logic_nodes"),ea=p("__nodemat"),ra=p("__objects"),ta=p("__obj_util"),H=p("__physics"),pa=p("__print"),qa=p("__reformer"),ba=p("__renderer"),ya=p("__scenes"),Da=p("__sfx"),Y=p("__shaders"),sa=p("__textures"),Ia=p("__time"),Sa=p("__transform"),Z=p("__tsr"),wa=p("__util");p("__vec4");var za=U.p,Qb=
U.be,ic=U.n,Vb=U.Ag,Ka=U.C,jb=null,la=null,tc="",ka=null,kb={},Na=null,Ea=null,ub=0,Ca=["LAMP","CAMERA"],Mc=["MESH","CAMERA","EMPTY"],xb=null;a.is_primary_loaded=function(a){return ja.is_primary_loaded(a)};a.update=function(){ja.AG(jb)};a.mF=function(a){xb=a};a.vG=function(a,b){if(Na){Ea.style.height=b.toString()+"px";Ea.style.width=a.toString()+"px";var c=Math.round(a/2-44);Na.style.top=Math.round(b/2-44).toString()+"px";Na.style.left=c.toString()+"px"}};a.load=function(a,b,h,f,k){var l={load_main:{Xa:ja.sg,
ib:!1,F:[],jb:!1,mb:500,Ab:!1,qb:c},duplicate_objects:{Xa:ja.uc,ib:!1,F:["load_main"],jb:!1,mb:50,Ab:!1,qb:A},load_binaries:{Xa:ja.sg,ib:!1,F:["load_main"],jb:!1,mb:500,Ab:!1,qb:m},wait_for_shaders:{Xa:ja.uc,ib:!1,F:[],jb:!1,mb:50,Ab:!0,wf:e},prepare_bindata:{Xa:ja.uc,ib:!1,F:["duplicate_objects","load_binaries"],jb:!1,mb:100,Ab:!1,qb:t},prepare_bpy_data:{Xa:ja.uc,ib:!1,F:["duplicate_objects","prepare_bindata"],jb:!1,mb:100,Ab:!1,qb:g},process_objects:{Xa:ja.uc,ib:!1,F:["prepare_bpy_data"],jb:!1,
mb:150,Ab:!1,qb:v},process_scenes:{Xa:ja.uc,ib:!1,F:["process_objects","wait_for_shaders"],jb:!1,mb:300,Ab:!1,qb:C},load_smaa_textures:{Xa:ja.sg,ib:!1,F:["process_scenes"],jb:!1,mb:30,Ab:!0,qb:y},load_shoremap:{Xa:ja.sg,ib:!1,F:["process_scenes"],jb:!1,mb:30,Ab:!0,qb:I},load_textures:{Xa:ja.sg,ib:!0,F:["process_scenes"],jb:!0,mb:500,Ab:!1,qb:E},update_scenes_nla:{Xa:ja.uc,ib:!1,F:["process_scenes","load_textures"],jb:!1,mb:50,Ab:!1,qb:w},wait_physics_workers:{Xa:ja.uc,ib:!1,F:["load_shoremap"],jb:!1,
mb:20,Ab:!1,wf:G},add_physics_objects:{Xa:ja.uc,ib:!1,F:["wait_physics_workers"],jb:!1,mb:50,Ab:!1,qb:M},add_objects:{Xa:ja.uc,ib:!1,F:["add_physics_objects"],jb:!1,mb:600,Ab:!1,qb:V,wf:T,Hj:R,Ij:{Xn:[],dv:0}},load_speakers:{Xa:ja.sg,ib:!0,F:["add_objects"],jb:!0,mb:100,Ab:!1,qb:O},mobile_media_start:{Xa:ja.uc,ib:!1,F:["load_textures","update_scenes_nla","load_speakers"],jb:!0,mb:5,Ab:!1,qb:ia,wf:ia},synchronize_media:{Xa:ja.uc,ib:!0,F:["mobile_media_start"],jb:!0,mb:50,Ab:!1,qb:ha},start_nla:{Xa:ja.uc,
ib:!0,F:["mobile_media_start"],jb:!1,mb:5,Ab:!0,qb:J}},n=ja.bu();n||(n=ja.MA(),jb={},la={},kb={});jb[n.xe.length]={};return ja.UA(l,a,b,h,d,f||Ka.zs,za.do_not_load_resources,k)};a.unload=function(a){var b=ja.bu();if(!b||!b.xe.length||a&&!ja.TF(b.xe[a]))pa.error("Unable to unload data!");else{if(0==a)pa.log("%cUNLOAD ALL","color: #00a"),oa.cleanup(),fa.cleanup(),Da.cleanup(),da.cleanup(),ya.cleanup(),ja.cleanup(),H.cleanup(),ra.cleanup(),wa.cleanup(),ba.cleanup(),ea.cleanup(),Y.cleanup(),ga.cleanup(),
va.cleanup(),ma.cleanup(),sa.cleanup(),ua.cleanup(),la=null,kb={},jb=ka=null;else{pa.log("%cUNLOAD DATA "+a,"color: #00a");fa.wE(a);for(var b=ya.mi(),c=0;c<b.length;c++)for(var d=b[c],e=ra.wa(d,"ALL",a),h=e.length-1;0<=h;h--){var f=e[h];X(d,f,!0);e.splice(h,1);var g=ra.wa(d,f.type,a),f=g.indexOf(f);-1!=f&&g.splice(f,1)}}W()}};a.qE=X;a.set_debug_resources_root=function(a){tc=a}};b4w.module.__batch=function(a,p){function d(a){a={type:a,fb:"",id:0,zE:0,Ki:"",Z:[],$b:[],Zc:[],Sj:[],Jh:null,Mb:{},Sb:null,nb:{sj:null,ji:null,Cf:[],Of:[]},Ml:[],OJ:null,S:null,Xd:!1,Mg:!1,mt:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,Au:0,Bu:0,eu:0,Cp:0,zc:new Float32Array(3),Rc:new Float32Array(16),yg:!1,Ua:!1,Ys:!1,ha:!1,nf:!1,hb:!1,nd:!1,ie:!1,Ic:!1,Jc:!1,kc:!1,qc:!1,gc:!1,Gc:!1,Pb:!1,wv:!1,Ne:W.wj,pf:W.Be,Ao:!1,Tg:!1,tE:"",ZJ:"",gu:!1,ku:0,hu:0,lu:0,mu:0,ju:new Float32Array(3),iu:new Float32Array(3),
Wg:!1,Ce:0,Oe:0,Bf:1,reflect_factor:0,Ch:0,fr:1,parallax_scale:0,Af:0,rf:1,Zu:0,kq:0,oh:0,Hv:0,Tc:Array(2),Kc:new Float32Array(3),fg:new Float32Array(3),se:new Float32Array(3),yc:new Float32Array(4),Pd:new Float32Array(4),xi:null,Xp:null,Vp:null,Up:null,Wp:null,ri:!1,ng:!1,water_dynamic:!1,On:!1,kx:!1,lx:0,mx:0,jx:0,uj:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,Ft:new Float32Array(2),Et:new Float32Array(2),op:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
nh:null,Jq:!1,za:null};a.yc[3]=1;a.Ys=!0;a.ha=!0;return a}function b(a){switch(a.type){case "MAIN":case "PARTICLES":a.fb=a.Ua?a.nf?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.fb=a.ri?"NODES":"DEPTH";break;case "COLOR_ID":a.fb=a.nf?"COLOR_ID_XRAY":"COLOR_ID"}}function c(a){var b=a.S;a.S=null;var c=ca.yf(a);a.S=b;c.S=b;return c}function m(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],h=e.ja.f,f=T.Id();T.bm(h.Wh,f);var g=e.data.b4w_bounding_cylinder_radius,l=e.data.b4w_bounding_sphere_radius,m=e.data.b4w_bounding_sphere_center,
n=e.data.b4w_bounding_ellipsoid_axes,q=e.data.b4w_bounding_ellipsoid_center;if(h.Jd){var g=Math.max(Math.abs(f.max_x),Math.abs(f.min_x)),l=Math.max(Math.abs(f.max_y),Math.abs(f.min_y)),r=Math.max(Math.abs(f.max_z),Math.abs(f.min_z)),r=Math.sqrt(g*g+l*l+r*r),g=Math.sqrt(g*g+l*l);f.max_x=f.max_y=f.max_z=r;f.min_x=f.min_y=f.min_z=-r;l=r;m[0]=m[1]=m[2]=0;n[0]=n[1]=n[2]=r;q[0]=q[1]=q[2]=0}h.Ub=f;r=T.so(f,h.h);h.wb=r;k(h,g,g,f);f=T.em(l,m);h.ud=f;f=T.vo(f,h.h);h.Vb=f;n=T.dm([n[0],0,0],[0,n[1],0],[0,0,n[2]],
q);h.tf=n;n=T.uo(n,h.h);h.Bg=n;c=c.concat(t(e,h,b))}return c}function e(a,b,c){for(var d=[],e=[],h={},f=0;f<a.length;f++){var g=a[f],k=g.ja.f,l=T.Id();T.bm(k.Wh,l);var m=T.so(l,k.h),n=T.em(g.data.b4w_bounding_sphere_radius,g.data.b4w_bounding_sphere_center),q=T.vo(n,k.h),r=g.data.b4w_bounding_ellipsoid_axes,r=T.dm([r[0],0,0],[0,r[1],0],[0,0,r[2]],g.data.b4w_bounding_ellipsoid_center),v=T.uo(r,k.h);k.Ub=l;k.wb=m;k.ud=n;k.Vb=q;k.tf=r;k.Bg=v;l={};l.Ic=k.Ic;l.Jc=k.Jc;l.kc=k.kc;l.df=k.df;l.Xm=k.Xm;l.Eb=
k.Eb;l.Wm=k.Wm;l.Li=k.Li;l.qc=k.qc;l.gc=k.gc;l.Gc=k.Gc;l.vd=k.vd;l.cd=k.cd;l.pe=k.pe;l.He=k.He;l.qd=k.qd;l.Xe=k.Xe;l.fc=k.fc;l.Jd=k.Jd;l.Dj=k.Dj;l.Cj=k.Cj;l.Pb=k.Pb;l.bi=k.bi;l.jm=k.jm;l.Ye=k.Ye;l.ih=k.ih;l.Om=k.Om;l.$c=k.$c;l.hh=k.hh;l.Pm=k.Pm;l.ie=k.ie;m=k.Vb.H;l.KC=0==c?[0,0]:[Math.floor(m[0]/c),Math.floor(m[2]/c)];l.Lf=k.Lf;l.Bk=k.Bk;l.gh=k.gh;l.km=k.km;k=JSON.stringify(l);h[k]=h[k]||[];h[k].push(g)}for(var p in h){l=JSON.parse(p);c=h[p];var g=ca.$h("STATIC"),x;for(x in l)g[x]=l[x];g.xc=a[0].ja.f.xc;
g.ze=0;g.mf=0;g.Le=0;g.Ke=0;g.Fe=0;g.Xg=!1;for(f=0;f<c.length;f++)k=c[f].ja,0==f?(g.wb=na.qa(k.f.wb),g.Vb=na.qa(k.f.Vb),g.tf=na.qa(k.f.tf),g.Bg=na.qa(k.f.Bg)):(T.yt(g.wb,k.f.wb),T.wB(g.Vb,k.f.Vb));g.Ub=na.qa(g.wb);g.ud=na.qa(g.Vb);e.push({f:g,Kz:c})}for(a=0;a<e.length;a++)for(h=e[a].f,f=e[a].Kz,p=0;p<f.length;p++){x=f[p];c=x.ja.f;g=t(x,h,b);k=ja.create();c.Jd&&!c.oo?(l=ja.get_trans_view(c.h),ja.set_trans(l,k)):ja.copy(c.h,k);l={};if(h.qd||h.Jd)l.au_center_pos=[k[0],k[1],k[2]];h.qd&&(l.au_wind_bending_amp=
[c.ze],l.au_wind_bending_freq=[x.b4w_wind_bending_freq],l.au_detail_bending_amp=[x.b4w_detail_bending_amp],l.au_detail_bending_freq=[x.b4w_detail_bending_freq],l.au_branch_bending_amp=[x.b4w_branch_bending_amp]);for(m=0;m<g.length;m++)r=g[m].f,n=g[m].jd,q=g[m].D,r.Im?r.Jd?W.LF(n,k):W.sw(n,k):("COLOR_ID"==q.type&&(g[m].f=c,q.Ki=x.uuid,u(q,c),r=Q(c),F(q,r)),n=W.sw(n,k),W.KF(n,l));d=d.concat(g)}return d}function t(a,b,c){var e=[],h=n(c,b),f=Q(b),k=a.data,l=k.materials,m=Array(l.length),q=ga.bb(c,"MAIN_OPAQUE"),
r=!1;q&&(r=q.Nm.length?!0:!1);for(var t=0;t<h.length;t++)for(var v=h[t],p=0;p<l.length;p++){var x=l[p];if(("LENS_FLARES"!=x.name||r)&&!W.nu(k,p)){var z=d(v);"COLOR_ID"==v&&(z.Ao=!(a.b4w_do_not_render||x.b4w_do_not_render));"MAIN"==v&&(m[p]=z);if(K(z,x)){"DEPTH"==v&&m[p]&&(z.nd=m[p].nd);z.Ne=b.Xd||b.ie?W.wl:W.wj;u(z,b);for(var y=z,U=a.particle_systems,I=0;I<U.length;I++){var A=U[I].settings.b4w_vcol_from_name,B=U[I].settings.b4w_vcol_to_name;""!==A&&""!==B&&(y.Mb[A]={Vg:!1,src:[{name:A,Dd:7}]})}"DYNAMIC"==
b.type&&(z.Ki=a.uuid);F(z,f);var C=W.Bt(k,p,z.Sj,b.Yh,z.Mb,z.Jh);"LENS_FLARES"==x.name&&(C=oa.pE(C));e.push({D:z,jd:C,Bc:[x.name],f:b,Td:[a]})}}}var E=a.particle_systems;if(0<E.length&&e.length){for(var J=!1,D=!1,t=0;t<E.length;t++){var G=E[t],V=G.settings;V.use_render_emitter&&(J=!0);"HAIR"!=V.type||"OBJECT"!=V.render_type&&"GROUP"!=V.render_type&&G.transforms.length||(D=!0);if(J&&D)break}var M=e[0].D.Mb,va;if(D){var N;if(1<l.length){for(var H={},T=0;T<E.length;T++){var R=E[T].settings;if("HAIR"==
R.type&&("OBJECT"==R.render_type||"GROUP"==R.render_type)){var fa=R.b4w_vcol_from_name,ma=R.b4w_vcol_to_name;""!==fa&&""!==ma&&(H[fa]=na.qa(M[fa]))}}"a_bending_col_main"in M&&(H.a_bending_col_main=na.qa(M.a_bending_col_main));"a_bending_col_detail"in M&&(H.a_bending_col_detail=na.qa(M.a_bending_col_detail));N=W.Ct(k,[],H)}else N=e[0].jd;va=N}else va=null;for(var S,aa=va,ua=a.ja,X=[],ha=a.particle_systems,ra=a.data,pa=0;pa<ha.length;pa++){var ca=ha[pa],ta=ca.settings;if(ta.count)if("EMITTER"==ta.type){if("DYNAMIC"==
b.type){var La=d("PARTICLES"),hb,Kb=ra.materials,Ac=ca.settings.material-1;Ac>=Kb.length&&(ia.warn('Wrong material used for rendering particle system "'+ca.name+'"'),Ac=0);hb=Kb[Ac];"HALO"===ca.settings.render_type&&(La.Wg=!0);g(La,hb);var Oa=La,ac=ca.settings;switch(ac.b4w_billboard_align){case "VIEW":w(Oa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":w(Oa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":w(Oa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":w(Oa,"BILLBOARD_ALIGN",
"BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}w(Oa,"BILLBOARD",0);w(Oa,"SOFT_PARTICLES",ac.b4w_enable_soft_particles&&0<ac.b4w_particles_softness&&ea.ak?1:0);w(Oa,"SOFT_STRENGTH",P.s(ac.b4w_particles_softness));P.I(Oa.nb,"WORLD_SPACE","WORLD"==ac.b4w_coordinate_system?1:0);La.ie=!0;La.Ki=ua.name+"_"+ta.uuid;La.tE=ca.name;F(La,f);oa.RC(La,ca,hb);var ab=oa.XB(La,ra,ca,ua.f.h);X.push({D:La,jd:ab,Bc:[hb.name],f:b,Td:[a]})}}else if("HAIR"==ta.type){var Ua=na.Em(ca.seed);ta.b4w_dynamic_grass&&
(b.bi=!0);var lb=L.Ts(ea.eq)&&!ta.b4w_initial_rand_rotation&&!ta.b4w_hair_billboard,Aa=4;lb&&(Aa=8);if(ca.transforms.length)var Ga=ca.transforms;else for(var Ba=W.xp(aa,ta.count,!1,Ua),Ga=new Float32Array(Ba.length*Aa),Ha=0;Ha<Ba.length;Ha++){var Bc=.75+.5*na.Fd(Ua);Ga[Ha*Aa]=Ba[Ha][0];Ga[Ha*Aa+1]=Ba[Ha][1];Ga[Ha*Aa+2]=Ba[Ha][2];Ga[Ha*Aa+3]=Bc;lb&&(Ga[Ha*Aa+4]=1,Ga[Ha*Aa+5]=0,Ga[Ha*Aa+6]=0,Ga[Ha*Aa+7]=0)}var Wb=ga.bb(c,"GRASS_MAP")?!0:!1;if("OBJECT"==ta.render_type)var Wa=[n(c,ta.dupli_object.ja.f,
!0)],rb=O(a,b,M,aa,[ta.dupli_object],Wa,[Ga],ta,ca,Wb,Ua,!1),X=X.concat(rb);else if("GROUP"==ta.render_type){for(var zb=ta.dupli_group.objects,Wa=[],Ha=0;Ha<zb.length;Ha++){var Cc=n(c,zb[Ha].ja.f,!0);Wa.push(Cc)}for(var eb=!1,Dc=[],Ha=0;Ha<zb.length;Ha++)Dc.push(zb[Ha].ja);if(ta.use_whole_group){for(var Ec,ob=Ga,Rb=Dc,Fc=lb,Gc=Aa,Bb={},Cb=new Float32Array([0,0,0,1]),Ta=0;Ta<ob.length;Ta+=Gc)for(var Ja=0;Ja<Rb.length;Ja++){var Xa=da.create(),nc=ja.get_scale(Rb[Ja].f.h),Mb=ja.get_trans_view(Rb[Ja].f.h);
da.scale(Mb,nc,Xa);var Nb=da.clone([ob[Ta],ob[Ta+1],ob[Ta+2]]);Bb[Ja]||(Bb[Ja]=new Float32Array(ob.length));Fc&&(Bb[Ja][Ta+4]=Cb[0]=ob[Ta+4],Bb[Ja][Ta+5]=Cb[1]=ob[Ta+5],Bb[Ja][Ta+6]=Cb[2]=ob[Ta+6],Bb[Ja][Ta+7]=Cb[3]=ob[Ta+7],na.Fq(Cb,Cb),na.XF(Xa,Cb,Xa));da.add(Nb,Xa,Nb);Bb[Ja][Ta]=Nb[0];Bb[Ja][Ta+1]=Nb[1];Bb[Ja][Ta+2]=Nb[2];Bb[Ja][Ta+3]=ob[Ta+3]}Ec=Bb;eb=!0}else{var Sb;if(ta.use_group_count){for(var sb=Ga,wb=Dc,vc=ta.dupli_weights,mc=Ua,vb=lb,Ob=Aa,pb={},Qa=[],Fa=0;Fa<wb.length;Fa++)for(var Ya=wb[Fa],
fb=Ya.ph||Ya.name,xa=0;xa<vc.length;xa++){var Db=vc[xa];fb==Db.name&&Qa.push(Db)}vc.length!=Qa.length&&ia.error("dupli weights match failed");for(Fa=0;Fa<sb.length;Fa+=Ob){for(var Za,bc=Qa,Ra=[0],yb=0;yb<bc.length;yb++)Ra[yb+1]=Ra[yb]+bc[yb].count;for(var mb=Ra[Ra.length-1]*na.Fd(mc),Tb=0,yb=0;yb<Ra.length;yb++)if(mb>=Ra[yb]&&mb<Ra[yb+1]){Tb=yb;break}Za=Tb;pb[Za]=pb[Za]||[];pb[Za].push(sb[Fa],sb[Fa+1],sb[Fa+2],sb[Fa+3]);vb&&pb[Za].push(sb[Fa+4],sb[Fa+5],sb[Fa+6],sb[Fa+7])}for(Za in pb)pb[Za]=new Float32Array(pb[Za]);
Sb=pb}else{for(var bb=Ga,Xb=Ua,cc=lb,jc=Aa,Pb=Dc.length,Va={},gb=0;gb<bb.length;gb+=jc){var Eb=Math.floor(Pb*na.Fd(Xb));Va[Eb]=Va[Eb]||[];Va[Eb].push(bb[gb],bb[gb+1],bb[gb+2],bb[gb+3]);cc&&Va[Eb].push(bb[gb+4],bb[gb+5],bb[gb+6],bb[gb+7])}for(Eb in Va)Va[Eb]=new Float32Array(Va[Eb]);Sb=Va}Ec=Sb}rb=O(a,b,M,aa,zb,Wa,Ec,ta,ca,Wb,Ua,eb);X=X.concat(rb)}"INSTANCE"==ta.b4w_wind_bend_inheritance&&ua.f.qd&&ia.warn('Emitter object "'+ua.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";
}S=X;e=J?e.concat(S):S}return e}function k(a,b,c,d){a.lo=T.gt(b,d);a.jo=T.et(c,d);a.ko=T.ft(b,d)}function n(a,b,c){var d;b.km&&!c?(d=[],b.df&&ga.bb(a,"COLOR_PICKING")&&d.push("COLOR_ID")):(d=["MAIN","NODES_GLOW"],(b.df&&ga.bb(a,"COLOR_PICKING")||b.Eb&&ga.bb(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID"),ga.bb(a,"WIREFRAME")&&d.push("WIREFRAME"),((b.Ic||b.kc)&&ga.bb(a,"DEPTH")||ga.bb(a,"SHADOW_CAST"))&&d.push("DEPTH"),ga.bb(a,"GRASS_MAP")&&d.push("GRASS_MAP"));d.push("PHYSICS");if(b.Jc||b.gc)for(a=null,
b.Jc&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.gc&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?na.rz(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function g(a,b){var c;switch(a.type){case "MAIN":if(b.b4w_do_not_render)c=!1;else{if(b.use_nodes)q(a,b,"MAIN");else{l(a,b);var d=b.game_settings.alpha_blend;a.nf=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;a.oh=b.offset_z;a.fg.set([1,1,1]);var e=b.texture_slots;ua.set(b.diffuse_color[0],
b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.yc);switch(b.name){case "LENS_FLARES":D(a,"special_lens_flares.glslv","special_lens_flares.glslf");E(a,"a_position");E(a,"a_texcoord");var f=h(e[0],null);G(a,f);break;default:D(a,"main_stack.glslv","main_stack.glslf");b.use_shadeless||(c=X.Po(b.uuid,b.name,{nd:b.use_shadeless,bk:b.diffuse_shader,aj:b.specular_shader}),a.nb.Of=X.$l(c));var g=v("use_map_color_diffuse",e),k=v("use_map_color_spec",e),m=v("use_map_normal",e),n=v("use_map_mirror",e),f=v("use_stencil",
e);c=g[0];k=k[0];m=m[0];n=n[0];g=g[1];e=f[0]&&v("use_rgb_to_intensity",e)[0];if(c){switch(c.blend_type){case "MIX":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}f=h(c,null);G(a,f,"u_colormap0");ea.Zn&&"CLIP"==d&&va.Uk(f,va.Nc,va.Nc);a.Af=c.diffuse_color_factor;a.rf=c.use_map_alpha?c.alpha_factor:0;a.fg.set(c.scale)}d=c&&c==k;k&&(d||(f=h(k,null),G(a,f,"u_specmap0")),a.Ch=k.specular_color_factor);if(m&&(E(a,"a_normal"),
E(a,"a_tangent"),f=h(m,null),G(a,f,"u_normalmap0"),a.Zu=m.normal_factor,f=m.texture,f.b4w_use_map_parallax&&ea.Hk)){var r=P.s(f.b4w_parallax_steps),t=P.s(f.b4w_parallax_lod_dist);w(a,"PARALLAX",1);w(a,"PARALLAX_STEPS",r);w(a,"PARALLAX_LOD_DIST",t);a.parallax_scale=f.b4w_parallax_scale}n&&(f=h(n,null),G(a,f,"u_mirrormap"),a.kq=n.mirror_factor);if(n=c&&g&&e?1:0)f=h(g,null),G(a,f,"u_colormap1"),f=h(e,null),G(a,f,"u_stencil0");(f=c||k||m)&&a.fg.set(f.scale);w(a,"TEXTURE_SPEC",void 0==k?0:1);w(a,"ALPHA_AS_SPEC",
d?1:0);w(a,"TEXTURE_STENCIL_ALPHA_MASK",n);E(a,"a_position");E(a,"a_normal");(c||k||m)&&E(a,"a_texcoord");if(b.b4w_water){a.ng=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.Ua?(ia.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),a.On=!1):a.On=b.b4w_water_shore_smoothing;D(a,"special_water.glslv","special_water.glslf");d=X.Po(b.uuid,b.name,{nd:!1,bk:b.diffuse_shader,aj:b.specular_shader});a.nb.Of=X.$l(d);E(a,"a_position");ea.nx?(E(a,"a_polyindex"),a.ha=
!0,a.wireframe_edge_color=[0,0,0],w(a,"DEBUG_WIREFRAME",1)):w(a,"DEBUG_WIREFRAME",0);n=b.texture_slots;d=v("use_map_normal",n);f=v("use_map_mirror",n)[0];d.length&&(r=h(d[0]),G(a,r,"u_normalmap0"),a.uj=b.b4w_water_norm_uv_velocity);w(a,"NUM_NORMALMAPS",d.length);a.nh=Array(d.length);for(r=0;r<d.length;r++)a.nh[r]=new Float32Array(2),a.nh[r].set([d[r].scale[0],d[r].scale[1]]);f&&(r=h(f),G(a,r,"u_mirrormap"),a.kq=f.mirror_factor);f=null;if(ea.hi)for(r=0;r<n.length;r++){var u=n[r];if(!0===u.texture.b4w_water_foam){f=
u;break}}f?(w(a,"FOAM",1),r=h(f),G(a,r,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.Ft.set(f.texture.b4w_foam_uv_freq),a.Et.set(f.texture.b4w_foam_uv_magnitude),a.op[0]=f.scale[0],a.op[1]=f.scale[1]):w(a,"FOAM",0);for(r=0;r<n.length;r++)if(u=n[r],!0===u.texture.b4w_shore_dist_map){var p=u;break}p&&ea.Yn?(p=h(p),G(a,p,"u_shore_dist_map"),w(a,"SHORE_PARAMS",1),p=u.texture.b4w_shore_boundings,w(a,"MAX_SHORE_DIST",P.s(u.texture.b4w_max_shore_dist)),w(a,"SHORE_MAP_SIZE_X",P.s(p[0]-p[1])),w(a,"SHORE_MAP_SIZE_Y",
P.s(p[2]-p[3])),w(a,"SHORE_MAP_CENTER_X",P.s((p[0]+p[1])/2)),w(a,"SHORE_MAP_CENTER_Y",P.s((p[2]+p[3])/2))):w(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh&&ea.ak)w(a,"GENERATED_MESH",1),a.kx=!0,a.lx=b.b4w_water_num_cascads,a.mx=b.b4w_water_subdivs,a.jx=b.b4w_water_detailed_dist;else{E(a,"a_normal");if(f||d.length)E(a,"a_texcoord"),E(a,"a_tangent");w(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){var u=P.s(b.b4w_water_dst_noise_scale0),p=P.s(b.b4w_water_dst_noise_scale1),d=P.s(b.b4w_water_dst_noise_freq0),
n=P.s(b.b4w_water_dst_noise_freq1),f=P.s(b.b4w_water_dir_min_shore_fac),r=P.s(b.b4w_water_dir_freq),t=P.s(b.b4w_water_dir_noise_scale),L=P.s(b.b4w_water_dir_noise_freq),z=P.s(b.b4w_water_dir_min_noise_fac),y=P.s(b.b4w_water_dst_min_fac),F=P.s(b.b4w_water_waves_hor_fac);w(a,"DST_NOISE_SCALE_0",u);w(a,"DST_NOISE_SCALE_1",p);w(a,"DST_NOISE_FREQ_0",d);w(a,"DST_NOISE_FREQ_1",n);w(a,"DIR_MIN_SHR_FAC",f);w(a,"DIR_FREQ",r);w(a,"DIR_NOISE_SCALE",t);w(a,"DIR_NOISE_FREQ",L);w(a,"DIR_MIN_NOISE_FAC",z);w(a,"DST_MIN_FAC",
y);w(a,"WAVES_HOR_FAC",F)}A(a,b);B(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;w(a,"ABSORB",P.s(b.b4w_water_absorb_factor));w(a,"SSS_STRENGTH",P.s(b.b4w_water_sss_strength));w(a,"SSS_WIDTH",P.s(b.b4w_water_sss_width))}"HALO"===b.type&&(u=b.halo,D(a,"halo.glslv","halo.glslf"),w(a,"NUM_RINGS",u.ring_count),w(a,"NUM_LINES",u.line_count),w(a,"NUM_STARS",
u.star_tip_count),w(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.Sj=["a_position"],a.ku=u.size,a.hu=u.hardness/20,a.ju.set(u.b4w_halo_rings_color),a.iu.set(u.b4w_halo_lines_color),a.lu=1/b.b4w_halo_stars_blend_height,a.mu=b.b4w_halo_stars_min_height,a.gu=!0);w(a,"TEXCOORD",0);w(a,"NORMAL_TEXCOORD",0);c&&x(a,c,"TEXTURE_COLOR0_CO");g&&x(a,g,"TEXTURE_COLOR1_CO");e&&x(a,e,"TEXTURE_STENCIL_ALPHA_MASK_CO");k&&x(a,k,"TEXTURE_SPEC_CO");m&&x(a,m,"TEXTURE_NORM_CO");w(a,"SHADELESS",b.use_shadeless?1:0);a.nd=b.use_shadeless}d=
b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===d?0:1);w(a,"ALPHA_CLIP","CLIP"===d?1:0);w(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(w(a,"VERTEX_COLOR",1),E(a,"a_color")):w(a,"VERTEX_COLOR",0);a.Ce=b.ambient;a.Bf=b.diffuse_intensity;a.Oe=b.emit;a.se.set(b.specular_color);a.fr=b.specular_alpha;A(a,b);B(a,b);b.b4w_wettable?w(a,"WETTABLE",1):w(a,"WETTABLE",0);C(a,b);a.Jq=b.b4w_refractive;a.Hv=b.b4w_refr_bump}c=!0}break;case "NODES_GLOW":c=q(a,b,"GLOW");break;
case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)c=!1;else if(l(a,b),a.Ua)c=!1;else{k=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==k?q(a,b,"DEPTH"):(D(a,"depth.glslv","depth.glslf"),ua.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.yc));E(a,"a_position");E(a,"a_normal");w(a,"ALPHA","OPAQUE"===k?0:1);a.fg.set([1,1,1]);if((c=v("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===k){a.fg.set(c.scale);w(a,"TEXTURE_COLOR",1);E(a,"a_texcoord");
if("IMAGE"==c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source)k=h(c),G(a,k,"u_colormap0");"NONE"==c.texture.k.source&&(k=h(c),G(a,k,"u_colormap0"))}else w(a,"TEXTURE_COLOR",0);c=!0}break;case "PHYSICS":b.b4w_collision?(a.ll=b.b4w_use_ghost,a.Ka=b.b4w_collision_id,a.Pj=b.b4w_collision_margin,a.Nj=b.b4w_collision_group,a.Qj=b.b4w_collision_mask,a.lk=b.physics.friction,a.gk=b.physics.elasticity,c=!0):b.b4w_water?(a.ng=!0,a.fH=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,
a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,c=!0):c=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||
"HALO"===b.type)c=!1;else{l(a,b);a.pf=W.Be;a.ha=!0;a.Ua=!1;k=b.game_settings.alpha_blend;a.nf=b.b4w_render_above_all&&"OPAQUE"!=k&&"CLIP"!=k;b.use_nodes&&"CLIP"==k?q(a,b,"COLOR_ID"):(D(a,"color_id.glslv","color_id.glslf"),ua.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.yc));E(a,"a_position");w(a,"ALPHA","OPAQUE"===k?0:1);a.fg.set([1,1,1]);if((c=v("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===k){a.fg.set(c.scale);w(a,"TEXTURE_COLOR",1);E(a,"a_texcoord");if("IMAGE"==
c.texture.k.source||"ENVIRONMENT_MAP"==c.texture.k.source)k=h(c),G(a,k,"u_colormap0");"NONE"==c.texture.k.source&&(k=h(c),G(a,k,"u_colormap0"))}else w(a,"TEXTURE_COLOR",0);c=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?c=!1:(l(a,b),a.Ua=!1,a.pf=W.Be,a.ha=!0,D(a,"grass_map.glslv","grass_map.glslf"),E(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,k=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.Mb.a_grass_size={Vg:!0,src:[]},c?(a.Mb.a_grass_size.src.push({name:c,
Dd:4}),w(a,"DYNAMIC_GRASS_SIZE",1)):w(a,"DYNAMIC_GRASS_SIZE",0),a.Mb.a_grass_color={Vg:!0,src:[]},k?(a.Mb.a_grass_color.src.push({name:k,Dd:7}),w(a,"DYNAMIC_GRASS_COLOR",1)):w(a,"DYNAMIC_GRASS_COLOR",0),c=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?c=!1:(D(a,"wireframe.glslv","wireframe.glslf"),E(a,"a_position"),E(a,"a_normal"),E(a,"a_polyindex"),a.ha=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],c=!0);break;case "PARTICLES":if(b.b4w_do_not_render)c=
!1;else{c=b.texture_slots;if(a.Wg)D(a,"particles_color.glslv","particles_color.glslf");else if(D(a,"particles_texture.glslv","particles_texture.glslf"),k=X.Po(b.uuid,b.name,{nd:!1,bk:b.diffuse_shader,aj:b.specular_shader}),a.nb.Of=X.$l(k),c=v("use_map_color_diffuse",c)[0]){w(a,"TEXTURE_COLOR",1);switch(c.blend_type){case "MIX":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Af=c.diffuse_color_factor;a.rf=c.use_map_alpha?
c.alpha_factor:0;c=h(c);G(a,c)}ua.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.yc);a.Ce=b.ambient;a.Bf=b.diffuse_intensity;a.Oe=b.emit;a.se.set(b.specular_color);a.fr=b.specular_alpha;E(a,"a_position");E(a,"a_normal");c=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===c?0:1);w(a,"ALPHA_CLIP","CLIP"===c?1:0);w(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);A(a,b);B(a,b);l(a,b);c=b.game_settings.alpha_blend;a.nf=b.b4w_render_above_all&&"OPAQUE"!=c&&"CLIP"!=c;a.oh=b.offset_z;
c=!0}break;default:throw"Wrong batch type: "+a.type;}return c}function x(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":w(a,c,"TEXTURE_COORDS_UV_ORCO");w(a,"TEXCOORD",1);break;case "NORMAL":w(a,c,"TEXTURE_COORDS_NORMAL");w(a,"NORMAL_TEXCOORD",1);break;default:w(a,c,0)}}function l(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.Ua=!0;a.pf=W.es;a.ha=!0;a.yg=!1;break;case "ALPHA":a.Ua=!0;a.pf=W.Be;a.ha=!0;a.yg=!1;break;case "CLIP":a.Ua=!1;a.pf=W.Be;a.ha=!0;a.yg=!0;break;
case "ADD":a.Ua=!0;a.pf=W.Be;a.ha=!1;a.yg=!1;break;case "OPAQUE":a.Ua=!1;a.pf=W.Be;a.ha=!0;a.yg=!1;break;default:throw Error("Unknown alpha blend mode: "+d);}a.hb=c.use_backface_culling}function h(a,b){var c=a.texture,d=c.k,c=c.image;d&&b&&c&&va.hl(d,b,c.Oc,c.filepath);return d}function v(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var h=b[e];1==h[a]&&h.texture&&h.texture.k&&c.push(h)}return c}function C(a,b){var c=b.raytrace_transparency;a.Pd[0]=c.fresnel;a.Pd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;
a.reflect_factor=c.reflect_factor;a.Pd[2]=c.fresnel;a.Pd[3]=1-c.fresnel_factor/5}function A(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;d=b.specular_toon_smooth;break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:ia.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.Kc[0]=b.specular_intensity;a.Kc[1]=
c;a.Kc[2]=d}function B(a,b){switch(b.diffuse_shader){case "LAMBERT":a.Tc[0]=0;a.Tc[1]=0;break;case "OREN_NAYAR":a.Tc[0]=b.roughness;a.Tc[1]=0;break;case "FRESNEL":a.Tc[0]=b.diffuse_fresnel;a.Tc[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.Tc[0]=b.darkness;a.Tc[1]=0;break;case "TOON":a.Tc[0]=b.diffuse_toon_size;a.Tc[1]=b.diffuse_toon_smooth;break;default:ia.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.Tc[0]=0,a.Tc[1]=0}}function q(a,b,c){if(!b.use_nodes||
b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":D(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":D(a,"main.glslv","main.glslf");d=!0;break;case "DEPTH":D(a,"depth.glslv","depth.glslf");d=!1;break;case "COLOR_ID":D(a,"color_id.glslv","color_id.glslf"),d=!1}c=X.nA(b.node_tree,b.uuid,!1,b.name,c);if(!c)return ia.error('Failed to create node graph for material "'+b.name+'", disable nodes'),z(a,b),!0;a.ri=!0;w(a,"NODES",1);w(a,"NODES_GLOW",d?1:0);var e=b.game_settings.alpha_blend;w(a,"ALPHA",
"OPAQUE"===e?0:1);w(a,"ALPHA_CLIP","CLIP"===e?1:0);w(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);E(a,"a_position");b.use_orco_tex_coord&&E(a,"a_orco_tex_coord");l(a,b);a.oh=b.offset_z;e=b.game_settings.alpha_blend;a.nf=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e;ua.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.yc);a.Oe=b.emit;a.Ce=b.ambient;C(a,b);b.b4w_wettable?w(a,"WETTABLE",1):w(a,"WETTABLE",0);a.nb.Of=X.$l(c);var h=!1;S.aa(c,function(b,c){switch(c.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var d=
c.data.name,f=c.data.value;a.Jh||(a.Jh={});a.Jh[f]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.Mb[d]={Vg:!0,src:[{name:c.data.value}]};f=0;if("GEOMETRY_VC"==c.type)f=7;else for(var g=0;g<c.ra.length;g++){var k="RGB".indexOf(c.ra[g].identifier);-1<k&&(f|=1<<2-k)}a.Mb[d].src[0].Dd=f;break;case "TEX_COORD_NO":case "GEOMETRY_NO":E(a,"a_normal");break;case "MATERIAL_BEGIN":E(a,"a_normal");h=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=
c.data.name;f=c.data.value;!1!==f.k.Gl&&(f.k.Gl="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);G(a,f.k,d);ea.Zn&&"CLIP"==e&&va.Uk(c.data.value.k,va.Nc,va.Nc);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":w(a,"CALC_TBN_SPACE",1);E(a,"a_normal");E(a,"a_tangent");d=c.data.name;f=c.data.value;f.k.Gl=!1;G(a,f.k,d);break;case "LAMP":c.data&&(a.xi=c.data);break;case "B4W_REFRACTION":a.Jq=!0}});h||(a.nd=!0);return!0}function z(a,b){switch(a.type){case "DEPTH":D(a,"depth.glslv","depth.glslf");break;case "COLOR_ID":D(a,
"color_id.glslv","color_id.glslf");break;default:D(a,"main_stack.glslv","main_stack.glslf")}w(a,"SHADELESS",1);E(a,"a_position");E(a,"a_normal");ua.set(1,0,1,1,a.yc);if(b){var c=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===c?0:1);w(a,"ALPHA_CLIP","CLIP"===c?1:0);w(a,"VERTEX_COLOR",0);a.oh=b.offset_z;l(a,b)}return!0}function u(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Im?w(a,"AU_QUALIFIER","attribute"):w(a,"AU_QUALIFIER","uniform"),w(a,"STATIC_BATCH",0)):(w(a,"AU_QUALIFIER","attribute"),
w(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(aa.BC()?w(a,"WIREFRAME_QUALITY",1):w(a,"WIREFRAME_QUALITY",0),a.Mg?(w(a,"DEBUG_SPHERE",1),a.mt?w(a,"DEBUG_SPHERE_DYNAMIC",1):w(a,"DEBUG_SPHERE_DYNAMIC",0)):w(a,"DEBUG_SPHERE",0),w(a,"ALPHA",1));b.Xd&&(a.Xd=b.Xd);b.qd?(""!==b.Xe?(a.Mb.a_bending_col_main={Vg:!0,src:[{name:b.Xe,Dd:4}]},E(a,"a_bending_col_main"),""!==b.fc.Fu&&""!==b.fc.Eu&&""!==b.fc.iv?(a.Mb.a_bending_col_detail={Vg:!0,src:[{name:b.fc.Fu,Dd:4},{name:b.fc.Eu,Dd:2},{name:b.fc.iv,Dd:1}]},E(a,
"a_bending_col_detail"),E(a,"a_normal"),w(a,"DETAIL_BEND",1)):w(a,"DETAIL_BEND",0),w(a,"MAIN_BEND_COL",1)):w(a,"MAIN_BEND_COL",0),w(a,"WIND_BEND",1)):w(a,"WIND_BEND",0);b.Ql?w(a,"BEND_CENTER_ONLY",1):w(a,"BEND_CENTER_ONLY",0);w(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.oo|0);b.Jd?w(a,"BILLBOARD",1):w(a,"BILLBOARD",0);b.Jd&&b.Im?w(a,"HAIR_BILLBOARD",1):w(a,"HAIR_BILLBOARD",0);b.Cj?w(a,"BILLBOARD_SPHERICAL",1):w(a,"BILLBOARD_SPHERICAL",0);switch(b.Dj){case "RANDOM":w(a,"BILLBOARD_RANDOM",1);w(a,"BILLBOARD_JITTERED",
0);break;case "JITTERED":w(a,"BILLBOARD_RANDOM",0);w(a,"BILLBOARD_JITTERED",1);break;default:w(a,"BILLBOARD_RANDOM",0),w(a,"BILLBOARD_JITTERED",0)}b.Pb&&ea.Yn?w(a,"DYNAMIC_GRASS",1):w(a,"DYNAMIC_GRASS",0);a.Pb=b.Pb;a.ie=b.ie;a.Ic=b.Ic;a.Jc=b.Jc;a.kc=b.kc&&!a.nd&&!(a.Ua&&ea.cp);a.qc=b.qc;a.gc=b.gc;a.Gc=b.Gc;b.vi?(E(a,"a_influence"),w(a,"SKINNED",1),ea.$n?(w(a,"DISABLE_TANGENT_SKINNING",1),w(a,"FRAMES_BLENDING",0)):(w(a,"DISABLE_TANGENT_SKINNING",0),b.kk?w(a,"FRAMES_BLENDING",1):w(a,"FRAMES_BLENDING",
0)),w(a,"MAX_BONES",b.Ze)):(w(a,"SKINNED",0),w(a,"FRAMES_BLENDING",0),w(a,"DISABLE_TANGENT_SKINNING",0));b.ac?(w(a,"VERTEX_ANIM",1),ea.bx?w(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):w(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):w(a,"VERTEX_ANIM",0);if(b.vi&&b.ac)throw"Skinning and vertex animation are mutually exlusive";b.jm?w(a,"DISABLE_FOG",1):w(a,"DISABLE_FOG",0);if(a.ri){for(var c=a.nb.Of,d=b.ih,e=b.hh,h=0;h<c.length;h++){var f=c[h];switch(f.id){case "VALUE":var g=f.Ym[0];if(g)for(var k=
0;k<d.length;k+=2)if(d[k]==g){f.xd.push(["VALUE_IND",d[k+1]]);break}break;case "RGB":if(g=f.Ym[0])for(k=0;k<e.length;k+=2)if(e[k]==g){f.xd.push(["RGB_IND",e[k+1]]);break}}}w(a,"NUM_VALUES",b.Ye.length);w(a,"NUM_RGBS",b.$c.length)}}}function r(a,b,c){if(b.length){for(var d=ca.wm(b)||b[0],e=a.nb,h=0,g=0;g<a.nb.Of.length;g++){var k=a.nb.Of[g];if("LIGHTING_LAMP"==k.id){var l=b[h++%b.length],m=l.Fa;"AREA"==m.type&&(l=b[h++%b.length],m=l.Fa);var n=ca.Sa(l,c);if("SPOT"==m.type||"POINT"==m.type)var q=Math.cos(m.gf/
2);if("SPOT"==m.type)var r=m.Zk*(1-q);n=n.dh;l=l==d?0:-1;k.xd=[["LAMP_TYPE",m.type],["LAMP_IND",n],["LAMP_LIGHT_FACT_IND",Math.floor(n/2)],["LAMP_FAC_CHANNELS",0==n%2?"rg":"ba"],["LAMP_SPOT_SIZE",P.s(q||.01)],["LAMP_SPOT_BLEND",P.s(r||.01)],["LAMP_LIGHT_DIST",P.s(m.distance)],["LAMP_SHADOW_MAP_IND",l]]}}if(a.xi){c=0;for(var t in a.xi)c++;a.Xp=new Float32Array(3*c);a.Vp=new Float32Array(3*c);a.Up=new Float32Array(3*c);a.Wp=new Float32Array(4*c);P.I(e,"NUM_LAMP_LIGHTS",c);for(g=0;g<b.length;g++)f(a,
b[g])}}}function f(a,b){if(b.Ih in a.xi){var c=a.xi[b.Ih],d=ja.get_trans_view(b.f.h);a.Xp.set(d,3*c);a.Vp.set(b.Fa.direction,3*c);a.Up.set(b.Fa.Rj,3*c);var d=H,e=b.Fa;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.Hh?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var h=d[0]=Math.cos(e.gf/2);d[1]=e.Zk*(1-h)}a.Wp.set(d,4*c)}}function E(a,b){var c=a.Sj;-1==c.indexOf(b)&&c.push(b)}function w(a,b,c){P.I(a.nb,b,c)}function N(a,b){if("PHYSICS"==a.type)0<b.fa.length&&W.MF(b,b.A[0]),a.jd=
b;else{var c=a.pf,d=a.Ne;a.gu&&(b=W.CB(b));a.kx&&(b=fa.bC(a.lx,a.mx,a.jx));c=W.OF(b,c,d,a.Mb);a.S=c;a.ie||c.Dm||a.Xd||(c.If=null,c.od=null);c=b.A.length;a.num_vertices=b.U*c;a:switch(a.Ne){case W.wj:case W.xl:case W.wl:d=!0;break a;default:d=!1}d?W.$C(b)?a.num_triangles=b.xa.length/3*c:a.num_triangles=b.U/3*c:a.num_triangles=0}}function O(a,b,c,e,h,f,g,k,l,m,n,q){var r=a.ja,t=[],p=k.b4w_dynamic_grass;if(!m&&p)return t;for(var v="INSTANCE"==k.b4w_wind_bend_inheritance,x="INSTANCE"==k.b4w_shadow_inheritance,
z="INSTANCE"==k.b4w_reflection_inheritance,y=[],U=[],I=0;I<h.length;I++){var A=h[I].ja.f,w=na.Mj(b);w.Jd=k.b4w_hair_billboard;w.Dj=k.b4w_hair_billboard_type;w.Cj="SPHERICAL"==k.b4w_hair_billboard_geometry;w.Pb=p;w.Im=!0;w.Ye=A.Ye;w.ih=A.ih;w.$c=A.$c;w.hh=A.hh;v?(w.qd=A.qd,w.rl=A.rl,w.mf=A.mf,w.Le=A.Le,w.Xe=A.Xe,w.Ke=A.Ke,w.Fe=A.Fe,w.ze=A.ze,w.fc=A.fc,w.Ql=!1):(w.qd=r.f.qd,w.rl=r.f.rl,w.mf=r.f.mf,w.Le=r.f.Le,w.Xe=r.f.Xe,w.Ke=r.f.Ke,w.Fe=r.f.Fe,w.ze=r.f.ze,w.fc=r.f.fc,w.Ql=!0);x?(w.Ic=A.Ic,w.Jc=A.Jc,
w.kc=A.kc):(w.Ic=r.f.Ic,w.Jc=r.f.Jc,w.kc=r.f.kc);z?(w.qc=A.qc,w.gc=A.gc,w.Gc=A.Gc,w.vd=A.vd,w.cd=A.cd,w.pe=A.pe):(w.qc=r.f.qc,w.gc=r.f.gc,w.Gc=r.f.Gc,w.vd=r.f.vd,w.cd=r.f.cd,w.pe=r.f.pe);y.push(w);var B=g[I];B||(B=new Float32Array);q&&na.Em(l.seed,n);var P=new Float32Array(3),ga=new Float32Array([0,0,0,1]),C=[],E=L.Ts(ea.eq)&&!k.b4w_initial_rand_rotation&&!k.b4w_hair_billboard,J=4;E&&(J=8);for(var D=0;D<B.length;D+=J){P[0]=B[D];P[1]=B[D+1];P[2]=B[D+2];var G=B[D+3]*ja.get_scale(A.h);if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var V=
new Float32Array([na.Fd(n),na.Fd(n),na.Fd(n)]);da.normalize(V,V);break;case "Z":V=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}ma.setAxisAngle(V,k.b4w_rand_rotation_strength*(2*Math.PI*na.Fd(n)-Math.PI),ga)}else if(E&&(ga.set(B.subarray(D+4,D+8)),na.Fq(ga,ga),!k.use_whole_group))if(k.use_rotation_dupli){var M=ja.get_quat_view(A.h);ma.multiply(ga,M,ga)}else ma.multiply(ga,ta,ga);var va=ja.set_sep(P,G,ga,ja.create());C.push(va)}U.push(C)}for(var N=
{},I=0;I<h.length;I++){var H=h[I],T=f[I],w=y[I],O={};w.qd&&(O.au_wind_bending_amp=[w.ze],O.au_wind_bending_freq=[w.mf],O.au_detail_bending_freq=[w.Le],O.au_detail_bending_amp=[w.Ke],O.au_branch_bending_amp=[w.Fe],w.ze=0,w.mf=0,w.Le=0,w.Ke=0,w.Fe=0);var R=Q(w),C=U[I];if(C.length)for(var oa=H.data,fa=oa.materials,S=Array(fa.length),D=0;D<fa.length;D++)if(!W.nu(oa,D))for(var aa=0;aa<T.length;aa++){var ua=T[aa],X=d(ua),ha=fa[D];"COLOR_ID"==ua&&(X.Ao=!(H.b4w_do_not_render||ha.b4w_do_not_render));"MAIN"==
ua&&(S[D]=X);if(K(X,ha)){"DEPTH"==ua&&S[D]&&(X.nd=S[D].nd);X.Ne=W.wj;u(X,w);X.Ki=k.uuid;"JITTERED"==k.b4w_hair_billboard_type&&(X.Au=k.b4w_hair_billboard_jitter_amp,X.Bu=k.b4w_hair_billboard_jitter_freq);p&&(X.eu=k.b4w_dynamic_grass_scale_threshold);v||(delete X.Mb.a_bending_col_main,delete X.Mb.a_bending_col_detail);F(X,R);var ra=W.Bt(oa,D,X.Sj,b.Yh,X.Mb,X.Jh),ca=W.GD(ra,O,C),pa=ca,ac=C;pa.R.au_center_pos=new Float32Array(3*pa.U);for(var ab=ac.length,Ua=pa.U/ab,lb=0;lb<ab;lb++)for(var Aa=ac[lb],
Ga=3*Ua*lb,Ba=0;Ba<Ua;Ba++)pa.R.au_center_pos[Ga+3*Ba]=Aa[0],pa.R.au_center_pos[Ga+3*Ba+1]=Aa[1],pa.R.au_center_pos[Ga+3*Ba+2]=Aa[2];ca=pa;if(w.qd&&w.Ql){var Ha=ca,Bc=r.f.h;Ha.R.a_emitter_center=new Float32Array(3*Ha.U);var Wb=da.fromValues(0,0,0);ja.transform_vec3(Wb,Bc,Wb);for(var Wa=0;Wa<Ha.U;Wa++)Ha.R.a_emitter_center[3*Wa]=Wb[0],Ha.R.a_emitter_center[3*Wa+1]=Wb[1],Ha.R.a_emitter_center[3*Wa+2]=Wb[2];ca=Ha}var rb=k.b4w_vcol_from_name,zb=k.b4w_vcol_to_name,Cc=X,eb=c,Dc=!v,Ec=oa,ob=[];if(""!==rb&&
""!==zb){var Rb,Fc=zb,Gc=Cc.Mb,Bb=[],Cb=void 0;for(Cb in Gc)for(var Ta=Gc[Cb].src,Ja=0,Xa=0;Xa<Ta.length;Xa++){var nc=Ta[Xa].Dd;Fc==Ta[Xa].name&&Bb.push(Cb,nc,Ja);Ja+=na.zh(nc)}Rb=Bb;if(0<Rb.length)for(var Mb=0;Mb<Rb.length;Mb+=3)ob.push({hk:rb,om:7,Zm:Rb[Mb],$m:Rb[Mb+1],lm:Rb[Mb+2]});else W.LC(Cc.Sj,"a_color")&&zb==Ec.active_vcol_name&&ob.push({hk:rb,om:7,Zm:"a_color",$m:7,lm:0})}Dc&&("a_bending_col_main"in eb&&ob.push({hk:"a_bending_col_main",om:4,Zm:"a_bending_col_main",$m:4,lm:0}),"a_bending_col_detail"in
eb&&ob.push({hk:"a_bending_col_detail",om:7,Zm:"a_bending_col_detail",$m:7,lm:0}));for(var Nb=ca,Sb=C,sb=e,wb=ob,vc=X.Mb,mc=!1,vb=0;vb<wb.length;vb++){var Ob=wb[vb].hk,pb=sb.R[Ob];if(pb&&0<pb.length){mc=!0;break}}if(mc){var Qa,Fa=r.f.Ub,Ya=sb.A[0].a_position,fb=Sb,xa=N,Db=new Float32Array(3),Za=new Float32Array(3),bc=new Uint32Array(fb.length);if(!("verts_indices"in xa)){xa.Ie=new Float32Array(3);xa.Ee=new Float32Array(3);xa.Kr=new Uint32Array(Ya.length/3);xa.Dk=new Uint32Array(Ya.length/3);xa.Ie[0]=
(Fa.max_x-Fa.min_x)/20;xa.Ie[1]=(Fa.max_y-Fa.min_y)/20;xa.Ie[2]=(Fa.max_z-Fa.min_z)/20;xa.Ee[0]=Fa.min_x;xa.Ee[1]=Fa.min_y;xa.Ee[2]=Fa.min_z;for(var Ra=0;Ra<Ya.length/3;Ra++){var yb=na.trunc((Ya[3*Ra]-xa.Ee[0])/xa.Ie[0]),mb=na.trunc((Ya[3*Ra+1]-xa.Ee[1])/xa.Ie[1]),Tb=na.trunc((Ya[3*Ra+2]-xa.Ee[2])/xa.Ie[2]),yb=na.clamp(yb,0,19),mb=na.clamp(mb,0,19),Tb=na.clamp(Tb,0,19);xa.Kr[Ra]=Ra;xa.Dk[Ra]=Tb*Math.pow(20,2)+20*mb+yb}W.hw(xa.Dk,xa.Kr,W.Vn,!0);xa.Lh=new Uint32Array(Math.pow(20,3));for(Ra=0;Ra<xa.Dk.length;Ra++)xa.Lh[xa.Dk[Ra]]++;
delete xa.Dk;for(Ra=1;Ra<xa.Lh.length;Ra++)xa.Lh[Ra]+=xa.Lh[Ra-1]}for(var bb=0;bb<fb.length;bb++){Db[0]=fb[bb][0];Db[1]=fb[bb][1];Db[2]=fb[bb][2];for(var Xb=1E10,cc=-1,jc=na.trunc((Db[0]-xa.Ee[0])/xa.Ie[0]),Pb=na.trunc((Db[1]-xa.Ee[1])/xa.Ie[1]),Va=na.trunc((Db[2]-xa.Ee[2])/xa.Ie[2]),jc=na.clamp(jc,0,19),Pb=na.clamp(Pb,0,19),Va=na.clamp(Va,0,19),gb=Va*Math.pow(20,2)+20*Pb+jc,Eb=xa.Lh[gb],cb=0==gb?0:xa.Lh[gb-1];cb<Eb;cb++){var Yb=xa.Kr[cb];Za[0]=Ya[3*Yb];Za[1]=Ya[3*Yb+1];Za[2]=Ya[3*Yb+2];da.sub(Za,
Db,Za);var Fb=da.sqrLen(Za);Fb<=Xb&&(Xb=Fb,cc=Yb)}if(-1==cc)for(cb=0;cb<Ya.length/3;cb++)Za[0]=Ya[3*cb],Za[1]=Ya[3*cb+1],Za[2]=Ya[3*cb+2],da.sub(Za,Db,Za),Fb=da.sqrLen(Za),Fb<=Xb&&(Xb=Fb,cc=cb);bc[bb]=cc}Qa=bc;for(var Ma=Nb.U/Sb.length,vb=0;vb<wb.length;vb++){var Ib=wb[vb].Zm,dc=wb[vb].$m,Ob=wb[vb].hk,Jb=wb[vb].om,pb=sb.R[Ob];switch(Ib){case "a_bending_col_main":var tb=1;break;case "a_bending_col_detail":tb=3;break;case "a_color":tb=3;break;default:for(var ib=tb=0;ib<vc[Ib].src.length;ib++)tb+=na.zh(vc[Ib].src[ib].Dd)}if(pb&&
0<pb.length){var oc=na.zh(Jb),Hc=na.zh(dc),ec=Jb&dc,kc=na.Lv(ec);ec!=dc&&ia.error("Wrong color extraction from "+Ob+" to "+Ib+".");if("a_bending_col_main"==Ib||"a_bending_col_detail"==Ib)Nb.R[Ib]=new Float32Array(Nb.U*Hc);for(ib=0;ib<Sb.length;ib++){var wc=Qa[ib],Zb=wc*oc,fc=ib*Ma*tb;if(-1!=wc)for(var gc=0;gc<Ma;gc++)for(var pc=gc*tb,qb=0;qb<kc.length;qb++)kc[qb]&&(Nb.R[Ib][fc+pc+(wb[vb].lm+na.Rk(dc,qb))]=pb[Zb+na.Rk(Jb,qb)])}}else Nb.R[Ib]=new Float32Array(0)}}ca=Nb;t.push({D:X,jd:ca,Bc:[ha.name],
f:w,Td:[a]})}}}return t}function K(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=X.Ss(b));return c=c&&g(a,b)}function F(a,b){for(var c=null,d=null,e=0;e<a.Z.length;e++){var h=a.Z[e].Ge;h&&(c||(c={}),c[e]=h,a.Z[e].Ge=null);if(h=a.Z[e].ba)d||(d={}),d[e]=h,a.Z[e].ba=null}a.id=0;a.zE=b;a.id=na.Ks(a,b);if(c)for(var f in c)a.Z[f].Ge=c[f];if(d)for(f in d)a.Z[f].ba=d[f]}function Q(a){var b=a.td;a.td=null;var c=na.Ks(a,0);a.td=b;return c}function J(a,b,c,e,h){var f=d("WIREFRAME");D(f,"wireframe.glslv","wireframe.glslf");
f.wireframe_mode=0;f.Mg=!0;f.ha=!0;f.Ki=c;h&&(f.mt=!0);u(f,b);b=Q(b);F(f,b);e?(e=fa.wp(1,a.H),W.Pv(e,[a.ce[0],a.de[1],a.ee[2]],a.H)):e=fa.wp(a.Ya,a.H);W.xn(e,1,!0);e.R.a_polyindex=W.mp(e);N(f,e);return f}function D(a,b,c){a.nb.sj=b;a.nb.ji=c;P.UE(a.nb)}function G(a,b,c){1==a.Z.length&&0==a.$b.length&&a.$b.push("default0");c=c||"default"+String(a.Z.length);-1==a.$b.indexOf(c)&&(a.Z.push(b),a.$b.push(c));a.Sb&&U.xs(a)}function M(a){if(!a.nb)throw"No shaders info for batch "+a.name;a.Sb=P.mC(a.nb);U.xz(a.Sb);
U.vs(a);U.xs(a)}function I(a,b,c){a=a.K[0].V;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].Tg&&-1!=a[d].Zc.indexOf(b))return a[d];return null}function y(a,b,c){a=a.K[0].V;for(var d=0;d<a.length;d++)if(a[d].type==c&&a[d].Tg&&-1!=a[d].Zc.indexOf(b))return a[d];return null}function V(a,b){a.yc.set(b.yc);a.Bf=b.Bf;a.se.set(b.se);a.Ch=b.Ch;a.Kc.set(b.Kc);a.Oe=b.Oe;a.Ce=b.Ce;a.Af=b.Af;a.rf=b.rf;a.reflect_factor=b.reflect_factor;a.Pd.set(b.Pd);a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);
a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.uj=b.uj}var T=p("__boundings"),R=p("__camera"),ha=p("__config"),ia=p("__print"),aa=p("__extensions"),W=p("__geometry"),S=p("__graph");p("__lights");var X=p("__nodemat"),ca=p("__obj_util"),oa=p("__particles"),fa=p("__primitives"),ma=p("__quat"),L=p("__reformer"),U=p("__renderer"),ga=p("__scenegraph"),P=p("__shaders");p("__scenes");var va=
p("__textures"),ja=p("__tsr"),na=p("__util"),da=p("__vec3"),ua=p("__vec4"),ea=ha.p,ra=["MAIN"],ta=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]);new Float32Array(3);var H=new Float32Array(4);a.nH=pa;var pa="u_colormap0 u_colormap1 u_stencil0 u_specmap0 u_normalmap0 u_mirrormap".split(" ");a.oJ=d;a.aC=function(a,c,d,h){for(var f=[],g=[],k=0;k<c.length;k++){var l=c[k],n=l.ja;n.yk||(ca.ga(n)?f.push(l):g.push(l))}for(var k=[],k=k.concat(m(f,a.k.sb)),n=k=k.concat(e(g,a.k.sb,a.b4w_batch_grid_size)),
f=[],g=[],q={},k=0;k<n.length;k++){var t=n[k].D,u=n[k].f,p=null;if(t.id in q){for(var v=q[t.id],x=g[v].D,L=g[v].f,z=null,y=null,l=0;l<t.Z.length;l++){var F=t.Z[l].Ge;F&&(z||(z={}),z[l]=F,t.Z[l].Ge=null);if(F=t.Z[l].ba)y||(y={}),y[l]=F,t.Z[l].ba=null}na.rw(t,x)&&na.rw(u,L)&&(p=g[v]);if(z)for(l in z)t.Z[l].Ge=z[l];if(y)for(l in y)t.Z[l].ba=y[l];if(!p){do t.id++;while(q[t.id])}}p||(p={D:t,f:n[k].f,Td:[],mr:[],Bc:[]},q[t.id]=g.length,g.push(p));p.Td=p.Td.concat(n[k].Td);n[k].jd&&n[k].jd.U&&p.mr.push(n[k].jd);
if(p.Bc.length)for(l=0;l<n[k].Bc.length;l++)t=n[k].Bc[l],-1==p.Bc.indexOf(t)&&p.Bc.push(t);else p.Bc=n[k].Bc;W.hw(p.Bc,p.mr,W.Hy,!1)}for(k=0;k<g.length;k++){n=g[k].mr;if(0==n.length)l=na.Ib(na.nj("%empty"));else if(1==n.length)l=n[0];else{q=[];for(l=0;l<n.length;l++)W.aD(n[l])||q.push(l);if(q.length<n.length)for(l=0;l<q.length;l++)W.xn(n[q[l]]);l=W.NF(n)}f.push({D:g[k].D,f:g[k].f,jd:l,Bc:g[k].Bc,Td:g[k].Td})}for(g=0;g<f.length;g++)if(n=f[g].D,n.Zc=f[g].Bc,N(n,f[g].jd),r(n,d,a),"STATIC"==f[g].f.type&&
"COLOR_ID"!=n.type)k=na.nj("%meta%"+n.type+"%"+n.Zc.join("%")+"%"),k=ca.Uj(k,"MESH"),k.f=f[g].f,ca.Kl(k,a),ca.Jl(k,a,n),h.push(k);else for(q=[],l=0;l<f[g].Td.length;l++)k=f[g].Td[l].ja,-1==q.indexOf(k.name)&&(ca.Jl(k,a,n),q.push(k.name));if(ea.wireframe_debug){for(g=0;g<f.length;g++)if(d=f[g].f,"DYNAMIC"==d.type&&(k=f[g].Td[0].ja,-1<ra.indexOf(f[g].D.type))){l=ca.Sa(k,a);n=l.V;q=!1;for(l=0;l<n.length;l++)n[l].Mg&&(q=!0);q||(d=J(d.tf,d,k.name,!0,!0),ca.Jl(k,a,d))}for(g=0;g<h.length;g++)k=h[g],d=k.f,
l=ca.Sa(k,a),n=l.V,-1<ra.indexOf(n[0].type)&&(d=J(d.ud,d,k.name,!1),ca.Jl(k,a,d))}for(g=0;g<c.length;g++)for(l=ca.Sa(c[g].ja,a),n=l.V,l=0;l<n.length;l++)b(n[l]);for(g=0;g<h.length;g++)for(l=ca.Sa(h[g],a),n=l.V,l=0;l<n.length;l++)b(n[l])};a.cC=function(a,c){var e=a.k.Qr,f=d("MAIN");D(f,"special_skydome.glslv","special_skydome.glslf");if(c.procedural_skydome)w(f,"PROCEDURAL_SKYDOME",1),f.wv=!0;else{var g=e.cr;if(g){w(f,"WO_SKYTEX",1);var k=h(e.fw,null);G(f,k,"u_sky");g.invert&&w(f,"MTEX_NEGATIVE",1);
g.RG&&w(f,"MTEX_RGBTOINT",1);w(f,"BLENDTYPE",g.Ez);g.NG&&w(f,"WOMAP_BLEND",1);g.OG&&w(f,"WOMAP_HORIZ",1);g.QG&&w(f,"WOMAP_ZENUP",1);g.PG&&w(f,"WOMAP_ZENDOWN",1)}e.SG&&w(f,"WO_SKYBLEND",1);e.TG&&w(f,"WO_SKYPAPER",1);e.UG&&w(f,"WO_SKYREAL",1)}c.qc&&(f.qc=!0,c.gc&&(f.gc=!0));f.oh=99999;E(f,"a_position");e=fa.ZB();N(f,e);b(f);e=na.nj("%meta_sky%");e=ca.Uj(e,"MESH");ca.Kl(e,a);g=ca.Sa(e,a);e.f=ca.$h("STATIC");e.f.bi=!0;e.f.Ub=T.Id();e.f.ud=T.sl();e.f.wb=T.Id();e.f.Vb=T.sl();g.V.push(f);return e};a.ht=
function(a,b,d){d=ca.Sa(a,d).V;var e=[],h=ga.bb(b,"SHADOW_CAST"),f=ga.bb(b,"MAIN_PLANE_REFLECT"),g=ga.bb(b,"MAIN_CUBE_REFLECT"),k=ga.bb(b,"OUTLINE_MASK");b=ga.bb(b,"COLOR_PICKING");for(var l=0;l<d.length;l++){var m=d[l],n=null;"DEPTH"==m.type&&h&&m.Ic&&(n=c(m),n.fb="SHADOW_CAST");"MAIN"!=m.type&&"PARTICLES"!=m.type||!f&&!g||m.Ua||!m.qc||(n=c(m),n.fb="REFLECT");"COLOR_ID"==m.type&&m.Ao&&k&&a.f.Eb&&(b&&a.f.df?(n=c(m),n.fb="OUTLINE"):m.fb="OUTLINE");n&&(n.Tg=!0,F(n,a.f.id),e.push(n))}d.push.apply(d,
e)};a.cF=k;a.hH=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.Az=function(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.jC=h;a.hG=z;a.gG=r;a.ZE=f;a.ws=function(a,b,c){c&&c.j.type==R.bc&&w(a,"PERSPECTIVE_SHADOW_CAST",1);w(a,"CSM_SECTION0",0);w(a,"CSM_SECTION1",0);w(a,"CSM_SECTION2",0);w(a,"CSM_SECTION3",0);if(b){for(c=0;c<b.csm_num;c++)w(a,
"CSM_SECTION"+String(c),1);w(a,"SHADOW_TEX_RES",P.s(b.csm_resolution));w(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);w(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else w(a,"SHADOW_TEX_RES",0),w(a,"CSM_FADE_LAST_CASCADE",0),w(a,"CSM_BLEND_BETWEEN_CASCADES",0)};a.ua=w;a.Qb=function(a,b){return P.qC(a.nb,b)};a.eG=N;a.fG=F;a.Nz=Q;a.rI=J;a.Vh=G;a.GE=function(a,b,c){c=a.$b.indexOf(c);-1<c&&(a.Z[c]=b)};a.OA=function(a,b){var c=d("MAIN");c.Ua=!0;ua.set(b[0],b[1],b[2],.5,c.yc);c.Ne=
W.xl;N(c,a);D(c,"main_stack.glslv","main_stack.glslf");w(c,"SHADELESS",1);M(c);return c};a.Fb=M;a.Vz=function(a){return a.Sb.Jk.length?a.Sb.zq.u_cube_fog?!0:!1:!1};a.yA=function(){var a=d("DEPTH_PACK");a.hb=!0;a.ha=!1;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");M(a);return a};a.Qo=function(a){var b=d("POSTPROCESSING");D(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":w(b,"POST_EFFECT","POST_EFFECT_NONE");
break;case "GRAYSCALE":w(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":w(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":w(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":w(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":w(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":w(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":w(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;case "FLIP_CUBEMAP_COORDS":w(b,"POST_EFFECT",
"FLIP_CUBEMAP_COORDS");break;default:throw"Wrong postprocessing effect: "+a;}b.hb=!0;b.ha=!1;a=fa.Jb();N(b,a);M(b);return b};a.RA=function(a){var b=d("SSAO");b.ha=!1;b.hb=!0;var c=fa.Jb();N(b,c);D(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");w(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.mw);w(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:va.dC(a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,
160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=h(a,c);G(b,a,"u_ssao_special_tex");M(b);return b};a.SA=function(a){var b=d("SSAO_BLUR");b.ha=!1;b.hb=!0;var c=fa.Jb();N(b,c);D(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");w(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);M(b);return b};a.zA=function(){var a=d("DOF");a.ha=!1;a.hb=!0;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");
w(a,"DEPTH_RGBA",1);M(a);return a};a.IA=function(){var a=d("OUTLINE");a.ha=!1;a.hb=!0;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");M(a);return a};a.BA=function(){var a=d("GLOW_COMBINE");a.ha=!1;a.hb=!0;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");M(a);return a};a.CA=function(a,b,c){var e=d("GOD_RAYS");e.ha=!1;e.hb=!0;var h=fa.UB();N(e,h);D(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");
w(e,"DEPTH_RGBA",a?1:0);w(e,"WATER_EFFECTS",b?1:0);w(e,"STEPS_PER_PASS",P.s(c,1));M(e);return e};a.DA=function(){var a=d("GOD_RAYS_COM");a.ha=!1;a.hb=!0;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");w(a,"SAFARI_CANVAS_ALPHA_HACK",ea.Ov?1:0);M(a);return a};a.JA=function(){var a=d("SKY");a.ha=!1;a.hb=!0;var b=fa.VB();N(a,b);D(a,"procedural_skydome.glslv","procedural_skydome.glslf");w(a,"WATER_EFFECTS",1);M(a);return a};a.sA=function(a){var b=
d("ANTIALIASING");b.ha=!1;b.hb=!0;var c=fa.Jb();N(b,c);D(b,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");ea.zv?(w(b,"AA_METHOD","AA_METHOD_FXAA_QUALITY"),w(b,"AA_QUALITY",a.SB)):w(b,"AA_METHOD","AA_METHOD_FXAA_LIGHT");M(b);return b};a.PA=function(a){var b=d("SMAA"),c=fa.Jb();N(b,c);D(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");w(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");w(b,"SMAA_PASS",a);w(b,"SMAA_PREDICATION",0);w(b,"SMAA_REPROJECTION",0);M(b);b.ha=!1;b.hb=
!0;return b};a.wA=function(){var a=d("COMPOSITING");a.ha=!1;a.hb=!0;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");M(a);return a};a.HA=function(){var a=d("MOTION_BLUR");a.hb=!0;a.ha=!1;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");M(a);return a};a.qA=function(){var a=d("ANAGLYPH");a.hb=!0;a.ha=!1;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");M(a);
return a};a.EA=function(){var a=d("LUMINANCE");a.ha=!1;a.hb=!0;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");M(a);return a};a.tA=function(){var a=d("LUMINANCE");a.ha=!1;a.hb=!0;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");M(a);return a};a.FA=function(){var a=d("LUMINANCE_X_BLUR");a.ha=!1;a.hb=!0;var b=fa.Jb();N(a,b);D(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");
M(a);return a};a.uA=function(){var a=d("POSTPROCESSING");a.hb=!0;a.ha=!1;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");M(a);return a};a.vA=function(){var a=d("BLOOM");a.ha=!1;a.hb=!0;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");M(a);return a};a.VA=function(){var a=d("VELOCITY");a.ha=!1;a.hb=!0;var b=fa.Jb();N(a,b);D(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");M(a);
return a};a.rA=function(){var a=d("ANCHOR_VISIBILITY");a.ha=!0;a.hb=!0;a.Ne=W.Wr;D(a,"anchors.glslv","anchors.glslf");var b=fa.Lt(1);N(a,b);w(a,"ANCHOR_NUM",1);M(a);a.Qi=new Float32Array([0,0,0]);return a};a.dG=function(a,b){var c=b.length/3;if(c!=a.Qi.length/3){var d=fa.Lt(c);N(a,d);w(a,"ANCHOR_NUM",c);M(a)}a.Qi=b};a.Ca=I;a.Vc=y;a.VJ=V;a.iI=function(a,b){for(var c=a.K[0].V,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.lA=function(a){for(var b=a.Z,c=0;c<b.length;c++)va.iB(b[c].Oa);W.Ws(a.S)};
a.inherit_material=function(a,b,c,d){for(var e=["MAIN","DEPTH","COLOR_ID"],h=!1,f=0;f<e.length;f++){var g=e[f],k=I(a,b,g),l=I(c,d,g);if(k&&l){var h=!0,m=y(c,d,g);"MAIN"==g&&(V(l,k),m&&V(m,k));for(g=0;g<l.$b.length;g++){var n=l.$b[g];if(-1!==pa.indexOf(n)){var q=k.$b.indexOf(n);-1!==q&&(l.Z[g]=k.Z[q],m&&(n=m.$b.indexOf(n),-1!==n&&(m.Z[n]=k.Z[q])))}}}}h||ia.error("Wrong objects for inheriting material!")}};b4w.module.__nodemat=function(a,p){function d(a,c,f,g,m){var q=ea.get_active(),q=e(c,m,q.uuid);if(q in pa)return pa[q];if("DEPTH"!=m&&"COLOR_ID"!=m){c=P.create();for(var r=a.nodes,u=0;u<r.length;u++)if(null==O(c,r[u],0,g,m))return pa[q]=null;if(f&&-1==w(a,c,"GROUP_OUTPUT","group"))return null;u=X(c);r=f?a.links:a.links.slice();if(!ca(c,r,u))return null;if(f)return c;for(u=0;u<r.length;u++){f=r[u];for(var p=h(f.from_node,c),L=h(f.to_node,c),z=0;z<p.length;z++)for(var y=0;y<L.length;y++){var F=p[z],
I=L[y],U=P.La(c,F),B=P.La(c,I);if(!W(c,F,I,U,B,f))return pa[q]=null}}l(c);a="GLOW"==m?w(a,c,"B4W_GLOW_OUTPUT","material",!0):w(a,c,"OUTPUT","material",!1,!0);-1==a&&(c=k(),a=0);v(c);a=P.wn(c,a,P.vl);b(a,g);n(a);A(a);E(a);x(a,g,m)}else g=d(a,c,f,g,"MAIN"),g=P.clone(g,function(a){var b=ra.Mj(a);b.F=ra.qa(a.F);b.ra=ra.qa(a.ra);return b}),a=w(a,g,"OUTPUT","material",!1,!0),t(g,a),a=P.wn(g,a,P.vl),n(a);return pa[q]=a}function b(a,b){var d=[];P.aa(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=b.type||
d.push({ZD:a,node:b})});for(var e=0;e<d.length;++e){var h=d[e].ZD,f=d[e].node,g=P.pk(a);P.Uh(a,g,f.data.JD);var k=P.pk(a);P.Uh(a,k,f.data.KD);P.dc(a,g,k,[4,2]);for(var l={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},m=P.Lp(a,h),n=[],q=[],r=[],t={},u=0;u<m;u++){var p=P.rk(a,h,u);p in t||(t[p]=0);var v=P.Te(a,p,h,t[p]++);n.push([p,h,v]);var x=l[v[1]];if(x)switch(x[0]){case "MATERIAL_END":q.push([p,k,[v[0],x[1]]]);break;case "LIGHTING_APPLY":r.push([p,
[v[0],x[1]]])}else q.push([p,g,v])}c(a,f.data.value,g,k,r,b);for(u=0;u<n.length;u++)P.jn(a,n[u][0],n[u][1],n[u][2]);for(u=0;u<q.length;u++)P.dc(a,q[u][0],q[u][1],q[u][2]);f=P.Qf(a,h);g=[];l=[];m={};for(u=0;u<f;u++)n=P.Ff(a,h,u),n in m||(m[n]=0),v=P.Te(a,h,n,m[n]++),g.push([h,n,v]),l.push([k,n,v]);for(u=0;u<g.length;u++)P.jn(a,g[u][0],g[u][1],g[u][2]);for(u=0;u<l.length;u++)P.dc(a,l[u][0],l[u][1],l[u][2]);P.qe(a,h)}}function c(a,b,c,d,e,h){var f={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},g=
O(a,f,0,h,null),k=g;m(a,c,g,"E");m(a,c,g,"A");m(a,c,g,"D");g=ea.get_active();g=na.wa(g,"LAMP",na.DATA_ID_ALL);if(!b.nd)for(var l,n,q=0;q<g.length;q++){var r=g[q].Fa,f={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};l=O(a,f,0,h,null);f={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};n=O(a,f,0,h,null);m(a,k,n,"color");m(a,k,n,"specular");m(a,l,n,"ldir");m(a,c,n,"normal");m(a,c,n,"D");m(a,c,n,"S");m(a,l,n,"lcolorint");m(a,c,l,"shadow_factor");k="COOKTORR"==b.aj?"SPECULAR_PHONG":"SPECULAR_"+b.aj;f={name:k,
type:k};f=O(a,f,0,h,null);m(a,l,f,"ldir");m(a,l,f,"lfac");m(a,c,f,"normal");m(a,f,n,"sfactor");"SPECULAR_PHONG"!=k&&"SPECULAR_BLINN"!=k||m(a,l,f,"norm_fac");m(a,c,f,"sp_params");k="HEMI"==r.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.bk;f={name:k,type:k};f=O(a,f,0,h,null);m(a,l,f,"ldir");m(a,l,f,"lfac");m(a,c,f,"normal");m(a,l,f,"norm_fac");m(a,f,n,"lfactor");"DIFFUSE_LAMBERT"!=k&&m(a,c,f,"dif_params");for(l=0;l<e.length;l++)P.dc(a,e[l][0],n,e[l][1]);k=n}m(a,k,d,"color");m(a,k,d,"specular")}function m(a,
b,c,d){for(var e=P.La(a,b),h=P.La(a,c),f,g=0;g<h.F.length;g++)if(d==h.F[g].identifier){f=g;break}for(var k,g=0;g<e.ra.length;g++)if(d==e.ra[g].identifier){k=g;break}void 0!=f&&void 0!=k&&P.dc(a,b,c,[k,f])}function e(a,b,c){switch(b){case "GLOW":return a+c+"11";case "COLOR_ID":case "DEPTH":return a+c+"00";default:return a+c+"10"}}function t(a,b){P.ye(a,function(c,d,e){var h=P.La(a,d);d==b&&"Color"==h.F[e[1]].identifier&&P.jn(a,c,d,e)})}function k(){var a=P.create(),b={data:null,xd:[],M:[],F:[{Ha:new Float32Array([0,
0,0]),identifier:"Color",Kb:!1,name:"Color"},{Ha:1,identifier:"Alpha",Kb:!1,name:"Alpha"}],ra:[],type:"OUTPUT",mg:[]};P.Uh(a,0,b);return a}function n(a){P.aa(a,function(b,c){for(var d=c.F,e=c.ra,h=0;h<d.length;h++)g(a,d[h],b,h,1);for(h=0;h<e.length;h++)g(a,e[h],b,h,0)})}function g(a,b,c,d,e){if(b.Kb){var h=!0;P.ye(a,function(a,b,f){if(!e&&a==c&&f[0]==d||e&&b==c&&f[1]==d)h=!1});h&&(b.Kb=!1)}}function x(a,b,c){var d=[];P.ye(a,function(e,h,f){var g=P.La(a,e),k=P.La(a,h),g=ra.is_vector(g.ra[f[0]].Ha),
k=ra.is_vector(k.F[f[1]].Ha);if(g!=k){var l,m={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},n={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};g&&!k?l=N("vector_to_scalar","B4W_VECTOSCAL",[m],[n]):!g&&k&&(l=N("scalar_to_vector","B4W_SCALTOVEC",[n],[m]));O(a,l,0,b,c);d.push([e,h,a.B[a.B.length-2],f])}});for(var e=0;e<d.length;++e)P.jn(a,d[e][0],d[e][1],d[e][3]),P.dc(a,d[e][0],d[e][2],[d[e][3][0],0]),P.dc(a,d[e][2],d[e][1],[0,d[e][3][1]])}function l(a){var b=[];
P.aa(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":P.ye(a,function(a,e,h){a==c&&"Translucency"==d.ra[h[0]].name&&b.push(a,e,[h[0]+1,h[1]+1])})}});for(var c=0;c<b.length;c+=3)P.dc(a,b[c],b[c+1],b[c+2])}function h(a,b){var c=[];P.aa(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function v(a){var b=[];P.aa(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var h=
C(a,d);if(-1!=h){var f=P.rk(a,h,0);P.yh(a,h,d,-1);-1!=f&&P.yh(a,f,h,-1);d=P.La(a,h);e.data=d.data;e.M[0]=d.M[0];P.qe(a,h)}e.F.splice(1,1)}else if("REROUTE"==e.type){for(var e=P.rk(a,d,0),g=P.Qf(a,d),h=[],f=[],k=[],l=0;l<g;l++){var m=P.Ff(a,d,l),n=f.indexOf(m);-1!=n?k[n]+=1:(f.push(m),k.push(1),h.push(d,m))}if(-1!=e)for(g=P.Te(a,e,d,0)[0],l=0;l<f.length;l++)for(m=0;m<k[l];m++)n=P.Te(a,d,f[l],m)[1],P.dc(a,e,f[l],[g,n]);for(l=0;l<h.length;l+=2)P.yh(a,h[l],h[l+1],-1)}}}function C(a,b){for(var c=a.Y,d=
0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function A(a){q(a);u(a);B(a)}function B(a){var b=[],c="",d="",e={};P.aa(a,function(a,h){if("GEOMETRY_UV"==h.type||"UVMAP"==h.type||"TEX_COORD_UV"==h.type){b.push(a,h);var f=h.data.value;c?c==f||d||(d=f,e[d]=0):(c=f,e[c]=0);e[f]++}});for(var h in e)if(2>e[h]){for(var g=0;g<b.length;g+=2)b[g+1].data.value==h&&b.splice(g,2);delete e[h];c==h&&(c=d,d="");d==h&&(d="")}if(!(3>b.length)){var g={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,
name:"UV_geom"},k={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,name:"UV_cycles"};h=N("merged_uv","UV_MERGED",[],[g,k]);h.uv_layer=c;O(a,h,0,"",void 0);var l=a.B[a.B.length-2];h=a.B[a.B.length-1];if(d){k=N("merged_uv","UV_MERGED",[],[g,k]);k.uv_layer=d;O(a,k,0,"",void 0);var m=a.B[a.B.length-2],k=a.B[a.B.length-1]}else k=null;for(var n=-1,q=null,g=0;g<b.length;g+=2){var r=b[g],t=b[g+1];f(t,b[1])?(n=l,q=h):k&&(n=m,q=k);for(var u=[],p=P.Qf(a,r),v={},x=0;x<p;x++){var L=P.Ff(a,r,x);L in v||
(v[L]=0);var z=P.Te(a,r,L,v[L]++);u.push(r,L,z);z=z.splice(0,z.length);switch(t.type){case "GEOMETRY_UV":z[0]=0;q.ra[0].Kb=!0;break;case "UVMAP":case "TEX_COORD_UV":z[0]=1,q.ra[1].Kb=!0}P.dc(a,n,L,z)}for(var x=0;x<u.length;x+=3)P.yh(a,u[x],u[x+1],0);P.qe(a,r)}}}function q(a){var b=[];P.aa(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=
2){for(var e=b[d],h=b[d+1],f=!0,g=0;g<c.length;g++){var k=c[g];if(r(h,k.Qc)){f=[];g=P.Qf(a,e);for(n=0;n<g;n++){var l=P.Ff(a,e,n),m=P.Te(a,e,l,0);f.push(e,l,m);P.dc(a,k.id,l,m)}for(var n=0;n<f.length;n+=3)P.yh(a,f[n],f[n+1],0);P.qe(a,e);f=!1;break}}f&&(k={id:e,Qc:h},c.push(k))}}function z(a){for(var b={},c=0;c<a.B.length;c+=2)b[a.B[c]]=[];for(c=0;c<a.Y.length;c+=3){for(var d=a.Y[c],e=a.Y[c+1],h=b[e],f=d,g=0;g<=h.length;g++){if(g>=h.length||h[g]>f)h.splice(g,0,f);else if(h[g]!=f)continue;break}for(var e=
b[e],d=b[d],f=h=0,g=e.length+d.length,k=[],l=0;l<g;l++)h>e.length||e[h]>d[f]?k.push(d[f++]):k.push(e[h++])}return b}function u(a){var b=[];P.aa(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=z(a),d=[],e=0;e<b.length;e+=2){for(var h=b[e],f=b[e+1],g=!0,k=0;k<d.length;k++){var l=d[k];if(!(3<=l.Ei.length||!r(f,l.Qc)||-1<c[h].indexOf(l.id)||-1<c[l.id].indexOf(h))){for(var n=!1,m=0;m<l.Ei.length;m++){var q=l.Ei[m].id;if(-1<c[h].indexOf(q)||-1<c[q].indexOf(h)){n=
!0;break}}if(!n){for(var k=[],q=P.Lp(a,h),t={},m=0;m<q;m++)n=P.rk(a,h,m),n in t||(t[n]=0),g=P.Te(a,n,h,t[n]++),k.push(n,h,g);for(var q=[],t=P.Qf(a,h),u={},m=0;m<t;m++)n=P.Ff(a,h,m),n in u||(u[n]=0),g=P.Te(a,h,n,u[n]++),q.push(h,n,g);g=k.concat(q);for(m=0;m<g.length;m+=3)P.yh(a,g[m],g[m+1],0);P.qe(a,h);m={id:h,Qc:f,rB:k,sB:q};l.Ei.push(m);g=!1;break}}}g&&(l={id:h,Qc:f,Ei:[]},d.push(l))}for(e=0;e<d.length;e++){l=d[e];c=l.Ei.length;for(k=0;k<c;k++){f=l.Ei[k];m=f.Qc;h=f.rB;f=f.sB;l.Qc.F[k+1].Kb=m.F[0].Kb;
l.Qc.F[k+1].Ha=m.F[0].Ha;l.Qc.ra[2*(k+1)].Kb=m.ra[0].Kb;l.Qc.ra[2*(k+1)].Ha=m.ra[0].Ha;l.Qc.ra[2*(k+1)+1].Kb=m.ra[1].Kb;l.Qc.ra[2*(k+1)+1].Ha=m.ra[1].Ha;for(m=0;m<h.length;m+=3)n=h[m],g=h[m+2],g[1]+=k+1,P.dc(a,n,l.id,g);for(m=0;m<f.length;m+=3)n=f[m+1],g=f[m+2],g[0]+=2*(k+1),P.dc(a,l.id,n,g);l.Qc.xd.push(["USE_uv"+(k+2),1])}P.qe(a,l.id);P.Uh(a,l.id,l.Qc)}}}function r(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;
case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value.uuid==b.data.value.uuid;default:return!1}}function f(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function E(a){var b=[];P.aa(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],h=!1,f=[],g=[],k=[[],[],[]],l=P.Qf(a,d),m=0;m<l;m++){var n=P.Ff(a,d,m);if("SEPRGB"!=P.La(a,n).type){h=!1;break}f.push(d,
n);for(var q={},r=P.Qf(a,n),h=0;h<r;h++){var t=P.Ff(a,n,h);t in q||(q[t]=0);var u=P.Te(a,n,t,q[t]++);f.push(n,t);k[u[0]].push(d,t,u)}g.push(n);h=!0}if(h){for(m=d=l=0;m<k.length;m++)k[m].length&&(l++,d|=1<<2-m);if(l){e.type+=l;e.ra=[];for(m=0;m<k.length;m++)if(k[m].length)for(e.ra.push({Ha:0,identifier:"RGB"[m],Kb:!0,name:"RGB"[m]}),h=0;h<k[m].length;h+=3)k[m][h+2][0]=ra.Rk(d,m);for(m=0;m<f.length;m+=2)P.yh(a,f[m],f[m+1],0);for(m=0;m<g.length;m++)P.qe(a,g[m]);for(m=0;m<k.length;m++)for(h=0;h<k[m].length;h+=
3)P.dc(a,k[m][h],k[m][h+1],k[m][h+2])}}}}function w(a,b,c,d,e,f){a=a.nodes;for(var g=null,k=0;k<a.length;k++){var l=a[k];e?"GROUP"==l.type&&l.node_tree_name==c&&(g=l):l.type==c&&(g=l)}return g?h(g,b)[0]:(f||da.error('No "'+c+'" node in node '+d),-1)}function N(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function O(a,b,c,d,e){var h=b.name,f=b.type,g=[],k=[],l=[],m=[],n=null,q=[];switch(f){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "PARTICLE_INFO":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":k=
ha(b);l=ia(b);da.warn(f+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":k=ha(b);l=ia(b);break;case "UVMAP":var r=b.uv_layer;r||(f="EMPTY_UV");if("EMPTY_UV"!=f){var n=J("param_"+f+"_a"),t=J("param_"+f+"_v");g.push(aa(n));g.push(aa(t));m.push(aa(t));n={name:n,value:r}}l=ia(b);break;case "UV_MERGED":n=J("param_UV_MERGED_a");t=J("param_UV_MERGED_v");g.push(aa(n));g.push(aa(t));l.push(V(b,"UV_geom"));l.push(V(b,"UV_cycles"));m.push(aa(t));n={name:n,value:b.uv_layer};
break;case "CAMERA":k=[];l=ia(b);break;case "COMBRGB":case "COMBHSV":k=ha(b);l=ia(b);break;case "CURVE_RGB":k=ha(b);l=ia(b);da.warn("CURVE_RGB node is not fully supported.");break;case "CURVE_VEC":k=ha(b);l=ia(b);da.warn("CURVE_VEC node is not fully supported.");break;case "GEOMETRY":if(!D(b))return!0;f=G(b,c);if(!f)return da.error("Geometry output is not supported"),null;switch(f){case "GEOMETRY_UV":(r=b.uv_layer)||(f="EMPTY_UV");"EMPTY_UV"!=f&&(n=J("param_GEOMETRY_UV_a"),t=J("param_GEOMETRY_UV_v"),
g.push(aa(n)),g.push(aa(t)),m.push(aa(t)),n={name:n,value:r});l.push(V(b,"UV"));break;case "GEOMETRY_VC":(r=b.color_layer)||(f="EMPTY_VC");"EMPTY_VC"!=f&&(n=J("param_GEOMETRY_VC_a"),t=J("param_GEOMETRY_VC_v"),g.push(aa(n)),g.push(aa(t)),m.push(aa(t)),n={name:n,value:r});l.push(V(b,"Vertex Color"));break;case "GEOMETRY_NO":l.push(V(b,"Normal"));break;case "GEOMETRY_FB":l.push(V(b,"Front/Back"));break;case "GEOMETRY_VW":l.push(V(b,"View"));break;case "GEOMETRY_GL":l.push(V(b,"Global"));break;case "GEOMETRY_LO":l.push(V(b,
"Local"));break;case "GEOMETRY_OR":r=J("param_GEOMETRY_OR_v"),g.push(aa(r)),l.push(V(b,"Orco")),m.push(aa(r))}break;case "TEX_COORD":if(!D(b))return!0;f=M(b,c);if(!f)return da.error("Texture coordinate output is not supported"),null;switch(f){case "TEX_COORD_UV":(r=b.uv_layer)||(f="EMPTY_UV");"EMPTY_UV"!=f&&(n=J("param_TEX_COORD_UV_a"),t=J("param_TEX_COORD_UV_v"),g.push(aa(n)),g.push(aa(t)),m.push(aa(t)),n={name:n,value:b.uv_layer});l.push(V(b,"UV"));break;case "TEX_COORD_NO":l.push(V(b,"Normal"));
break;case "TEX_COORD_GE":r=J("param_TEX_COORD_GE_v");g.push(aa(r));l.push(V(b,"Generated"));m.push(aa(r));break;case "TEX_COORD_OB":l.push(V(b,"Object"));da.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":l.push(V(b,"Camera"));break;case "TEX_COORD_WI":l.push(V(b,"Window"));da.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":l.push(V(b,"Reflection")),da.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;
case "GROUP":r=b.node_tree_name;switch(r){case "B4W_LINEAR_TO_SRGB":if(!K(b,[1],[1])){n=F(b,d,e);break}f="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!K(b,[1],[1])){n=F(b,d,e);break}f="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!K(b,[1],[1])){n=F(b,d,e);break}f="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!K(b,[1,1],[1])){n=F(b,d,e);break}f="B4W_REFLECT";break;case "B4W_REFRACTION":if(!K(b,[1,0],[1])){n=F(b,d,e);break}f="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!K(b,
[1,1,0,0,0],[1])){n=F(b,d,e);break}f="B4W_PARALLAX";t=J("temp_texture");m.push(aa(t));break;case "B4W_CLAMP":if(!K(b,[1],[1])){n=F(b,d,e);break}f="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!K(b,[0,0,0,0,0],[0])){n=F(b,d,e);break}f="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!K(b,[],[0])){n=F(b,d,e);break}f="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!K(b,[0,0,0],[0])){n=F(b,d,e);break}f="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":f="B4W_GLOW_OUTPUT";break;default:n=F(b,d,e)}k=ha(b);l=ia(b);"B4W_TRANSLUCENCY"==
r&&(r=R("TranslucencyParams","TranslucencyParams",[0,0,0,0]),r.Kb=l[0].Kb,l.push(r));break;case "LAMP":n=b.lamp;if(!n)return da.error("There is no lamp in node: "+b.name),null;l.push(V(b,"Color"));l.push(V(b,"Light Vector"));l.push(V(b,"Distance"));l.push(V(b,"Visibility Factor"));n.uuid in qa?q.push(["LAMP_INDEX",String(qa[n.uuid])]):(qa[n.uuid]=ba,q.push(["LAMP_INDEX",String(ba++)]));n=qa;break;case "LIGHTING_AMBIENT":k=[R("E","E",[0,0,0],!0),R("A","A",[0,0,0],!0),R("D","D",[0,0,0],!0)];l=[R("color",
"color",[0,0,0],!0),R("specular","specular",[0,0,0],!0)];break;case "LIGHTING_BEGIN":l=[R("E","E",[0,0,0],!0),R("A","A",[0,0,0],!0),R("D","D",[0,0,0],!0),R("S","S",[0,0,0],!0),R("normal","normal",[0,0,0],!0),R("dif_params","dif_params",[0,0],!0),R("sp_params","sp_params",[0,0],!0),R("shadow_factor","shadow_factor",0,!0),R("translucency_color","translucency_color",0,!0),R("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":k=[R("color","color",[0,0,0],!0),R("specular",
"specular",[0,0,0],!0)];break;case "LIGHTING_LAMP":k=[R("shadow_factor","shadow_factor",0,!0)];l=[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("lcolorint","lcolorint",[0,0,0],!0),R("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":k=[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("norm_fac","norm_fac",0,!0)];l=[R("lfactor","lfactor",0,!0)];break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":k=
[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("norm_fac","norm_fac",0,!0),R("dif_params","dif_params",[0,0],!0)];l=[R("lfactor","lfactor",0,!0)];break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":k=[R("ldir","ldir",[0,0,0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("norm_fac","norm_fac",0,!0),R("sp_params","sp_params",[0,0],!0)];l=[R("sfactor","sfactor",0,!0)];break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":k=[R("ldir","ldir",[0,0,
0],!0),R("lfac","lfac",[0,0],!0),R("normal","normal",[0,0,0],!0),R("sp_params","sp_params",[0,0],!0)];l=[R("sfactor","sfactor",0,!0)];break;case "LIGHTING_APPLY":k=[R("color","color",[0,0,0,0],!0),R("specular","specular",[0,0,0],!0),R("lfactor","lfactor",0,!0),R("sfactor","sfactor",0,!0),R("ldir","ldir",[0,0,0],!0),R("normal","normal",[0,0,0],!0),R("translucency_params","translucency_params",[0,0,0,0],!0),R("D","D",[0,0,0],!0),R("S","S",[0,0,0],!0),R("lcolorint","lcolorint",[0,0,0],!0),R("translucency_color",
"translucency_color",0,!0)];l=[R("color","color",[0,0,0,0],!0),R("specular","specular",[0,0,0],!0)];break;case "NORMAL":k=ha(b);l=ia(b);r=V(b,"Normal");m.push(aa(J("param_NORMAL_Normal"),r.Ha,3));break;case "MAPPING":r=b.vector_type;f="MAPPING";k.push(y(b,"Vector"));l.push(V(b,"Vector"));var t=b.rotation,u=b.scale,p=b.translation,v=va.create(),x=ra.vB(t);"TEXTURE"==r&&(u[0]=u[0]||1,u[1]=u[1]||1,u[2]=u[2]||1);var L=new Float32Array([u[0],0,0,0,u[1],0,0,0,u[2]]);va.multiply(x,L,v);v=ra.ID(v,ja.create());
switch(r){case "POINT":v[12]=p[0];v[13]=p[1];v[14]=p[2];break;case "TEXTURE":v[12]=p[0];v[13]=p[1];v[14]=p[2];v=ja.invert(v,v);break;case "NORMAL":ja.invert(v,v),ja.transpose(v,v)}switch(r){case "NORMAL":q.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":q.push(["MAPPING_TRS_MATRIX",ua.s(v,16)]);break;case "POINT":0!==ta.length(t)?q.push(["MAPPING_TRS_MATRIX",ua.s(v,16)]):(0!==ta.length(u)&&q.push(["MAPPING_SCALE",ua.s(u,3)]),0!==ta.length(p)&&q.push(["MAPPING_TRANSLATION",ua.s(p,3)]));break;case "VECTOR":0!==
ta.length(t)?q.push(["MAPPING_TRS_MATRIX",ua.s(v,16)]):0!==ta.length(u)&&q.push(["MAPPING_SCALE",ua.s(u,3)])}b.use_min&&q.push(["MAPPING_MIN_CLIP",ua.s(b.min,3)]);b.use_max&&q.push(["MAPPING_MAX_CLIP",ua.s(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":n=[];r=[];t=[];u=[R("E","E",[0,0,0],!0),R("A","A",[0,0,0],!0),R("D","D",[0,0,0],!0),R("S","S",[0,0,0],!0),R("normal","normal",[0,0,0],!0),R("dif_params","dif_params",[0,0],!0),R("sp_params","sp_params",[0,0],!0),R("shadow_factor","shadow_factor",
0,!0)];p=[R("color","color",[0,0,0],!0),R("specular","specular",[0,0,0],!0),R("normal","normal",[0,0,0],!0)];v=[V(b,"Color"),V(b,"Alpha"),V(b,"Normal")];x=[];L=y(b,"Color");L.Ha.splice(3);t.push(L);k.push(L);L=y(b,"Spec");L.Ha.splice(3);t.push(L);k.push(L);t.push(R("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));k.push(L);var z=y(b,"Normal");z.Ha.splice(3);t.push(z);k.push(z);"MATERIAL_EXT"==f?((L=y(b,"Emit"))||(L=R("Emit","Emit",0)),t.push(L),k.push(L),(L=y(b,"Translucency"))?(L.Ha=0,
L.name="Translucency",L.identifier="Translucency"):L=R("Translucency","Translucency",0),k.push(L),(L=y(b,"Translucency"))?(L.Ha=[0,0,0,0],L.name="TranslucencyParams",L.identifier="TranslucencyParams"):L=R("TranslucencyParams","TranslucencyParams",[0,0,0,0]),k.push(L),l=y(b,"Reflectivity"),L=y(b,"Ray Mirror"),l?(L=l,l="Reflectivity"):L?l="Ray Mirror":(L=l,l="Reflectivity"),L||(L=R(l,l,0)),k.push(L),p.push(L),(L=y(b,"SpecTra"))||(L=R("SpecTra","SpecTra",0)),k.push(L),p.push(L),(L=y(b,"Alpha"))||(L=
R("Alpha","Alpha",b.alpha)),k.push(L),p.push(L),v.push(V(b,"Diffuse")),v.push(V(b,"Spec")),n.push(["MATERIAL_EXT",1]),r.push(["MATERIAL_EXT",1])):(t.push(R("emit_intensity","emit_intensity",0)),p.push(R("reflect_factor","reflect_factor",0)),p.push(R("specular_alpha","specular_alpha",0)),p.push(R("alpha_in","alpha_in",0)),v.push(R("diffuse_out","diffuse_out",0)),v.push(R("spec_out","spec_out",0)),n.push(["MATERIAL_EXT",0]),r.push(["MATERIAL_EXT",0]));x.push(aa(J("param_MATERIAL_alpha"),b.alpha));x.push(aa(J("param_MATERIAL_spec_alpha"),
b.specular_alpha));l=v;z.Kb&&n.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&(n.push(["USE_MATERIAL_DIFFUSE",1]),r.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&r.push(["USE_MATERIAL_SPECULAR",1]);var L=[],U=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":z=b.specular_hardness;break;case "WARDISO":z=b.specular_slope;break;case "TOON":z=b.specular_toon_size;U=b.specular_toon_smooth;break;case "BLINN":z=b.specular_ior;U=b.specular_hardness;break;default:da.error("unsupported specular shader: "+
b.specular_shader+' (material "'+b.material_name+'")'),z=b.specular_hardness}var w,A;switch(b.diffuse_shader){case "LAMBERT":A=w=0;break;case "OREN_NAYAR":w=b.roughness;A=0;break;case "FRESNEL":w=b.diffuse_fresnel;A=b.diffuse_fresnel_factor;break;case "MINNAERT":w=b.darkness;A=0;break;case "TOON":w=b.diffuse_toon_size;A=b.diffuse_toon_smooth;break;default:da.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),A=w=0}L.push(aa(J("param_MATERIAL_diffuse"),[w,A],
2));L.push(aa(J("param_MATERIAL_spec"),[b.specular_intensity,z,U],3));n.push(["SHADELESS_MAT",b.use_shadeless?1:0]);z={name:b.name,value:{aj:b.specular_shader,bk:b.diffuse_shader,nd:b.use_shadeless}};n={name:b.name,value:{aj:b.specular_shader,bk:b.diffuse_shader,nd:b.use_shadeless},JD:{name:"material_begin",type:"MATERIAL_BEGIN",F:t,ra:u,M:L,data:z,xd:n,mg:[]},KD:{name:"material_end",type:"MATERIAL_END",F:p,ra:v,M:x,data:z,xd:r,mg:[]}};break;case "MATH":switch(b.operation){case "ADD":f="MATH_ADD";
break;case "SUBTRACT":f="MATH_SUBTRACT";break;case "MULTIPLY":f="MATH_MULTIPLY";break;case "DIVIDE":f="MATH_DIVIDE";break;case "SINE":f="MATH_SINE";break;case "COSINE":f="MATH_COSINE";break;case "TANGENT":f="MATH_TANGENT";break;case "ARCSINE":f="MATH_ARCSINE";break;case "ARCCOSINE":f="MATH_ARCCOSINE";break;case "ARCTANGENT":f="MATH_ARCTANGENT";break;case "POWER":f="MATH_POWER";break;case "LOGARITHM":f="MATH_LOGARITHM";break;case "MINIMUM":f="MATH_MINIMUM";break;case "MAXIMUM":f="MATH_MAXIMUM";break;
case "ROUND":f="MATH_ROUND";break;case "LESS_THAN":f="MATH_LESS_THAN";break;case "GREATER_THAN":f="MATH_GREATER_THAN";break;case "MODULO":f="MATH_MODULO";break;case "ABSOLUTE":f="MATH_ABSOLUTE";break;default:return da.error("Unsupported MATH operation: "+b.operation),null}q.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);k=ha(b);l=ia(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":f="MIX_RGB_MIX";break;case "ADD":f="MIX_RGB_ADD";break;case "MULTIPLY":f="MIX_RGB_MULTIPLY";break;case "SUBTRACT":f=
"MIX_RGB_SUBTRACT";break;case "SCREEN":f="MIX_RGB_SCREEN";break;case "DIVIDE":f="MIX_RGB_DIVIDE";break;case "DIFFERENCE":f="MIX_RGB_DIFFERENCE";break;case "DARKEN":f="MIX_RGB_DARKEN";break;case "LIGHTEN":f="MIX_RGB_LIGHTEN";break;case "OVERLAY":f="MIX_RGB_OVERLAY";break;case "DODGE":f="MIX_RGB_DODGE";break;case "BURN":f="MIX_RGB_BURN";break;case "HUE":f="MIX_RGB_HUE";break;case "SATURATION":f="MIX_RGB_SATURATION";break;case "VALUE":f="MIX_RGB_VALUE";break;case "COLOR":f="MIX_RGB_COLOR";break;case "SOFT_LIGHT":f=
"MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":f="MIX_RGB_LINEAR_LIGHT";break;default:return da.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}q.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);k=ha(b);l=ia(b);break;case "OUTPUT":k=ha(b);l=[];break;case "RGB":r=d+"%join%"+b.name;r={name:"-1",value:r};m.push(r);l.push(V(b,"Color"));break;case "SEPRGB":case "SEPHSV":k=ha(b);l=ia(b);break;case "TEXTURE":f=I(b);if("TEXTURE_EMPTY"==f)l.push(V(b,"Color")),l.push(V(b,"Normal")),l.push(V(b,"Value"));
else if("TEXTURE_ENVIRONMENT"==f)k.push(y(b,"Vector")),l.push(V(b,"Color")),l.push(V(b,"Value"));else{if("TEXTURE_NORMAL"==f&&"ENVIRONMENT_MAP"==b.texture.type)return da.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),null;for(n=0;4>n;++n)n?(L=R("Vector"+n,"Vector"+n,[0,0,0]),"TEXTURE_COLOR"==f&&(r=R("Color"+n,"Color"+n,[0,0,0]),t=R("Value"+n,"Value"+n,0)),"TEXTURE_NORMAL"==f&&(r=R("Normal"+n,"Normal"+n,[0,0,0]),t=R("Value"+n,"Value"+n,0))):(L=y(b,"Vector"),"TEXTURE_COLOR"==f&&(r=V(b,"Color"),
t=V(b,"Value")),"TEXTURE_NORMAL"==f&&(r=V(b,"Normal"),t=V(b,"Value"))),k.push(L),l.push(r),l.push(t)}t=J("param_TEXTURE_texture");m.push(aa(t));n={name:t,value:b.texture};break;case "VALTORGB":k=ha(b);l=ia(b);da.warn("VALTORGB node is not fully supported.");break;case "VALUE":f="VALUE";r=d+"%join%"+b.name;r={name:"-1",value:r};m.push(r);l.push(V(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":f="VECT_MATH_ADD";break;case "SUBTRACT":f="VECT_MATH_SUBTRACT";break;case "AVERAGE":f="VECT_MATH_AVERAGE";
break;case "DOT_PRODUCT":f="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":f="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":f="VECT_MATH_NORMALIZE";break;default:return da.error("Unsupported VECT_MATH operation: "+b.operation),null}k=ha(b);l=ia(b);break;default:k=ha(b),l=ia(b)}f={name:h,type:f,mg:g,F:k,ra:l,M:m,data:n,xd:q};h=P.pk(a);P.Uh(a,P.pk(a),f);if(!(f="GEOMETRY"!=b.type&&"TEX_COORD"!=b.type)){a:{f=b.outputs;for(k=g=0;k<f.length;k++)if(f[k].is_linked&&g++>c){f=!0;break a}f=!1}f=!f}return f||
null!=O(a,b,++c,d,e)?h:null}function K(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,h=0;h<b.length;h++){var g=d[h],k=b[h];if(!g||g.default_value instanceof Array!=k)return da.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(h=0;h<c.length;h++)if(b=e[h],d=c[h],!b||b.default_value instanceof Array!=d)return da.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1;return!0}
function F(a,b,c){var e=a.node_group.node_tree,f={},h;for(h in e)if("links"==h||"nodes"==h){f[h]=[];for(var g=0;g<e[h].length;g++){f[h][g]={};for(var k in e[h][g])if("links"==h){f[h][g][k]={};for(var l in e[h][g][k])f[h][g][k][l]=Q(e[h][g][k][l])}else f[h][g][k]=Q(e[h][g][k])}}else f[h]=Q(e[h]);e=a.node_tree_name;if("B4W_REPLACE"==e||"B4W_LEVELS_OF_QUALITY"==e)h=N("Group input","GROUP_INPUT",[],a.inputs),g=N("Group output","GROUP_OUTPUT",a.outputs,[]),k=null,k="B4W_REPLACE"==e||"B4W_LEVELS_OF_QUALITY"==
e&&(ya.quality==ga.P_LOW||ya.pp)?{from_node:h,from_socket:h.outputs[1],to_node:g,to_socket:g.inputs[0]}:{from_node:h,from_socket:h.outputs[0],to_node:g,to_socket:g.inputs[0]},f.nodes=[h,g],f.links=[k];e=a.name;h=f.nodes;g=f.links;for(k=0;k<h.length;k++)h[k].name=S(h[k].type,e,h[k].name);for(k=0;k<g.length;k++)g[k].from_node.name=S(g[k].from_node.type,e,g[k].from_node.name),g[k].to_node.name=S(g[k].to_node.type,e,g[k].to_node.name);return{XD:d(f,a.node_group.uuid,!0,b,c),YD:f.links}}function Q(a){var b=
typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?ra.Mj(a):a}function J(a){H[a]||(H[a]=0);var b=a+H[a],b=b.replace(/ /g,"_").replace(/\//g,"_");H[a]++;return b}function D(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function G(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";
case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}function M(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";
default:return null}}}function I(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,f=0;f<b.length;f++){var h=b[f];if(h.is_linked)switch(h.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&da.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==
a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function y(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return T(e)}return null}function V(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return T(e)}return null}function T(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=ra.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,Kb:d,Ha:a}}function R(a,b,c,d){return{name:a,identifier:b,Kb:d||!1,Ha:c}}function ha(a){for(var b=
[],c=0;c<a.inputs.length;c++){var d=T(a.inputs[c]);d.Ha.length&&d.Ha.splice(3);b.push(d)}return b}function ia(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=T(a.outputs[c]);b.push(d)}return b}function aa(a,b,c){b=null===b||void 0===b?null:ua.s(b,c);return{name:a,value:b}}function W(a,b,c,d,e,f){var h=[],g=f.from_socket.identifier;f=f.to_socket.identifier;var k=d.ra;for(d=0;d<k.length;d++)if(k[d].identifier==g){h.push(d);break}e=e.F;for(d=0;d<e.length;d++)if(e[d].identifier==f){h.push(d);break}2==
h.length&&P.dc(a,b,c,h);return!0}function S(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function X(a){var b=[];P.aa(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function ca(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.XD,f=c[d].data.YD;if(!e)return!1;P.aa(e,function(b,c){P.Uh(a,P.pk(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);U(c[d],b,a)}return!0}function oa(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function fa(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],h=null,g=0;g<b.length;g++)if(f.from_socket.identifier==b[g].to_socket.identifier){h=b[g];break}h?(f.from_node=h.from_node,f.from_socket=h.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function ma(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function L(a,b,c,
d){for(var e=0;e<d.length;e++){for(var f=d[e],g,k=0;k<c.F.length;k++)if(f.from_socket.identifier==c.F[k].identifier){g=c.F[k].Ha;break}for(var k=f,l=b,n=g,m=h(k.to_node,l),q=0;q<m.length;q++)for(var r=P.La(l,m[q]),t=0;t<r.F.length;t++){var u=r.F[t];if(u.identifier==k.to_socket.identifier){r=u.Ha instanceof Object?0:1;if((n instanceof Object?0:1)==r)u.Ha=n;else switch(r){case 0:u=u.Ha;u[0]=u[1]=u[2]=n;break;case 1:u.Ha=(n[0]+n[1]+n[2])/3}break}}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function U(a,b,c){for(var d=
a.name,e=[],f=[],h=[],g=[],k=0;k<b.length;k++){var l=b[k];oa(l.from_node,d,l,e,h,g);oa(l.to_node,d,l,f,h,g)}f=fa(b,f,h);e=fa(b,g,e);ma(b,f);L(b,c,a,f);if(e.length){var n;P.aa(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(n=b)});L(b,c,n,e)}}var ga=p("__config"),P=p("__graph"),va=p("__mat3"),ja=p("__mat4"),na=p("__objects"),da=p("__print"),ua=p("__shaders"),ea=p("__scenes"),ra=p("__util"),ta=p("__vec3"),H={},pa={},qa={},ba=0;new Float32Array(4);var ya=ga.p;a.nA=d;a.Po=function(a,
b,d){var f=ea.get_active();a=e(a,"MAIN",f.uuid);if(a in pa)return pa[a];var f=P.create(),h={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},g=O(f,h,0,b,null),h={name:"LIGHTING_END",type:"LIGHTING_END"},h=O(f,h,0,b,null);c(f,d,g,h,[[g,[8,10]],[g,[9,6]]],b);n(f);return pa[a]=f};a.$l=function(a){var b=[],c={};H={};var d=P.zr(a);P.aa(d,function(a,d){var e;e=[];for(var f=[],h=[],g=[],k=[],l=[],n=0;n<d.F.length;n++){var m=d.F[n];if(m.Kb)e.push(null),f.push(null);else{e.push(J("in_"+d.type+"_"+m.identifier));
var q=ua.s(m.Ha,0);ya.Xv&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==m.identifier||"Color2"==m.identifier||"Fac"==m.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==m.identifier||"Value_001"==m.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==m.identifier||0<=d.type.indexOf("LIGHTING_APPLY")||0<=d.type.indexOf("MATERIAL_END")||0<=d.type.indexOf("MATERIAL_BEGIN"))&&(m=q,m=m.replace(/(,)/g,"$1 "),m=m.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),m=m.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,
"$1UNITY_VALUE_NODES$3"),q=m=m.replace(/\s+/g,""));f.push(q)}}for(n=0;n<d.ra.length;n++)m=d.ra[n],m.Kb?h.push(null):h.push(J("out_"+d.type+"_"+m.identifier));for(n=0;n<d.M.length;n++)m=d.M[n],g.push(m.name),k.push(m.value);for(n=0;n<d.mg.length;n++)l.push(d.mg[n].name);e={id:d.type,F:e,Np:f,ra:h,M:g,Ym:k,mg:l,xd:JSON.parse(JSON.stringify(d.xd))};b.push(e);c[a]=e});P.ye(d,function(a,b,e){var f=P.La(d,a);P.La(d,b);var h=f.ra[e[0]];a=c[a].ra;b=c[b].F;f=a[e[0]]||J("out_"+f.type+"_"+h.identifier);a[e[0]]=
f;b[e[1]]=f});return b};a.Ss=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in pa)delete pa[a];for(var b in qa)delete qa[b];ba=0}};b4w.module.__animation=function(a,p){function d(a,b){var c=a.G[b];c&&c.np&&c.ik&&(c.ik=!1,c.np(a,b))}function b(a,b,c){c=a.G[c];c.type=30;var d=b.L,e=b.ea-d+1;c.start=d;c.length=e;c.Sc=d;c.De=b.name;for(e=d=0;e<a.ac.length;e++){var f=a.ac[e];if(f==b)break;else d+=f.ea-f.L+1}c.Yw=d}function c(a,b,c){for(var d=a.K,e=0;e<d.length;e++)for(var f=d[e].V,h=0;h<f.length;h++){var g=f[h].za;if(g&&g.name==b){var k=a.G[c];k.type=50;k.De=g.name;k.start=g.L;k.length=g.ea-k.start;g.cyclic||(k.length+=g.$p)}}}function m(a){return a.replace(/_B4W_BAKED$/,
"")}function e(a,b){if(a.animation_data){var c=a.animation_data.action;c&&c.k.type==da&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var f=c[d];f.node_group&&(f=f.node_group.node_tree)&&e(f,b)}}function t(a){return y.is_mesh(a)&&a.f.ac?!0:!1}function k(a,b,c){var d=a.G;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.Sc=b,g(a,0,c,!0))}else if(e=d[c])e.Sc=b,g(a,0,c,!0)}function n(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function g(a,b,c,e){B(a,b,c,e);d(a,c);a.f.zg&&(u(a,
b),z(a,b))}function x(a,b,c){var d=b.frame_range;if(d[0]>d[1])return R.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var e=b.k,g=a.G[c];g.De=b.name;g.Wn=d;g.ms=e.nv;g.ls=e.Bs;g.Fg.set(e.Fg);g.start=d[0];g.length=d[1]-d[0];g.Sc=d[0];switch(e.type){case va:if(y.is_armature(a)){g.type=10;var k=l(a,b);if(!k){for(var k=a.f.td,d=[],n=[],m=b.k.tq,q=0;q<m;q++){for(var t in k){var u=k[t],p=u.An,x=b.k.ro[t];x?X.copy(x.subarray(8*q,8*q+8),p):X.identity(p);u.Bn=!1}u=r(k);
d.push(u.trans);n.push(u.sa)}k={trans:d,sa:n};a.Sh.push(b,k)}g.trans=k.trans;g.sa=k.sa;g=k;t=a.f;k=t.sn;n=a.G[c];d=n.ar;a:{m=t.bw;for(q=0;q<m.length;q+=2)if(b==m[q]){m=m[q+1];break a}m=null}if(m)n.ar=m;else{for(n=0;n<k.length;n++){for(var m=k[n].Yh,q=[],u=[],p=g.trans,x=g.sa,L=0;L<p.length;L++){var z=f(p[L],x[L],m);q.push(z.trans);u.push(z.sa)}d.push({trans:q,sa:u})}t.bw.push(b,d)}t.zg&&(b=t.En,c>b[1]?(g=b[1],b[1]=c,b[0]=g):c>b[0]&&c<b[1]&&(b[0]=c),h(a))}break;case ja:y.is_speaker(a)&&(g.volume=e.M.volume||
null,g.pitch=e.M.pitch||null,g.type=40);break;case ua:y.is_lamp(a)&&(g.color=e.M.color||null,g.Pe=e.M.energy||null,g.type=70);break;case da:if("MESH"==a.type){g.type=60;t=l(a,b);if(!t){t=[];d=[];n=[];m=[];q=b.k;u=a.f.Om;p=a.f.Pm;for(k in q.M)x=b.name+"%join%"+k,C(k,x,q,d,t,u),C(k,x,q,m,n,p);t={VG:t,values:d,IE:n,JE:m};a.Sh.push(b,t)}g.Wu=t.VG;g.Yu=t.values;g.Vu=t.IE;g.Xu=t.JE}break;case na:if(t=e.M.tsr){g.type=20;k=l(a,b);if(!k){k=b.k.tq;d=[];n=[];for(m=0;m<k;m++)d.push(t.subarray(8*m,8*m+4)),n.push(t.subarray(8*
m+4,8*m+8));k={trans:d,sa:n};a.Sh.push(b,k)}g.trans=k.trans;g.sa=k.sa;V.Ii(a)&&V.DG(a,g.trans[0],g.sa[0])}else return R.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1}y.is_armature(a)&&e.type!=va&&v(a,c);return!0}function l(a,b){for(var c=a.Sh,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function h(a){var b=a.f.En;if(-1!=b[0]&&-1!=b[1]){var c=a.G;a=c[b[1]].Sc;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.Sc;d=Math.floor(a);b.Sc=d+e}}function v(a,b){var c=
a.f.En,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.G;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function C(a,b,c,d,e,f){for(var h=0;h<f.length;h+=2)b==f[h]&&(e.push(f[h+1]),d.push(new Float32Array(c.M[a])))}function A(a){a=a.k;for(var b in a.M)if(-1!=b.indexOf("nodes"))return!0;return!1}function B(a,b,c,d){if((c=a.G[c])&&null!=c.type&&(c.play||d)){var e=a.f,f=c.Sc,h=c.start,g=c.length,f=f+c.speed*b*W.Rb(),k=c.type,l=c.speed;if(0<=l&&f>=h+g||0>l&&f<h)switch(d||
(c.ik=!0),c.behavior){case 10:f=0<=l?(f-h)%g+h:h+g-1E-6;break;case 20:f=0<=l?h:h+g-1E-6;c.play=!1;break;case 30:f=0<=l?h+g-1E-6:h,c.play=!1}c.Sc=f;switch(k){case 10:if(!e.zg){d=q(c);b=d[0];f=d[1];d=d[2];e.Fc=c.sa[b];e.dd=c.sa[f];e.Lc=c.trans[b];e.ld=c.trans[f];e.Ad=d;d=e.sn;c=c.ar;for(h=0;h<d.length;h++)g=d[h],k=c[h],g.Fc=k.sa[b],g.dd=k.sa[f],g.Lc=k.trans[b],g.ld=k.trans[f],g.Ad=e.Ad;S.o(a)}break;case 20:d=q(c);var e=ra,f=d[0],h=d[1],g=d[2],k=c.trans,l=k[f][1],m=k[f][2],n=k[h][1],r=k[h][2];e[0]=(1-
g)*k[f][0]+g*k[h][0];e[1]=(1-g)*l+g*n;e[2]=(1-g)*m+g*r;f=H;m=d[0];h=d[1];g=d[2];k=c.sa;l=pa;l[0]=k[m][0];l[1]=k[m][1];l[2]=k[m][2];l[3]=k[m][3];m=qa;m[0]=k[h][0];m[1]=k[h][1];m[2]=k[h][2];m[3]=k[h][3];ha.slerp(l,m,g,f);h=d[2];g=c.trans;d=(1-h)*g[d[0]][3]+h*g[d[1]][3];c.Ar&&(h=ta,S.get_translation(a,h),ca.smooth_v(e,h,b,c.Ar,e));c.Gq&&(h=pa,S.get_rotation(a,h),ca.gw(f,h,b,c.Gq,f));h=c.Fg;h[0]&&S.set_translation_rel(a,e);h[1]&&S.set_rotation_rel(a,f);h[2]&&S.set_scale_rel(a,d);S.o(a);T.sync_transform(a);
break;case 30:d=c.Sc-c.start;0>d&&(d=0);d>=c.length&&(d=c.length);a=Math.floor(d);b=a+1;d-=a;10!=c.behavior&&b==c.length&&(b=--a,d=1);c=c.Yw;ea[0]=a+c;ea[1]=b+c;ea[2]=d;d=ea;e.Jr=d[0];e.Xw=d[2];break;case 40:d=q(c);b=d[0];e=d[1];d=d[2];c.volume&&aa.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&aa.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:V.hF(a,c.De,f/W.Rb());break;case 60:d=q(c);b=d[0];e=d[1];d=d[2];k=c.Yu;l=c.Wu;f=c.Xu;h=c.Vu;for(c=0;c<l.length;c++)m=k[c],g=l[c],a.f.Ye[g]=
(1-d)*m[b]+d*m[e];for(c=0;c<h.length;c++)k=f[c],g=h[c],k=oa.lerp(k.subarray(3*b,3*b+3),k.subarray(3*e,3*e+3),d,ra),a.f.$c[3*g]=k[0],a.f.$c[3*g+1]=k[1],a.f.$c[3*g+2]=k[2];break;case 70:d=q(c);b=d[0];e=d[1];d=d[2];h=c.Fg;(f=c.Pe)&&h[0]&&ma.Wq(a.Fa,(1-d)*f[b]+d*f[e]);(c=c.color)&&h[1]&&(ra[0]=(1-d)*c[3*b]+d*c[3*e],ra[1]=(1-d)*c[3*b+1]+d*c[3*e+1],ra[2]=(1-d)*c[3*b+2]+d*c[3*e+2],ma.Sv(a.Fa,ra));b=a.K;for(c=0;c<b.length;c++)L.tG(a,b[c].Ga);break;default:ca.O("Unknown animation type:"+k)}}}function q(a){var b=
a.Wn[0],c=a.Wn[1]-b,b=a.Sc-b;0>b&&(b=0);b>=c&&(b=c);b/=a.ms;c=Math.floor(b);a=a.ls[c]?b-c:0;b=Math.ceil(c+a);ea[0]=c;ea[1]=b;ea[2]=a;return ea}function z(a,b){var c=a.f,d=c.sf,e=c.En,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var h=a.G[f];if(h.play||0==b){var g=q(h),k=g[0],l=g[1];c.Ad=g[2];var g=h.sa[k],m=h.sa[l],k=h.trans[k],l=h.trans[l]}else d=1}else d=1;e=a.G[e];if(e.play||0==b){var f=q(e),n=f[0],r=f[1];c.Ad=f[2]}else if(-1!=f&&h.play)d=0;else return;f=e.sa[n];h=e.sa[r];n=e.trans[n];r=e.trans[r];if(1==
d)c.Fc.set(f),c.dd.set(h),c.Lc.set(n),c.ld.set(r);else if(0==d)c.Fc.set(g),c.dd.set(m),c.Lc.set(k),c.ld.set(l);else{for(e=0;e<g.length;e+=4){for(var t=H,u=pa,p=0;4>p;p++)t[p]=g[e+p],u[p]=f[e+p];ha.slerp(t,u,d,t);for(p=0;4>p;p++)c.Fc[e+p]=t[p];for(p=0;4>p;p++)t[p]=m[e+p],u[p]=h[e+p];ha.slerp(t,u,d,t);for(p=0;4>p;p++)c.dd[e+p]=t[p]}ca.Ds(k,n,d,c.Lc);ca.Ds(l,r,d,c.ld)}S.o(a);fa.BG(a)}}function u(a,b){var c=a.f,d=c.sf,e=c.bo;if(0!=e){var d=c.ao-d,f=e*b;ca.sign(d)==ca.sign(e)&&Math.abs(f)<Math.abs(d)?
c.sf+=f:(c.sf=c.ao,c.bo=0)}}function r(a){var b=[],c=[],d=new Float32Array(4),e=new Float32Array(4),f;for(f in a){var h=a[f],g=d,k=e,l=h.Xl,m=l[l.length-1],n=m.Cr;m.Bn||X.identity(n);for(m=l.length-1;0<=m;m--){var q=l[m],r=q.Cr;if(q.Bn)n=r;else{var t=q.hg,u=q.An;X.invert(t,ba);X.multiply(u,ba,ba);X.multiply(t,ba,ba);X.multiply(n,ba,r);n=r;q.Bn=!0}}l=q.Cr;g[0]=l[0];g[1]=l[1];g[2]=l[2];g[3]=l[3];k[0]=l[4];k[1]=l[5];k[2]=l[6];k[3]=l[7];ha.normalize(k,k);h=h.uf;for(g=0;4>g;g++)k=4*h+g,b[k]=d[g],c[k]=
e[g]}return{trans:b,sa:c}}function f(a,b,c){var d=[],e=[];new Float32Array(4);new Float32Array(4);for(var f in c)for(var h=c[f],g=h.uf,h=h.ap,k=0;4>k;k++){var l=4*h+k,m=4*g+k;d[l]=a[m];e[l]=b[m]}d=new Float32Array(d);e=new Float32Array(e);return{trans:d,sa:e}}function E(a){var b=a.k,c;if(b.ro)c=va;else if(b.M)if("volume"in b.M||"pitch"in b.M)c=ja;else if(A(a))c=da;else{a:{if(a.k.M){a=a.fcurves;for(c in a)if("color"==c&&!a[c][3]){c=!0;break a}if("energy"==c){c=!0;break a}}c=!1}c=c?ua:na}else c=P;b.type=
c}function A(a){if(a=a.k.M)for(var b in a)if(-1!=b.indexOf("nodes"))return!0;return!1}function w(a,b){b[0]=b[1]=b[2]=0;for(var c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1)}function N(a,b){b[0]=b[1]=0;for(var c in a)"energy"==c?b[0]=1:"color"==c&&(b[1]=1)}function O(a,b,c,d,e,f,h){var g=a+(b-a)/2,k=K(g,d,e,f,h)-c;return.02>Math.abs(k)?g:0<k?O(a,g,c,d,e,f,h):O(g,b,c,d,e,f,h)}function K(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function F(a,b){var c=
{type:null,De:null,Wn:null,ms:0,ls:null,Fg:new Int8Array(3),sa:null,trans:null,ar:[],play:!1,behavior:20,Sc:0,start:0,length:0,Ar:0,Gq:0,ik:!1,Yw:null,speed:1,volume:null,pitch:null,color:null,Pe:null,Yu:[],Wu:[],Xu:[],Vu:[]};if(!a.G.length)for(var d=0;8>d;d++)a.G.push(null);a.G[b]=c;-1==ya.indexOf(a)&&ya.push(a)}function Q(a,b){S.o(a);T.sync_transform(a);g(a,0,b,!0)}function J(a,d,e){e=e||0;if(y.is_mesh(a)){var f=D(a,d);if(f)return F(a,e),b(a,f,e),Q(a,e),!0;if((f=G(a,d))&&"EMITTER"==f.wq)return F(a,
e),c(a,f.name,e),Q(a,e),!0}if(f=ca.keysearch("name",d,Da)||ca.keysearch("name",d+"_B4W_BAKED",Da)){F(a,e);if(x(a,f,e))return Q(a,e),!0;a.G[e]=null}R.error('Unsupported object: "'+a.name+'" or animation name: "'+d+'"');return!1}function D(a,b){for(var c=0;c<a.ac.length;c++){var d=a.ac[c];if(d.name===b)return d}return null}function G(a,b){for(var c=a.K,d=0;d<c.length;d++)for(var e=c[d].V,f=0;f<e.length;f++){var h=e[f].za;if(h&&h.name===b)return h}return null}function M(a){a=a.modifiers;for(var b=0;b<
a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}var I=p("__config"),y=p("__obj_util"),V=p("__particles"),T=p("__physics"),R=p("__print"),ha=p("__quat"),ia=p("__reformer"),aa=p("__sfx"),W=p("__time"),S=p("__transform"),X=p("__tsr"),ca=p("__util"),oa=p("__vec3"),fa=p("__armature"),ma=p("__lights"),L=p("__scenes"),U=I.Ag,ga=I.p;a.Ox=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=
50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.IH=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var P=a.lH=0,va=a.sx=1,ja=a.mH=2,na=a.ux=3,da=a.Ur=4,ua=a.tx=5,ea=Array(3),ra=new Float32Array(3),ta=new Float32Array(3),H=new Float32Array(4),pa=new Float32Array(4),qa=new Float32Array(4),ba=X.create();new Float32Array(16);var ya=[],Da=[];a.Xt=function(){return ca.trunc((ga.Ru-50)/4)};a.frame_to_sec=function(a){return a/
W.Rb()};a.update=function(a){for(var b=0;b<ya.length;b++){for(var c=ya[b],e=0;8>e;e++)B(c,a,e);c.f.zg&&(u(c,a),z(c,a))}for(b=0;b<ya.length;b++)for(c=ya[b],e=0;8>e&&c.G.length;e++)d(c,e)};a.Nt=function(){return Da};a.get_anim_names=function(a){var b=[];if(t(a))for(var c=0;c<a.ac.length;c++)b.push(a.ac[c].name);for(var d=[],c=0;c<Da.length;c++){var e=Da[c],f=e.k;f.type==na?d.push(e):f.type==va&&"ARMATURE"==a.type?d.push(e):f.type==ja&&"SPEAKER"==a.type&&d.push(e)}if("MESH"==a.type)for(c=0;c<a.actions.length;c++)e=
a.actions[c],e.k.type==da&&d.push(e);for(c=0;c<d.length;c++)b.push(m(d[c].name));if(V.Ii(a)&&V.uq(a))for(a=a.K,c=0;c<a.length;c++)for(d=a[c].V,e=0;e<d.length;e++)(f=d[e].za)&&b.push(f.name);return b};a.JF=m;a.get_anim_type=function(a,b){var c=a.G[b];return c?c.type:0};a.apply_def=function(a){for(var d=0,e=a.K,f=0;f<e.length;f++)for(var h=e[f].V,g=0;g<h.length;g++){var k=h[g].za;k&&"EMITTER"==k.wq&&(F(a,d),c(a,k.name,d),Q(a,d),a.G[d].behavior=a.Hl,k.cyclic&&(a.G[d].behavior=10),d++)}e=a.actions.slice();
for(f=0;f<e.length;f++)h=e[f],F(a,d),x(a,h,d)?(Q(a,d),a.G[d].behavior=a.Hl,d++):a.G[d]=null;t(a)&&(F(a,d),b(a,a.ac[0],d),Q(a,d),a.G[d].behavior=a.Hl)};a.qs=function(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:ca.O("Wrong animation behavior")}};a.kC=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&e(d,b)}return b};a.play=function(a,b,c){n(a.G,c,function(a){a.play=!0;a.np=b?b:null;a.ik=!1});a.f.zg&&
h(a)};a.stop=function(a,b){n(a.G,b,function(a){a.play=!1;a.np=null;a.ik=!1})};a.is_play=function(a,b){var c=a.G;if(-1==b)for(var d=0;8>d;d++){if(c[d]&&c[d].play)return!0}else if(c=c[b])return c.play;return!1};a.set_frame=k;a.set_first_frame=function(a,b){b=b||0;n(a.G,b,function(c){k(a,c.start,b)})};a.get_current_frame_float=function(a,b){var c=a.G[b];return c&&c.Sc?c.Sc:0};a.is_cyclic=function(a,b){var c=a.G[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){n(a.G,c,function(a){a.behavior=
b})};a.get_behavior=function(a,b){var c=a.G[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){n(a.G,d,function(a){a.Ar=b||0;a.Gq=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.G[c]=null;else a.G[b]=null;a.f.zg&&v(a,b)};a.update_object_animation=g;a.fv=function(a){if("ARMATURE"==a.type||a.Ll)return!0;for(var b=0;b<a.actions.length;b++){var c=a.actions[b].k.type;if(c==na||c==va||c==ja&&"SPEAKER"==a.type||c==ua&&"LAMP"==a.type||c==da&&"MESH"==a.type)return!0}return V.Ii(a)&&
V.uq(a)||"MESH"==a.type&&a.ac.length?!0:!1};a.Hs=function(a,b){if("ARMATURE"==b.type||M(a))return!0;for(var c=0;c<b.actions.length;c++){var d=b.actions[c].k.type;if(d==na||d==va||d==ja&&"SPEAKER"==b.type||d==da&&"MESH"==b.type)return!0}return V.Jz(a)&&V.Iz(a)||"MESH"==b.type&&a.data.b4w_vertex_anim.length?!0:!1};a.is_animated=function(a){return Boolean(a.G.length)};a.Mz=r;a.DB=f;a.Uy=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);ha.normalize(e,e)}}function c(a,b){if(-1<
a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,e=0):(d=0,e=b);return d+e}function d(a,b,c,h,g){if(-1<c.search(e)){a=b;c=c.split('"')[1];var k=f}else 8==g?(c="tsr",k=f):k=1<g?new Float32Array(g):0;if(!a[c]){g=a;b=c;if("object"==typeof k&&k.length)for(var l=k.length,m=new Float32Array(h*l),n=0;n<h;n++)for(var q=0;q<l;q++)m[n*l+q]=k[q];else if("number"==typeof k)for(m=new Float32Array(h),n=0;n<h;n++)m[n]=k;else ca.O("Wrong storage default value");
g[b]=m}return a[c]}var e=new RegExp(/pose.bones\[\".+\"\]/g),f=X.create(),h=a.k={type:P,tq:0,nv:0,M:null,ro:null,Bs:null,Fg:new Int8Array(3)};h.nv=1/U.Ug;var g=a.fcurves,k={},l={},m=0,n;for(n in g){var q=g[n],r;for(r in q){var t=q[r],u=t.Pc;ia.Uz(t,a);t=t.num_channels;m||(m=u.length);for(var t=d(k,l,n,m,t),p=t.length/m,v=c(n,r|0),x=0;x<m;x++)t[x*p+v]=u[x]}}if(ca.qk(k)){for(var L in k)"tsr"==L&&b(k[L],m);h.M=k}if(ca.qk(l)){for(var z in l)b(l[z],m);h.ro=l}h.tq=m;h.Bs=a.Ny;"tsr"in k&&w(g,h.Fg);("color"in
k||"energy"in k)&&N(g,h.Fg);E(a);Da.push(a)};a.iC=function(a,b){return(b-a)*U.Ug+1};a.qz=function(a,b,c,d,e,f){var h,g,k=new Float32Array(2),l=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),q=b[1],r=b[2],t=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var u=0,p=0,v=null;e<=f;e++)if(e<q)for(var x=0;x<U.Ug;x++)c[u++]=r;else if(e>t)for(x=0;x<U.Ug;x++)c[u++]=a;else{var L=b[p],z=3;0===L&&(z+=2);0===v&&(z+=2);var y=2===L?0:1;if(b[p+1]==b[p+z+1])v=L,p+=z;else{x=0;e==b[p+1]&&(y&&
(d[u]=1),c[u]=b[p+2],u++,x++);if(e==t)for(;x<U.Ug;x++)c[u++]=a;else for(k[0]=b[p+1],k[1]=b[p+2],0!==L?(l[0]=0,l[1]=0):0===v?(l[0]=b[p+5],l[1]=b[p+6]):(l[0]=b[p+3],l[1]=b[p+4]),0!==L?(m[0]=0,m[1]=0):(m[0]=b[p+z+3],m[1]=b[p+z+4]),n[0]=b[p+z+1],n[1]=b[p+z+2];x<U.Ug;x++){var F=e+x/U.Ug;switch(L){case 0:h=k;g=l;var I=m,w=n,A=[],B=[],P=void 0,ga=void 0,C=void 0,P=void 0;A[0]=h[0]-g[0];A[1]=h[1]-g[1];B[0]=w[0]-I[0];B[1]=w[1]-I[1];C=w[0]-h[0];P=Math.abs(A[0]);ga=Math.abs(B[0]);0!=P+ga&&P+ga>C&&(P=C/(P+ga),
g[0]=h[0]-P*A[0],g[1]=h[1]-P*A[1],I[0]=w[0]-P*B[0],I[1]=w[1]-P*B[1]);y&&(d[u]=1);c[u]=K(O(0,1,F,k[0],l[0],m[0],n[0]),k[1],l[1],m[1],n[1]);u++;break;case 1:g=k[0];I=k[1];h=w=(n[1]-I)/(n[0]-g);g=I-w*g;y&&(d[u]=1);c[u]=h*F+g;u++;break;case 2:y&&(d[u]=1);c[u]=b[p+2];u++;break;default:ca.O("Unknown keyframe interpolation mode: "+L)}}e+1==b[p+z+1]&&(v=L,p+=z)}}};a.apply=J;a.mz=function(a,b,c){c=c||0;var d=ca.keysearch("uuid",b,Da);if(d){F(a,c);if(x(a,d,c)){Q(a,c);return}a.G[c]=null}R.error('Unsupported object: "'+
a.name+'" or animation uuid: "'+b+'"')};a.WG=function(a,b){var c=ca.keysearch("name",b,Da)||ca.keysearch("name",b+"_B4W_BAKED",Da);if(c){if(c.k.type==P)return!1}else if(!(G(a,b)||y.is_mesh(a)&&D(a,b)))return!1;return!0};a.get_slot_num_by_anim=function(a,b){for(var c=a.G,d=0;d<c.length;d++){var e=c[d];if(e&&m(e.De)==m(b))return d}return-1};a.gC=function(a,b){var c=a.G[b];return c&&c.De?m(c.De):null};a.remove=function(a){a.G.length=0;a=ya.indexOf(a);-1!=a&&ya.splice(a,1)};a.wE=function(a){for(var b=
Da.length-1;0<=b;b--)Da[b].Oy==a&&Da.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.G.length)return J(a,b,0)?0:-1;for(var c=0;c<a.G.length;c++)if(!a.G[c])return J(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.f.bo=(b-a.f.sf)/c;a.f.ao=b};a.set_speed=function(a,b,c){n(a.G,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.G[b].speed};a.get_anim_start_frame=function(a,b){return a.G[b].start};a.get_anim_length=function(a,b){return a.G[b].length};a.cleanup=function(){ya.length=
0;Da.length=0};a.FB=function(a){var b=(a[0]||a[1]||a[2]).Pc.length,c=H,d=ra,e=Boolean(a[0]);e||(a[0]={Pc:new Float32Array(b),num_channels:8});var f=Boolean(a[1]);f||(a[1]={Pc:new Float32Array(b),num_channels:8});var h=Boolean(a[2]);h||(a[2]={Pc:new Float32Array(b),num_channels:8});a[3]={Pc:new Float32Array(b),num_channels:8};for(var g=0;g<b;g++)d[0]=e?a[0].Pc[g]:0,d[1]=f?a[1].Pc[g]:0,d[2]=h?a[2].Pc[g]:0,ca.euler_to_quat(d,c),a[0].Pc[g]=c[3],a[1].Pc[g]=c[0],a[2].Pc[g]=c[1],a[3].Pc[g]=c[2]};a.Qt=M};b4w.module.__time=function(a,p){var d=p("__config");p("__print");p("__util");var b=0,c=0,m=[],e=0,t=0,k=[],n=-1;a.Vv=function(a){b=a;c=performance.now();for(a=0;a<m.length;a++){var d=m[a];b>d.jp&&(m.splice(a,1),a--,d.callback())}for(a=0;a<k.length;a++){var d=k[a],e=1-(d.jp-b)/d.duration,e=Math.min(e,1);d.callback(d.from+e*(d.to-d.from));1==e&&(k.splice(a,1),a--)}};a.get_timeline=function(){return b};a.set_timeout=function(a,d){var k;e++;k=e;m.push({id:k,callback:a,jp:b+(performance.now()-c+d)/1E3});
return k};a.clear_timeout=function(a){for(var b=0;b<m.length;b++)if(m[b].id==a){m.splice(b,1);break}};a.clear_animation=function(a){for(var b=k.length;b--;)if(k[b].id==a){k.splice(b,1);break}};a.animate=function(a,c,d,e){d/=1E3;var m;t++;m=t;k.push({id:m,callback:e,from:a,to:c,jp:b+d,duration:d});e(a);return m};a.reset=function(){c=b=0;m.length=0;t=e=k.length=0};a.Rb=function(){return-1!==d.Ag.tm?d.Ag.tm:n};a.WE=function(a){n=a}};b4w.module.__transform=function(a,p){function d(a,b){g.Cd(a)?A.set_trans(b,g.Bd(a)):A.set_trans(b,a.f.h)}function b(a,b){var c=a.f;if(g.Cd(a)){A.set_quat(b,c.h);var d=g.um(a),d=A.invert(d,w);A.multiply(d,c.h,g.Bd(a))}else A.set_quat(b,c.h)}function c(a,b){g.Cd(a)?A.set_quat(b,g.Bd(a)):A.set_quat(b,a.f.h)}function m(a,b){g.Cd(a)?A.copy(b,g.Bd(a)):A.copy(b,a.f.h)}function e(a,b){g.Cd(a)?A.copy(g.Bd(a),b):A.copy(a.f.h,b);return b}function t(a){var b=a.f,c=a.K,d=a.type;"CAMERA"==d&&n.Er(a);g.qG(a,O);
"CAMERA"==d&&n.nG(a);var e=A.get_trans_view(b.h),f=A.get_quat_view(b.h);"CAMERA"==d&&A.set_scale(1,b.h);b.Ub&&b.wb&&(k.so(b.Ub,b.h,b.wb),k.vo(b.ud,b.h,b.Vb),k.uo(b.tf,b.h,b.Bg));switch(d){case "SPEAKER":C.AF(a,O);break;case "MESH":var m=a.Ll;m&&(A.invert(m.f.h,w),A.multiply(w,b.h,w),r.set(w[0],w[1],w[2],w[3],b.eo),h.set(w[4],w[5],w[6],w[7],b.co));break;case "CAMERA":n.oG(a);if(v.pa()){var u=v.get_active();v.ni(u)==a&&C.vD(u,e,f,O)}break;case "LAMP":x.uG(a)}for(u=0;u<c.length;u++){var p=c[u];if(p.Gm){var m=
p.Ga,E=m.k,N=p.V;switch(d){case "LAMP":v.Gn(a,m);break;case "CAMERA":v.QE(m);E.jc&&E.jc.enable_csm&&v.Sq(m);break;case "MESH":b.Ub&&b.wb&&(b.Ic&&v.Sq(m),E=p.zf,null!=b.vd&&E&&v.Kw(E,e));a.G.length&&l.uq(a)&&l.rG(a,N);break;case "EMPTY":B.Lw(a)}p=p.Uf;N=a.Qk;N.length&&p&&(E=p.j,v.Nw(p,e,f),q.Ow(N,E.pc),n.jF(E,v.ni(m)),z.pm(E.Yd,E.mk))}}c=a.Kd;for(u=0;u<c.length;u++)t(c[u]);a=a.Lo;for(u=0;u<a.length;u++)c=a[u],m=c[0],g.jG(m,c[1]);b.qp=!0}var k=p("__boundings"),n=p("__camera"),g=p("__constraints"),x=
p("__lights");p("__mat3");p("__mat4");var l=p("__particles"),h=p("__quat"),v=p("__scenes"),C=p("__sfx"),A=p("__tsr"),B=p("__objects"),q=p("__obj_util"),z=p("__util"),u=p("__vec3"),r=p("__vec4"),f=new Float32Array(3),E=new Float32Array(4);new Float32Array(9);var w=A.create(),N=A.create(),O=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.SPACE_PARENT=2;a.update=function(a){O=a};a.set_translation=function(a,b){var c=a.f;if(g.Cd(a)){A.set_trans(b,c.h);var d=g.um(a),d=A.invert(d,w);A.multiply(d,c.h,g.Bd(a))}else A.set_trans(b,
c.h)};a.set_translation_rel=d;a.get_translation=function(a,b){var c=A.get_trans_view(a.f.h);u.copy(c,b);return b};a.get_translation_rel=function(a,b){if(g.Cd(a))u.copy(A.get_trans_view(g.Bd(a)),b);else{var c=A.get_trans_view(a.f.h);u.copy(c,b)}return b};a.set_rotation=b;a.set_rotation_rel=c;a.get_rotation=function(a,b){var c=A.get_quat_view(a.f.h);h.copy(c,b);return b};a.get_rotation_rel=function(a,b){if(g.Cd(a))h.copy(A.get_quat_view(g.Bd(a)),b);else{var c=A.get_quat_view(a.f.h);h.copy(c,b)}return b};
a.set_rotation_euler=function(a,c){var d=z.euler_to_quat(c,E);b(a,d)};a.set_rotation_euler_rel=function(a,b){var d=z.euler_to_quat(b,E);c(a,d)};a.set_scale=function(a,b){var c=a.f;if(g.Cd(a)){var c=g.Bd(a),d=A.get_scale(g.um(a));A.set_scale(b/d,c)}else A.set_scale(b,c.h)};a.set_scale_rel=function(a,b){var c=a.f;g.Cd(a)?A.set_scale(b,g.Bd(a)):A.set_scale(b,c.h)};a.get_scale=function(a){return A.get_scale(a.f.h)};a.get_scale_rel=function(a){return g.Cd(a)?A.get_scale(g.Bd(a)):A.get_scale(a.f.h)};a.set_tsr=
function(a,b){var c=a.f;if(g.Cd(a)){A.set_trans(trans,c.h);var d=g.um(a),d=A.invert(d,w);A.multiply(d,c.h,g.Bd(a))}else A.copy(b,c.h)};a.set_tsr_rel=m;a.get_tsr=function(a,b){return A.copy(a.f.h,b)};a.get_tsr_rel=e;a.get_object_size=function(a){var b=a.f;a=b.Wh;var c=A.get_scale(b.h),b=c*(a.max_x-a.min_x),d=c*(a.max_y-a.min_y);a=c*(a.max_z-a.min_z);return.5*Math.sqrt(b*b+d*d+a*a)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(a=a.f,u.copy(a.Vb.H,c)):(a=a.f,b=a.Wh,c[0]=(b.max_x+
b.min_x)/2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,A.transform_vec3(c,a.h,c));return c};a.move_local=function(a,b,c,h){var k=e(a,w);f[0]=b;f[1]=c;f[2]=h;A.transform_vec3(f,k,f);d(a,f)};a.Oq=function(a,b){var c=e(a,w),d=A.set_quat(b,A.identity(N));A.multiply(c,d,d);m(a,d)};a.o=t;a.distance=function(a,b){var c=A.get_trans_view(a.f.h),d=A.get_trans_view(b.f.h);return u.dist(c,d)};a.Ji=function(a,b){var c=A.get_trans_view(a.f.h);return u.dist(c,b)};a.get_object_bounding_box=function(a){return{max_x:a.f.wb.max_x,
min_x:a.f.wb.min_x,max_y:a.f.wb.max_y,min_y:a.f.wb.min_y,max_z:a.f.wb.max_z,min_z:a.f.wb.min_z}}};b4w.module.__tsr=function(a,p){function d(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a}function b(){var a=new Float32Array(9);a[3]=1;a[7]=1;return a}function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3];return d}function m(a,b,c){var d=b[0],e=b[1],k=b[2],g=b[3],l=b[4],m=b[5],f=b[6];b=b[7];var n=a[0]*g,t=a[1]*g,p=a[2]*g;a=b*n+m*p-f*t;var g=b*t+f*n-l*p,x=b*p+l*t-m*n,n=-l*n-m*t-f*p;c[0]=a*b+n*-l+g*-f-x*-m;c[1]=g*b+n*-m+x*-l-a*-f;c[2]=x*b+n*-f+a*-m-g*-l;
c[0]+=d;c[1]+=e;c[2]+=k;return c}p("__mat3");var e=p("__mat4"),t=p("__quat"),k=p("__util"),n=p("__vec3"),g=new Float32Array(3),x=new Float32Array(4),l=new Float32Array(16);a.create=d;a.from_values=function(a,b,c,e,g,k,l,m){var n=d();n[0]=a;n[1]=b;n[2]=c;n[3]=e;n[4]=g;n[5]=k;n[6]=l;n[7]=m;return n};a.Oo=b;a.NI=function(a,c,d,e,g,k,l,m){var n=b();n[0]=a;n[1]=c;n[2]=d;n[3]=e;n[4]=g;n[5]=k;n[6]=l;n[7]=m;return n};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];
b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.set_sep=c;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4,
8)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],e=a[1],g=a[2];x[0]=a[4];x[1]=a[5];x[2]=a[6];x[3]=a[7];t.invert(x,x);var k=x[0],l=x[1],m=x[2],f=x[3],d=d*c,e=e*c,n=g*c,g=f*d+l*n-m*e,p=f*e+m*d-k*n,N=f*n+k*e-l*d,d=-k*d-l*e-m*n;b[0]=-(g*f+d*-k+p*-m-N*-l);b[1]=-(p*f+d*-l+N*-k-g*-m);b[2]=-(N*f+d*-m+g*-l-p*-k);b[3]=c;b[4]=k;b[5]=l;b[6]=m;b[7]=f;return b};a.to_mat4=function(a,b){var c=a[3];e.fromRotationTranslation(a.subarray(4,8),a.subarray(0,3),b);for(var d=0;12>d;d++)b[d]*=c;return b};
a.from_mat4=function(a,b){var d=k.Qu(a,g),e=k.Pu(a),l=k.matrix_to_quat(a,x);c(d,e,l,b);return b};a.multiply=function(a,b,c){m(b,a,c);c[3]=a[3]*b[3];var d=a[4],e=a[5],k=a[6];a=a[7];var g=b[4],l=b[5],n=b[6];b=b[7];c[4]=d*b+a*g+e*n-k*l;c[5]=e*b+a*l+k*g-d*n;c[6]=k*b+a*n+d*l-e*g;c[7]=a*b-d*g-e*l-k*n;return c};a.YF=function(a,b,c){var d=b[3];b=e.fromRotationTranslation(b.subarray(4,8),b.subarray(0,3),l);for(var k=0;12>k;k++)b[k]*=d;e.multiply(b,a,c);return c};a.transform_vec3=m;a.transform_vec3_inv=function(a,
b,c){var d=b[3],e=a[0]-b[0],k=a[1]-b[1],g=a[2]-b[2];a=b[4];var l=b[5],m=b[6];b=b[7];var f=a*a+l*l+m*m+b*b,f=f?1/f:0;a=-a*f;l=-l*f;m=-m*f;b*=f;var f=b*e+l*g-m*k,n=b*k+m*e-a*g,t=b*g+a*k-l*e,e=-a*e-l*k-m*g;c[0]=f*b+e*-a+n*-m-t*-l;c[1]=n*b+e*-l+t*-a-f*-m;c[2]=t*b+e*-m+f*-l-n*-a;c[0]/=d;c[1]/=d;c[2]/=d;return c};a.transform_vectors=function(a,b,c,d){d||(d=0);var e=a.length,k=b[0],g=b[1],l=b[2],m=b[3],f=b[4],n=b[5],t=b[6];b=b[7];for(var p=0;p<e;p+=3){var x=a[p]*m,K=a[p+1]*m,F=a[p+2]*m,Q=b*x+n*F-t*K,J=b*
K+t*x-f*F,D=b*F+f*K-n*x,x=-f*x-n*K-t*F;c[d+p]=Q*b+x*-f+J*-t-D*-n;c[d+p+1]=J*b+x*-n+D*-f-Q*-t;c[d+p+2]=D*b+x*-t+Q*-n-J*-f;c[d+p]+=k;c[d+p+1]+=g;c[d+p+2]+=l}return c};a.transform_dir_vectors=function(a,b,c,d){d||(d=0);var e=a.length,k=b[3],g=b[4],l=b[5],m=b[6];b=b[7];for(var f=0;f<e;f+=3){var n=a[f]*k,t=a[f+1]*k,p=a[f+2]*k,x=b*n+l*p-m*t,K=b*t+m*n-g*p,F=b*p+g*t-l*n,n=-g*n-l*t-m*p;c[d+f]=x*b+n*-g+K*-m-F*-l;c[d+f+1]=K*b+n*-l+F*-g-x*-m;c[d+f+2]=F*b+n*-m+x*-l-K*-g}return c};a.transform_dir_vec3=function(a,
b,c){var d=b[3],e=b[4],k=b[5],g=b[6];b=b[7];var l=a[0]*d,m=a[1]*d,f=a[2]*d;a=b*l+k*f-g*m;var d=b*m+g*l-e*f,n=b*f+e*m-k*l,l=-e*l-k*m-g*f;c[0]=a*b+l*-e+d*-g-n*-k;c[1]=d*b+l*-k+n*-e-a*-g;c[2]=n*b+l*-g+a*-k-d*-e;return c};a.transform_tangents=function(a,b,c,d){d||(d=0);var e=a.length,k=b[3],g=b[4],l=b[5],m=b[6];b=b[7];for(var f=0;f<e;f+=4){var n=a[f]*k,t=a[f+1]*k,p=a[f+2]*k,x=b*n+l*p-m*t,K=b*t+m*n-g*p,F=b*p+g*t-l*n,n=-g*n-l*t-m*p;c[d+f]=x*b+n*-g+K*-m-F*-l;c[d+f+1]=K*b+n*-l+F*-g-x*-m;c[d+f+2]=F*b+n*-m+
x*-l-K*-g;c[d+f+3]=a[f+3]}return c};a.translate=function(a,b,c){var d=a[3],e=a[4],k=a[5],g=a[6],l=a[7],m=b[0]*d,f=b[1]*d,n=b[2]*d;b=l*m+k*n-g*f;var d=l*f+g*m-e*n,t=l*n+e*f-k*m,m=-e*m-k*f-g*n;c[0]=a[0]+b*l+m*-e+d*-g-t*-k;c[1]=a[1]+d*l+m*-k+t*-e-b*-g;c[2]=a[2]+t*l+m*-g+b*-k-d*-e;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,d){n.lerp(a.subarray(0,3),b.subarray(0,3),c,d.subarray(0,3));var e=a[3];d[3]=e+c*(b[3]-e);t.slerp(a.subarray(4,8),b.subarray(4,8),c,d.subarray(4,
8));return d};a.FI=function(a,b,c,d){var e=a.subarray(0,3),k=b.subarray(0,3),g=d.subarray(0,3);g[0]=k[0]*(c+1)-e[0]*c;g[1]=k[1]*(c+1)-e[1]*c;g[2]=k[2]*(c+1)-e[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4,8);b=b.subarray(4,8);e=d.subarray(4,8);e[0]=b[0]*(c+1)-a[0]*c;e[1]=b[1]*(c+1)-a[1]*c;e[2]=b[2]*(c+1)-a[2]*c;e[3]=b[3]*(c+1)-a[3]*c;t.normalize(e,e);return d};a.TC=function(a,b,c,d,e){e[0]=a[0]+b*c[0];e[1]=a[1]+b*c[1];e[2]=a[2]+b*c[2];e[3]=a[3];c=d[0];var k=d[1];d=d[2];var g=a[4],l=a[5],m=a[6],f=a[7];
e[4]=.5*(c*f+k*m-d*l);e[5]=.5*(k*f+d*g-c*m);e[6]=.5*(d*f+c*l-k*g);e[7]=.5*(-c*g-k*l-d*m);e[4]=a[4]+e[4]*b;e[5]=a[5]+e[5]*b;e[6]=a[6]+e[6]*b;e[7]=a[7]+e[7]*b;a=e[4];b=e[5];c=e[6];k=e[7];a=a*a+b*b+c*c+k*k;0<a&&(a=1/Math.sqrt(a),e[4]*=a,e[5]*=a,e[6]*=a,e[7]*=a)}};b4w.module.__util=function(a,p){function d(a){return 0<a?1:0>a?-1:0}function b(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function c(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function m(a,b){var c=b;switch(typeof a){case "number":return e(a,c);case "string":return t(a,c);case "boolean":return e(a|0,c);case "function":case "undefined":return e(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==
a.byteLength)for(d=0;d<a.length;d++)c=e(a[d],c);else if(d)for(d=0;d<a.length;d++)c=m(a[d],c);else for(var f in a)c=m(a[f],c)}else c=e(0,c)}return c}function e(a,b){var c=b;I[0]=a;c=(c<<5)-c+y[0];c&=c;c=(c<<5)-c+y[1];return c&c}function t(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),c&=c;return c}function k(a){return(34*a+1)*a%289}function n(a){return a-Math.floor(a)}function g(a){return x((34*a+5)*a)}function x(a){return a-289*Math.floor(a/289)}function l(a){return a-7*Math.floor(a/
7)}function h(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function v(a){return h(a,0,2*Math.PI)}function C(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!A(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!A(a[f],
b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function A(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return C(a,b);default:return!0}}function B(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=
c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var q=p("__mat3"),z=p("__mat4"),u=p("__print"),r=p("__tsr"),f=p("__quat"),E=p("__vec3"),w=p("__vec4"),N=0,O={},K=new Float32Array(3),F=new Float32Array(3),Q=new Float32Array(4),J=new Float32Array(4),D=new Float32Array(9),G=new Float32Array(16),M=new Float32Array(16),I=new Float64Array(1),y=new Uint32Array(I.buffer),V=new Float32Array([0,0,0]),T=new Float32Array([0,0,0,1]),R=new Float32Array([0,0,0,1,0,0,0,1]),ha=new Float32Array([1,1,1]),ia=new Float32Array([1,
0,0]),aa=new Float32Array([0,1,0]),W=new Float32Array([0,0,1]),S=new Float32Array([-1,0,0]),X=new Float32Array([0,-1,0]),ca=new Float32Array([0,0,-1]),oa=Math.floor(44488.07041494893),fa=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,
0,0,1])];a.cs=V;a.bs=T;a.LH=R;a.ds=ha;a.AXIS_X=ia;a.AXIS_Y=aa;a.AXIS_Z=W;a.AXIS_MX=S;a.AXIS_MY=X;a.AXIS_MZ=ca;a.xx=fa;a.keyfind=function(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var h=c[f];h[a]==b&&d.push(h)}return d};a.IB=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.$F=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.aA=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,
!0)};a.rz=function(a,b){var c=[],d={},e=b.length,f,h;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)h=a[f],h in d&&c.push(h);return c};a.sign=d;a.AJ=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.zJ=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var h=e[f];if(h[a]==b&&h[c]==d)return h}return null};a.vC=function(a,b){for(var c=0;c<a.length;c++)if(a[c].uuid==
b)return c;return-1};a.lz=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.lI=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.VF=function(a,b,c,d){d||(d=new Float32Array(16));z.identity(d);d[12]=a;d[13]=b;d[14]=c};var ma=1;a.uE=function(){ma=(69069*ma+5)%Math.pow(2,32);return Math.round(ma/65536)%32768/32767};a.GF=function(a){ma=a};a.Fd=function(a){var b=a[0]%oa*48271-3399*Math.floor(a[0]/oa);a[0]=0<b?b:b+2147483647;
return(a[0]-1)/2147483646};a.Em=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),h=Math.sin(a[2]/2),k=Math.sin(a[0]/2);b[0]=f*h*e+c*d*k;b[1]=f*d*e+c*h*k;b[2]=c*h*e-f*d*k;b[3]=c*d*e-f*h*k;return b};a.vB=function(a){var b=q.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),h=Math.sin(a[1]);a=Math.sin(a[2]);var k=c*e,g=c*a,l=f*e,m=
f*a;b[0]=d*e;b[1]=d*a;b[2]=-h;b[3]=h*l-g;b[4]=h*m+k;b[5]=d*f;b[6]=h*k+m;b[7]=h*g-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],h=e*e,k=c*d+e*f;.499999<k?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>k?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*h),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*h),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));E.transformQuat(b,a,c);return c};
a.zI=function(a,b,c){c||(c=new Float32Array(4));a=E.normalize(a,K);var d=E.dot(b,a);a=E.cross(b,a,F);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.WF=function(a,b,c,d){d||(d=new Float32Array(4));E.transformQuat(c,b,d);d[3]=-E.dot(a,d)};a.lB=function(a){var b=r.get_quat_view(a.f.h);switch(a.type){case "CAMERA":K[0]=0;K[1]=-1;K[2]=0;E.transformQuat(K,b,K);F[0]=0;F[1]=0;F[2]=-1;break;case "MESH":K[0]=0;K[1]=0;K[2]=1;E.transformQuat(K,
b,K);F[0]=0;F[1]=0;F[2]=1;break;case "EMPTY":K[0]=0,K[1]=1,K[2]=0,E.transformQuat(K,b,K),F[0]=0,F[1]=1,F[2]=0}K[1]=0;E.normalize(K,K);a=E.dot(K,F);return Math.acos(a)*(0<-K[0]*F[2]?-1:1)};a.Ds=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.iK=function(){N++;return N.toString(16)};a.nj=function(a){O[a]||(O[a]=0);var b=a+O[a];O[a]++;return b};a.Ld=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.Ib=
function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,U:0,xa:null,A:[],R:b,fa:[]}};a.Gg=function(a){return JSON.parse(JSON.stringify(a))};a.qa=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.qa(b[d]);break;default:for(d in c=new c,b)c[d]=a.qa(b[d])}return c};a.Mj=function(a){var b=
a instanceof Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));q.fromMat4(a,D);var c=D[0],d=D[3],e=D[6],h=D[1],k=D[4],g=D[7],l=D[2],m=D[5],n=D[8],c=Math.sqrt(c*c+d*d+e*e)||1,h=Math.sqrt(h*h+k*k+g*g)||1,l=Math.sqrt(l*l+m*m+n*n)||1;D[0]/=c;D[3]/=c;D[6]/=c;
D[1]/=h;D[4]/=h;D[7]/=h;D[2]/=l;D[5]/=l;D[8]/=l;f.fromMat3(D,b);f.normalize(b,b);return b};a.Qu=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.Pu=function(a){Q[0]=.577350269189626;Q[1]=.577350269189626;Q[2]=.577350269189626;Q[3]=0;w.transformMat4(Q,a,Q);return w.length(Q)};a.pm=function(a,c){var d=c.left,e=c.right,f=c.top,h=c.bottom,k=c.ub,g=c.rb;d[0]=a[3]+a[0];d[1]=a[7]+a[4];d[2]=a[11]+a[8];d[3]=a[15]+a[12];e[0]=a[3]-a[0];e[1]=a[7]-a[4];e[2]=a[11]-a[8];e[3]=
a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];h[0]=a[3]+a[1];h[1]=a[7]+a[5];h[2]=a[11]+a[9];h[3]=a[15]+a[13];k[0]=a[3]+a[2];k[1]=a[7]+a[6];k[2]=a[11]+a[10];k[3]=a[15]+a[14];g[0]=a[3]-a[2];g[1]=a[7]-a[6];g[2]=a[11]-a[10];g[3]=a[15]-a[14];b(d);b(e);b(f);b(h);b(k);b(g)};a.BF=function(a,b,d){return d<-c(a,b.left)||d<-c(a,b.right)||d<-c(a,b.top)||d<-c(a,b.bottom)||d<-c(a,b.ub)||d<-c(a,b.rb)?!0:!1};a.tB=function(a,b,d,e,f){h=E.dot(d,b.rb);k=E.dot(e,b.rb);g=E.dot(f,b.rb);h=Math.sqrt(h*
h+k*k+g*g);if(h<-c(a,b.ub)||h<-c(a,b.rb))return!0;var h=E.dot(d,b.left),k=E.dot(e,b.left),g=E.dot(f,b.left);if(Math.sqrt(h*h+k*k+g*g)<-c(a,b.left))return!0;h=E.dot(d,b.right);k=E.dot(e,b.right);g=E.dot(f,b.right);if(Math.sqrt(h*h+k*k+g*g)<-c(a,b.right))return!0;h=E.dot(d,b.top);k=E.dot(e,b.top);g=E.dot(f,b.top);if(Math.sqrt(h*h+k*k+g*g)<-c(a,b.top))return!0;h=E.dot(d,b.bottom);k=E.dot(e,b.bottom);g=E.dot(f,b.bottom);return Math.sqrt(h*h+k*k+g*g)<-c(a,b.bottom)?!0:!1};a.Ri=function(a,b,c,d){d||(d=
0);for(var e=a.length,f=0;f<e;f+=3){var h=a[f],k=a[f+1],g=a[f+2];c[d+f]=b[0]*h+b[4]*k+b[8]*g+b[12];c[d+f+1]=b[1]*h+b[5]*k+b[9]*g+b[13];c[d+f+2]=b[2]*h+b[6]*k+b[10]*g+b[14]}};a.ZG=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var h=a[f],k=a[f+1],g=a[f+2];c[d+f]=b[0]*h+b[4]*k+b[8]*g;c[d+f+1]=b[1]*h+b[5]*k+b[9]*g;c[d+f+2]=b[2]*h+b[6]*k+b[10]*g}};a.SF=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var h=a[f],k=a[f+1],g=a[f+2];c[d+f]=b[0]*h+b[4]*k+b[8]*g;c[d+f+1]=b[1]*h+b[5]*k+b[9]*
g;c[d+f+2]=b[2]*h+b[6]*k+b[10]*g;c[d+f+3]=a[f+3]}};a.XG=function(a,b,c){c||(c=new Float32Array(3));Q[0]=a[0];Q[1]=a[1];Q[2]=a[2];Q[3]=0;w.transformMat4(Q,b,Q);c[0]=Q[0];c[1]=Q[1];c[2]=Q[2]};a.II=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.YG=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],
a[c+1],a[c+2]]);b[c/3]=d}return b};a.Rl=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.Rl(b,c,d,f-1):b[f]<c?a.Rl(b,c,f+1,e):f};a.xf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.mI=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.TJ=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.YF=function(a,b,c,d,e){e||(e=new Float32Array(16));
b=z.fromRotationTranslation(c,d,G);z.multiply(b,a,e);return e};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=z.fromRotationTranslation(c,d,G);1!==b&&(d=z.identity(M),b=E.set(b,b,b,K),z.scale(d,b,d),z.multiply(c,d,c));E.transformMat4(a,c,e);return e};a.gK=function(a,b,c,d,e){e||(e=new Float32Array(4));b=z.fromRotationTranslation(c,d,G);w.transformMat4(a,b,e);return e};a.sJ=function(a,b,c,d,e){e||(e=new Float32Array(3));b=z.fromRotationTranslation(c,d,G);z.invert(b,b);E.transformMat4(a,
b,e);return e};a.fK=function(a,b,c){c||(c=new Float32Array(16));z.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.JJ=function(b,c,d){a.Qu(b,c);c[3]=a.Pu(b);a.matrix_to_quat(b,d)};a.SH=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.KE=function(a,b,c,d){d||(d=new Float32Array(3));E.subtract(b,a,K);E.transformQuat(K,c,K);E.subtract(b,K,d)};a.WB=function(){K[0]=0;K[1]=0;K[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),
d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);z.lookAt(K,[-1,0,0],[0,-1,0],a);z.scale(a,[-1,1,1],a);z.scale(a,[-1,1,-1],b);z.lookAt(K,[0,-1,0],[0,0,-1],c);z.scale(c,[1,1,-1],c);z.scale(c,[1,-1,-1],d);z.lookAt(K,[0,0,-1],[0,-1,0],e);z.scale(e,[-1,1,1],e);z.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.$B=function(){K[0]=0;K[1]=0;K[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16);z.lookAt(K,
[1,0,0],[0,-1,0],a);z.scale(a,[-1,1,-1],b);z.lookAt(K,[0,1,0],[0,0,1],c);z.scale(c,[1,-1,-1],d);z.lookAt(K,[0,0,1],[0,-1,0],e);z.scale(e,[-1,1,-1],f);return[a,b,c,d,e,f]};a.Ks=function(a,b){return m(a,b)};a.hash_code=m;a.lJ=t;a.IJ=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,h,k,g,l,m,n,q,r,t,u,p;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];h=a[1];k=a[2];g=a[3];l=a[4];m=a[5];n=a[6];
q=a[7];r=a[8];t=a[9];u=a[10];p=a[11];c[0]=f;c[1]=h;c[2]=k;c[3]=g;c[4]=l;c[5]=m;c[6]=n;c[7]=q;c[8]=r;c[9]=t;c[10]=u;c[11]=p;c[12]=f*d+l*e+r*b+a[12];c[13]=h*d+m*e+t*b+a[13];c[14]=k*d+n*e+u*b+a[14];c[15]=g*d+q*e+p*b+a[15];return c};a.ID=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),
c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.gn=function(a){return a*Math.PI/180};a.hB=function(a){return 180*a/Math.PI};a.dr=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,h=1-f,e=b+.211324865405187-f,g=a+.211324865405187-h,l=b+-.577350269189626,m=
a+-.577350269189626,c=c%289,d=d%289,q=k(k(d)+c),h=k(k(d+h)+c+f),r=k(k(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+g*g),0),f=Math.max(.5-(l*l+m*m),0),t=2*n(.024390243902439*q)-1,u=2*n(.024390243902439*h)-1,p=2*n(.024390243902439*r)-1,q=Math.abs(t)-.5,h=Math.abs(u)-.5,r=Math.abs(p)-.5,t=t-Math.floor(t+.5),u=u-Math.floor(u+.5),p=p-Math.floor(p+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(t*t+q*q)),d=d*d*d*d*(1.79284291400159-.85373472095314*(u*u+h*h)),f=f*f*f*f*(1.79284291400159-.85373472095314*
(p*p+r*r));return 130*(c*(t*b+q*a)+d*(u*e+h*g)+f*(p*l+r*m))};a.Ps=function(a){var b=1/7,c=b/2,d=x(Math.floor(a[0])),e=x(Math.floor(a[1])),f=n(a[0]);a=n(a[1]);var h=f-.5,k=f-1.5,f=a-.5;a-=1.5;var m=g(d),q=g(d+1),r=m,d=q,m=g(m+e),q=g(q+e),r=g(r+e+1),d=g(d+e+1),e=h+.7*(l(m)*b+c),t=k+.7*(l(q)*b+c),h=h+.7*(l(r)*b+c),k=k+.7*(l(d)*b+c),m=f+.7*(l(Math.floor(m*b))*b+c),f=f+.7*(l(Math.floor(q*b))*b+c),r=a+.7*(l(Math.floor(r*b))*b+c),b=a+.7*(l(Math.floor(d*b))*b+c);return Math.min(e*e+m*m,t*t+f*f,h*h+r*r,k*
k+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=E.transformQuat(b,a,K);b=c[0];var h=c[1];c=c[2];D[0]=h*h+c*c;D[1]=-h*b;D[2]=-c*b;D[3]=-b*h;D[4]=b*b+c*c;D[5]=-c*h;D[6]=-b*c;D[7]=-h*c;D[8]=b*b+h*h;E.transformMat3(a,D,a);E.normalize(a,a);f.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=Q,d=J,c=f.setAxisAngle([0,1,0],Math.PI,f.create()),d=f.setAxisAngle([1,0,0],Math.PI/2,f.create());f.multiply(c,d,c);f.multiply(a,c,b);return b};
a.cleanup=function(){N=0;O={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.gw=function(a,b,c,d,e){e||(e=new Float32Array(a.length));f.slerp(a,b,Math.exp(-c/d),e)};a.tJ=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof
Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=q.fromQuat(a,D);F[0]=0;F[1]=1;F[2]=0;K[0]=c[3];K[1]=c[4];K[2]=c[5];var d=E.cross(F,K,K);E.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);F[0]=c[0];F[1]=c[1];F[2]=c[2];E.normalize(F,F);f.rotationTo(F,d,J);f.multiply(J,a,a)};a.Pt=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),h=b-1,k=
a[e*b+c],g=a[e*b+Math.min(c+1,h)],l=a[Math.min(e+1,h)*b+c];a=a[Math.min(e+1,h)*b+Math.min(c+1,h)];return(k*(1-d)+g*d)*(1-f)+(l*(1-d)+a*d)*f};a.zh=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.Lv=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Rk=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.vp=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:
b&3|8).toString(16)})};a.qk=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];E.normalize(c,c)};a.XF=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],h=b[1],k=b[2];b=b[3];var g=h*a-k*e,l=k*d-f*a,m=f*e-h*d,n=h*m-k*l,k=k*g-f*m,f=f*l-h*g;c[0]=d+2*g*b+2*n;c[1]=e+2*l*b+2*k;c[2]=
a+2*m*b+2*f};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.O=function(a){a&&u.error.apply(u,arguments);throw"engine panic:\nThe engine tried to perform an invalid operation and halted.\nPlease copy the console contents above and submit it to the Blend4Web forum at\nhttps://www.blend4web.com/en/forums/forum/17/";};a.angle_wrap_periodic=h;a.angle_wrap_0_2pi=v;a.Ap=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.rw=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=
e==f;break;case "object":d=C(e,f)}if(!d)return!1}return!0};a.Fq=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.Jt=function(a){a+=1;132651<a&&u.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){Q.set(a);Q[3]=b;J.set(d);J[3]=0;a=w.dot(Q,J);if(0==a)return null;J.set(c);J[3]=1;a=-w.dot(Q,J)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};
a.yC=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],h=b[1]-a[1],k=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=h*a-b*k;d[1]=f*b-e*a;d[2]=e*k-h*f;return d};a.oI=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.Nv=function(a,b,c){var d=E.dot(a,b);-.9999999>d?(E.cross(ia,a,K),1E-6>E.length(K)&&E.cross(aa,a,K),E.normalize(K,K),f.setAxisAngle(K,Math.PI,c)):(E.cross(a,b,K),c.set(K),c[3]=1+d,f.normalize(c,c));return c};a.vf=function(a,b,c){if(b==c)return c-a;a=v(a);b=v(b);c=v(c);var d=Math.abs(b-
c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=v(c+b);a=v(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));return a*a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.sz=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.uI=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.ax=function(a,b){for(var c=Math.max(a.length,b.length),e=0;e<c;e++){var f=
d((e>=a.length?0:a[e])-(e>=b.length?0:b[e]));if(f)return f}return 0};a.kg=function(a){return a.join(".")};a.pw=function(a){return a.split(".").map(function(a){return a|0})};a.lw=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2)};a.cq=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.Ck=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=B(b[1]),b.join("://")):B(a)};a.Lj=function(a){return 0!=parseInt(a.toString(2).substr(1),
2)}};b4w.module.__sfx=function(a,p){function d(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;B.warn("deprecated WebAudio implementation");return null}B.warn("WebAudio is not supported");return null}function b(a,b,d){var f=a.C;if("NONE"!=f.behavior){var h=f.loop,g=f.pitch;if(f.src&&(h||0<=d)){f.io=Math.floor(5E4*Math.random());var l=Q.currentTime+b;f.hd=l;f.state=20;c(a);"POSITIONAL"==f.behavior||"BACKGROUND_SOUND"==f.behavior?(b=Q.createBufferSource(),b.buffer=
f.src,b.playbackRate.value=g,b.onended=function(){f.state=50},h?(f.Lb&&f.Lb.disconnect(),b.loop=!0,b.start(l),f.duration=0):(h=b.buffer?b.buffer.duration:0,d>h?(h=l+d+f.Uc,b.loop=!0,b.start(l),b.stop(h),f.duration=d):(b.loop=!1,b.start(l),f.duration=h)),b.connect(f.Ec),f.Lb=b,e(f),t(f)):"BACKGROUND_MUSIC"==f.behavior&&(q.clear_timeout(f.mo),q.clear_timeout(f.no),d=function(){var b=a.C,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.Lb=b.Lb||Q.createMediaElementSource(c),b.Lb.connect(b.Ec),20==b.state&&(c.currentTime&&
(c.currentTime=0),c.play()))},0==b?d():f.mo=q.set_timeout(d,1E3*b),f.duration=h?0:C(a));k(f,l)}}}function c(a){var b=a.C;if(!b.Ec){var c=z.get_trans_view(a.f.h);a=z.get_quat_view(a.f.h);if(E.Rm){var d=Q.createBiquadFilter();d.type="peaking"}else d=null;var e=Q.createGain();switch(b.behavior){case "POSITIONAL":var f=Q.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],
c[1],c[2]);r.copy(c,b.Yp);c=w;u.quat_to_dir(a,u.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);r.copy(c,b.direction);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.at;f.coneOuterAngle=b.bt;f.coneOuterGain=b.ct;var h=Q.createGain();h.gain.value=v(b);d?(f.connect(d),d.connect(h)):f.connect(h);h.connect(e);b.Ec=f;if(b.Mh){var k=Q.createGain();e.connect(k);k.connect(Q?J.ka.Ec:null)}else k=null,e.connect(Q?J.ka.Ec:null);break;case "BACKGROUND_SOUND":f=null;
h=Q.createGain();h.gain.value=v(b);d?(b.Ec=d,d.connect(h)):b.Ec=h;h.connect(e);b.Mh?(k=Q.createGain(),e.connect(k),k.connect(Q?J.ka.Ec:null)):(k=null,e.connect(Q?J.ka.Ec:null));break;case "BACKGROUND_MUSIC":k=f=null,h=Q.createGain(),h.gain.value=v(b),d?(b.Ec=d,d.connect(h)):b.Ec=h,h.connect(e),e.connect(Q?J.ka.Ec:null)}b.Gk=f;b.je=d;b.li=h;b.Qg=e;b.Bv=k}}function m(a){var c=a.C,d=c.duration,c=c.delay+c.rt*Math.random();b(a,c,d)}function e(a){a.Mh&&a.Bv.gain.cancelScheduledValues(a.hd);a.Pi&&a.Lb.playbackRate.cancelScheduledValues(a.hd);
a.ql=a.hd}function t(a){if(a.Mh||a.Pi){var b=a.Bv,c=a.Lb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.hd;G[0]=a.io;for(var f=0;5>f;){var h=a.pitch+a.Pi*u.Fd(G);if(e>=a.ql){if(a.Mh){var k=1-u.clamp(a.Mh,0,1)*Math.random();b.gain.setValueAtTime(k,e)}a.Pi&&c.playbackRate.setValueAtTime(h,e);f++}e+=d/h}a.ql=e-.001}}}function k(a,b){if(a.Rg||a.Uc){var c=a.Qg;c.gain.cancelScheduledValues(b);a.Rg?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.Rg)):c.gain.setValueAtTime(1,b);a.Uc&&!a.loop&&
(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.Uc))}}function n(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.C;if(50==b.state)b.state=30;else if(20==b.state||40==b.state){var c=b.Qg,d=Q.currentTime;b.Uc&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.Uc));"BACKGROUND_MUSIC"==b.behavior?b.src&&(q.clear_timeout(b.mo),q.clear_timeout(b.no),b.no=q.set_timeout(function(){var b=a.C.src;b&&(b.currentTime&&(b.currentTime=0),
b.pause())},1E3*b.Uc)):(c=b.Lb,b.duration<c.buffer.duration?b.Uc&&20==b.state?c.stop(d+b.Uc):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.hd=0,b.yq=0,b.wo=0);b.state=30}}function g(a){a=a.C;if(20==a.state){var b=Q.currentTime;a.yq=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.hd){G[0]=a.io;for(var d=a.Lb.buffer.duration,f=a.hd;f<b;)c=a.pitch+a.Pi*u.Fd(G),f+=d/c;c*=d/c-(f-b)}else c=0;a.wo=c;a.Lb.stop(0);a.Lb.disconnect();e(a)}a.state=40}}function x(a){var b=
a.C;if(40==b.state){var c=Q.currentTime;b.hd+=c-b.yq;"BACKGROUND_MUSIC"==b.behavior?b.src.play():(l(a),b.ql=c,a=b.Lb,a.onended=function(){b.state=50},a.start(b.hd,b.wo),t(b));k(b,b.hd);b.state=20}}function l(a){a=a.C;var b=Q.createBufferSource();b.loop=a.Lb.loop;b.buffer=a.Lb.buffer;b.playbackRate.value=a.Lb.playbackRate.value;a.Gk?b.connect(a.Gk):b.connect(a.li);a.Lb=b}function h(a){a=a.C;return!a||20!=a.state&&40!=a.state&&30!=a.state&&50!=a.state?!1:!0}function v(a){return a.muted?0:a.volume}function C(a){a=
a.C;return(a=a.src)?a.duration:0}var A=p("__config"),B=p("__print"),q=p("__time"),z=p("__tsr"),u=p("__util"),r=p("__vec3"),f=A.p,E=A.C;a.Tr=10;a.Qn=20;a.Sr=30;var w=new Float32Array(3),N=new Float32Array(3),O=new Float32Array(3),K=[],F=[],Q=null,J=null,D=[],G=[1],M=null;a.NA=function(){return{Ih:-1,Re:"",behavior:"NONE",Ng:!1,muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,at:360,bt:360,ct:1,cyclic:!1,loop:!1,delay:0,rt:0,Mh:0,Pi:0,Rg:0,Uc:0,hd:0,yq:0,wo:0,duration:0,ql:0,io:1,src:null,
state:10,Yp:new Float32Array(3),direction:new Float32Array(3),gr:new Float32Array(3),mo:-1,no:-1,Og:0}};a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(K.push("ogg"),K.push("ogv")),""!=a.canPlayType("audio/mpeg")&&K.push("mp3"),""!=a.canPlayType("audio/mp4")&&(K.push("mp4"),K.push("m4v")),""!=a.canPlayType("audio/webm")&&K.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&F.push("ogv"),""!=b.canPlayType("video/mp4")&&
F.push("m4v"),""!=b.canPlayType("video/webm")&&F.push("webm"));(Q=E.Nr?d():null)&&B.log("%cINIT WEBAUDIO: "+Q.sampleRate+"Hz","color: #00a")};a.ys=function(a){var b={eh:new Float32Array(3),Ju:new Float32Array(3),zi:new Float32Array(3)};a.ka=b;if(Q){var c=Q.createGain(),d=Q.createGain();b.li=c;b.Qg=d;c.connect(d);d.connect(Q.destination);if(a.b4w_enable_dynamic_compressor){var d=Q.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=
e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.Tj=d;b.Ec=d}else b.Tj=null,b.Ec=c;c=Q.listener;b.Ng=f.dp;b.Ng||(c.dopplerFactor=a.audio_doppler_factor,c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.Og=0}};a.TE=function(a){J=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<K.indexOf(a)?a:"ogg"==a&&-1<K.indexOf("mp4")?"mp4":"mp3"==a&&-1<K.indexOf("ogg")?"ogg":"mp4"==a&&-1<K.indexOf("ogg")?"ogg":"ogv"==a&&-1<K.indexOf("m4v")?"m4v":"webm"==a&&-1<K.indexOf("m4v")?
"m4v":"m4v"==a&&-1<K.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<F.indexOf(a)?a:"ogv"==a&&-1<F.indexOf("m4v")?"m4v":"webm"==a&&-1<F.indexOf("m4v")?"m4v":"m4v"==a&&-1<F.indexOf("webm")?"webm":""};a.Fh=function(a,b){var c=a.data,d=b.C;d.Ih=a.data.sound.uuid;d.Re=a.data.sound.filepath;switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":d.behavior=Q?c.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var e;Q?(window.MediaElementAudioSourceNode?e=
!0:(B.warn("MediaElementAudioSourceNode not found"),e=!1),e=e?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):e="NONE";d.behavior=e;break;default:throw"Wrong speaker behavior";}c.sound||(d.behavior="NONE");d.Ng=c.b4w_disable_doppler||f.dp;d.muted=c.muted;d.volume=c.volume;d.pitch=c.pitch;d.attenuation=c.attenuation;d.dist_ref=c.distance_reference;d.dist_max=c.distance_max||1E4;d.at=c.cone_angle_inner;d.bt=c.cone_angle_outer;d.ct=c.cone_volume_outer;d.cyclic=c.b4w_cyclic_play;d.loop=c.b4w_loop;d.delay=c.b4w_delay;
d.rt=c.b4w_delay_random;d.Mh=c.b4w_volume_random;d.Pi=c.b4w_pitch_random;d.Rg=c.b4w_fade_in;d.Uc=c.b4w_fade_out;D.push(b)};a.iw=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.C.behavior){case "POSITIONAL":return a.Qn;case "BACKGROUND_SOUND":return a.Qn;case "BACKGROUND_MUSIC":return a.Sr;case "NONE":return a.Tr;default:throw"Wrong speaker behavior";}};a.CG=function(a,b){var c=a.C;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;
case "NONE":break;default:throw"Wrong speaker behavior";}};a.nE=function(){var a=Q.createBufferSource();a.buffer=Q.createBuffer(1,22050,22050);a.connect(Q.destination);a.start(0)};a.fB=function(a,b,c){Q?Q.decodeAudioData(a,b,c):c()};a.yF=function(a){n(a);a.C=null;D.splice(D.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<D.length;a++){var b=D[a].C;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.Lb&&b.Lb.disconnect()}J&&J.ka&&(a=J.ka,a.eh[0]=0,a.eh[1]=0,a.eh[2]=0,a.zi[0]=0,a.zi[1]=0,a.zi[2]=
0);J=null;D.splice(0);M=null};a.update=function(a){if(Q&&0!=D.length){for(var b=0;b<D.length;b++){var c=D[b],d=c.C,e=Q.currentTime;!d.loop&&20==d.state&&d.duration&&d.hd+d.duration<e&&(d.state=50);d.cyclic&&50==d.state&&m(c);20==d.state&&3>d.ql-e&&t(d)}M&&M.ff.length&&(-1==M.pb||a>M.ns+M.ut[M.pb])&&(b=M,-1<b.pb&&n(b.ff[b.pb]),-1==b.pb&&b.random?c=Math.round(Math.random()*(b.ff.length-1)):b.random?(c=1+Math.round(Math.random()*(b.ff.length-2)),c=(b.pb+c)%b.ff.length):c=(b.pb+1)%b.ff.length,m(b.ff[c]),
b.pb=c,b.ns=a)}};a.play=b;a.play_def=m;a.stop=n;a.is_playing=function(a){return 20==a.C.state};a.xF=g;a.zF=x;a.playrate=function(a,b){var c=a.C;c.pitch=b;!h(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.Lb.playbackRate.value=b,e(c),t(c))};a.get_playrate=function(a){return a.C.pitch};a.cyclic=function(a,b){a.C.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.C.cyclic};a.vD=function(a,b,c,d){if(Q&&a.ka){var e=w;e[0]=0;e[1]=-1;e[2]=0;r.transformQuat(e,c,e);N[0]=0;N[1]=0;N[2]=-1;
r.transformQuat(N,c,N);c=Q.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],N[0],N[1],N[2]);r.copy(e,a.ka.Ju);!a.ka.Ng&&d&&(O[0]=(b[0]-a.ka.eh[0])/d,O[1]=(b[1]-a.ka.eh[1])/d,O[2]=(b[2]-a.ka.eh[2])/d,u.smooth_v(O,a.ka.zi,d,.3,O),c.setVelocity(O[0],O[1],O[2]),r.copy(O,a.ka.zi));r.copy(b,a.ka.eh)}};a.listener_reset_speed=function(a,b){if(Q&&J.ka&&!J.ka.Ng){var c=w;b?r.copy(b,c):r.copy(J.ka.Ju,c);r.scale(c,a,c);Q.listener.setVelocity(c[0],c[1],c[2]);r.copy(c,J.ka.zi)}};a.AF=function(a,
b){var c=a.C;if(h(a)&&"POSITIONAL"==c.behavior){var d=z.get_trans_view(a.f.h),e=z.get_quat_view(a.f.h),f=c.Gk;f.setPosition(d[0],d[1],d[2]);var k=w;u.quat_to_dir(e,u.AXIS_MY,k);f.setOrientation(k[0],k[1],k[2]);e=c.Yp;!c.Ng&&b&&(N[0]=(d[0]-e[0])/b,N[1]=(d[1]-e[1])/b,N[2]=(d[2]-e[2])/b,u.smooth_v(N,c.gr,b,.3,N),f.setVelocity(N[0],N[1],N[2]),r.copy(N,c.gr));r.copy(d,e)}};a.speaker_reset_speed=function(a,b,c){var d=a.C;if(h(a)&&"POSITIONAL"==d.behavior&&!d.Ng){var e=w;c?r.copy(c,e):r.copy(d.direction,
e);r.scale(e,b,e);d.Gk.setVelocity(e[0],e[1],e[2]);r.copy(e,d.gr);a=z.get_trans_view(a.f.h);r.copy(a,d.Yp)}};a.Bp=function(a){return a.C.behavior};a.check_active_speakers=function(){for(var a=0;a<D.length;a++)if(h(D[a]))return!0;return!1};a.dF=function(a){var b=J.ka;b&&(b.volume=a,Q&&(b.li.gain.value=v(b)))};a.xC=function(){var a=J.ka;return a?a.volume:0};a.set_volume=function(a,b){var c=a.C;c.volume=b;h(a)&&(c.li.gain.value=v(c))};a.get_volume=function(a){return a.C.volume};a.mute=function(a,b){a.C.muted=
Boolean(b);h(a)&&(a.C.li.gain.value=v(a.C))};a.is_muted=function(a){return a.C.muted};a.VD=function(a){var b=J.ka;b&&(b.muted=Boolean(a),Q&&(b.li.gain.value=v(b)))};a.bD=function(){var a=J.ka;return a?a.muted:!1};a.get_speaker_objects=function(){return D};a.pause=function(){for(var a=0;a<D.length;a++)g(D[a])};a.resume=function(){for(var a=0;a<D.length;a++)x(D[a])};a.set_compressor_params=function(a,b){if(a.ka&&a.ka.Tj){var c=a.ka.Tj;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=
b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.ka||!a.ka.Tj)return null;a=a.ka.Tj;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(h(a)){a=a.C;var d=a.Qg,e=Q.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.Og=c}};a.unduck=function(a){if(h(a)){a=a.C;var b=a.Qg,c=Q.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.Og);a.Og=0}};a.pB=function(a,b){if(Q){var c=J.ka,d=c.Qg,e=Q.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Og=b}};a.bG=function(){if(Q){var a=J.ka,b=a.Qg,c=Q.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Og);a.Og=0}};a.apply_playlist=function(a,b,c){M={pb:-1,ns:0,random:c,ff:[],ut:[]};for(c=0;c<a.length;c++){var d=a[c],e=C(d);0==e?B.warn("Ignoring speaker with zero duration: "+
d.name):(n(d),d.C.cyclic=!1,M.ff.push(d),M.ut.push(e+b))}};a.get_duration=C;a.clear_playlist=function(){if(M)for(var a=M.ff,b=0;b<a.length;b++)n(a[b]);M=null};a.get_positional_params=function(a){return(a=a.C)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.C;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Gk;d&&(d.refDistance=c.dist_ref,
d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.C;c&&c.je&&(c.je.frequency.value=b.freq,c.je.Q.value=b.Q,c.je.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.C)&&a.je?{freq:a.je.frequency.value,Q:a.je.Q.value,gain:a.je.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.C;if(!a||!a.je)return null;a.je.getFrequencyResponse(b,c,d)}};b4w.module.__vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new p(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var e=new p(3);e[0]=a;e[1]=c;e[2]=d;return e};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,e){e[0]=a;e[1]=c;e[2]=d;return e};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];
return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],
c[2]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,e){e[0]=a[0]+c[0]*d;e[1]=a[1]+c[1]*d;e[2]=a[2]+c[2]*d;return e};a.distance=function(a,c){var d=c[0]-a[0],e=c[1]-a[1],t=c[2]-a[2];return Math.sqrt(d*d+e*e+t*t)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],e=c[1]-a[1],t=c[2]-a[2];return d*d+e*e+t*t};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;
a.squaredLength=function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],e=a[1],t=a[2],d=d*d+e*e+t*t;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var e=a[0],t=a[1];a=a[2];var k=c[0],n=c[1];c=c[2];
d[0]=t*c-a*n;d[1]=a*k-e*c;d[2]=e*n-t*k;return d};a.lerp=function(a,c,d,e){var t=a[0],k=a[1];a=a[2];e[0]=t+d*(c[0]-t);e[1]=k+d*(c[1]-k);e[2]=a+d*(c[2]-a);return e};a.random=function(a,c){a=a||1;var m=2*d()*Math.PI,e=2*d()-1,t=Math.sqrt(1-e*e)*a;c[0]=Math.cos(m)*t;c[1]=Math.sin(m)*t;c[2]=e*a;return c};a.transformMat4=function(a,c,d){var e=a[0],t=a[1];a=a[2];var k=c[3]*e+c[7]*t+c[11]*a+c[15],k=k||1;d[0]=(c[0]*e+c[4]*t+c[8]*a+c[12])/k;d[1]=(c[1]*e+c[5]*t+c[9]*a+c[13])/k;d[2]=(c[2]*e+c[6]*t+c[10]*a+c[14])/
k;return d};a.transformMat3=function(a,c,d){var e=a[0],t=a[1];a=a[2];d[0]=e*c[0]+t*c[3]+a*c[6];d[1]=e*c[1]+t*c[4]+a*c[7];d[2]=e*c[2]+t*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var e=a[0],t=a[1],k=a[2];a=c[0];var n=c[1],g=c[2];c=c[3];var p=c*e+n*k-g*t,l=c*t+g*e-a*k,h=c*k+a*t-n*e,e=-a*e-n*t-g*k;d[0]=p*c+e*-a+l*-g-h*-n;d[1]=l*c+e*-n+h*-a-p*-g;d[2]=h*c+e*-g+p*-n-l*-a;return d};a.rotateX=function(a,c,d,e){var t=[],k=[];t[0]=a[0]-c[0];t[1]=a[1]-c[1];t[2]=a[2]-c[2];k[0]=t[0];k[1]=t[1]*Math.cos(d)-
t[2]*Math.sin(d);k[2]=t[1]*Math.sin(d)+t[2]*Math.cos(d);e[0]=k[0]+c[0];e[1]=k[1]+c[1];e[2]=k[2]+c[2];return e};a.rotateY=function(a,c,d,e){var t=[],k=[];t[0]=a[0]-c[0];t[1]=a[1]-c[1];t[2]=a[2]-c[2];k[0]=t[2]*Math.sin(d)+t[0]*Math.cos(d);k[1]=t[1];k[2]=t[2]*Math.cos(d)-t[0]*Math.sin(d);e[0]=k[0]+c[0];e[1]=k[1]+c[1];e[2]=k[2]+c[2];return e};a.rotateZ=function(a,c,d,e){var t=[],k=[];t[0]=a[0]-c[0];t[1]=a[1]-c[1];t[2]=a[2]-c[2];k[0]=t[0]*Math.cos(d)-t[1]*Math.sin(d);k[1]=t[0]*Math.sin(d)+t[1]*Math.cos(d);
k[2]=t[2];e[0]=k[0]+c[0];e[1]=k[1]+c[1];e[2]=k[2]+c[2];return e};a.forEach=function(){var b=a.create();return function(a,d,e,t,k,n){d||(d=3);e||(e=0);for(t=t?Math.min(t*d+e,a.length):a.length;e<t;e+=d)b[0]=a[e],b[1]=a[e+1],b[2]=a[e+2],k(b,n,b),a[e]=b[0],a[e+1]=b[1],a[e+2]=b[2];return a}}();a.QH=function(b,c){var d=a.fromValues(b[0],b[1],b[2]),e=a.fromValues(c[0],c[1],c[2]);a.normalize(d,d);a.normalize(e,e);d=a.dot(d,e);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new p(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,e){var t=new p(4);t[0]=a;t[1]=c;t[2]=d;t[3]=e;return t};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,e,t){t[0]=a;t[1]=c;t[2]=d;t[3]=e;return t};a.add=function(a,c,d){d[0]=
a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);d[3]=
Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,e){e[0]=a[0]+c[0]*d;e[1]=a[1]+c[1]*d;e[2]=a[2]+c[2]*d;e[3]=a[3]+c[3]*d;return e};a.distance=function(a,c){var d=c[0]-a[0],e=c[1]-a[1],t=c[2]-a[2],k=c[3]-a[3];return Math.sqrt(d*d+e*e+t*t+k*k)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],e=c[1]-a[1],t=c[2]-a[2],k=c[3]-a[3];return d*d+e*e+t*t+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],e=a[2];a=a[3];return Math.sqrt(c*c+d*d+e*e+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],e=a[2];a=a[3];return c*c+d*d+e*e+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],e=a[1],t=a[2],k=a[3],d=d*d+e*e+t*t+k*k;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,e){var t=a[0],k=a[1],n=a[2];a=a[3];e[0]=t+d*(c[0]-t);e[1]=k+d*(c[1]-k);e[2]=n+d*(c[2]-n);e[3]=a+d*(c[3]-a);return e};a.random=function(b,c){b=b||1;c[0]=d();c[1]=d();c[2]=d();c[3]=d();a.normalize(c,c);a.scale(c,b,c);return c};a.transformMat4=function(a,c,d){var e=a[0],
t=a[1],k=a[2];a=a[3];d[0]=c[0]*e+c[4]*t+c[8]*k+c[12]*a;d[1]=c[1]*e+c[5]*t+c[9]*k+c[13]*a;d[2]=c[2]*e+c[6]*t+c[10]*k+c[14]*a;d[3]=c[3]*e+c[7]*t+c[11]*k+c[15]*a;return d};a.transformQuat=function(a,c,d){var e=a[0],t=a[1],k=a[2],n=c[0],g=c[1],p=c[2];c=c[3];var l=c*e+g*k-p*t,h=c*t+p*e-n*k,v=c*k+n*t-g*e,e=-n*e-g*t-p*k;d[0]=l*c+e*-n+h*-p-v*-g;d[1]=h*c+e*-g+v*-n-l*-p;d[2]=v*c+e*-p+l*-g-h*-n;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,d,e,t,k,n){d||(d=4);e||(e=0);for(t=t?Math.min(t*
d+e,a.length):a.length;e<t;e+=d)b[0]=a[e],b[1]=a[e+1],b[2]=a[e+2],b[3]=a[e+3],k(b,n,b),a[e]=b[0],a[e+1]=b[1],a[e+2]=b[2],a[e+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,p){var d=p("__vec3"),b=p("__vec4"),c=p("__mat3"),m="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new m(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=d.create(),c=d.fromValues(1,0,0),k=d.fromValues(0,1,0);return function(n,g,m){var l=d.dot(n,g);if(-.9999999>l)return d.cross(c,n,b),1E-6>d.length(b)&&d.cross(k,n,b),d.normalize(b,b),a.setAxisAngle(b,Math.PI,m),m;if(.9999999<l)return m[0]=0,m[1]=0,m[2]=0,m[3]=1,m;d.cross(n,
g,b);m[0]=b[0];m[1]=b[1];m[2]=b[2];m[3]=1+l;return a.normalize(m,m)}}();a.setAxes=function(){var b=c.create();return function(c,d,n,g){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=n[0];b[4]=n[1];b[7]=n[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,g),g)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=b.add;a.multiply=function(a,b,c){var d=a[0],g=a[1],m=a[2];a=a[3];var l=b[0],h=b[1],p=b[2];b=b[3];c[0]=d*b+a*l+g*p-m*h;c[1]=g*b+a*h+m*l-d*p;c[2]=m*b+a*p+d*h-g*l;c[3]=a*b-d*l-g*h-m*p;return c};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],g=a[1],m=a[2];a=a[3];var l=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*l;c[1]=g*b+m*l;c[2]=m*b-g*l;c[3]=a*b-d*l;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],g=a[1],m=a[2];a=a[3];var l=Math.sin(b);b=Math.cos(b);c[0]=d*
b-m*l;c[1]=g*b+a*l;c[2]=m*b+d*l;c[3]=a*b-g*l;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],g=a[1],m=a[2];a=a[3];var l=Math.sin(b);b=Math.cos(b);c[0]=d*b+g*l;c[1]=g*b-d*l;c[2]=m*b+a*l;c[3]=a*b-m*l;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],g=a[2];b[0]=c;b[1]=d;b[2]=g;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-g*g));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,c,d){var g=a[0],m=a[1],l=a[2];a=a[3];var h=b[0],p=b[1],C=b[2];b=b[3];var A,B,q;B=g*h+m*p+l*C+a*b;0>B&&(B=-B,h=-h,p=-p,
C=-C,b=-b);1E-6<1-B?(A=Math.acos(B),q=Math.sin(A),B=Math.sin((1-c)*A)/q,c=Math.sin(c*A)/q):B=1-c;d[0]=B*g+c*h;d[1]=B*m+c*p;d[2]=B*l+c*C;d[3]=B*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],g=a[2],m=a[3],l=c*c+d*d+g*g+m*m,l=l?1/l:0;b[0]=-c*l;b[1]=-d*l;b[2]=-g*l;b[3]=m*l;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var g=(d+1)%3,m=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*g+g]-a[3*m+m]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*g+m]-a[3*m+g])*c;b[g]=(a[3*g+d]+a[3*d+g])*c;b[m]=(a[3*m+d]+a[3*d+m])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new p(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var c=a[1],m=a[2],e=a[5];b[1]=a[3];b[2]=a[6];b[3]=c;b[5]=a[7];b[6]=m;b[7]=e}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var c=a[0],m=a[1],e=a[2],t=a[3],k=a[4],n=a[5],g=a[6],p=a[7],l=a[8],h=l*k-n*p,v=-l*t+n*g,C=
p*t-k*g,A=c*h+m*v+e*C;if(!A)return null;A=1/A;b[0]=h*A;b[1]=(-l*m+e*p)*A;b[2]=(n*m-e*k)*A;b[3]=v*A;b[4]=(l*c-e*g)*A;b[5]=(-n*c+e*t)*A;b[6]=C*A;b[7]=(-p*c+m*g)*A;b[8]=(k*c-m*t)*A;return b};a.adjoint=function(a,b){var c=a[0],m=a[1],e=a[2],t=a[3],k=a[4],n=a[5],g=a[6],p=a[7],l=a[8];b[0]=k*l-n*p;b[1]=e*p-m*l;b[2]=m*n-e*k;b[3]=n*g-t*l;b[4]=c*l-e*g;b[5]=e*t-c*n;b[6]=t*p-k*g;b[7]=m*g-c*p;b[8]=c*k-m*t;return b};a.determinant=function(a){var b=a[3],c=a[4],m=a[5],e=a[6],t=a[7],k=a[8];return a[0]*(k*c-m*t)+a[1]*
(-k*b+m*e)+a[2]*(t*b-c*e)};a.multiply=function(a,b,c){var m=a[0],e=a[1],t=a[2],k=a[3],n=a[4],g=a[5],p=a[6],l=a[7];a=a[8];var h=b[0],v=b[1],C=b[2],A=b[3],B=b[4],q=b[5],z=b[6],u=b[7];b=b[8];c[0]=h*m+v*k+C*p;c[1]=h*e+v*n+C*l;c[2]=h*t+v*g+C*a;c[3]=A*m+B*k+q*p;c[4]=A*e+B*n+q*l;c[5]=A*t+B*g+q*a;c[6]=z*m+u*k+b*p;c[7]=z*e+u*n+b*l;c[8]=z*t+u*g+b*a;return c};a.mul=a.multiply;a.translate=function(a,b,c){var m=a[0],e=a[1],t=a[2],k=a[3],n=a[4],g=a[5],p=a[6],l=a[7];a=a[8];var h=b[0];b=b[1];c[0]=m;c[1]=e;c[2]=t;
c[3]=k;c[4]=n;c[5]=g;c[6]=h*m+b*k+p;c[7]=h*e+b*n+l;c[8]=h*t+b*g+a;return c};a.rotate=function(a,b,c){var m=a[0],e=a[1],t=a[2],k=a[3],n=a[4],g=a[5],p=a[6],l=a[7];a=a[8];var h=Math.sin(b);b=Math.cos(b);c[0]=b*m+h*k;c[1]=b*e+h*n;c[2]=b*t+h*g;c[3]=b*k-h*m;c[4]=b*n-h*e;c[5]=b*g-h*t;c[6]=p;c[7]=l;c[8]=a;return c};a.scale=function(a,b,c){var m=b[0];b=b[1];c[0]=m*a[0];c[1]=m*a[1];c[2]=m*a[2];c[3]=b*a[3];c[4]=b*a[4];c[5]=b*a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.QB=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.OB=function(a,b){var c=Math.sin(a),m=Math.cos(a);b[0]=m;b[1]=c;b[2]=0;b[3]=-c;b[4]=m;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.PB=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var c=a[0],m=a[1],e=a[2],t=a[3],k=c+c,n=m+m,g=e+e,c=c*k,p=m*k,m=m*n,l=e*k,h=
e*n,e=e*g,k=t*k,n=t*n,t=t*g;b[0]=1-m-e;b[3]=p-t;b[6]=l+n;b[1]=p+t;b[4]=1-c-e;b[7]=h-k;b[2]=l-n;b[5]=h+k;b[8]=1-c-m;return b};a.normalFromMat4=function(a,b){var c=a[0],m=a[1],e=a[2],t=a[3],k=a[4],n=a[5],g=a[6],p=a[7],l=a[8],h=a[9],v=a[10],C=a[11],A=a[12],B=a[13],q=a[14],z=a[15],u=c*n-m*k,r=c*g-e*k,f=c*p-t*k,E=m*g-e*n,w=m*p-t*n,N=e*p-t*g,O=l*B-h*A,K=l*q-v*A,l=l*z-C*A,F=h*q-v*B,h=h*z-C*B,v=v*z-C*q,C=u*v-r*h+f*F+E*l-w*K+N*O;if(!C)return null;C=1/C;b[0]=(n*v-g*h+p*F)*C;b[1]=(g*l-k*v-p*K)*C;b[2]=(k*h-n*
l+p*O)*C;b[3]=(e*h-m*v-t*F)*C;b[4]=(c*v-e*l+t*K)*C;b[5]=(m*l-c*h-t*O)*C;b[6]=(B*N-q*w+z*E)*C;b[7]=(q*f-A*N-z*r)*C;b[8]=(A*w-B*f+z*u)*C;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.NB=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new p(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];
b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var c=a[1],m=a[2],e=a[3],t=a[6],k=a[7],n=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=c;b[6]=a[9];b[7]=a[13];b[8]=m;b[9]=t;b[11]=a[14];b[12]=e;b[13]=
k;b[14]=n}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var c=a[0],m=a[1],e=a[2],t=a[3],k=a[4],n=a[5],g=a[6],p=a[7],l=a[8],h=a[9],v=a[10],C=a[11],A=a[12],B=a[13],q=a[14],z=a[15],u=c*n-m*k,r=c*g-e*k,f=c*p-t*k,E=m*g-e*n,w=m*p-t*n,N=e*p-t*g,O=l*B-h*A,K=l*q-v*A,F=l*z-C*A,Q=h*q-v*B,J=h*z-C*B,D=v*z-C*q,G=u*D-r*J+f*Q+E*F-w*K+N*O;if(!G)return null;
G=1/G;b[0]=(n*D-g*J+p*Q)*G;b[1]=(e*J-m*D-t*Q)*G;b[2]=(B*N-q*w+z*E)*G;b[3]=(v*w-h*N-C*E)*G;b[4]=(g*F-k*D-p*K)*G;b[5]=(c*D-e*F+t*K)*G;b[6]=(q*f-A*N-z*r)*G;b[7]=(l*N-v*f+C*r)*G;b[8]=(k*J-n*F+p*O)*G;b[9]=(m*F-c*J-t*O)*G;b[10]=(A*w-B*f+z*u)*G;b[11]=(h*f-l*w-C*u)*G;b[12]=(n*K-k*Q-g*O)*G;b[13]=(c*Q-m*K+e*O)*G;b[14]=(B*r-A*E-q*u)*G;b[15]=(l*E-h*r+v*u)*G;return b};a.adjoint=function(a,b){var c=a[0],m=a[1],e=a[2],t=a[3],k=a[4],n=a[5],g=a[6],p=a[7],l=a[8],h=a[9],v=a[10],C=a[11],A=a[12],B=a[13],q=a[14],z=a[15];
b[0]=n*(v*z-C*q)-h*(g*z-p*q)+B*(g*C-p*v);b[1]=-(m*(v*z-C*q)-h*(e*z-t*q)+B*(e*C-t*v));b[2]=m*(g*z-p*q)-n*(e*z-t*q)+B*(e*p-t*g);b[3]=-(m*(g*C-p*v)-n*(e*C-t*v)+h*(e*p-t*g));b[4]=-(k*(v*z-C*q)-l*(g*z-p*q)+A*(g*C-p*v));b[5]=c*(v*z-C*q)-l*(e*z-t*q)+A*(e*C-t*v);b[6]=-(c*(g*z-p*q)-k*(e*z-t*q)+A*(e*p-t*g));b[7]=c*(g*C-p*v)-k*(e*C-t*v)+l*(e*p-t*g);b[8]=k*(h*z-C*B)-l*(n*z-p*B)+A*(n*C-p*h);b[9]=-(c*(h*z-C*B)-l*(m*z-t*B)+A*(m*C-t*h));b[10]=c*(n*z-p*B)-k*(m*z-t*B)+A*(m*p-t*n);b[11]=-(c*(n*C-p*h)-k*(m*C-t*h)+l*
(m*p-t*n));b[12]=-(k*(h*q-v*B)-l*(n*q-g*B)+A*(n*v-g*h));b[13]=c*(h*q-v*B)-l*(m*q-e*B)+A*(m*v-e*h);b[14]=-(c*(n*q-g*B)-k*(m*q-e*B)+A*(m*g-e*n));b[15]=c*(n*v-g*h)-k*(m*v-e*h)+l*(m*g-e*n);return b};a.determinant=function(a){var b=a[0],c=a[1],m=a[2],e=a[3],t=a[4],k=a[5],n=a[6],g=a[7],p=a[8],l=a[9],h=a[10],v=a[11],C=a[12],A=a[13],B=a[14];a=a[15];return(b*k-c*t)*(h*a-v*B)-(b*n-m*t)*(l*a-v*A)+(b*g-e*t)*(l*B-h*A)+(c*n-m*k)*(p*a-v*C)-(c*g-e*k)*(p*B-h*C)+(m*g-e*n)*(p*A-l*C)};a.multiply=function(a,b,c){var m=
a[0],e=a[1],t=a[2],k=a[3],n=a[4],g=a[5],p=a[6],l=a[7],h=a[8],v=a[9],C=a[10],A=a[11],B=a[12],q=a[13],z=a[14];a=a[15];var u=b[0],r=b[1],f=b[2],E=b[3];c[0]=u*m+r*n+f*h+E*B;c[1]=u*e+r*g+f*v+E*q;c[2]=u*t+r*p+f*C+E*z;c[3]=u*k+r*l+f*A+E*a;u=b[4];r=b[5];f=b[6];E=b[7];c[4]=u*m+r*n+f*h+E*B;c[5]=u*e+r*g+f*v+E*q;c[6]=u*t+r*p+f*C+E*z;c[7]=u*k+r*l+f*A+E*a;u=b[8];r=b[9];f=b[10];E=b[11];c[8]=u*m+r*n+f*h+E*B;c[9]=u*e+r*g+f*v+E*q;c[10]=u*t+r*p+f*C+E*z;c[11]=u*k+r*l+f*A+E*a;u=b[12];r=b[13];f=b[14];E=b[15];c[12]=u*m+
r*n+f*h+E*B;c[13]=u*e+r*g+f*v+E*q;c[14]=u*t+r*p+f*C+E*z;c[15]=u*k+r*l+f*A+E*a;return c};a.mul=a.multiply;a.translate=function(a,b,c){var m=b[0],e=b[1];b=b[2];var t,k,n,g,p,l,h,v,C,A,B,q;a===c?(c[12]=a[0]*m+a[4]*e+a[8]*b+a[12],c[13]=a[1]*m+a[5]*e+a[9]*b+a[13],c[14]=a[2]*m+a[6]*e+a[10]*b+a[14],c[15]=a[3]*m+a[7]*e+a[11]*b+a[15]):(t=a[0],k=a[1],n=a[2],g=a[3],p=a[4],l=a[5],h=a[6],v=a[7],C=a[8],A=a[9],B=a[10],q=a[11],c[0]=t,c[1]=k,c[2]=n,c[3]=g,c[4]=p,c[5]=l,c[6]=h,c[7]=v,c[8]=C,c[9]=A,c[10]=B,c[11]=q,
c[12]=t*m+p*e+C*b+a[12],c[13]=k*m+l*e+A*b+a[13],c[14]=n*m+h*e+B*b+a[14],c[15]=g*m+v*e+q*b+a[15]);return c};a.scale=function(a,b,c){var m=b[0],e=b[1];b=b[2];c[0]=a[0]*m;c[1]=a[1]*m;c[2]=a[2]*m;c[3]=a[3]*m;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.rotate=function(a,b,c,m){var e=c[0],t=c[1];c=c[2];var k=Math.sqrt(e*e+t*t+c*c),n,g,p,l,h,v,C,A,B,q,z,u,r,f,E,w,N,O,K,F;if(1E-7>Math.abs(k))return null;
k=1/k;e*=k;t*=k;c*=k;n=Math.sin(b);g=Math.cos(b);p=1-g;b=a[0];k=a[1];l=a[2];h=a[3];v=a[4];C=a[5];A=a[6];B=a[7];q=a[8];z=a[9];u=a[10];r=a[11];f=e*e*p+g;E=t*e*p+c*n;w=c*e*p-t*n;N=e*t*p-c*n;O=t*t*p+g;K=c*t*p+e*n;F=e*c*p+t*n;e=t*c*p-e*n;t=c*c*p+g;m[0]=b*f+v*E+q*w;m[1]=k*f+C*E+z*w;m[2]=l*f+A*E+u*w;m[3]=h*f+B*E+r*w;m[4]=b*N+v*O+q*K;m[5]=k*N+C*O+z*K;m[6]=l*N+A*O+u*K;m[7]=h*N+B*O+r*K;m[8]=b*F+v*e+q*t;m[9]=k*F+C*e+z*t;m[10]=l*F+A*e+u*t;m[11]=h*F+B*e+r*t;a!==m&&(m[12]=a[12],m[13]=a[13],m[14]=a[14],m[15]=a[15]);
return m};a.rotateX=function(a,b,c){var m=Math.sin(b);b=Math.cos(b);var e=a[4],t=a[5],k=a[6],n=a[7],g=a[8],p=a[9],l=a[10],h=a[11];a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[4]=e*b+g*m;c[5]=t*b+p*m;c[6]=k*b+l*m;c[7]=n*b+h*m;c[8]=g*b-e*m;c[9]=p*b-t*m;c[10]=l*b-k*m;c[11]=h*b-n*m;return c};a.rotateY=function(a,b,c){var m=Math.sin(b);b=Math.cos(b);var e=a[0],t=a[1],k=a[2],n=a[3],g=a[8],p=a[9],l=a[10],h=a[11];a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],
c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=e*b-g*m;c[1]=t*b-p*m;c[2]=k*b-l*m;c[3]=n*b-h*m;c[8]=e*m+g*b;c[9]=t*m+p*b;c[10]=k*m+l*b;c[11]=n*m+h*b;return c};a.rotateZ=function(a,b,c){var m=Math.sin(b);b=Math.cos(b);var e=a[0],t=a[1],k=a[2],n=a[3],g=a[4],p=a[5],l=a[6],h=a[7];a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=e*b+g*m;c[1]=t*b+p*m;c[2]=k*b+l*m;c[3]=n*b+h*m;c[4]=g*b-e*m;c[5]=p*b-t*m;c[6]=l*b-k*m;c[7]=h*b-n*m;return c};
a.QB=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.PB=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.OB=function(a,b,c){var m=b[0],e=b[1];b=b[2];var t=Math.sqrt(m*m+e*e+b*b),k;if(1E-7>Math.abs(t))return null;t=1/t;m*=t;e*=t;b*=t;t=Math.sin(a);a=Math.cos(a);k=1-a;c[0]=m*m*k+a;c[1]=e*m*k+b*
t;c[2]=b*m*k-e*t;c[3]=0;c[4]=m*e*k-b*t;c[5]=e*e*k+a;c[6]=b*e*k+m*t;c[7]=0;c[8]=m*b*k+e*t;c[9]=e*b*k-m*t;c[10]=b*b*k+a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.KI=function(a,b){var c=Math.sin(a),m=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=m;b[6]=c;b[7]=0;b[8]=0;b[9]=-c;b[10]=m;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.LI=function(a,b){var c=Math.sin(a),m=Math.cos(a);b[0]=m;b[1]=0;b[2]=-c;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=c;b[9]=0;b[10]=m;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.MI=function(a,b){var c=Math.sin(a),m=Math.cos(a);b[0]=m;b[1]=c;b[2]=0;b[3]=0;b[4]=-c;b[5]=m;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,c){var m=a[0],e=a[1],t=a[2],k=a[3],n=m+m,g=e+e,p=t+t;a=m*n;var l=m*g,m=m*p,h=e*g,e=e*p,t=t*p,n=k*n,g=k*g,k=k*p;c[0]=1-(h+t);c[1]=l+k;c[2]=m-g;c[3]=0;c[4]=l-k;c[5]=1-(a+t);c[6]=e+n;c[7]=0;c[8]=m+g;c[9]=e-n;c[10]=1-(a+h);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];
c[15]=1;return c};a.fromQuat=function(a,b){var c=a[0],m=a[1],e=a[2],t=a[3],k=c+c,n=m+m,g=e+e,c=c*k,p=m*k,m=m*n,l=e*k,h=e*n,e=e*g,k=t*k,n=t*n,t=t*g;b[0]=1-m-e;b[1]=p+t;b[2]=l-n;b[3]=0;b[4]=p-t;b[5]=1-c-e;b[6]=h+k;b[7]=0;b[8]=l+n;b[9]=h-k;b[10]=1-c-m;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,c,m,e,t,k){var n=1/(b-a),g=1/(m-c),p=1/(e-t);k[0]=2*e*n;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2*e*g;k[6]=0;k[7]=0;k[8]=(b+a)*n;k[9]=(m+c)*g;k[10]=(t+e)*p;k[11]=-1;k[12]=0;k[13]=0;k[14]=
t*e*2*p;k[15]=0;return k};a.perspective=function(a,b,c,m,e){a=1/Math.tan(a/2);var t=1/(c-m);e[0]=a/b;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=a;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=(m+c)*t;e[11]=-1;e[12]=0;e[13]=0;e[14]=2*m*c*t;e[15]=0;return e};a.PJ=function(a,b,c,m){var e=Math.tan(a.jK*Math.PI/180),t=Math.tan(a.AI*Math.PI/180),k=Math.tan(a.BJ*Math.PI/180);a=Math.tan(a.SJ*Math.PI/180);var n=2/(k+a),g=2/(e+t);m[0]=n;m[1]=0;m[2]=0;m[3]=0;m[4]=0;m[5]=g;m[6]=0;m[7]=0;m[8]=-((k-a)*n*.5);m[9]=(e-t)*g*.5;m[10]=c/
(b-c);m[11]=-1;m[12]=0;m[13]=0;m[14]=c*b/(b-c);m[15]=0;return m};a.ortho=function(a,b,c,m,e,t,k){var n=1/(a-b),g=1/(c-m),p=1/(e-t);k[0]=-2*n;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=-2*g;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=2*p;k[11]=0;k[12]=(a+b)*n;k[13]=(m+c)*g;k[14]=(t+e)*p;k[15]=1;return k};a.lookAt=function(d,b,c,m){var e,t,k,n,g,p,l,h,v=d[0],C=d[1];d=d[2];k=c[0];n=c[1];t=c[2];l=b[0];c=b[1];e=b[2];if(1E-7>Math.abs(v-l)&&1E-7>Math.abs(C-c)&&1E-7>Math.abs(d-e))return a.identity(m);b=v-l;c=C-c;l=d-e;h=1/Math.sqrt(b*
b+c*c+l*l);b*=h;c*=h;l*=h;e=n*l-t*c;t=t*b-k*l;k=k*c-n*b;(h=Math.sqrt(e*e+t*t+k*k))?(h=1/h,e*=h,t*=h,k*=h):k=t=e=0;n=c*k-l*t;g=l*e-b*k;p=b*t-c*e;(h=Math.sqrt(n*n+g*g+p*p))?(h=1/h,n*=h,g*=h,p*=h):p=g=n=0;m[0]=e;m[1]=n;m[2]=b;m[3]=0;m[4]=t;m[5]=g;m[6]=c;m[7]=0;m[8]=k;m[9]=p;m[10]=l;m[11]=0;m[12]=-(e*v+t*C+k*d);m[13]=-(n*v+g*C+p*d);m[14]=-(b*v+c*C+l*d);m[15]=1;return m};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.NB=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a){function p(a,e){var n=a[0],g=a[1],p=a[2],l=a[3],n=b(n,g,p,l,e[0],7,-680876936),l=b(l,n,g,p,e[1],12,-389564586),p=b(p,l,n,g,e[2],17,606105819),g=b(g,p,l,n,e[3],22,-1044525330),n=b(n,g,p,l,e[4],7,-176418897),l=b(l,n,g,p,e[5],12,1200080426),p=b(p,l,n,g,e[6],17,-1473231341),g=b(g,p,l,n,e[7],22,-45705983),n=b(n,g,p,l,e[8],7,1770035416),l=b(l,n,g,p,e[9],12,-1958414417),p=b(p,l,n,g,e[10],17,-42063),g=b(g,p,l,n,e[11],22,-1990404162),n=b(n,g,p,l,e[12],7,1804603682),l=b(l,n,g,p,
e[13],12,-40341101),p=b(p,l,n,g,e[14],17,-1502002290),g=b(g,p,l,n,e[15],22,1236535329),n=c(n,g,p,l,e[1],5,-165796510),l=c(l,n,g,p,e[6],9,-1069501632),p=c(p,l,n,g,e[11],14,643717713),g=c(g,p,l,n,e[0],20,-373897302),n=c(n,g,p,l,e[5],5,-701558691),l=c(l,n,g,p,e[10],9,38016083),p=c(p,l,n,g,e[15],14,-660478335),g=c(g,p,l,n,e[4],20,-405537848),n=c(n,g,p,l,e[9],5,568446438),l=c(l,n,g,p,e[14],9,-1019803690),p=c(p,l,n,g,e[3],14,-187363961),g=c(g,p,l,n,e[8],20,1163531501),n=c(n,g,p,l,e[13],5,-1444681467),l=
c(l,n,g,p,e[2],9,-51403784),p=c(p,l,n,g,e[7],14,1735328473),g=c(g,p,l,n,e[12],20,-1926607734),n=d(g^p^l,n,g,e[5],4,-378558),l=d(n^g^p,l,n,e[8],11,-2022574463),p=d(l^n^g,p,l,e[11],16,1839030562),g=d(p^l^n,g,p,e[14],23,-35309556),n=d(g^p^l,n,g,e[1],4,-1530992060),l=d(n^g^p,l,n,e[4],11,1272893353),p=d(l^n^g,p,l,e[7],16,-155497632),g=d(p^l^n,g,p,e[10],23,-1094730640),n=d(g^p^l,n,g,e[13],4,681279174),l=d(n^g^p,l,n,e[0],11,-358537222),p=d(l^n^g,p,l,e[3],16,-722521979),g=d(p^l^n,g,p,e[6],23,76029189),n=
d(g^p^l,n,g,e[9],4,-640364487),l=d(n^g^p,l,n,e[12],11,-421815835),p=d(l^n^g,p,l,e[15],16,530742520),g=d(p^l^n,g,p,e[2],23,-995338651),n=m(n,g,p,l,e[0],6,-198630844),l=m(l,n,g,p,e[7],10,1126891415),p=m(p,l,n,g,e[14],15,-1416354905),g=m(g,p,l,n,e[5],21,-57434055),n=m(n,g,p,l,e[12],6,1700485571),l=m(l,n,g,p,e[3],10,-1894986606),p=m(p,l,n,g,e[10],15,-1051523),g=m(g,p,l,n,e[1],21,-2054922799),n=m(n,g,p,l,e[8],6,1873313359),l=m(l,n,g,p,e[15],10,-30611744),p=m(p,l,n,g,e[6],15,-1560198380),g=m(g,p,l,n,e[13],
21,1309151649),n=m(n,g,p,l,e[4],6,-145523070),l=m(l,n,g,p,e[11],10,-1120210379),p=m(p,l,n,g,e[2],15,718787259),g=m(g,p,l,n,e[9],21,-343485551);a[0]=n+a[0]&4294967295;a[1]=g+a[1]&4294967295;a[2]=p+a[2]&4294967295;a[3]=l+a[3]&4294967295}function d(a,b,c,d,e,l){b=(b+a&4294967295)+(d+l&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function b(a,b,c,e,m,l,h){return d(b&c|~b&e,a,b,m,l,h)}function c(a,b,c,e,m,l,h){return d(b&e|c&~e,a,b,m,l,h)}function m(a,b,c,e,m,l,h){return d(c^(b|~e),a,b,m,
l,h)}var e="0123456789abcdef".split("");a.ou=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var m=b.substring(d-64,d),l=[],h=void 0,h=0;64>h;h+=4)l[h>>2]=m.charCodeAt(h)+(m.charCodeAt(h+1)<<8)+(m.charCodeAt(h+2)<<16)+(m.charCodeAt(h+3)<<24);p(a,l)}b=b.substring(d-64);m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)m[d>>2]|=b.charCodeAt(d)<<(d%4<<3);m[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,m),d=0;16>d;d++)m[d]=0;m[14]=8*
c;p(a,m);for(b=0;b<a.length;b++){c=a[b];d="";for(m=0;4>m;m++)d+=e[c>>8*m+4&15]+e[c>>8*m&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"include",file:"math.glslv"},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_proj_matrix ; void main ( ) { gl_Position = u_view_proj_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",
name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",
b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"pack.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"color_util.glslf"},
{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_color_id",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",
";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bC ; varying vec4 bD ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_perspective_cast_far_bound ; varying vec4 bI ; varying vec4 bJ ; varying vec4 bK ; varying vec4 bL ; uniform float u_perspective_cast_far_bound ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { mat4 qN ; float qO , qP ; vec3 qQ , qR , qS , qT ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"qQ = u_camera_eye_frag - bC ; qQ = normalize ( qQ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW",
"REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"qN = O ( u_view_tsr_frag ) ; qM ( qQ , qN , qR , qS , qT , qO , qP ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"qM ( qQ , mat4 ( 0.0 ) , qR , qS , qT , qO , qP ) ;".split(" ")}]}}]},{type:"textline",b:["qP","=","qP",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:"qP = ( texture2D ( u_sampler , bM ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"qP = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( qP < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_OUTLINE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",
b:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bC ; varying vec4 bD ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 tv ; float tw , tx , ty ; vec3 tz , tA , tB , tC , tD , tE ; mat4 tF , tG , tH ; tF = O ( u_view_tsr ) ; tz = a_position ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["tA","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"tB = vec3 ( a_tangent ) ; tC = a_tangent [ 3 ] * cross ( tA , tB ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"tB = vec3 ( 0.0 ) ; tC = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tA = vec3 ( 0.0 ) ; tB = vec3 ( 0.0 ) ; tC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"tz = mix ( tz , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"tA = mix ( tA , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"tD = vec3 ( a_tangent ) ; tE = a_tangent_next [ 3 ] * cross ( a_normal_next , tD ) ; tB = mix ( tB , tD , u_va_frame_factor ) ; tC = mix ( tC , tE , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sB ( tz , tB , tC , tA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["tC","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"tG = O ( u_model_tsr ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",
a:[{type:"textline",b:"tB = ( tG * vec4 ( tC , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tH = ru ( u_camera_eye , tB , tF , tG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tH = ro ( u_camera_eye , tB , tF ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tH = tH * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , tB ) ;".split(" ")}]}}]},{type:"textline",b:"c tI = rB ( tz - tC , tC , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tH ) ; tI . b = tB ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c tI = rB ( tz , tC , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , tG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tp ( tI . a , tI . b , tA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["tA","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"tp ( tI . a , tI . b , tA ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bC = tI . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"bE = tI . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"tw = ( dot ( cross ( tI . e , tI . c ) , tI . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( tI . c , tw ) ;".split(" ")}]}}]},{type:"textline",b:"bD = tF * vec4 ( tI . a , 1.0 ) ; tv = u_proj_matrix * bD ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"tv . xy += u_subpixel_jitter * tv . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tw = tv . x ; tx = tv . y ; ty = tv . w ; bG . x = ( tw + ty ) / 2.0 ; bG . y = ( tx + ty ) / 2.0 ; bG . z = ty ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["tu","(",")",";"]}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * tF * vec4 ( tI . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",
b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",
b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"condition",
a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},
{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bC",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1},"NODES","ALPHA",{type:"logical_and_expr",d:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { mat4 tv ; float tw , tx ; vec3 ty , tz , tA , tB ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:"ty = u_camera_eye_frag - bC ; ty = normalize ( ty ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW",
"REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"tv = O ( u_view_tsr_frag ) ; qM ( ty , tv , tz , tA , tB , tw , tx ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"qM ( ty , mat4 ( 0.0 ) , tz , tA , tB , tw , tx ) ;".split(" ")}]}}]},{type:"textline",b:["tx","=","tx",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:"tx = ( texture2D ( u_colormap0 , bM ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tx = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( tx < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",
c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( dp ( bD . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor . a += 0.00001 * bF . r ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",
a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",
c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",
b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",
a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS",
"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_shadow_cast_billboard_view_tsr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",
d:2},{type:"logic_negative_expr",d:1},"TEXTURE_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat3 u_v_light_tsr ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",
b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bC",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"bL",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying",
"float","bH",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec2 um ; vec4 un , uo ; float up ; vec3 uq , ur , us , ut , uu , uv ; mat4 uw , ux , uy , uz ; uw = O ( u_view_tsr ) ; uq = a_position ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["ur","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ur = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA","CALC_TBN_SPACE",
{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"us = vec3 ( a_tangent ) ; ut = a_tangent [ 3 ] * cross ( ur , us ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"us = vec3 ( 0.0 ) ; ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"uq = mix ( uq , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",
d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"ur = mix ( ur , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"uu = vec3 ( a_tangent ) ; uv = a_tangent_next [ 3 ] * cross ( a_normal_next , uu ) ; us = mix ( us , uu , u_va_frame_factor ) ; ut = mix ( ut , uv , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sB ( uq , us , ut , ur ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["ut","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ut = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",
b:"c uA = t_ ( uq , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , ut , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , uw ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ux = O ( u_model_tsr ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"us = ( ux * vec4 ( ut , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD",{type:"logic_negative_expr",
d:1},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uy = O ( u_shadow_cast_billboard_view_tsr ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uy","=","uw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uz = ru ( u_camera_eye , us , uy , ux ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"uz = ro ( u_camera_eye , us , uy ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uz = uz * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , us ) ;".split(" ")}]}}]},{type:"textline",b:"c uA = rB ( uq - ut , ut , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , uz ) ; uA . b = us ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"c uA = rB ( uq , ut , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur , ux ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["ur","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ur = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"tp ( uA . a , uA . b , ur ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bC = uA . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"bE = uA . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",
b:"up = ( dot ( cross ( uA . e , uA . c ) , uA . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( uA . c , up ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"un = uw * vec4 ( uA . a , 1.0 ) ; uo = u_proj_matrix * un ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"uo . xy += u_subpixel_jitter * uo . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES","ALPHA",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bG = L ( uo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bH = - bD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["tu","(",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ul ( uA . a , uA . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"NODES","ALPHA",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["bD","=","un",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"um = ( u_proj_matrix * uw [ 3 ] ) . xy ; up = SHADOW_TEX_RES / 2.0 ; um = floor ( um * up + 0.5 ) / up - um ; uo . xy += um ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","uo",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",
c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( um , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , um ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",b:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","um",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","um",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","um",";"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec4 un ; vec3 uo ; mat4 up , uq , ur ; up = O ( u_view_tsr ) ; uq = O ( u_model_tsr ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"uo = ( uq * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; ur = ro ( u_camera_eye , uo , up ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ur = ur * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"c us = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ur ) ; us . b = uo ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c us = rB ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , uq ) ;".split(" ")}]}}]},{type:"textline",b:"un = u_proj_matrix * up * vec4 ( us . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"um = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["um","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["um","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","un",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},
{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 un ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 bM ; varying float uo ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const int up = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"const int up = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float ur ( float uq ) { return uq - floor ( uq * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void uA ( inout float us , in float ut [ up ] , in float uu ) { float uv , uw , ux , uy ; for ( int uz = 0 ; uz < NUM_RINGS ; uz ++ ) { uv = 40.0 * ut [ uz ] ; uw = 300.0 * ( ur ( uv ) - 0.005 ) ; ux = uv ; uy = abs ( ux * ( u_halo_size * uw - uu ) ) ; us += 1.0 - min ( uy , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void uJ ( inout float uB , in float uC [ up ] , in float uD ) { float uE , uF , uG , uH ; for ( int uI = 0 ; uI < NUM_LINES ; uI ++ ) { uE = uC [ uI ] ; uF = uE ; uG = 1000.0 * ( ur ( uE ) - 0.005 ) ; uH = 20.0 * abs ( uF * bM . x + uG * bM . y ) ; uB += 1.0 - min ( uH , 1.0 ) ; } uB *= uD ; }".split(" ")}]}}]},{type:"textline",b:"void uQ ( inout float uK , in vec2 uL ) { float uM , uN , uO , uP ; uN = atan ( uL . y , uL . x ) ; uN *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; uO = cos ( uN ) ; uP = sin ( uN ) ; uN = ( uO * uL . x + uP * uL . y ) * ( uO * uL . y - uP * uL . x ) ; uM = abs ( uN ) ; if ( uM < 1.0 ) { uM = ( 0.01 * u_halo_size ) / ( uM ) ; uK *= sqrt ( min ( uM , 1.0 ) ) ; } } void main ( ) { vec3 uR ; float uS , uT , uU , uV ; uS = ( bM . x * bM . x + bM . y * bM . y ) ; uT = sqrt ( uS ) ; uS = max ( 1.0 - uS , 0.0 ) ; uS = pow ( uS , u_halo_hardness ) ; uU = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float uW [ up ] ; for ( int uX = 0 ; uX < up ; uX ++ ) { uW [ uX ] = fract ( uo / ( float ( uX ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"uV = 0.0 ; uA ( uV , uW , uT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"uT = 0.0 ; uJ ( uT , uW , uS ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"uQ ( uS , bM ) ;".split(" ")}]}}]},{type:"textline",b:"uS *= uU ; uR = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"uV *= uS ; uR += u_halo_rings_color * uV ; uS += uV ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"uT *= uU ; uR += u_halo_lines_color * uT ; uS += uT ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"uS *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uT = u_halo_stars_blend * ( un . y - u_halo_stars_height ) ; uS *= clamp ( uT , 0.0 , 1.0 ) ; uS *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"bu ( uR ) ; bx ( uR , uS ) ; gl_FragColor = vec4 ( uR , uS ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform PRECISION float u_halo_size ; varying vec2 bM ; varying float uo ;".split(" ")},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","un",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 up , uq ; vec3 ur ; mat4 us , ut , uu ; us = O ( u_view_tsr ) ; ut = O ( u_model_tsr ) ; ur = ( ut * vec4 ( a_position , 1.0 ) ) . xyz ; bM = a_halo_bb_vertex * 2.0 ; uo = fract ( ur . x + ur . y + ur . z ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ut = qT ( ur , us ) ; uu = us ; uu [ 3 ] [ 0 ] = 0.0 ; uu [ 3 ] [ 1 ] = 0.0 ; uu [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ut = qT ( ur , us ) ;".split(" ")}]}}]},{type:"textline",b:"up = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; up = ut * up ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",
b:"uq = u_proj_matrix * uu * up ; uq . z = 0.99999 * uq . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["un","=","up",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"uq = u_proj_matrix * us * up ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","uq",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"include",file:"math.glslv"},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_proj_matrix ; void main ( ) { vec3 up ; up = u_line_points [ int ( a_point ) ] ; gl_Position = u_view_proj_matrix * vec4 ( up , 1.0 ) ; }".split(" ")}]};a["main.glslf"]=
{type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",
b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3",
"u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",
b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D",
"u_scene_depth",";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","bC",";"]},{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"textline",b:["varying","vec4","bD",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",
a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"nodes.glslf"},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",
b:"void main ( ) { vec2 vd ; mat4 ve ; vec3 vf , vg , vh , vi , vj ; float vk , vl , vm , vn ; vk = length ( bD ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vl = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["vf",
"=","u_sun_intensity",";"]}]}}]},{type:"textline",b:"vg = normalize ( u_camera_eye_frag - bC ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ve = O ( u_view_tsr_frag ) ; qM ( vg , ve , vh , vi , vj , vm , vn ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"qM ( vg , mat4 ( 0.0 ) , vh , vi , vj , vm , vn ) ;".split(" ")}]}}]},
{type:"textline",b:"vh = vh ; vn = vn ; vj = vj ; vm = vm ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"vh = max ( vh - sqrt ( 0.01 * - min ( vl , 0.0 ) ) , 0.5 * vh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",
b:"bp ( vh , vl , u_time , vm , vj , u_sun_direction , vf , u_sun_quaternion , bC , vk ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( vn < 0.5 ) discard ; vn = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NODES_GLOW",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["vn",
"=","1.0",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vc ( vh , length ( bD ) , vg , vl ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vc ( vh , length ( bD ) , vg , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vd = texture2DProj ( u_shadow_mask , bG ) . rg ; vl = vd . g ; vh = vec3 ( vl ) ;".split(" ")}]}}]},{type:"textline",b:["bu","(","vh",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},"NODES_GLOW",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bx ( vh , vn ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( vh , vn ) ; }".split(" ")}]};
a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",
d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",
";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",b:["uniform","mat4","u_proj_matrix",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat3 u_v_light_tsr ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:["varying","vec3","bC",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","vd",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ve",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float",
"bH",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 vf , vg ; float vh ; vec3 vi , vj , vk , vl , vm , vn , vo ; mat4 vp , vq , vr ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",
b:["vp","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vp = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",b:"vq = O ( u_model_tsr ) ; vi = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",
b:["vj","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vj = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vk = vec3 ( a_tangent ) ; vl = a_tangent [ 3 ] * cross ( vj , vk ) ;".split(" ")}]}},{type:"elif",c:["NODES",{type:"logic_negative_expr",
d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vm = ( vq * vec4 ( a_position , 1.0 ) ) . xyz ; vn = normalize ( ( vq * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vm = vm - u_camera_eye ; vl = cross ( vm , vn ) ; vk = cross ( vn , vl ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vk = vec3 ( 0.0 ) ; vl = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:"vi = mix ( vi , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"vj = mix ( vj , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",
b:"vn = vec3 ( a_tangent ) ; vm = a_tangent_next [ 3 ] * cross ( a_normal_next , vn ) ; vk = mix ( vk , vn , u_va_frame_factor ) ; vl = mix ( vl , vm , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sB ( vi , vk , vl , vj ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["vm","=","au_center_pos",
";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vm = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c vs = t_ ( vi , vk , vl , vj , vm , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , vp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vn = ( vq * vec4 ( vm , 1.0 ) ) . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vr = ru ( u_camera_eye , vn , vp , vq ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vr = ro ( u_camera_eye , vn , vp ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vo = ( vq * vec4 ( vm , 1.0 ) ) . xyz ; vr = vr * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vo ) ;".split(" ")}]}}]},
{type:"textline",b:"c vs = rB ( vi - vm , vm , vk , vl , vj , vr ) ; vs . b = vn ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c vs = rB ( vi , vm , vk , vl , vj , vq ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vh = ( dot ( cross ( vs . e , vs . c ) , vs . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( vs . c , vh ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tp ( vs . a , vs . b , vj ) ;".split(" ")}]}}]},{type:"textline",b:"bC = vs . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"bE = vs . e ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vd = u_camera_eye - vs . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"ve = vs . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["ve","=",
"a_color",";"]}]}}]}]}}]},{type:"textline",b:"vf = vp * vec4 ( vs . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["bD","=","vf",";"]}]}}]},{type:"textline",b:"vg = u_proj_matrix * vf ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],
group:{type:"group",a:[{type:"textline",b:"vg . xy += u_subpixel_jitter * vg . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"bG = L ( vg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"ul ( vs . a , vs . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bH = - vf . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["tu","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","vg",";","}"]}]};
a["main_stack.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",
name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",
";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4",
"u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",
";"]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 bC ; varying vec3 bE ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",
d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},{type:"textline",b:["varying","vec3","vd",";"]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR",
"DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ve",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",
a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec4 xk , xl , xm , xn ; mat4 xo ; mat3 xp ; vec2 xq , xr , xs , xt ; vec3 xu , xv , xw , xx , xy , xz , xA , xB , xC ; float xD , xE , xF , xG , xH ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",
{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"xD = length ( bD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"xE = bC . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["xu","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["xq","=","bM",";"]}]}}]},{type:"textline",b:"xv = normalize ( bE ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["INVERT_FRONTFACING"],group:{type:"group",a:[{type:"textline",b:["if","(","!","gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",b:"xv = xv ; else xv = - xv ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"xw = cross ( xv , bF . xyz ) * bF . w ; xp = mat3 ( bF . xyz , xw , xv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xo = O ( u_view_tsr_frag ) ; xr = normalize ( xo * vec4 ( bE , 0.0 ) ) . st ; xr = xr * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( xD < PARALLAX_LOD_DIST ) { xF = clamp ( 0.5 * ( PARALLAX_LOD_DIST - xD ) , 0.0 , 1.0 ) ; xF = u_parallax_scale * xF ; xw = normalize ( vd * xp ) ; xG = 1.0 / PARALLAX_STEPS ; xs = xw . xy * xF / ( PARALLAX_STEPS * xw . z ) ; xF = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:["xt","=","xr",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["xt","=","xq",";"]}]}}]},{type:"textline",b:"xH = texture2D ( u_normalmap0 , xt ) . a ; for ( float xI = 1.0 ; xI <= PARALLAX_STEPS ; xI ++ ) { if ( xH < xF ) { xF -= xG ; xt -= xs ; xH = texture2D ( u_normalmap0 , xt ) . a ; } } xs = xt + xs ; xG = texture2D ( u_normalmap0 , xs ) . a - ( xF + xG ) ; xF = xH - xF ; xG = xF / ( xF - xG ) ; xt = xG * xs + ( 1.0 - xG ) * xt ;".split(" ")},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xq += xt - xr ;".split(" ")}]}}]},{type:"textline",b:["xr","=","xt",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xr += xt - xq ;".split(" ")}]}}]},{type:"textline",b:["xq","=","xt",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xk = texture2D ( u_normalmap0 , xr ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xk = texture2D ( u_normalmap0 , xq ) ;".split(" ")}]}}]},{type:"textline",b:"xw = xk . rgb - 0.5 ; xw = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , xw , u_normal_factor ) ; xw = xp * xw ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["xw","=","xv",";"]}]}}]},{type:"textline",b:"xw = normalize ( xw ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"xr = normalize ( xo * vec4 ( xw , 0.0 ) ) . st ; xr = xr * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"xv = normalize ( vd ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"xx = ve ; br ( xx ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xk = vec4 ( xx , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["xk","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["xG","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"xl = texture2D ( u_colormap0 , xr ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xl = texture2D ( u_colormap0 , xq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"br ( xl . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:[";"]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xm = texture2D ( u_colormap1 , xr ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xm = texture2D ( u_colormap1 , xq ) ;".split(" ")}]}}]},{type:"textline",b:"br ( xm . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"xn = texture2D ( u_stencil0 , xr ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xn = texture2D ( u_stencil0 , xq ) ;".split(" ")}]}}]},{type:"textline",b:"xl = mix ( xl , xm , xn . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xk . rgb = mix ( xk . rgb , xl . rgb , u_diffuse_color_factor ) ; xF = u_alpha_factor * xl . a ; xF += ( 1.0 - step ( 0.0 , xF ) ) ; xk . a = mix ( xF , 1.0 , u_diffuse_color . a ) ; xG = xl . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xk . rgb *= mix ( vec3 ( 1.0 ) , xl . rgb , u_diffuse_color_factor ) ; xk . a = xl . a ; xG = xl . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"xx = u_diffuse_intensity * xk . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["xy","=","xx",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xz = u_environment_energy * dS ( xw ) ; xz = u_ambient * xz ; xF = du ( xx ) ; xA = u_emit * xk . rgb ; xB = u_specular_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"xC = vec3 ( xG ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xC = texture2D ( u_specmap0 , xr ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xC = texture2D ( u_specmap0 , xq ) . rgb ;".split(" ")}]}}]},
{type:"textline",b:"br ( xC . rgb ) ; xB = mix ( xB , xC , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"xG = u_specular_params [ 0 ] ; xq = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; xB = xG * xB ; xj ( xA , xz , xx , xB , bC , xw , xv , xq , u_diffuse_params , xF , 0.0 , vec4 ( 0.0 ) , xy , xC ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},
{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"dP ( xy , xv , xw , u_reflect_factor , xo ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"dP ( xy , xv , xw , u_reflect_factor , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:"dP ( xy , xv , xw , 0.0 , xo ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"dP ( xy , xv , xw , 0.0 , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["xy","+=","xC",";"]}]}}]},{type:"textline",b:"xG = xk . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"xy = max ( xy - sqrt ( 0.01 * - min ( xE , 0.0 ) ) , 0.5 * xy ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"bp ( xy , xE , u_time , xF , xw , u_sun_direction , xu , u_sun_quaternion , bC , xD ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( xG < 0.5 ) discard ; xG = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"xF = max ( max ( xC . r , xC . g ) , xC . b ) * u_specular_alpha ; xG = xk . a * ( 1.0 - xF ) + xF ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["xG","=","1.0",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"xy = mix ( ef ( bG , xw . xz * u_refr_bump ) , xy , xG ) ; xG = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vc ( xy , xD , xv , xE ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vc ( xy , xD , xv , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["bu","(","xy",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bx ( xy , xG ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( xy , xG ) ; }".split(" ")}]};a["main_stack.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",
b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",
d:7}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",b:["uniform","mat4","u_proj_matrix",";"]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform",
"vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",
a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat3 u_v_light_tsr ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:["varying","vec3","bC",";"]},{type:"condition",
a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:7}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS",
"CAUSTICS",{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","vd",";"]},{type:"condition",a:[{type:"if",
c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ve",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bI",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","bJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bL",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",
{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec4 xk , xl ; float xm ; vec3 xn , xo , xp , xq , xr , xs , xt ; mat4 xu , xv , xw ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["xu","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xu = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",b:"xv = O ( u_model_tsr ) ; xn = a_position ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},"NODES",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:["xo","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xo = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",
d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xp = vec3 ( a_tangent ) ; xq = a_tangent [ 3 ] * cross ( xo , xp ) ;".split(" ")}]}},{type:"elif",c:["NODES",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xr = ( xv * vec4 ( a_position , 1.0 ) ) . xyz ; xs = normalize ( ( xv * vec4 ( a_normal , 0.0 ) ) . xyz ) ; xr = xr - u_camera_eye ; xq = cross ( xr , xs ) ; xp = cross ( xs , xq ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"xp = vec3 ( 0.0 ) ; xq = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"xn = mix ( xn , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"xo = mix ( xo , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"xs = vec3 ( a_tangent ) ; xr = a_tangent_next [ 3 ] * cross ( a_normal_next , xs ) ; xp = mix ( xp , xs , u_va_frame_factor ) ; xq = mix ( xq , xr , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"sB ( xn , xp , xq , xo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["xr","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xr = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c xx = t_ ( xn , xp , xq , xo , xr , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , xu ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"xs = ( xv * vec4 ( xr , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xw = ru ( u_camera_eye , xs , xu , xv ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xw = ro ( u_camera_eye , xs , xu ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xt = ( xv * vec4 ( xr , 1.0 ) ) . xyz ; xw = xw * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , xt ) ;".split(" ")}]}}]},{type:"textline",b:"c xx = rB ( xn - xr , xr , xp , xq , xo , xw ) ; xx . b = xs ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c xx = rB ( xn , xr , xp , xq , xo , xv ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"CALC_TBN_SPACE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xm = ( dot ( cross ( xx . e , xx . c ) , xx . d ) < 0.0 ) ? - 1.0 : 1.0 ; bF = vec4 ( xx . c , xm ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tp ( xx . a , xx . b , xo ) ;".split(" ")}]}}]},{type:"textline",b:"bC = xx . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO",
"CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",d:3},{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"bE = xx . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vd = u_camera_eye - xx . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"bM = rE ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"ve = xx . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["ve","=","a_color",";"]}]}}]}]}}]},{type:"textline",b:"xk = xu * vec4 ( xx . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NODES","DISABLE_FOG",{type:"logic_negative_expr",d:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",d:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",
d:2},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["bD","=","xk",";"]}]}}]},{type:"textline",b:"xl = u_proj_matrix * xk ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"xl . xy += u_subpixel_jitter * xl . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",
{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"bG = L ( xl ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ul ( xx . a , xx . e ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","NODES",{type:"logic_negative_expr",d:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"bH = - xk . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NODES"],group:{type:"group",a:[{type:"textline",b:["tu","(",")",";"]}]}}]},{type:"textline",b:["gl_Position","=","xl",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"SOFT_STRENGTH",
b:["1.0"]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec2 u_texel_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"varying float xk ; varying vec3 ve ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",
b:"varying vec4 bD ; varying vec3 bG ; varying float xl ;".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 xm ; vec3 xn ; float xo , xp , xq ; vec2 xr , xs ; xr = gl_PointCoord - 0.5 ; xo = 2.0 * length ( xr ) ; xo = smoothstep ( u_p_alpha_start , u_p_alpha_end , xo ) ; xo = u_diffuse_color . a * xk * ( 1.0 - xo ) ; xn = ve * u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"xs = bG . xy / bG . z ; xr = vec2 ( xr . x , - xr . y ) * xl * u_texel_size ; xr = vec2 ( xs + xr ) ; xm = texture2D ( u_scene_depth , xr ) ; xp = Z ( xm ) ; xq = - bD . z / u_view_max_depth ; xq = xp - xq ; xq = u_view_max_depth / SOFT_STRENGTH * xq ; xo = xo * min ( xq , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["bu","(","xn",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bx ( xn , xo ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( xn , xo ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform",
"mat3","u_model_tsr",";"]}]}}]},{type:"textline",b:"varying float xk ; varying vec3 ve ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"varying vec4 bD ; varying vec3 bG ; varying float xl ;".split(" ")}]}}]},{type:"include",file:"math.glslv"},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { float x_ , ya , yb , yc ; vec4 yd , ye ; mat4 yf ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",
a:[{type:"textline",b:["yf","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"yf = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",b:"xm yg ; yg = xZ ( ) ; yd = yf * vec4 ( yg . b , 1.0 ) ; ye = u_proj_matrix * yd ; gl_Position = ye ; xk = yg . c ; ve = yg . d ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["bD","=","yd",";"]}]}}]},{type:"textline",b:"x_ = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; x_ = yg . a * x_ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"ya = ye . x ; yb = ye . y ; yc = ye . w ; bG . x = ( ya + yc ) / 2.0 ; bG . y = ( yb + yc ) / 2.0 ; bG . z = yc ; xl = x_ ;".split(" ")}]}}]},{type:"textline",b:["gl_PointSize","=","x_",";","}"]}]};a["particles_texture.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},
{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",
b:["0"]},{type:"var",name:"SOFT_STRENGTH",b:["1.0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",c:["USE_ENVIRONMENT_LIGHT",
"SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float xk ; varying vec3 ve ; varying vec2 bM ; varying vec3 bC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1},"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","vd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"textline",b:"void main ( ) { vec2 x_ ; float ya , yb , yc ; vec3 yd , ye , yf , yg , yh , yi , yj , yk ; vec4 yl , ym ; yl = u_diffuse_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"ym = texture2D ( u_sampler , bM ) ; br ( ym . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"yl . rgb = mix ( yl . rgb , ym . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"yl . rgb *= mix ( vec3 ( 1.0 ) , ym . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"yl . a = ym . a ;".split(" ")}]}}]},{type:"textline",b:"yl . rgb *= ve ; yd = u_diffuse_intensity * yl . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1},"DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ye = normalize ( vd ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["PARTICLES_SHADELESS",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"yf = u_emit * yl . rgb ; yg = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logic_negative_expr",d:1},"SKY_COLOR",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"yh = u_environment_energy * dS ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"yh = u_environment_energy * dS ( yg ) ;".split(" ")}]}}]},{type:"textline",b:"yh = u_ambient * yh ; ya = u_specular_params [ 0 ] ; x_ = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; yi = ya * u_specular_color ; xj ( yf , yh , yd , yi , bC , yg , ye , x_ , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , yj , yk ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["yj","=","yd",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"vc ( yj , length ( bD ) , ye , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ya = yl . a * xk ;".split(" ")},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"yb = - bD . z / u_view_max_depth ; yl = texture2DProj ( u_scene_depth , bG ) ; yc = Z ( yl ) ; yb = yc - yb ; yb = u_view_max_depth / SOFT_STRENGTH * yb ; ya = ya * min ( yb , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["bu","(","yj",")",";"]},{type:"condition",
a:[{type:"if",c:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bx ( yj , ya ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( yj , ya ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_view_tsr",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ; uniform vec3 u_wind ; uniform float u_p_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["WORLD_SPACE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:["uniform",
"mat3","u_model_tsr",";"]}]}}]},{type:"textline",b:"varying float xk ; varying vec3 ve ; varying vec2 bM ; varying vec3 vd ; varying vec3 bC ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","bD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"include",
file:"particles.glslv"},{type:"textline",b:"float yb ( vec2 x_ , vec2 ya ) { return ( atan ( ya . y , ya . x ) - atan ( x_ . y , x_ . x ) ) ; } void main ( ) { vec4 yc , yd , ye ; float yf , yg , yh ; mat4 yi , yj ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_PASS"],group:{type:"group",a:[{type:"textline",b:["yi","=","u_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"yi = O ( u_view_tsr ) ;".split(" ")}]}}]},{type:"textline",b:"xm yk ; yk = xZ ( ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { yf = yk . e ; yj = qT ( yk . b , yi ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { yf = yk . e ; yj = w ( ) ; yj [ 3 ] = vec4 ( yk . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { yf = yk . e ; yj = A ( radians ( 90.0 ) ) ; yj [ 3 ] = vec4 ( yk . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { yf = yb ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + yk . e ; yj = y ( radians ( - 90.0 ) ) ; yj [ 3 ] = vec4 ( yk . b , 1.0 ) ; } yc = vec4 ( a_p_bb_vertex * 2.0 * yk . a * u_p_size , 0.0 , 1.0 ) ; yc = yj * C ( yf ) * yc ; yd = yi * yc ; ye = u_proj_matrix * yd ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SOFT_PARTICLES"],group:{type:"group",a:[{type:"textline",b:"yf = ye . x ; yg = ye . y ; yh = ye . w ; bG . x = ( yf + yh ) / 2.0 ; bG . y = ( yg + yh ) / 2.0 ; bG . z = yh ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = ye ; xk = yk . c ; ve = yk . d ; bM = a_p_bb_vertex + 0.5 ; bC = yc . xyz ; vd = u_camera_eye - yc . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"SOFT_PARTICLES",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["bD","=","yd",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 x_ ; const float ya = 0.99 ; const float yb = 1.8 ; const int yc = 8 ; float yi ( vec3 yd , vec3 ye ) { float yf , yg , yh ; yf = dot ( ye , ye ) ; yg = 2.0 * dot ( ye , yd ) ; yh = dot ( yd , yd ) - 1.0 ; yf = yg * yg - 4.0 * yf * yh ; yf = sqrt ( yf ) ; yf = ( - yg - yf ) / 2.0 ; yf = yh / yf ; return yf ; } float yp ( float yj , float yk ) { float yl , ym , yn , yo ; yl = 3.0 * ( 1.0 - yk * yk ) ; ym = 2.0 * ( 2.0 + yk * yk ) ; yn = 1.0 + yj * yj ; yo = pow ( 1.0 + yk * yk - 2.0 * yk * yj , 1.5 ) ; yo = max ( yo , 0.00001 ) ; return ( yl / ym ) * ( yn / yo ) ; } float yv ( vec3 yq , vec3 yr , float ys ) { vec3 yt ; float yu ; yu = dot ( yr , - yq ) ; if ( yu < 0.0 ) { return 1.0 ; } yt = yq + yu * yr ; if ( length ( yt ) < ys ) { return 0.0 ; } else if ( length ( yt ) >= ys ) { yt = normalize ( yt ) * ys - yq ; yu = acos ( dot ( normalize ( yt ) , yr ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( yu * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 yz ( float yw , vec3 yx , float yy ) { return yx - yx * pow ( u_sky_color , vec3 ( yy / yw ) ) ; } void main ( ) { float yA , yB , yC , yD , yE , yF , yG , yH , yI ; vec3 yJ , yK , yL , yM , yN , yO , yP ; yJ = normalize ( x_ ) ; yK = u_sun_direction ; yA = dot ( yJ , yK ) ; yB = yp ( yA , - 0.01 ) * u_rayleigh_brightness * yK . y ; yC = yp ( yA - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - yK . y ) ; yA = smoothstep ( 0.0 , 100.0 , yp ( yA , 0.9995 ) ) * u_spot_brightness ; yL = vec3 ( 0.0 , ya , 0.0 ) ; yD = yi ( yL , yJ ) ; yE = yD / float ( yc ) ; yF = yv ( yL , yJ , ya - 0.3 ) ; yM = vec3 ( 0.0 , 0.0 , 0.0 ) ; yN = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int yQ = 0 ; yQ < yc ; yQ ++ ) { yG = yE * float ( yQ ) ; yO = yL + yJ * yG ; yH = yv ( yO , yK , ya - 0.2 ) ; yI = yi ( yO , yK ) ; yP = yz ( yI , vec3 ( yb ) , u_scatter_strength ) * yH ; yM += yz ( sqrt ( yG ) , u_sky_color * yP , u_rayleigh_strength ) ; yN += yz ( yG , yP , u_mie_strength ) ; } yM = yM * yF * pow ( yD , u_rayleigh_collection_power ) / float ( yc ) ; yN = ( yN * yF * pow ( yD , u_mie_collection_power ) ) / float ( yc ) ; yM = vec3 ( yA * yN + yC * yN + yB * yM ) ; bu ( yM ) ; gl_FragColor = vec4 ( yM , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 x_ ; void main ( ) { vec4 ya , yb ; ya = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; yb = u_cube_view_matrix * ya ; x_ = yb . xyz ; gl_Position = ya ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 bM ; void main ( ) { vec4 ya ; ya = texture2D ( u_sampler , bM ) ; bu ( ya . rgb ) ; bx ( ya . rgb , ya . a ) ; gl_FragColor = ya ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"include",file:"math.glslv"},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 bM ; void main ( ) { vec2 ya ; float yb ; vec4 yc ; vec3 yd ; mat4 ye ; ye = O ( u_view_tsr ) ; bM = a_texcoord ; yd = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; yc = u_proj_matrix * ye * vec4 ( yd , 0.0 ) ; yc . x /= yc . w ; yc . y /= yc . w ; yc += 99999.0 * step ( yc . z , 0.0 ) ; yc += 100.0 * ( step ( 1.0 , abs ( yc . x ) ) + step ( 1.0 , abs ( yc . y ) ) ) ; yc . x = - a_lf_dist * yc . x ; yc . y = - a_lf_dist * yc . y ; yb = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; ya = vec2 ( a_lf_bb_vertex . x / yb , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float yf = 1.9 ; ya *= ( 1.0 + yf * length ( yc . xy ) ) ; } gl_Position = vec4 ( yc . xy + ya , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"define",name:"INV_PI",b:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",a:[{type:"if",c:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX",
{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",b:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 Ae ( vec3 z_ , vec3 Aa , float Ab , float Ac ) { float Ad ; Ad = Ab * Ac ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yo ( Aa , z_ , Ad ) ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ys ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yw ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yB ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"return yG ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yL ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yP ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"return yT ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yX ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return za ( z_ , Aa , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","HUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zg ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",
c:["BLENDTYPE","SATURATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zm ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","VALUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zs ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","COLOR",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zy ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"return zD ( Aa , z_ , Ad ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zH ( Aa , z_ , Ad ) ;".split(" ")}]}}]},{type:"textline",b:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float Am ( float Af , float Ag , float Ah , float Ai ) { float Aj ; vec3 Ak , Al ; Ak = vec3 ( Af ) , Al = vec3 ( Ag ) ; Aj = Ah * Ai ;".split(" ")},{type:"condition",a:[{type:"if",c:["BLENDTYPE","MIX",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yo ( Al , Ak , Aj ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","ADD",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return ys ( Ak , Al , Aj ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SUBTRACT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yw ( Ak , Al , Aj ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","MULTIPLY",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"return zN ( Af , Ag , Aj , Ai ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SCREEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zT ( Af , Ag , Aj , Ai ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","OVERLAY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zZ ( Af , Ag , Aj , Ai ) ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yP ( Ak , Al , Aj ) . x ;".split(" ")}]}},
{type:"elif",c:["BLENDTYPE","DIVIDE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yT ( Ak , Al , Aj ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","DARKEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return yX ( Ak , Al , Aj ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LIGHTEN",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return za ( Ak , Al , Aj ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","SOFT_LIGHT",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zD ( Al , Ak , Aj ) . x ;".split(" ")}]}},{type:"elif",c:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return zH ( Al , Ak , Aj ) . x ;".split(" ")}]}}]},{type:"textline",b:["return","0.0",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},"REFLECTION_PASS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{type:"textline",b:["varying","vec3","x_",";"]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",
d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 An ; float Ao , Ap , Aq ; vec3 Ar , As , At , Au , Av ; As = normalize ( x_ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME"],group:{type:"group",a:[{type:"textline",b:"Ar = textureCube ( u_sky , As ) . rgb ;".split(" ")}]}},{type:"elif",c:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",
d:2},{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Ar = u_horizon_color ; bu ( Ar ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]},{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"textline",b:"At = vec3 ( bM , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"At = vec3 ( x_ . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:["Ao","=","0.0",";"]},{type:"condition",a:[{type:"if",
c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYPAPER"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"Ao = abs ( bM . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ao = ( bM . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ap = acos ( As . y ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",
a:[{type:"textline",b:"Ao = abs ( Ap * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ao = 1.0 - Ap * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",b:"Au = u_horizon_color ; Av = u_zenith_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYTEX"],group:{type:"group",a:[{type:"textline",b:"Ap = 1.0 ; An = textureCube ( u_sky , As ) ; br ( An . rgb ) ; Ap = An . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",
a:[{type:"textline",b:"Ap = bB ( An ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MTEX_NEGATIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"An = vec4 ( vec3 ( 1.0 ) - An . rgb , An . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ap = 1.0 - Ap ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT"],group:{type:"group",a:[{type:"textline",b:"An = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ap = An . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_HORIZ"],group:{type:"group",a:[{type:"textline",b:"Au = Ae ( An . rgb , Au , Ap , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["Aq","=","0.0",";"]},{type:"condition",a:[{type:"if",c:["WO_SKYREAL"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( At , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"Aq = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:[";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["WOMAP_ZENDOWN"],
group:{type:"group",a:[{type:"textline",b:"else Aq = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WOMAP_ZENUP"],group:{type:"group",a:[{type:"textline",b:"Aq = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",c:["WOMAP_ZENDOWN"],group:{type:"group",a:[{type:"textline",b:"Aq = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",b:"if ( Aq != 0.0 ) Av = Ae ( An . rgb , Av , Ap , Aq ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["WOMAP_BLEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MTEX_RGBTOINT",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Ap = dot ( An . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{type:"textline",b:"Ao = Am ( u_sky_tex_dvar , Ao , Ap , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"Ar = mix ( Au , Av , Ao ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["Ar","=","Au",";"]}]}}]},{type:"textline",b:["bu","(","Ar",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bu ( Au ) ; bu ( Av ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WO_SKYBLEND"],group:{type:"group",a:[{type:"textline",b:"Ar = mix ( Au , Av , Ao ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["Ar","=","Au",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","DISABLE_FOG",
{type:"logic_negative_expr",d:1},"REFLECTION_PASS",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"br ( Ar ) ; Ao = u_camera_eye_frag . y - WATER_LEVEL ; Ao = min ( - Ao * 0.03 , 0.8 ) ; Ap = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; Au = vec3 ( 0.0 ) ; An = u_underwater_fog_color_density ; An . rgb = mix ( An . rgb , Au , min ( - As . y + Ao , 1.0 ) ) * Ap ; Ao = clamp ( sign ( As . y - 0.05 * Ao ) , 0.0 , 1.0 ) ; Ar = mix ( An . rgb , Ar , Ao ) ; bu ( Ar ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( Ar , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 x_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 z_ , Aa ; z_ = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; Aa = u_sky_vp_inverse * z_ ; x_ = Aa . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",d:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"bM = a_position . xy ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","z_",";","}"]}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",
b:["0.0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",
c:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],
group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_params",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_plane_reflection",";"]}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2",
"u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float z_ = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 vd ; varying vec3 bC ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",
{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"varying vec3 bF ; varying vec3 Aa ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ab",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ac",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",
d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ad",";"]}]}}]},{type:"include",
file:"environment.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",b:"vec3 Ap ( in vec2 Ae , in vec3 Af , in vec3 Ag , in vec3 Ah , out float Ai ) { float Aj , Ak , Al ; vec2 Am ; vec3 An , Ao ; Ai = 0.0 ; An = reflect ( - Ag , Af ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Am = Ae . xy + Af . xz * REFL_BUMP / bH ; Ai = u_reflect_factor ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1},"WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ao = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"Ao = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"} else { Ao = texture2D ( u_plane_reflection , Am ) . rgb ; br ( Ao ) ; }".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ai = u_mirror_factor ; Ao = Ah * textureCube ( u_mirrormap , An ) . rgb ; br ( Ao ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ai = u_reflect_factor ; Ao = Ah * vec3 ( 0.3 , 0.5 , 1.0 ) ; br ( Ao ) ;".split(" ")}]}}]},
{type:"textline",b:"An = normalize ( An + Ag ) ; Aj = 1.0 - dot ( Ag , An ) ; Ak = u_fresnel_params [ 3 ] ; Al = u_fresnel_params [ 2 ] ; Al = Ak + ( 1.0 - Ak ) * pow ( Aj , Al ) ; Ai = min ( Ai * Al , 1.0 ) ; return Ao ; }".split(" ")},{type:"include",file:"lighting_nodes.glslf"},{type:"textline",b:"void main ( ) { vec4 Aq ; vec2 Ar , As , At ; float Au , Av , Aw , Ax , Ay , Az ; vec3 AA , AB , AC , AD , AE , AF , AG , AH , AI ; mat3 AJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AJ = mat3 ( bF , Aa , bE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"AA = normalize ( bE ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AA = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","FOAM",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Au = bC . y - WATER_LEVEL ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"Ar = vec2 ( Ab . x , - Ab . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ar = vec2 ( bC . x , - bC . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["Ar","=","bM",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AB = vec3 ( 0.0 ) ; AC = texture2D ( u_normalmap0 , Ar * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AB += AC ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"AD = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],
group:{type:"group",a:[{type:"textline",b:["AD","+=","AC",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AC = texture2D ( u_normalmap0 , Ar * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AB += AC ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",
b:["AD","+=","AC",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AC = texture2D ( u_normalmap0 , Ar * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AB += AC ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["AD","+=","AC",";"]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AC = texture2D ( u_normalmap0 , Ar * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; AB += AC ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["AD","+=","AC",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"AD = AJ * AD ; if ( ! f ( AD , vec3 ( 0.0 ) ) ) AD = normalize ( AD ) ; AD = mix ( AA , AD , 0.2 ) ; AD = normalize ( AD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"AA = mix ( AA , normalize ( AJ * AB ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"AA = mix ( AA , normalize ( AJ * AB ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"AA = normalize ( AA ) ;".split(" ")}]}}]},{type:"textline",b:"AB = normalize ( vd ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"As = bG . xy / bG . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",
d:1},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Av = bH * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"Aw = u_diffuse_color . a ; Aq = texture2DProj ( u_scene_depth , bG ) ; Ax = Z ( Aq ) ; Ay = max ( Ax - bH , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"At = As + AA . xz * u_refr_bump / bH ; Ax = dY ( Ax , At , As ) ; Ax = max ( Ax - bH , 0.0 ) ; Ax = u_view_max_depth / ABSORB * Ax ; if ( u_cam_water_depth < 0.0 ) Az = 0.0 ; else Az = min ( Aw * Ax , 1.0 ) ; Ax = u_view_max_depth / ABSORB * Ay ; Aw = min ( 15.0 * Aw * u_view_max_depth * Ay , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"Ax = u_view_max_depth / ABSORB * Ay ; if ( u_cam_water_depth > 0.0 ) Aw = min ( Aw * Ax , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"Aw *= min ( 5.0 * Av , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Aw = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"Az = 1.0 - Aw ; At = As + AA . xz * u_refr_bump / bH ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"AC = texture2D ( u_refractmap , At ) . rgb ; br ( AC ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Ax = pow ( min ( Ac . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; AE = mix ( u_shallow_water_col , u_diffuse_color . rgb , Ax ) ; Ax = pow ( min ( Ac . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; AE = mix ( u_shore_water_col , AE , Ax ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"AE = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"Ay = max ( 1.0 - u_view_max_depth * Ay , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ay = 1.0 - Aw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:"Au = max ( Au / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"AF = normalize ( vec3 ( Ac . r , 0.0 , Ac . g ) ) ; AF = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , AF , 0.8 ) ) ; Ax = 1.25 * max ( dot ( AD , AF ) - 0.2 , 0.0 ) ; Ax += max ( dot ( AD , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; Ay += Ax * ( 1.0 - Ac . b ) ; Au *= ( 1.0 - 0.95 * pow ( Ac . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"Ay += Au ; Ay = min ( u_foam_factor * Ay , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"Aq = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + Ar * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"Au = u_specular_params [ 0 ] ; Ar = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; AD = Au * u_specular_color ; AF = u_environment_energy * dS ( AA ) ; AF = u_ambient * AF ; AF = AF + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"AG = Ap ( As , AA , AB , AF , Au ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AG = Ap ( vec2 ( 0.0 ) , AA , AB , AF , Au ) ;".split(" ")}]}}]},{type:"textline",b:"AE = u_diffuse_intensity * AE ; xj ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , AE , AD , bC , AA , AB , Ar , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , AH , AI ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"Ax = max ( dot ( u_sun_direction , - bE ) + SSS_WIDTH , 0.0 ) * max ( dot ( - AB , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; Ax = clamp ( SSS_STRENGTH * Ax , 0.0 , 1.0 ) ; AH = mix ( AH , u_shallow_water_col , Ax ) ; AH = mix ( AH , u_shore_water_col , Ax ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"AH = mix ( AC , AH , Az ) ;".split(" ")}]}}]},{type:"textline",b:"AH = mix ( AH , AG , Au ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"Au = mix ( Aq . g , Aq . r , max ( 4.0 * ( Ay - 0.75 ) , 0.0 ) ) ; Au = mix ( Aq . b , Au , max ( 2.0 * Ay - 1.0 , 0.0 ) ) ; Au = mix ( 0.0 , Au , Ay ) ; AH = mix ( AH , AF , Au ) ;".split(" ")}]}}]},{type:"textline",
b:["AH","+=","AI",";"]},{type:"condition",a:[{type:"if",c:["DISABLE_FOG",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { uW ( AH , Av , u_cam_water_depth ) ; } else { vc ( AH , Av , AB , 1.0 ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vc ( AH , Av , AB , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["bu","(","AH",")",";"]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"Aw = max ( Aw , AI . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["Aw","+=","Au",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"bx ( AH , Aw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",
":","enable"]},{type:"textline",b:"AI = fwidth ( Ad ) ; AI = smoothstep ( vec3 ( 0.0 ) , AI * z_ , Ad ) ; Au = min ( min ( AI . x , AI . y ) , AI . z ) ; Au = clamp ( Au , 0.0 , 1.0 ) ; AH = mix ( u_wireframe_edge_color , AH , Au ) ; Aw = mix ( 1.0 , Aw , Au ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( AH , Aw ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",
b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",
b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"DYNAMIC",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH",{type:"logic_negative_expr",d:1},"NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",";"]}]}}]},{type:"textline",b:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 vd ; varying vec3 bC ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","bM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"varying vec3 bF ; varying vec3 Aa ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","Ab",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ac",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","bG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",
{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:["varying","float","bH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","Ad",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 Ai ( in vec2 z_ ) { float Ae ; vec4 Af ; vec2 Ag ; Ag = 0.5 + vec2 ( ( z_ . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( z_ . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; Af = texture2D ( u_shore_dist_map , Ag ) ; const vec2 Ah = vec2 ( 1.0 / 255.0 , 1.0 ) ; Ae = dot ( Af . ba , Ah ) ; Ag = normalize ( Af . rg * 2.0 - 1.0 ) ; return vec3 ( Ag , Ae ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void Au ( inout vec3 Aj , in float Ak , in vec3 Al ) { vec2 Am , An , Ao ; float Ap , Aq , Ar , As , At ; Ap = aU ( DST_NOISE_SCALE_0 * ( Aj . xz + DST_NOISE_FREQ_0 * Ak ) ) * aU ( DST_NOISE_SCALE_1 * ( Aj . zx - DST_NOISE_FREQ_1 * Ak ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"Aq = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; Ar = Al . b ; As = sqrt ( Ar ) ; Aq = max ( Ar , DIR_MIN_SHR_FAC ) * sin ( As / Aq + DIR_FREQ * Ak ) ; At = max ( aU ( DIR_NOISE_SCALE * ( Aj . xz + DIR_NOISE_FREQ * Ak ) ) , DIR_MIN_NOISE_FAC ) ; Aq *= At ; As = WAVES_HEIGHT * mix ( Aq , Ap , max ( As , DST_MIN_FAC ) ) ; Am = Al . rg ; Aq = WAVES_HOR_FAC * Aq * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - Ar ) , 0.0 ) ; Am = Aq * Am ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"As = WAVES_HEIGHT * Ap ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"An = 2.0 * ( Aj . xz - 0.1 * Ak ) ; Ao = 1.3 * ( Aj . zx + 0.03 * Ak ) ; Ap = ay ( 0.5 * An ) . x + ay ( 0.5 * Ao ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Aj . xz += Am ; Ap *= Ar ;".split(" ")}]}}]},{type:"textline",b:"As += SMALL_WAVES_FAC * Ap ;".split(" ")}]}}]},{type:"textline",
b:"Aj . y += As ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec4 Av , Aw ; vec2 Ax ; float Ay , Az , AA ; vec3 AB , AC , AD , AE ; mat4 AF , AG ; AF = O ( u_view_tsr ) ; AG = O ( u_model_tsr ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) Ad = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ad = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ad = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["AB","=","a_position",";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"Ay = abs ( AB . y ) ; Ax = u_camera_eye . xz - mod ( u_camera_eye . xz , Ay ) ; AB . y = WATER_LEVEL ; AB . xz += Ax ;".split(" ")}]}},{type:"elif",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["bM","=","a_texcoord",";"]}]}}]},{type:"textline",b:"c AH = rB ( AB , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , AG ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"Ac = Ai ( AH . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"Az = length ( u_wind ) ; AA = u_time ; AA *= Az ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"Ay = Ay ; AB = AH . a + vec3 ( Ay , 0.0 , 0.0 ) ; AC = AH . a + vec3 ( 0.0 , 0.0 , Ay ) ; if ( a_position . y < 0.0 ) { AH . a . y = WATER_LEVEL - 1.0 ; AB . y = AH . a . y ; AC . y = AH . a . y ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",0,{type:"g_expr",d:2},"FOAM",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ab = AH . a ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"AB = AH . a + vec3 ( 0.05 , 0.0 , 0.0 ) ; AC = AH . a + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"AD = Ai ( AB . xz ) ; AE = Ai ( AC . xz ) ; Au ( AB , AA , AD ) ; Au ( AC , AA , AE ) ; Au ( AH . a , AA , Ac ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"Au ( AB , AA , vec3 ( 0.0 ) ) ; Au ( AC , AA , vec3 ( 0.0 ) ) ; Au ( AH . a , AA , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"AB = normalize ( AB - AH . a ) ; AC = normalize ( AC - AH . a ) ; bE = normalize ( cross ( AC , AB ) ) ; AA = dot ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; AA = clamp ( 0.8 - AA , 0.0 , 1.0 ) ; bE = mix ( bE , vec3 ( 0.0 , 1.0 , 0.0 ) , AA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"AC = a_tangent ; bE = a_normal ;".split(" ")}]}}]},{type:"textline",b:"bF = AC ; Aa = cross ( bE , bF ) ;".split(" ")}]}}]},{type:"textline",b:"bC = AH . a ; vd = u_camera_eye - AH . a ; Av = AF * vec4 ( AH . a , 1.0 ) ; Aw = u_proj_matrix * Av ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",d:2},"REFRACTIVE",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"AA = Aw . x ; Ay = Aw . y ; Az = Aw . w ; bG . x = ( AA + Az ) / 2.0 ; bG . y = ( Ay + Az ) / 2.0 ; bG . z = Az ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",d:1},{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"bH = - Av . z / u_view_max_depth ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","Aw",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_NONE",b:["0"]},{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["1"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["2"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["3"]},{type:"define",name:"WM_DEBUG_SPHERES",b:["4"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 Ad ; const float z_ = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 Ae = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 Ae = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 Af = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 Ag = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 Ah = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"void main ( ) { float Ai , Aj ; vec3 Ak , Al ; Ak = vec3 ( 0.0 ) ; Ai = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"Al = sign ( Ad - vec3 ( 0.02 * z_ ) ) ; if ( Al . x < 0.0 || Al . y < 0.0 || Al . z < 0.0 ) { Ak = Ae ; Ai = 1.0 ; } else discard ;".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Al = sign ( Ad - vec3 ( 0.02 * z_ ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( Al . x < 0.0 || Al . y < 0.0 || Al . z < 0.0 ) Ak = u_wireframe_edge_color ; else Ak = Ah ; Ai = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( Al . x < 0.0 || Al . y < 0.0 || Al . z < 0.0 ) Ai = 1.0 ; else Ai = 0.0 ; Ak = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( Al . x < 0.0 || Al . y < 0.0 || Al . z < 0.0 ) Ak = u_wireframe_edge_color ; else if ( gl_FrontFacing ) Ak = Af ; else Ak = Ag ; Ai = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY",1,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"Al = fwidth ( Ad ) ; Al = smoothstep ( vec3 ( 0.0 ) , Al * z_ , Ad ) ; Aj = min ( min ( Al . x , Al . y ) , Al . z ) ; Aj = clamp ( Aj , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { Ak = vec3 ( mix ( u_wireframe_edge_color , Ah , Aj ) ) ; Ai = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { Ak = u_wireframe_edge_color ; Ai = mix ( 1.0 , 0.0 , Aj ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) Ak = mix ( u_wireframe_edge_color , Af , Aj ) ; else Ak = mix ( u_wireframe_edge_color , Ag , Aj ) ; Ai = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["bu","(","Ak",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"bx ( Ak , Ai ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( Ak , Ai ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat3","u_model_tsr",
";"]}]}}]},{type:"textline",b:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["varying","vec3","Ad",";"]},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { vec3 z_ , Ae , Af , Ag , Ah ; mat4 Ai , Aj , Ak ; Ai = O ( u_view_tsr ) ; Aj = O ( u_model_tsr ) ; if ( a_polyindex == 0.0 ) Ad = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Ad = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Ad = vec3 ( 0.0 , 0.0 , 1.0 ) ; z_ = a_position ; Ae = a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"c Al = rB ( z_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Aj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"z_ = mix ( z_ , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"Af = vec3 ( 0.0 ) ; Ag = vec3 ( 0.0 ) ; sB ( z_ , Af , Ag , Ae ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:["Ag","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ag = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c Al = t_ ( z_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ag , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , Ai ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"Af = ( Aj * vec4 ( Ag , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ak = ru ( u_camera_eye , Af , Ai , Aj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Ak = ro ( u_camera_eye , Af , Ai ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ah = ( Aj * vec4 ( Ag , 1.0 ) ) . xyz ; Ak = Ak * rg ( u_wind , u_time , u_jitter_amp , u_jitter_freq , Ah ) ;".split(" ")}]}}]},{type:"textline",b:"c Al = rB ( z_ - Ag , Ag , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ak ) ; Al . b = Af ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c Al = rB ( z_ , Ag , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Aj ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"tp ( Al . a , Al . b , Ae ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * Ai * vec4 ( Al . a , 1.0 ) ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 bM ; void main ( ) { vec4 z_ , Ae ; z_ = texture2D ( u_sampler_left , bM ) ; Ae = texture2D ( u_sampler_right , bM ) ; gl_FragColor = vec4 ( z_ [ 0 ] , Ae [ 1 ] , Ae [ 2 ] , z_ [ 3 ] + Ae [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["2"]},{type:"define",name:"AA_QUALITY_LOW",b:["0"]},{type:"define",name:"AA_QUALITY_MEDIUM",b:["1"]},{type:"define",name:"AA_QUALITY_HIGH",b:["2"]},
{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"vec4 Ag ( float z_ , float Ae ) { vec2 Af ; Af = bM + vec2 ( z_ , Ae ) * u_texel_size ; return texture2D ( u_color , Af ) ; } vec4 At ( ) { vec2 Ah ; float Ai , Aj , Ak , Al , Am , An ; vec4 Ao , Ap , Aq , Ar , As ; Ao = Ag ( - 1.0 , - 1.0 ) ; Ap = Ag ( 1.0 , - 1.0 ) ; Aq = Ag ( - 1.0 , 1.0 ) ; Ar = Ag ( 1.0 , 1.0 ) ; As = Ag ( 0.0 , 0.0 ) ; Ai = bB ( As ) ; Aj = bB ( Ao ) ; Ak = bB ( Ap ) ; Al = bB ( Aq ) ; Am = bB ( Ar ) ; An = min ( Ai , min ( min ( Aj , Ak ) , min ( Al , Am ) ) ) ; Ai = max ( Ai , max ( max ( Aj , Ak ) , max ( Al , Am ) ) ) ; Ah . x = - ( ( Aj + Ak ) - ( Al + Am ) ) ; Ah . y = ( ( Aj + Al ) - ( Ak + Am ) ) ; Am = max ( ( Aj + Ak + Al + Am ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; Am = 1.0 / ( min ( abs ( Ah . x ) , abs ( Ah . y ) ) + Am ) ; Ah = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , Ah * Am ) ) * u_texel_size ; Ar = 0.5 * ( texture2D ( u_color , bM + Ah * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , bM + Ah * ( 2.0 / 3.0 - 0.5 ) ) ) ; Aq = Ar * 0.5 + 0.25 * ( texture2D ( u_color , bM + Ah * - 0.5 ) + texture2D ( u_color , bM + Ah * 0.5 ) ) ; Am = bB ( Aq ) ; if ( ( Am < An ) || ( Am > Ai ) ) return Ar ; else return Aq ; }".split(" ")}]}},
{type:"elif",c:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_GREEN_AS_LUMA",b:["1"]},{type:"define",name:"FXAA_BLEND4WEB",b:["1"]},{type:"include",file:"fxaa.glslf"},{type:"condition",a:[{type:"if",c:["AA_QUALITY","AA_QUALITY_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PRESET",b:["39"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["1.00"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",
b:["0.063"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["0.0312"]}]}},{type:"elif",c:["AA_QUALITY","AA_QUALITY_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PRESET",b:["20"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["0.65"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["0.0625"]}]}},{type:"elif",c:["AA_QUALITY","AA_QUALITY_LOW",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"define",name:"FXAA_QUALITY_PRESET",b:["12"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["0.50"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["0.166"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["0.0833"]}]}}]}]}}]},{type:"textline",b:"void main ( ) { vec2 Bk ;".split(" ")},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = At ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD",
"AA_METHOD_FXAA_QUALITY",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Bk = u_texel_size ; gl_FragColor = Bj ( bM , u_color , Bk , FXAA_QUALITY_SUBPIX , FXAA_QUALITY_EDGE_THRESHOLD , FXAA_QUALITY_EDGE_THRESHOLD_MIN ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 bM ; void main ( ) { vec4 z_ ; vec2 Ae , Af ; Ae = vec2 ( 0.0 , 0.0 ) ; Af = u_texel_size ; z_ = texture2D ( u_color , bM ) ; gl_FragColor = z_ * 0.0875447373698 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0858112354248 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0808139781061 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0731235112908 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0635705267419 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0530985673112 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0426125984122 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0328565115809 ; Ae += Af ; gl_FragColor += texture2D ( u_color , bM + Ae ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , bM - Ae ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * z_ , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 bM ; void main ( ) { vec4 z_ , Ae ; z_ = texture2D ( u_main , bM ) ; Ae = texture2D ( u_bloom , bM ) ; z_ = z_ ; z_ += Ae ; gl_FragColor = vec4 ( z_ . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},
{type:"define",name:"PI_4",b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 bM ; void main ( ) { float z_ ; vec3 Ae ; vec4 Af ; Af = texture2D ( u_color , bM ) ; Ae = Af . rgb ; if ( u_brightness < 0.0 ) Ae = Ae * ( 1.0 + u_brightness ) ; else Ae = Ae + ( ( 1.0 - Ae ) * u_brightness ) ; Ae = ( Ae - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; Ae *= u_exposure ; z_ = bB ( vec4 ( Ae , 0.0 ) ) ; Ae = mix ( vec3 ( z_ ) , Ae , u_saturation ) ; gl_FragColor = vec4 ( Ae , Af . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { gl_FragColor = V ( clamp ( Bq ( u_depth , bM , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]=
{type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 bM ; void main ( ) { float z_ , Ae ; vec4 Af , Ag ; Af = texture2D ( u_sharp , bM ) ; if ( u_dof_dist > 0.0 ) { z_ = Bq ( u_depth , bM , u_camera_range ) ; z_ *= u_view_max_depth ; if ( z_ < u_dof_dist ) Ae = ( u_dof_dist - z_ ) / u_dof_front ; else Ae = ( z_ - u_dof_dist ) / u_dof_rear ; Ae = clamp ( Ae , 0.0 , 1.0 ) ; Ag = texture2D ( u_blurred , bM ) ; gl_FragColor = mix ( Af , Ag , Ae ) ; } else gl_FragColor = Af ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 bM ; void main ( ) { float z_ ; vec4 Ae , Af , Ag ; Ae = texture2D ( u_src_color , bM ) ; Af = texture2D ( u_glow_mask_small , bM ) ; Ag = texture2D ( u_glow_mask_large , bM ) ; gl_FragColor = Ae ; if ( Ag . a != 0.0 ) { z_ = u_glow_mask_large_coeff * Ag . a ; z_ = clamp ( z_ , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Ag . rgb / Ag . a , z_ ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , z_ ) ; } if ( Af . a != 0.0 ) { z_ = u_glow_mask_small_coeff * Af . a ; z_ = clamp ( z_ , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , Af . rgb / Af . a , z_ ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , z_ ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",
a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float Br ; varying vec2 Bs ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 bM ; varying vec4 Bt ; void main ( ) { vec4 Bu ; float Bv , Bw , Bx , By , Bz ; vec2 BA , BB , BC ; BA = ( Bt . xy - bM ) ; Bv = length ( BA ) ; BA = u_radial_blur_step * BA / Bv ; Bw = Bv / u_radial_blur_step ; BA *= min ( Bw , STEPS_PER_PASS ) / STEPS_PER_PASS ; Bw = max ( Bw , STEPS_PER_PASS ) ; BB = bM ; Bx = 0.0 ; for ( float BD = 0.0 ; BD < STEPS_PER_PASS ; BD += 1.0 ) { if ( BD <= Bw ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"By = Bq ( u_input , BB , u_camera_range ) ; Bx += max ( ( 1.0 - pow ( Bv , 0.3 ) ) * step ( 0.9 , By ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Bu = texture2D ( u_input , BB ) ; Bx += Z ( Bu ) ;".split(" ")}]}}]},{type:"textline",b:"} BB += BA ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"BC = bM + Bs ; Bz = ay ( vec2 ( 2.5 * ( BC . x ) , 2.5 * ( BC . y ) + 1.0 * u_time ) ) . x + 0.75 * ay ( vec2 ( 5.0 * ( BC . x ) - 0.66 * u_time , 5.0 * ( BC . y ) + 0.66 * u_time ) ) . x + 0.5 * aU ( vec2 ( 7.5 * ( BC . x ) + 0.33 * u_time , 7.5 * ( BC . y ) - 0.33 * u_time ) ) ; Bz *= clamp ( 1.2 - sqrt ( 0.2 * Bv ) , 0.0 , 1.0 ) * Br ; Bx = max ( Bz , Bx ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = V ( Bx / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"include",file:"math.glslv"},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float Br ; varying vec2 Bs ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 bM ; varying vec4 Bt ; void main ( ) { float z_ , Ae ; vec3 Af ; bM = a_bb_vertex + 0.5 ; Af = normalize ( u_sun_direction ) ; Bt = u_view_proj_matrix * vec4 ( Af , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { Br = 1.0 ; Af = vec3 ( 0.0 , 1.0 , 0.0 ) ; Af = i ( u_camera_quat , Af ) ; Af = normalize ( Af ) ; z_ = dot ( Af , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; Ae = atan ( Af . x , Af . z ) ; Bs = vec2 ( - Ae , acos ( z_ ) ) ; } else { Br = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"Bt . xy = 0.5 * ( Bt . xy / Bt . w + 1.0 ) ; Bt += 99999.0 * step ( Bt . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 bM ; void main ( ) { float z_ ; vec3 Ae ; vec4 Af ; Af = texture2D ( u_main , bM ) ; Ae = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; br ( Af . rgb ) ; z_ = Z ( texture2D ( u_god_rays , bM ) ) ; Ae = Af . rgb + u_god_rays_intensity * vec3 ( z_ ) * Ae ; bu ( Ae ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SAFARI_CANVAS_ALPHA_HACK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( Ae , max ( 0.01 , Af . a ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( Ae , Af . a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 bM ; void main ( ) { float z_ ; vec4 Ae ; Ae = texture2D ( u_input , bM ) ; z_ = dot ( Ae . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( z_ ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float z_ , Ae ; Ae = 0.0 ; for ( float Af = 0.025 ; Af < 1.0 ; Af += 0.05 ) for ( float Ag = 0.025 ; Ag < 1.0 ; Ag += 0.05 ) { z_ = max ( texture2D ( u_input , vec2 ( Af , Ag ) ) . r , 0.01 ) ; Ae += log ( z_ ) ; } Ae = exp ( Ae / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( Ae ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_trunced.glslf"]=
{type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 bM ; varying float Bu ; void main ( ) { vec4 Bv ; float Bw , Bx ; Bw = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; Bx = texture2D ( u_luminance , bM ) . r ; Bv = texture2D ( u_main , bM ) ; Bw = Bx / Bw ; Bx = u_bloom_edge_lum ; gl_FragColor = Bv * max ( Bw - Bx , 0.0 ) * Bu ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 bM ; varying float Bu ; const vec3 z_ = vec3 ( 0.0 , 1.0 , 0.0 ) ; void Al ( in vec4 Ae , in vec3 Af , out vec3 Ag ) { float Ah , Ai , Aj , Ak ; Ah = Ae . w * Af . x + Ae . y * Af . z - Ae . z * Af . y ; Ai = Ae . w * Af . y + Ae . z * Af . x - Ae . x * Af . z ; Aj = Ae . w * Af . z + Ae . x * Af . y - Ae . y * Af . x ; Ak = - Ae . x * Af . x - Ae . y * Af . y - Ae . z * Af . z ; Ag . x = Ah * Ae . w - Ak * Ae . x - Ai * Ae . z + Aj * Ae . y ; Ag . y = Ai * Ae . w - Ak * Ae . y - Aj * Ae . x + Ah * Ae . z ; Ag . z = Aj * Ae . w - Ak * Ae . z - Ah * Ae . y + Ai * Ae . x ; } void main ( ) { vec3 Am ; bM = 2.0 * a_position ; Al ( u_camera_quat , z_ , Am ) ; Bu = dot ( - Am , u_sun_direction ) * u_bloom_key ; Bu *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 bM ; float z_ = 0.0042 ; void main ( ) { vec4 Ae , Af , Ag , Ah ; Ae = texture2D ( u_mb_tex_curr , bM ) ; Af = texture2D ( u_mb_tex_accum , bM ) ; if ( length ( Ae - Af ) > u_motion_blur_decay_threshold ) { Ag = ( 1.0 - u_motion_blur_exp ) * Ae + u_motion_blur_exp * Af ; Ag = Ag - Af ; Ah = Ae - Af ; Ag = min ( max ( abs ( Ag ) , vec4 ( z_ ) ) , abs ( Ah ) ) * sign ( Ag ) ; gl_FragColor = Af + Ag ; } else { gl_FragColor = Ae ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"textline",b:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 bM ; void main ( ) { vec3 z_ ; float Ae ; vec4 Af , Ag , Ah ; Af = texture2D ( u_outline_src , bM ) ; gl_FragColor = Af ; if ( u_draw_outline != 0.0 ) { Ag = texture2D ( u_outline_mask , bM ) ; Ah = texture2D ( u_outline_mask_blurred , bM ) ; Ae = Ah . a - Ag . a ; if ( Ae != 0.0 ) { Ae = smoothstep ( 0.0 , 1.0 , Ah . a ) ; if ( Ag . a == 0.0 ) { z_ = u_outline_color ; bu ( z_ ) ; Ag = vec4 ( clamp ( z_ , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( Af , Ag , Ae ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"define",name:"FLIP_CUBEMAP_COORDS",b:["7"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform int u_tex_number ; uniform vec2 u_delta ;".split(" ")}]}}]},{type:"textline",b:"varying vec2 bM ; void main ( ) { float z_ , Ae , Af , Ag ; vec2 Ah , Ai ; vec4 Aj ;".split(" ")},{type:"condition",a:[{type:"if",c:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , bM ) ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Aj = texture2D ( u_color , bM ) ; gl_FragColor . rgb = vec3 ( ( Aj . r + Aj . g + Aj . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_BLUR",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ah = vec2 ( 0.0 , 0.0 ) ; Ai = u_texel_size ; Aj = texture2D ( u_color , bM ) ; gl_FragColor = Aj * 0.2270270270 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * 0.1945945946 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * 0.1945945946 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * 0.1216216216 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * 0.1216216216 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * 0.0540540541 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * 0.0540540541 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * 0.0162162162 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ah = vec2 ( 0.0 , 0.0 ) ; Ai = u_texel_size ; Aj = texture2D ( u_color , bM ) ; gl_FragColor = Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.152507 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.141763 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.141763 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.113861 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.113861 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.079019 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.079019 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.047383 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.047383 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.024549 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.024549 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.01099 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.01099 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.00425 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.00425 ; Ah += Ai ; Aj = texture2D ( u_color , bM + Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.00142 ; Aj = texture2D ( u_color , bM - Ah ) ; gl_FragColor += Aj * ( 1.0 - step ( 0.0 , - Aj . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",d:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ai = u_texel_size ; Aj = texture2D ( u_color , bM ) ; gl_FragColor = Aj ; if ( Aj . a == 0.0 ) { Aj = texture2D ( u_color , bM + Ai ) ; if ( Aj . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Aj . a ) ; else { Aj = texture2D ( u_color , bM - Ai ) ; if ( Aj . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , Aj . a ) ; } }".split(" ")}]}},
{type:"elif",c:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"z_ = u_delta [ 0 ] ; Ae = u_delta [ 1 ] ; Af = 1.0 / 3.0 ; Ag = 0.5 ; Ai = vec2 ( Af , Ag ) ; if ( u_tex_number == 0 ) { Ah = bM * Ai + vec2 ( 2.0 * Af , 0.0 ) ; Ah [ 0 ] = min ( Ah [ 0 ] , 1.0 - z_ ) ; Ah [ 1 ] = min ( Ah [ 1 ] , 0.5 - Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * Af - Ah [ 0 ] , Ah [ 1 ] ) ) ; } else if ( u_tex_number == 1 ) { Ah = bM * Ai ; Ah [ 0 ] = max ( Ah [ 0 ] , z_ ) ; Ah [ 1 ] = min ( Ah [ 1 ] , 0.5 - Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( Af - Ah [ 0 ] , Ah [ 1 ] ) ) ; } else if ( u_tex_number == 2 ) { Ah = bM * Ai + vec2 ( Af , Ag ) ; Ah [ 0 ] = max ( Ah [ 0 ] , Af + z_ ) ; Ah [ 0 ] = min ( Ah [ 0 ] , 2.0 * Af - z_ ) ; Ah [ 1 ] = min ( Ah [ 1 ] , 1.0 - Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( Ah [ 0 ] , 3.0 * Ag - Ah [ 1 ] ) ) ; } else if ( u_tex_number == 3 ) { Ah = bM * Ai + vec2 ( 0.0 , Ag ) ; Ah [ 0 ] = min ( Ah [ 0 ] , Af - z_ ) ; Ah [ 1 ] = min ( Ah [ 1 ] , 1.0 - Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( Ah [ 0 ] , 3.0 * Ag - Ah [ 1 ] ) ) ; } else if ( u_tex_number == 4 ) { Ah = bM * Ai + vec2 ( Af , 0.0 ) ; Ah [ 0 ] = max ( Ah [ 0 ] , Af + z_ ) ; Ah [ 0 ] = min ( Ah [ 0 ] , 2.0 * Af - z_ ) ; Ah [ 1 ] = min ( Ah [ 1 ] , 0.5 - Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( 1.0 - Ah [ 0 ] , Ah [ 1 ] ) ) ; } else { Ai = bM * Ai + vec2 ( 2.0 * Af , Ag ) ; Ai [ 0 ] = min ( Ai [ 0 ] , 1.0 - z_ ) ; Ai [ 1 ] = max ( Ai [ 1 ] , 0.5 + Ae ) ; gl_FragColor = texture2D ( u_color , vec2 ( 5.0 * Af - Ai [ 0 ] , Ai [ 1 ] ) ) ; }".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 bM ; void main ( ) { bM = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"color_util.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",
name:"SMAA_EDGE_DETECTION",b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2},"SMAA_PREDICATION",{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","Bv",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 Bw ; varying vec4 Bx ; varying vec4 By ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","Bz",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",
b:["1"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",
name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},
{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},
{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 BF ( vec2 BA , sampler2D BB ) { float BC , BD , BE ; BC = texture2D ( BB , BA ) . r ; BD = texture2D ( BB , Bw . xy ) . r ; BE = texture2D ( BB , Bw . zw ) . r ; return vec3 ( BC , BD , BE ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 BK ( vec2 BG , sampler2D BH ) { vec2 BI ; vec3 BJ ; BJ = BF ( BG , BH ) ; BI = abs ( BJ . xx - BJ . yz ) ; BI = step ( SMAA_PREDICATION_THRESHOLD , BI ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * BI ) ; }".split(" ")}]}}]},
{type:"textline",b:"void BO ( bvec2 BL , inout vec2 BM , vec2 BN ) { if ( BL . x ) BM . x = BN . x ; if ( BL . y ) BM . y = BN . y ; } void BO ( bvec4 BP , inout vec4 BQ , vec4 BR ) { BO ( BP . xy , BQ . xy , BR . xy ) ; BO ( BP . zw , BQ . zw , BR . zw ) ; } vec2 BT ( vec2 BS ) { return sign ( BS ) * floor ( abs ( BS ) + .5 ) ; } vec4 BT ( vec4 BU ) { return sign ( BU ) * floor ( abs ( BU ) + .5 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",
d:2}],group:{type:"group",a:[{type:"textline",b:"vec2 Cg ( vec2 BV , sampler2D BW".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","BX"]}]}}]},{type:"textline",b:") { vec4 BY ; float BZ , B_ , Ca , Cb , Cc ; vec3 Cd ; vec2 Ce , Cf ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"Ce = BK ( BV , BX ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"Ce = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"Cd = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; BZ = dot ( texture2D ( BW , BV ) . rgb , Cd ) ; B_ = dot ( texture2D ( BW , Bw . xy ) . rgb , Cd ) ; Ca = dot ( texture2D ( BW , Bw . zw ) . rgb , Cd ) ; BY . xy = abs ( BZ - vec2 ( B_ , Ca ) ) ; Ce = step ( Ce , BY . xy ) ; if ( dot ( Ce , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; Cb = dot ( texture2D ( BW , Bx . xy ) . rgb , Cd ) ; Cc = dot ( texture2D ( BW , Bx . zw ) . rgb , Cd ) ; BY . zw = abs ( BZ - vec2 ( Cb , Cc ) ) ; Cf = max ( BY . xy , BY . zw ) ; Cc = dot ( texture2D ( BW , By . xy ) . rgb , Cd ) ; Cb = dot ( texture2D ( BW , By . zw ) . rgb , Cd ) ; BY . zw = abs ( vec2 ( B_ , Ca ) - vec2 ( Cc , Cb ) ) ; Cf = max ( Cf . xy , BY . zw ) ; Cb = max ( Cf . x , Cf . y ) ; Ce . xy *= step ( Cb , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * BY . xy ) ; return Ce ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"vec2 Ci ( vec2 Ch ) { Ch . r = Ch . r * abs ( 5.0 * Ch . r - 5.0 * 0.75 ) ; return BT ( Ch ) ; } vec4 Ci ( vec4 Cj ) { Cj . rb = Cj . rb * abs ( 5.0 * Cj . rb - 5.0 * 0.75 ) ; return BT ( Cj ) ; } vec2 Cr ( sampler2D Ck , vec2 Cl , vec2 Cm , out vec2 Cn ) { vec3 Co ; vec4 Cp ; Cp = vec4 ( Cl , - 1.0 , 1.0 ) ; Co = vec3 ( u_texel_size , 1.0 ) ; for ( int Cq = 0 ; Cq < SMAA_MAX_SEARCH_STEPS_DIAG ; Cq ++ ) { if ( Cp . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Cp . w > 0.9 ) { Cp . xyz += Co * vec3 ( Cm , 1.0 ) ; Cn = texture2D ( Ck , Cp . xy , 0.0 ) . rg ; Cp . w = dot ( Cn , vec2 ( 0.5 , 0.5 ) ) ; } } return Cp . zw ; } vec2 Cz ( sampler2D Cs , vec2 Ct , vec2 Cu , out vec2 Cv ) { vec3 Cw ; vec4 Cx ; Cx = vec4 ( Ct , - 1.0 , 1.0 ) ; Cx . x += 0.25 * u_texel_size . x ; Cw = vec3 ( u_texel_size , 1.0 ) ; for ( int Cy = 0 ; Cy < SMAA_MAX_SEARCH_STEPS_DIAG ; Cy ++ ) { if ( Cx . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && Cx . w > 0.9 ) { Cx . xyz = Cw * vec3 ( Cu , 1.0 ) + Cx . xyz ; Cv = texture2D ( Cs , Cx . xy , 0.0 ) . rg ; Cv = Ci ( Cv ) ; Cx . w = dot ( Cv , vec2 ( 0.5 , 0.5 ) ) ; } } return Cx . zw ; } vec2 CF ( sampler2D CA , vec2 CB , vec2 CC , float CD ) { vec2 CE ; CE = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * CC + CB ; CE = SMAA_AREATEX_PIXEL_SIZE * CE + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; CE . x += 0.5 ; CE . y += SMAA_AREATEX_SUBTEX_SIZE * CD ; return texture2D ( CA , CE , 0.0 ) . rg ; } vec2 CR ( sampler2D CG , sampler2D CH , vec2 CI , vec2 CJ , vec4 CK ) { vec4 CL , CM , CN ; vec2 CO , CP , CQ ; CO = vec2 ( 0.0 , 0.0 ) ; if ( CJ . r > 0.0 ) { CL . xz = Cr ( CG , CI , vec2 ( - 1.0 , 1.0 ) , CP ) ; CL . x += float ( CP . y > 0.9 ) ; } else CL . xz = vec2 ( 0.0 , 0.0 ) ; CL . yw = Cr ( CG , CI , vec2 ( 1.0 , - 1.0 ) , CP ) ; if ( CL . x + CL . y > 2.0 ) { CM = vec4 ( - CL . x + 0.25 , CL . x , CL . y , - CL . y - 0.25 ) * u_texel_size . xyxy + CI . xyxy ; CN . xy = texture2D ( CG , CM . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; CN . zw = texture2D ( CG , CM . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; CN . yxwz = Ci ( CN . xyzw ) ; CQ = vec2 ( 2.0 , 2.0 ) * CN . xz + CN . yw ; BO ( bvec2 ( step ( 0.9 , CL . zw ) ) , CQ , vec2 ( 0.0 , 0.0 ) ) ; CO += CF ( CH , CL . xy , CQ , CK . z ) ; } CL . xz = Cz ( CG , CI , vec2 ( - 1 , - 1 ) , CP ) ; if ( texture2D ( CG , CI + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { CL . yw = Cz ( CG , CI , vec2 ( 1 , 1 ) , CP ) ; CL . y += float ( CP . y > 0.9 ) ; } else CL . yw = vec2 ( 0.0 , 0.0 ) ; if ( CL . x + CL . y > 2.0 ) { CN = vec4 ( - CL . x , - CL . x , CL . y , CL . y ) * u_texel_size . xyxy + CI . xyxy ; CM . x = texture2D ( CG , CN . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; CM . y = texture2D ( CG , CN . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; CM . zw = texture2D ( CG , CN . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; CP = vec2 ( 2.0 , 2.0 ) * CM . xz + CM . yw ; BO ( bvec2 ( step ( 0.9 , CL . zw ) ) , CP , vec2 ( 0 , 0 ) ) ; CO += CF ( CH , CL . xy , CP , CK . w ) . gr ; } return CO ; }".split(" ")}]}}]},
{type:"textline",b:"float CX ( sampler2D CS , vec2 CT , float CU ) { vec2 CV , CW ; CV = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; CW = SMAA_SEARCHTEX_SIZE * vec2 ( CU , 1.0 ) ; CV += vec2 ( - 1.0 , 1.0 ) ; CW += vec2 ( 0.5 , - 0.5 ) ; CV *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; CW *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( CS , CV * CT + CW , 0.0 ) . r ; } float De ( sampler2D CY , sampler2D CZ , vec2 C_ , float Da ) { float Db ; vec2 Dc ; Dc = vec2 ( 0.0 , 1.0 ) ; for ( int Dd = 0 ; Dd < SMAA_MAX_SEARCH_STEPS ; Dd ++ ) { if ( C_ . x > Da && Dc . g > 0.8281 && Dc . r == 0.0 ) { Dc = texture2D ( CY , C_ , 0.0 ) . rg ; C_ = - vec2 ( 2.0 , 0.0 ) * u_texel_size + C_ ; } } Db = - ( 255.0 / 127.0 ) * CX ( CZ , Dc , 0.0 ) + 3.25 ; return u_texel_size . x * Db + C_ . x ; } float Dm ( sampler2D Df , sampler2D Dg , vec2 Dh , float Di ) { float Dj ; vec2 Dk ; Dk = vec2 ( 0.0 , 1.0 ) ; for ( int Dl = 0 ; Dl < SMAA_MAX_SEARCH_STEPS ; Dl ++ ) { if ( Dh . x < Di && Dk . g > 0.8281 && Dk . r == 0.0 ) { Dk = texture2D ( Df , Dh , 0.0 ) . rg ; Dh = vec2 ( 2.0 , 0.0 ) * u_texel_size + Dh ; } } Dj = - ( 255.0 / 127.0 ) * CX ( Dg , Dk , 0.5 ) + 3.25 ; return - u_texel_size . x * Dj + Dh . x ; } float Du ( sampler2D Dn , sampler2D Do , vec2 Dp , float Dq ) { float Dr ; vec2 Ds ; Ds = vec2 ( 1.0 , 0.0 ) ; for ( int Dt = 0 ; Dt < SMAA_MAX_SEARCH_STEPS ; Dt ++ ) { if ( Dp . y > Dq && Ds . r > 0.8281 && Ds . g == 0.0 ) { Ds = texture2D ( Dn , Dp , 0.0 ) . rg ; Dp = - vec2 ( 0.0 , 2.0 ) * u_texel_size + Dp ; } } Dr = - ( 255.0 / 127.0 ) * CX ( Do , Ds . gr , 0.0 ) + 3.25 ; return u_texel_size . y * Dr + Dp . y ; } float DC ( sampler2D Dv , sampler2D Dw , vec2 Dx , float Dy ) { float Dz ; vec2 DA ; DA = vec2 ( 1.0 , 0.0 ) ; for ( int DB = 0 ; DB < SMAA_MAX_SEARCH_STEPS ; DB ++ ) { if ( Dx . y < Dy && DA . r > 0.8281 && DA . g == 0.0 ) { DA = texture2D ( Dv , Dx , 0.0 ) . rg ; Dx = vec2 ( 0.0 , 2.0 ) * u_texel_size + Dx ; } } Dz = - ( 255.0 / 127.0 ) * CX ( Dw , DA . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * Dz + Dx . y ; } vec2 DJ ( sampler2D DD , vec2 DE , float DF , float DG , float DH ) { vec2 DI ; DI = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * BT ( 4.0 * vec2 ( DF , DG ) ) + DE ; DI = SMAA_AREATEX_PIXEL_SIZE * DI + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; DI . y = SMAA_AREATEX_SUBTEX_SIZE * DH + DI . y ; return texture2D ( DD , DI , 0.0 ) . rg ; } void DQ ( sampler2D DK , inout vec2 DL , vec4 DM , vec2 DN ) { vec2 DO , DP ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"DO = step ( DN . xy , DN . yx ) ; DP = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * DO ; DP /= DO . x + DO . y ; DO = vec2 ( 1.0 , 1.0 ) ; DO . x -= DP . x * texture2D ( DK , DM . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; DO . x -= DP . y * texture2D ( DK , DM . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; DO . y -= DP . x * texture2D ( DK , DM . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; DO . y -= DP . y * texture2D ( DK , DM . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; DL *= clamp ( DO , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void DX ( sampler2D DR , inout vec2 DS , vec4 DT , vec2 DU ) { vec2 DV , DW ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"DV = step ( DU . xy , DU . yx ) ; DW = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * DV ; DW /= DV . x + DV . y ; DV = vec2 ( 1.0 , 1.0 ) ; DV . x -= DW . x * texture2D ( DR , DT . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; DV . x -= DW . y * texture2D ( DR , DT . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; DV . y -= DW . x * texture2D ( DR , DT . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; DV . y -= DW . y * texture2D ( DR , DT . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; DS *= clamp ( DV , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Ek ( vec2 DY , vec2 DZ , sampler2D D_ , sampler2D Ea , sampler2D Eb , vec4 Ec ) { float Ed , Ee ; vec3 Ef ; vec2 Eg , Eh , Ei ; vec4 Ej ; Ej = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; Eg = texture2D ( D_ , DY ) . rg ; if ( Eg . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",
d:1}],group:{type:"group",a:[{type:"textline",b:"Ej . rg = CR ( D_ , Ea , DY , Eg , Ec ) ; if ( Ej . r == - Ej . g ) {".split(" ")}]}}]},{type:"textline",b:"; Ef . x = De ( D_ , Eb , Bw . xy , By . x ) ; Ef . y = Bx . y ; Eh . x = Ef . x ; Ed = texture2D ( D_ , Ef . xy , 0.0 ) . r ; Ef . z = Dm ( D_ , Eb , Bw . zw , By . y ) ; Eh . y = Ef . z ; Eh = abs ( BT ( Eh / u_texel_size . xx - DZ . xx ) ) ; Ei = sqrt ( Eh ) ; Ee = texture2D ( D_ , Ef . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; Ej . rg = DJ ( Ea , Ei , Ed , Ee , Ec . y ) ; Ef . y = DY . y ; DQ ( D_ , Ej . rg , Ef . xyzy , Eh ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"} else Eg . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( Eg . r > 0.0 ) { ; Ef . y = Du ( D_ , Eb , Bx . xy , By . z ) ; Ef . x = Bw . x ; Eg . x = Ef . y ; Ee = texture2D ( D_ , Ef . xy , 0.0 ) . g ; Ef . z = DC ( D_ , Eb , Bx . zw , By . w ) ; Eg . y = Ef . z ; Eg = abs ( BT ( Eg / u_texel_size . yy - DZ . yy ) ) ; Eh = sqrt ( Eg ) ; Ed = texture2D ( D_ , Ef . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; Ej . ba = DJ ( Ea , Eh , Ee , Ed , Ec . x ) ; Ef . x = DY . x ; DX ( D_ , Ej . ba , Ef . xyxz , Eg ) ; } return Ej ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Ew ( vec2 El , sampler2D Em , sampler2D En".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","Eo"]}]}}]},{type:"textline",b:") { bool Ep ; vec2 Eq , Er , Es ; vec4 Et , Eu , Ev ; Et . x = texture2D ( En , Bv . xy ) . a ; Et . y = texture2D ( En , Bv . zw ) . g ; Et . wz = texture2D ( En , El ) . xz ; if ( dot ( Et , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { Eu = texture2D ( Em , El , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"Ev = texture2D ( Eo , bM ) ; Eq = 2.0 * ag ( Ev ) - 1.0 ; Eu . a = sqrt ( 2.0 * length ( Eq ) ) ;".split(" ")}]}}]},{type:"textline",b:"return Eu ; } else { Ep = max ( Et . x , Et . z ) > max ( Et . y , Et . w ) ; Eu = vec4 ( 0.0 , Et . y , 0.0 , Et . w ) ; Eq = Et . yw ; BO ( bvec4 ( Ep , Ep , Ep , Ep ) , Eu , vec4 ( Et . x , 0.0 , Et . z , 0.0 ) ) ; BO ( bvec2 ( Ep , Ep ) , Eq , Et . xz ) ; Eq /= dot ( Eq , vec2 ( 1.0 , 1.0 ) ) ; Eu = Eu * vec4 ( u_texel_size , - u_texel_size ) + El . xyxy ; Et = Eq . x * texture2D ( Em , Eu . xy , 0.0 ) ; Et += Eq . y * texture2D ( Em , Eu . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"Ev = texture2D ( Eo , Eu . xy ) ; Er = 2.0 * ag ( Ev ) - 1.0 ; Es = Eq . x * Er ; Ev = texture2D ( Eo , Eu . zw ) ; Er = 2.0 * ag ( Ev ) - 1.0 ; Es += Eq . y * Er ; Et . a = sqrt ( 2.0 * length ( Es ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","Et",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"vec4 EG ( vec2 Ex , sampler2D Ey , sampler2D Ez".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","EA"]}]}}]},{type:"textline",b:") { float EB ; vec2 EC ; vec4 ED , EE , EF ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"ED = texture2D ( EA , bM ) ; EC = 2.0 * ag ( ED ) - 1.0 ; ED = texture2D ( Ey , Ex ) ; EE = texture2D ( Ez , Ex - EC ) ; EB = abs ( ED . a * ED . a - EE . a * EE . a ) / 2.0 ; EB = 0.5 * clamp ( 1.0 - sqrt ( EB ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; EF = mix ( ED , EE , EB ) ; EF . a = 1.0 ; return EF ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ED = texture2D ( Ey , Ex ) ; EE = texture2D ( Ez , Ex ) ; return mix ( ED , EE , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"void main ( ) { vec4 EH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EH = vec4 ( Cg ( bM , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",
a:[{type:"textline",b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EH = Ek ( bM , Bz , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EH = Ew ( bM , u_color , u_blend".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"EH = vec4 ( EG ( bM , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"EH = texture2D ( u_color , bM ) ;".split(" ")}]}}]},{type:"textline",b:["gl_FragColor","=","EH",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",
b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec4","Bv",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 Bw ; varying vec4 Bx ; varying vec4 By ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec2","Bz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD",
"AA_METHOD_SMAA_HIGH",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void Ae ( vec2 z_ ) { Bw = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + z_ . xyxy ; Bx = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + z_ . xyxy ; By = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + z_ . xyxy ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void Ah ( vec2 Af , out vec2 Ag ) { Ag = Af / u_texel_size ; Bw = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + Af . xyxy ; Bx = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + Af . xyxy ; By = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( Bw . xz , Bx . yw ) ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void Aj ( vec2 Ai ) { Bv = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Ai . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { bM = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["Ae","(","bM",")",";"]}]}},{type:"elif",c:["SMAA_PASS",
"SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"Ah ( bM , Bz ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["Aj","(","bM",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",
b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 bM ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float Ae ( in vec2 z_ ) { return Bq ( u_depth , z_ , u_camera_range ) ; } void main ( ) { vec3 Af , Ag , Ah ; float Ai , Aj , Ak , Al , Am , An , Ao ; Ai = texture2D ( u_color , bM ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( Ai , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"Af = normalize ( 2.0 * texture2D ( u_ssao_special_tex , bM * 0.25 / u_texel_size ) . rgb - 1.0 ) ; Aj = Ae ( bM ) ; Ak = Aj * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",
b:"const float Ap = 8.0 ; const int Aq = 1 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float Ap = 16.0 ; const int Aq = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float Ap = 24.0 ; const int Aq = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",d:2}],group:{type:"group",
a:[{type:"textline",b:"const float Ap = 32.0 ; const int Aq = 4 ;".split(" ")}]}}]},{type:"textline",b:"Al = u_ssao_radius_increase * 0.001 ; const float Ar = 1.0 + 2.4 / Ap ; Am = 0.0 ; for ( int As = 0 ; As < Aq ; As ++ ) for ( int At = - 1 ; At <= 1 ; At += 2 ) for ( int BA = - 1 ; BA <= 1 ; BA += 2 ) for ( int BB = - 1 ; BB <= 1 ; BB += 2 ) { Ag = reflect ( normalize ( vec3 ( At , BA , BB ) ) , Af ) * ( Al *= Ar ) ; Ah = vec3 ( bM , Ak ) ; Ah += vec3 ( Ag . xy , Ag . z * Ak * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"Ah . z -= 1.4 * ( Ah . z - Ak ) * step ( Ak , Ah . z ) ;".split(" ")}]}}]},{type:"textline",b:"An = Ae ( Ah . xy ) * ( u_camera_range . y - u_camera_range . x ) ; Ao = clamp ( ( Ak - An ) / An , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"Am += mix ( 1.0 , Ao , step ( An , Ah . z ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"Am += mix ( step ( Ah . z , An ) , 0.5 , Ao ) ;".split(" ")}]}}]},{type:"textline",b:"} Am = Am / Ap ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"Am = clamp ( Am * Am + 0.6 * Am , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Am = clamp ( Am * Am + Am , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"Aj = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * Aj ) ; Am = mix ( 1.0 , Am , Aj ) ; gl_FragColor = vec4 ( Ai , Am , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 bM ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float Ae ( in vec2 z_ ) { return Bq ( u_depth , z_ , u_camera_range ) ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec2 Af , Ag ; float Ah , Ai , Aj , Ak , Al , Am , An ; Ah = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"Ai = Ae ( bM ) ; Aj = 0.0 ; Ak = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},
{type:"textline",b:"Af = vec2 ( - 2.0 ) ; for ( int Ao = 0 ; Ao < 4 ; ++ Ao ) { for ( int Ap = 0 ; Ap < 4 ; ++ Ap ) { Ag = ( Af + vec2 ( float ( Ao ) , float ( Ap ) ) ) * u_texel_size ; Al = texture2D ( u_ssao_mask , bM + Ag ) . g ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"Am = Ae ( bM + Ag ) ; An = 1.0 - clamp ( abs ( Am - Ai ) * Ak , 0.0 , 1.0 ) ; Ah += Al * An ; Aj += An ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["Ah","+=","Al",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . r , Ah / Aj , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , bM ) . r , Ah / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",
file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 bM ; void main ( ) { vec2 z_ ; vec4 Ae , Af ; float Ag ; Ag = texture2D ( u_depth , bM ) . x ; Ae = vec4 ( bM * 2.0 - 1.0 , 2.0 * Ag - 1.0 , 1.0 ) ; Af = u_view_proj_inverse * Ae ; Af = Af / Af . w ; Af = u_view_proj_prev * Af ; Af /= Af . w ; z_ = ( Ae . xy - Af . xy ) / 4.0 + 0.5 ; z_ = clamp ( z_ , 0.0 , 1.0 ) ; gl_FragColor = V ( z_ ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float a = 0.0 ; float b = 1.0 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( vec3 d , vec3 e ) { return any ( lessThan ( abs ( d - e ) , vec3 ( EPSILON ) ) ) ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } vec4 k ( in vec4 j ) { return vec4 ( - j . xyz , j . w ) / dot ( j , j ) ; } vec3 p ( vec4 l , vec4 m , vec4 n ) { vec3 o ; o = n . xyz * l . w ; o = i ( m , o ) ; o += l . xyz * n . w ; return o ; } vec3 v ( vec4 q , vec4 r , vec4 s ) { vec4 t ; vec3 u ; u = s . xyz - q . xyz * s . w ; t = k ( r ) ; u = i ( t , u ) ; u /= q . w ; return u ; } mat4 w ( ) { return mat4 ( b , a , a , a , a , b , a , a , a , a , b , a , a , a , a , b ) ; } mat4 y ( float x ) { return mat4 ( b , a , a , a , a , cos ( x ) , sin ( x ) , a , a , - sin ( x ) , cos ( x ) , a , a , a , a , b ) ; } mat4 A ( float z ) { return mat4 ( cos ( z ) , a , - sin ( z ) , a , a , b , a , a , sin ( z ) , a , cos ( z ) , a , a , a , a , b ) ; } mat4 C ( float B ) { return mat4 ( cos ( B ) , sin ( B ) , a , a , - sin ( B ) , cos ( B ) , a , a , a , a , b , a , a , a , a , b ) ; } c E ( in c D ) { return c ( D . a , D . b , normalize ( D . c ) , normalize ( D . d ) , normalize ( D . e ) , D . f ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",d:4}],group:{type:"group",a:[{type:"textline",b:"vec3 L ( vec4 F ) { vec3 G ; float H , I , J ; H = F . x ; I = F . y ; J = F . w ; G . x = ( H + J ) / 2.0 ; G . y = ( I + J ) / 2.0 ; G . z = J ; return G ; }".split(" ")}]}}]},{type:"textline",b:"mat4 O ( mat3 M ) { mat4 N ; N [ 0 ] [ 0 ] = ( b - ( M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 1 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) + M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 2 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 0 ] [ 3 ] = a ; N [ 1 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) - M [ 2 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 1 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 2 ] [ 0 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 2 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 1 ] [ 3 ] = a ; N [ 2 ] [ 0 ] = ( M [ 1 ] [ 1 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) + M [ 2 ] [ 1 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 1 ] = ( M [ 1 ] [ 2 ] * ( M [ 2 ] [ 0 ] + M [ 2 ] [ 0 ] ) - M [ 2 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 2 ] = ( b - ( M [ 1 ] [ 1 ] * ( M [ 1 ] [ 1 ] + M [ 1 ] [ 1 ] ) + M [ 1 ] [ 2 ] * ( M [ 1 ] [ 2 ] + M [ 1 ] [ 2 ] ) ) ) * M [ 1 ] [ 0 ] ; N [ 2 ] [ 3 ] = a ; N [ 3 ] [ 0 ] = M [ 0 ] [ 0 ] ; N [ 3 ] [ 1 ] = M [ 0 ] [ 1 ] ; N [ 3 ] [ 2 ] = M [ 0 ] [ 2 ] ; N [ 3 ] [ 3 ] = b ; return N ; }".split(" ")}]};
a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},
{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"NO_SHADOWS",b:["1"]},{type:"define",name:"SHADOW_CASTING",b:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",b:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",b:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",b:["5"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"SPECULAR_BLINN",b:["4"]},{type:"define",name:"SPECULAR_TOON",
b:["5"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",b:["4"]},{type:"define",name:"DIFFUSE_TOON",b:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]},{type:"define",name:"MIX",b:["0"]},{type:"define",
name:"ADD",b:["1"]},{type:"define",name:"SUBTRACT",b:["2"]},{type:"define",name:"MULTIPLY",b:["3"]},{type:"define",name:"SCREEN",b:["4"]},{type:"define",name:"OVERLAY",b:["5"]},{type:"define",name:"DIFFERENCE",b:["6"]},{type:"define",name:"DIVIDE",b:["7"]},{type:"define",name:"DARKEN",b:["8"]},{type:"define",name:"LIGHTEN",b:["9"]},{type:"define",name:"HUE",b:["10"]},{type:"define",name:"SATURATION",b:["11"]},{type:"define",name:"VALUE",b:["12"]},{type:"define",name:"COLOR",b:["13"]},{type:"define",
name:"SOFT_LIGHT",b:["14"]},{type:"define",name:"LINEAR_LIGHT",b:["15"]},{type:"define",name:"REFL_NONE",b:["0"]},{type:"define",name:"REFL_MIRRORMAP",b:["1"]},{type:"define",name:"REFL_PLANE",b:["2"]},{type:"define",name:"REFL_CUBE",b:["3"]},{type:"define",name:"INVERSE_QUADRATIC",b:["0"]},{type:"define",name:"LINEAR",b:["1"]},{type:"define",name:"QUADRATIC",b:["2"]},{type:"define",name:"HEMI",b:["1"]},{type:"define",name:"SPOT",b:["2"]},{type:"define",name:"POINT",b:["3"]},{type:"define",name:"SUN",
b:["4"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float P = 255.0 ; float Q = 0.0 ; float R = 1.0 ; vec4 V ( const in float S ) { vec4 T , U ; T = vec4 ( P * P * P , P * P , P , R ) ; U = vec4 ( Q , R / P , R / P , R / P ) ; T = fract ( S * T ) ; T -= T . xxyz * U ; return T ; } float Z ( const in vec4 W ) { vec4 X ; float Y ; X = vec4 ( R / ( P * P * P ) , R / ( P * P ) , R / P , R ) ; Y = dot ( W , X ) ; return Y ; } vec4 V ( const in vec2 _ ) { vec4 aa ; vec2 ab , ac ; ab = vec2 ( P , R ) ; ac = vec2 ( Q , R / P ) ; aa = fract ( _ . xxyy * ab . xyxy ) ; aa -= aa . xxzz * ac . xyxy ; if ( _ . r == R ) aa . rg = vec2 ( Q , R ) ; if ( _ . g == R ) aa . ba = vec2 ( Q , R ) ; return aa ; } vec2 ag ( const in vec4 ad ) { vec2 ae , af ; af = vec2 ( R / P , R ) ; ae . r = dot ( ad . rg , af ) ; ae . g = dot ( ad . ba , af ) ; return ae ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float ah = 0.0 ; float ai = 1.0 ; vec4 ak ( vec4 aj ) { return aj - floor ( aj * ( ai / 289.0 ) ) * 289.0 ; } vec3 ak ( vec3 al ) { return al - floor ( al * ( ai / 289.0 ) ) * 289.0 ; } vec2 ak ( vec2 am ) { return am - floor ( am * ( ai / 289.0 ) ) * 289.0 ; } vec4 ao ( vec4 an ) { return an - floor ( an * ( ai / 7.0 ) ) * 7.0 ; } vec4 aq ( vec4 ap ) { return ak ( ( 34.0 * ap + 5.0 ) * ap ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 ay ( vec2 ar ) { vec4 as , at , au , av ; vec2 aw , ax ; aw = ak ( floor ( ar ) ) ; ax = fract ( ar ) ; as = ax . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; at = ax . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; au = aq ( aw . x + vec4 ( ah , ai , ah , ai ) ) ; au = aq ( au + aw . y + vec4 ( ah , ah , ai , ai ) ) ; av = ao ( au ) * K + K2 ; au = ao ( floor ( au * K ) ) * K + K2 ; av = as + JITTER * av ; au = at + JITTER * au ; au = av * av + au * au ;".split(" ")},
{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"textline",b:"au . xy = min ( au . xy , au . zw ) ; au . x = min ( au . x , au . y ) ; return au . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"au . xy = ( au . x < au . y ) ? au . xy : au . yx ; au . xz = ( au . x < au . z ) ? au . xz : au . zx ; au . xw = ( au . x < au . w ) ? au . xw : au . wx ; au . y = min ( au . y , au . z ) ; au . y = min ( au . y , au . w ) ; return sqrt ( au . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aH ( vec2 az , float aA ) { vec4 aB , aC , aD , aE ; vec2 aF , aG ; aF = ak ( floor ( az ) ) ; aG = fract ( az ) ; aB = aG . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; aC = aG . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; aD = aq ( aF . x + vec4 ( ah , ai , ah , ai ) ) ; aD = aq ( aD + aF . y + vec4 ( ah , ah , ai , ai ) ) ; aE = ao ( aD ) * K + K2 ; aD = ao ( floor ( aD * K ) ) * K + K2 ; aE = aB + JITTER * aE ; aD = aC + JITTER * aD ; aC = aE * aE + aD * aD ; aE += aA ; aD += aA ; aB = aE * aE + aD * aD ; aE += aA ; aD += aA ; aD = aE * aE + aD * aD ; aC . xy = min ( aC . xy , aC . zw ) ; aC . x = min ( aC . x , aC . y ) ; aB . xy = min ( aB . xy , aB . zw ) ; aB . x = min ( aB . x , aB . y ) ; aD . xy = min ( aD . xy , aD . zw ) ; aD . x = min ( aD . x , aD . y ) ; return vec3 ( aC . x , aB . x , aD . x ) ; } vec3 aJ ( vec3 aI ) { return ak ( ( ( aI * 34.0 ) + ai ) * aI ) ; } float aU ( vec2 aK ) { vec3 aL , aM , aN , aO ; vec4 aP ; vec2 aQ , aR , aS ; const vec4 aT = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; aQ = floor ( aK + dot ( aK , aT . yy ) ) ; aR = aK - aQ + dot ( aQ , aT . xx ) ; aS = ( aR . x > aR . y ) ? vec2 ( ai , ah ) : vec2 ( ah , ai ) ; aP = aR . xyxy + aT . xxzz ; aP . xy -= aS ; aQ = ak ( aQ ) ; aL = aJ ( aJ ( aQ . y + vec3 ( ah , aS . y , ai ) ) + aQ . x + vec3 ( ah , aS . x , ai ) ) ; aM = max ( 0.5 - vec3 ( dot ( aR , aR ) , dot ( aP . xy , aP . xy ) , dot ( aP . zw , aP . zw ) ) , ah ) ; aM = aM * aM ; aM = aM * aM ; aL = 2.0 * fract ( aL * aT . www ) - ai ; aN = abs ( aL ) - 0.5 ; aO = floor ( aL + 0.5 ) ; aO = aL - aO ; aM *= 1.79284291400159 - 0.85373472095314 * ( aO * aO + aN * aN ) ; aL . x = aO . x * aR . x + aN . x * aR . y ; aL . yz = aO . yz * aP . xz + aN . yz * aP . yw ; return 130.0 * dot ( aM , aL ) ; } vec2 aY ( vec2 aV ) { float aW , aX ; aW = dot ( aV , vec2 ( 12.9898 , 78.233 ) ) ; aX = dot ( aV , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; aW = fract ( sin ( aW ) * 43758.5453 ) * 2.0 - ai ; aX = fract ( sin ( aX ) * 43758.5453 ) * 2.0 - ai ; return vec2 ( aW , aX ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void bp ( inout vec3 aZ , float a_ , float ba , float bb , vec3 bc , vec3 bd , vec3 be , vec4 bf , vec3 bg , float bh ) { float bi , bj , bk ; vec2 bl , bm ; vec3 bn ; vec4 bo ; if ( bh > CAUSTICS_VIEW_DISTANCE ) return ; bo = bf ; bn = bg + bc ; bn . xz = 10.0 * sin ( 0.1 * bn . xz ) ; bn = bn + 2.0 * cross ( - bo . xyz , cross ( - bo . xyz , bn ) + bo . w * bn ) ; bl = bn . xz ; bn = bd ; bi = max ( dot ( bc , bn ) , 0.0 ) ; bj = 0.025 ; bm = CAUST_SPEED * ba ; bl . s += 0.25 * sin ( dot ( bg + ba , vec3 ( 1.0 ) ) ) ; bl . t += 0.35 * ( - sin ( dot ( bg - ba , vec3 ( - 0.7 ) ) ) ) ; bl . st += 0.15 * cos ( 4.0 * a_ - bm . x ) + 1.5 * sin ( a_ - 0.3 * bm . y ) ; bk = CAUST_SCALE * ( 1.0 + max ( 0.1 * a_ , 0.0 ) ) ; bn = aH ( ( bl / bk ) , bj ) ; bn *= CAUST_BRIGHT ; bn *= bn ; bj = min ( 0.25 * a_ , - a_ ) + 1.0 ; bj = max ( bj , 0.0 ) ; bi = bb * bi ; bk = max ( sign ( a_ ) , 0.0 ) ; bi = bi + max ( 0.5 * sign ( - bc . y ) * bk , 0.0 ) ; bi = min ( bi , 1.0 ) ; aZ += be * bn * bj * bi ; }".split(" ")}]};
a["include/color_util.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void br ( inout vec3 bq ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"bq = max ( vec3 ( 0.0 ) , bq ) ; bq = pow ( bq , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void br ( inout float bs ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"bs = pow ( max ( 0.0 , bs ) , 2.2 ) ;".split(" ")}]}}]},{type:"textline",b:"} void bu ( inout vec3 bt ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"bt = max ( vec3 ( 0.0 ) , bt ) ; bt = pow ( bt , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void bx ( inout vec3 bv , in float bw ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"bv = bv * bw ;".split(" ")}]}}]},
{type:"textline",b:"} float bB ( vec4 by ) { float bz ; vec3 bA ; bA = vec3 ( 0.299 , 0.587 , 0.114 ) ; bz = dot ( by . rgb , bA ) ; return bz ; }".split(" ")}]};a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",
{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["vec4","bN",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"const float bO = 0.1 ; const float bP = 0.1 ; const float bQ = - 0.01 ; const float bR = 0.05 ; vec4 bS = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 bT = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 bU = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 bV = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 bW = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 bX = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 bY = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 bZ = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool cb ( vec2 b_ , float ca ) { return all ( lessThanEqual ( b_ , vec2 ( 1.0 + ca ) ) ) && all ( greaterThanEqual ( b_ , vec2 ( 0.0 - ca ) ) ) ; } float ck ( float cc , float cd , mat2 ce , vec3 cf , float cg , PRECISION sampler2D ch ) { vec2 ci , cj ; cj . x = cc ; cj . y = cd ; cj = ce * cj ; ci = cf . xy + cj * cg / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"if ( ! cb ( ci , bQ ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",b:"return step ( cf . z , texture2D ( ch , ci ) . r ) ; } float ct ( vec3 cl , PRECISION sampler2D cm , float cn ) { mat2 co ; float cp , cq , cr ;".split(" ")},{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:"if ( cl . z > u_perspective_cast_far_bound ) return 1.0 ; else {".split(" ")}]}}]},
{type:"textline",b:"cl . z = clamp ( cl . z , 0.0 , 1.0 ) ; cp = 0.0 ; cq = aY ( cl . xy ) . x * M_PI ; cr = cos ( cq ) ; cq = sin ( cq ) ; co = mat2 ( cr , cq , - cq , cr ) ; for ( int cs = 0 ; cs < 4 ; cs ++ ) { cp += ck ( bS [ cs ] , bW [ cs ] , co , cl , cn , cm ) ; cp += ck ( bT [ cs ] , bX [ cs ] , co , cl , cn , cm ) ; cp += ck ( bU [ cs ] , bY [ cs ] , co , cl , cn , cm ) ; cp += ck ( bV [ cs ] , bZ [ cs ] , co , cl , cn , cm ) ; } cp /= 16.0 ; return clamp ( cp , 0.0 , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",a:[{type:"textline",b:["}"]}]}}]},{type:"textline",b:"return 1.0 ; } float cI ( vec3 cu , PRECISION sampler2D cv , vec3 cw , PRECISION sampler2D cx , float cy , float cz , float cA ) { mat2 cB ; float cC , cD , cE , cF ; cu . z = clamp ( cu . z , 0.0 , 1.0 ) ; cw . z = clamp ( cw . z , 0.0 , 1.0 ) ; cC = 0.0 ; cD = 0.0 ; cE = aY ( cu . xy ) . x * M_PI ; cF = cos ( cE ) ; cE = sin ( cE ) ; cB = mat2 ( cF , cE , - cE , cF ) ; for ( int cG = 0 ; cG < 4 ; cG ++ ) { cC += ck ( bS [ cG ] , bW [ cG ] , cB , cu , cy , cv ) ; cC += ck ( bT [ cG ] , bX [ cG ] , cB , cu , cy , cv ) ; cC += ck ( bU [ cG ] , bY [ cG ] , cB , cu , cy , cv ) ; cC += ck ( bV [ cG ] , bZ [ cG ] , cB , cu , cy , cv ) ; } for ( int cH = 0 ; cH < 4 ; cH ++ ) { cD += ck ( bS [ cH ] , bW [ cH ] , cB , cw , cz , cx ) ; cD += ck ( bT [ cH ] , bX [ cH ] , cB , cw , cz , cx ) ; cD += ck ( bU [ cH ] , bY [ cH ] , cB , cw , cz , cx ) ; cD += ck ( bV [ cH ] , bZ [ cH ] , cB , cw , cz , cx ) ; } cC = mix ( cC , cD , cA ) ; cC /= 16.0 ; return clamp ( cC , 0.0 , 1.0 ) ; } float cM ( vec2 cJ ) { float cK , cL ; cK = min ( cJ . x , cJ . y ) ; cL = min ( 1.0 - cJ . x , 1.0 - cJ . y ) ; return min ( cK , cL ) ; } float cP ( float cN , float cO ) { if ( cO >= 0.0 && cO <= bP ) cN = ( cN - 1.0 ) / bP * cO + 1.0 ; return cN ; } float c_ ( vec3 cQ , vec3 cR , PRECISION sampler2D cS , PRECISION sampler2D cT , float cU , float cV , float cW , float cX ) { float cY , cZ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"cZ = cM ( cQ . xy ) ; if ( - cX > cW && cZ >= 0.0 && cZ <= bO && cb ( cR . xy , 0.0 ) ) { cZ = 1.0 - cZ / bO ; cY = cI ( cQ , cS , cR , cT , cU , cV , cZ ) ; } else".split(" ")}]}}]},{type:"textline",b:"cY = ct ( cQ , cS , cU ) ; return cY ; } float dh ( vec3 da , PRECISION sampler2D db , float dc , float dd , float de ) { float df , dg ; df = ct ( da , db , dc ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - de > dd ) { dg = cM ( da . xy ) ; df = cP ( df , dg ) ; }".split(" ")}]}}]},{type:"textline",b:"return df ; } float dp ( float di ) { vec3 dj , dk , dl , dm ; float dn ; dn = 1.0 ; dj = bI . xyz / bI . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"dk = bJ . xyz / bJ . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:"dl = bK . xyz / bK . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"dm = bL . xyz / bL . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( cb ( dj . xy , 0.0 ) ) { dn = c_ ( dj , dk , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , di ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( cb ( dj . xy , bR ) ) { dn = dh ( dj , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , di ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( cb ( dk . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"dn = c_ ( dk , dl , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , di ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"dn = dh ( dk , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , di ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( cb ( dl . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"dn = c_ ( dl , dm , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , di ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"dn = dh ( dl , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , di ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( cb ( dm . xy , 0.0 ) ) dn = dh ( dm , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , di ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","dn",";","}"]}]}}]},{type:"textline",b:"float du ( inout vec3 dq ) { float dr ; vec3 ds ; vec2 dt ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dt = texture2DProj ( u_shadow_mask , bG ) . rg ; ds = vec3 ( dt . r ) ; dr = dt . g ; bN = vec4 ( ds , dr ) ; dq *= bN . a ; return bN . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},
"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return dp ( bD . z ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2},"REFLECTION_TYPE","REFL_MIRRORMAP",
{type:"equal_expr",d:2},{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float dB ( in vec3 dv , vec3 dw , float dx , float dy ) { float dz ; vec3 dA ; dA = normalize ( dw + dv ) ; dz = 1.0 - dot ( dv , dA ) ; dz = dy + ( 1.0 - dy ) * pow ( dz , dx ) ; return dz ; } void dP ( inout vec3 dC , vec3 dD , vec3 dE , float dF , mat4 dG ) { vec2 dH , dI ; float dJ , dK , dL ; vec3 dM , dN , dO ; dM = reflect ( - dD , dE ) ; dJ = u_fresnel_params [ 2 ] ; dK = u_fresnel_params [ 3 ] ; dL = 1.0 ; if ( dJ != 0.0 ) dL = dB ( dD , dM , dJ , dK ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dN = textureCube ( u_cube_reflection , dM ) . xyz ;".split(" ")}]}},{type:"elif",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dO = u_refl_plane . xyz * dot ( dE , u_refl_plane . xyz ) ; dO = dE - dO ; dH = ( dG * vec4 ( dO , 0.0 ) ) . xy ; dI = bG . xy / bG . z ; dI += dH * REFL_BUMP ; dN = texture2D ( u_plane_reflection , dI ) . rgb ;".split(" ")}]}},
{type:"elif",c:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"dN = textureCube ( u_mirrormap , dM ) . xyz ; dF = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",b:"br ( dN . rgb ) ; dC = mix ( dC , dN , dF * dL ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",a:[{type:"textline",b:"vec3 dS ( vec3 dQ ) { float dR ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_ENVIRONMENT_LIGHT"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , dQ ) . rgb ;".split(" ")}]}},{type:"elif",c:["SKY_COLOR"],group:{type:"group",a:[{type:"textline",b:"dR = 0.5 * dQ . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , dR ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"float dY ( in float dT , inout vec2 dU , in vec2 dV ) { float dW ; vec4 dX ; dX = texture2D ( u_scene_depth , dU ) ; dW = Z ( dX ) ; if ( dW < bH ) { dU = dV ; return dT ; } else { return dW ; } return dT ; }".split(" ")}]}}]},{type:"textline",b:"vec3 ef ( in vec3 dZ , in vec2 d_ ) { vec3 ea ; float eb ; vec4 ec ; vec2 ed , ee ; ed = dZ . xy / dZ . z ; ee = ed + d_ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_REFRACTION_CORRECTION"],group:{type:"group",a:[{type:"textline",b:"ec = texture2DProj ( u_scene_depth , dZ ) ; eb = Z ( ec ) ; dY ( eb , ee , ed ) ;".split(" ")}]}}]},{type:"textline",b:"ea = texture2D ( u_refractmap , ee ) . rgb ; br ( ea ) ; return ea ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]={type:"group",a:[{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",
b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"var",name:"LAMP_INDEX",b:["0"]},{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",
b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["varying","vec3","eg",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float eh = 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"vec3 el ( in vec3 ei , in float ej ) { vec3 ek ; ek = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"ek = ef ( bG , ei . xz * ej ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ek = texture2D ( u_refractmap , bG . xy / bG . z ) . rgb ; br ( ek ) ;".split(" ")}]}}]},{type:"textline",
b:["return","ek",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 eq ( vec3 em ) { float en , eo ; vec4 ep ; ep = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; ep = mix ( vec4 ( em . bg , ep . wz ) , vec4 ( em . gb , ep . xy ) , step ( em . b , em . g ) ) ; ep = mix ( vec4 ( ep . xyw , em . r ) , vec4 ( em . r , ep . yzx ) , step ( ep . x , em . r ) ) ; en = ep . x - min ( ep . w , ep . y ) ; eo = 1.0e-10 ; return vec3 ( abs ( ep . z + ( ep . w - ep . y ) / ( 6.0 * en + eo ) ) , en / ( ep . x + eo ) , ep . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",d:6}],group:{type:"group",a:[{type:"textline",b:"vec3 eu ( vec3 er ) { vec3 es ; vec4 et ; et = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; es = abs ( fract ( vec3 ( er . r , er . r , er . r ) + et . xyz ) * 6.0 - et . www ) ; return er . b * mix ( et . xxx , clamp ( es - et . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , er . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec3 ew ( vec2 ev ) { return vec3 ( ev * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",d:3}],group:{type:"group",a:[{type:"textline",b:"vec2 ey ( vec3 ex ) { return vec2 ( ex . xy * eh + vec2 ( eh , eh ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",i:[{type:"node_out",name:"fm",qualifier:["vec3"],e:!0},{type:"node_out",name:"fn",qualifier:["float"],e:!0},{type:"node_out",name:"fo",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fm"],g:[{type:"textline",b:"fm = normalize ( fd . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fn"],g:[{type:"textline",b:"fn = abs ( fd . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_fo"],
g:[{type:"textline",b:"fo = length ( fd . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",i:[{type:"node_in",name:"fp",qualifier:["float"],e:!1},{type:"node_in",name:"fq",qualifier:["float"],e:!1},{type:"node_in",name:"fr",qualifier:["float"],e:!1},{type:"node_out",name:"fs",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fs = vec3 ( fp , fq , fr ) ;".split(" ")}]},{type:"node",name:"COMBHSV",i:[{type:"node_in",name:"ft",qualifier:["float"],e:!1},{type:"node_in",name:"fu",qualifier:["float"],
e:!1},{type:"node_in",name:"fv",qualifier:["float"],e:!1},{type:"node_out",name:"fw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fw = eu ( vec3 ( ft , fu , fv ) ) ;".split(" ")}]},{type:"node",name:"EMPTY_UV",i:[{type:"node_out",name:"fx",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fx = vec3 ( - UNITY_VALUE_NODES , - UNITY_VALUE_NODES , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"EMPTY_VC",i:[{type:"node_out",name:"fy",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fy = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_UV",i:[{type:"node_out",name:"fz",qualifier:["vec3"],e:!1},{type:"node_param",name:"ez",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"fz = ew ( ez ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",i:[{type:"node_out",name:"fA",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fA = 2.0 * eg - vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",i:[{type:"node_out",name:"fB",qualifier:["vec3"],e:!1},{type:"node_param",name:"eA",qualifier:["varying",
"vec3"]}],g:[{type:"textline",b:"fB = eA ; br ( fB ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC1",i:[{type:"node_out",name:"fC",qualifier:["float"],e:!1},{type:"node_param",name:"eB",qualifier:["varying","float"]}],g:[{type:"textline",b:"fC = eB ; br ( fC ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC2",i:[{type:"node_out",name:"fD",qualifier:["float"],e:!1},{type:"node_out",name:"fE",qualifier:["float"],e:!1},{type:"node_param",name:"eC",qualifier:["varying","vec2"]}],g:[{type:"textline",
b:"fD = eC [ 0 ] ; fE = eC [ 1 ] ; br ( fD ) ; br ( fE ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",i:[{type:"node_out",name:"fF",qualifier:["float"],e:!1},{type:"node_out",name:"fG",qualifier:["float"],e:!1},{type:"node_out",name:"fH",qualifier:["float"],e:!1},{type:"node_param",name:"eD",qualifier:["varying","vec3"]}],g:[{type:"textline",b:"fF = eD [ 0 ] ; fG = eD [ 1 ] ; fH = eD [ 2 ] ; br ( fF ) ; br ( fG ) ; br ( fH ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",i:[{type:"node_out",
name:"fI",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["fI","=","fg",";"]}]},{type:"node",name:"GEOMETRY_FB",i:[{type:"node_out",name:"fJ",qualifier:["float"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["INVERT_FRONTFACING"],g:[{type:"textline",b:"fJ = ( gl_FrontFacing ) ? ZERO_VALUE_NODES : UNITY_VALUE_NODES ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"fJ = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}]}]},{type:"node",name:"GEOMETRY_VW",i:[{type:"node_out",
name:"fK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["fK","=","eM",";"]}]},{type:"node",name:"GEOMETRY_LO",i:[{type:"node_out",name:"fL",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fL [ 0 ] = fd [ 0 ] ; fL [ 1 ] = fd [ 1 ] ; fL [ 2 ] = fd [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",i:[{type:"node_out",name:"fM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fM = vec3 ( fh . r , - fh . b , fh . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",i:[{type:"node_out",name:"fN",
qualifier:["vec3"],e:!1},{type:"node_out",name:"fO",qualifier:["vec3"],e:!1},{type:"node_out",name:"fP",qualifier:["vec3"],e:!1},{type:"node_out",name:"fQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"fR",qualifier:["vec3"],e:!1},{type:"node_out",name:"fS",qualifier:["vec3"],e:!1},{type:"node_out",name:"fT",qualifier:["float"],e:!1},{type:"node_out",name:"fU",qualifier:["float"],e:!1}],g:[{type:"textline",b:"fN = vec3 ( ZERO_VALUE_NODES ) ; fO = vec3 ( ZERO_VALUE_NODES ) ; fP = vec3 ( ZERO_VALUE_NODES ) ; fQ = vec3 ( ZERO_VALUE_NODES ) ; fR = vec3 ( ZERO_VALUE_NODES ) ; fS = vec3 ( ZERO_VALUE_NODES ) ; fT = ZERO_VALUE_NODES ; fU = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"HUE_SAT",i:[{type:"node_in",name:"fV",qualifier:["float"],e:!1},{type:"node_in",name:"fW",qualifier:["float"],e:!1},{type:"node_in",name:"fX",qualifier:["float"],e:!1},{type:"node_in",name:"fY",qualifier:["float"],e:!1},{type:"node_in",name:"fZ",qualifier:["vec3"],e:!1},{type:"node_out",name:"f_",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"fj = eq ( fZ ) ; fj [ 0 ] += ( fV - eh ) ; if ( fj [ 0 ] > UNITY_VALUE_NODES ) fj [ 0 ] -= UNITY_VALUE_NODES ; else if ( fj [ 0 ] < ZERO_VALUE_NODES ) fj [ 0 ] += UNITY_VALUE_NODES ; fj *= vec3 ( UNITY_VALUE_NODES , fW , fX ) ; fj = mix ( vec3 ( UNITY_VALUE_NODES ) , mix ( vec3 ( ZERO_VALUE_NODES ) , fj , step ( vec3 ( ZERO_VALUE_NODES ) , fj ) ) , step ( fj , vec3 ( UNITY_VALUE_NODES ) ) ) ; f_ = mix ( fZ , eu ( fj ) , fY ) ;".split(" ")}]},
{type:"node",name:"INVERT",i:[{type:"node_in",name:"ga",qualifier:["float"],e:!1},{type:"node_in",name:"gb",qualifier:["vec3"],e:!1},{type:"node_out",name:"gc",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"gc = mix ( gb , vec3 ( UNITY_VALUE_NODES ) - gb , ga ) ;".split(" ")}]},{type:"node",name:"LAMP",i:[{type:"node_out",name:"gd",qualifier:["vec3"],e:!0},{type:"node_out",name:"ge",qualifier:["vec3"],e:!1},{type:"node_out",name:"gf",qualifier:["float"],e:!1},{type:"node_out",name:"gg",qualifier:["float"],
e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gd"],g:[{type:"textline",b:"gd = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",b:"fe = u_lamp_light_factors [ LAMP_INDEX ] ; fj = u_lamp_light_directions [ LAMP_INDEX ] ; fk = u_lamp_light_positions [ LAMP_INDEX ] ; eX = fe . z ; if ( eX != - UNITY_VALUE_NODES ) {".split(" ")},{type:"textline",b:"ge = fk - bC ; gf = length ( ge ) ; ge = normalize ( ge ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_gg"],g:[{type:"textline",b:"gg = eX / ( eX + gf * gf ) ; eX = fe . x ; eY = fe . y ; if ( eX > - UNITY_VALUE_NODES ) { eZ = dot ( ge , fj ) ; eZ *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( eZ - eX ) / eY ) ; gg *= eZ ; }".split(" ")}]}]},{type:"textline",b:["}","else","{"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ge"],g:[{type:"textline",b:["ge","=","fj",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gf"],g:[{type:"textline",b:"gf = length ( fk - bC ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gg"],g:[{type:"textline",b:["gg","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"NORMAL",i:[{type:"node_in",name:"gh",qualifier:["vec3"],e:!1},{type:"node_out",name:"gi",qualifier:["vec3"],e:!0},{type:"node_out",name:"gj",qualifier:["float"],e:!0},{type:"node_param",name:"eE",qualifier:["vec3"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_gi"],g:[{type:"textline",b:["gi","=","eE",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_gj"],g:[{type:"textline",b:"gj = - dot ( gh , eE ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",i:[{type:"node_in",name:"gk",qualifier:["vec3"],e:!1},{type:"node_out",name:"gl",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"gl = - ( eN * vec4 ( gk , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",i:[{type:"node_in",name:"gm",qualifier:["vec3"],e:!1},{type:"node_in",name:"gn",qualifier:["float"],e:!1},{type:"node_in",name:"go",
qualifier:["float"],e:!1},{type:"node_in",name:"gp",qualifier:["float"],e:!1},{type:"node_in",name:"gq",qualifier:["vec3"],e:!1},{type:"node_in",name:"gr",qualifier:["vec3"],e:!1},{type:"node_out",name:"gs",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gs","=","gm",";"]},{type:"textline",b:"gn ; go ; gp ; gq ; gr ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",i:[{type:"node_in",name:"gt",qualifier:["vec3"],e:!1},{type:"node_in",name:"gu",qualifier:["float"],e:!1},{type:"node_in",name:"gv",
qualifier:["vec3"],e:!1},{type:"node_out",name:"gw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gw","=","gt",";"]},{type:"textline",b:["gu",";","gv",";"]}]},{type:"node",name:"BSDF_GLASS",i:[{type:"node_in",name:"gx",qualifier:["vec3"],e:!1},{type:"node_in",name:"gy",qualifier:["float"],e:!1},{type:"node_in",name:"gz",qualifier:["float"],e:!1},{type:"node_in",name:"gA",qualifier:["vec3"],e:!1},{type:"node_out",name:"gB",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gB","=","gx",";"]},{type:"textline",
b:"gy ; gz ; gA ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",i:[{type:"node_in",name:"gC",qualifier:["vec3"],e:!1},{type:"node_in",name:"gD",qualifier:["float"],e:!1},{type:"node_in",name:"gE",qualifier:["vec3"],e:!1},{type:"node_out",name:"gF",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gF","=","gC",";"]},{type:"textline",b:["gD",";","gE",";"]}]},{type:"node",name:"BSDF_HAIR",i:[{type:"node_in",name:"gG",qualifier:["vec3"],e:!1},{type:"node_in",name:"gH",qualifier:["float"],e:!1},{type:"node_in",
name:"gI",qualifier:["float"],e:!1},{type:"node_in",name:"gJ",qualifier:["float"],e:!1},{type:"node_out",name:"gK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gK","=","gG",";"]},{type:"textline",b:"gH ; gI ; gJ ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",i:[{type:"node_in",name:"gL",qualifier:["vec3"],e:!1},{type:"node_out",name:"gM",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gM","=","gL",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",i:[{type:"node_in",name:"gN",qualifier:["vec3"],
e:!1},{type:"node_in",name:"gO",qualifier:["vec3"],e:!1},{type:"node_out",name:"gP",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gP","=","gN",";"]},{type:"textline",b:["gO",";"]}]},{type:"node",name:"BSDF_REFRACTION",i:[{type:"node_in",name:"gQ",qualifier:["vec3"],e:!1},{type:"node_in",name:"gR",qualifier:["float"],e:!1},{type:"node_in",name:"gS",qualifier:["float"],e:!1},{type:"node_in",name:"gT",qualifier:["vec3"],e:!1},{type:"node_out",name:"gU",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"gU [ 0 ] = gU [ 1 ] = gU [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"gQ ; gR ; gS ; gT ;".split(" ")}]},{type:"node",name:"BSDF_TOON",i:[{type:"node_in",name:"gV",qualifier:["vec3"],e:!1},{type:"node_in",name:"gW",qualifier:["float"],e:!1},{type:"node_in",name:"gX",qualifier:["float"],e:!1},{type:"node_in",name:"gY",qualifier:["vec3"],e:!1},{type:"node_out",name:"gZ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["gZ","=","gV",";"]},{type:"textline",b:"gW ; gX ; gY ;".split(" ")}]},
{type:"node",name:"BSDF_VELVET",i:[{type:"node_in",name:"g_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ha",qualifier:["float"],e:!1},{type:"node_in",name:"hb",qualifier:["vec3"],e:!1},{type:"node_out",name:"hc",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hc","=","g_",";"]},{type:"textline",b:["ha",";","hb",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",i:[{type:"node_in",name:"hd",qualifier:["vec3"],e:!1},{type:"node_in",name:"he",qualifier:["float"],e:!1},{type:"node_in",name:"hf",
qualifier:["vec3"],e:!1},{type:"node_in",name:"hg",qualifier:["float"],e:!1},{type:"node_in",name:"hh",qualifier:["float"],e:!1},{type:"node_in",name:"hi",qualifier:["vec3"],e:!1},{type:"node_out",name:"hj",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hj [ 0 ] = hj [ 1 ] = hj [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"hd ; hf ; hg ; hh ; hi ; he ;".split(" ")}]},{type:"node",name:"EMISSION",i:[{type:"node_in",name:"hk",qualifier:["vec3"],e:!1},{type:"node_in",name:"hl",qualifier:["float"],
e:!1},{type:"node_out",name:"hm",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hm","=","hk",";"]},{type:"textline",b:["hl",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",i:[{type:"node_in",name:"hn",qualifier:["vec3"],e:!1},{type:"node_out",name:"ho",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ho [ 0 ] = ho [ 1 ] = ho [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hn",";"]}]},{type:"node",name:"HOLDOUT",i:[{type:"node_out",name:"hp",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"hp [ 0 ] = hp [ 1 ] = hp [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",i:[{type:"node_in",name:"hq",qualifier:["vec3"],e:!1},{type:"node_in",name:"hr",qualifier:["float"],e:!1},{type:"node_out",name:"hs",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hs [ 0 ] = hs [ 1 ] = hs [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hq",";","hr",";"]}]},{type:"node",name:"VOLUME_SCATTER",i:[{type:"node_in",name:"ht",qualifier:["vec3"],e:!1},{type:"node_in",
name:"hu",qualifier:["float"],e:!1},{type:"node_in",name:"hv",qualifier:["float"],e:!1},{type:"node_out",name:"hw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hw [ 0 ] = hw [ 1 ] = hw [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:"ht ; hu ; hv ;".split(" ")}]},{type:"node",name:"BUMP",i:[{type:"node_in",name:"hx",qualifier:["float"],e:!1},{type:"node_in",name:"hy",qualifier:["float"],e:!1},{type:"node_in",name:"hz",qualifier:["float"],e:!1},{type:"node_in",name:"hA",qualifier:["vec3"],
e:!1},{type:"node_out",name:"hB",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hB","=","hA",";"]},{type:"textline",b:"hx ; hy ; hz ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",i:[{type:"node_in",name:"hC",qualifier:["float"],e:!1},{type:"node_in",name:"hD",qualifier:["vec3"],e:!1},{type:"node_out",name:"hE",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["hE","=","hD",";"]},{type:"textline",b:["hC",";"]}]},{type:"node",name:"VECT_TRANSFORM",i:[{type:"node_in",name:"hF",qualifier:["vec3"],
e:!1},{type:"node_out",name:"hG",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hG [ 0 ] = hG [ 1 ] = hG [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hF",";"]}]},{type:"node",name:"BLACKBODY",i:[{type:"node_in",name:"hH",qualifier:["float"],e:!1},{type:"node_out",name:"hI",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hI [ 0 ] = hI [ 1 ] = hI [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hH",";"]}]},{type:"node",name:"WAVELENGTH",i:[{type:"node_in",name:"hJ",qualifier:["float"],
e:!1},{type:"node_out",name:"hK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hK [ 0 ] = hK [ 1 ] = hK [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hJ",";"]}]},{type:"node",name:"SEPXYZ",i:[{type:"node_in",name:"hL",qualifier:["vec3"],e:!1},{type:"node_out",name:"hM",qualifier:["float"],e:!1},{type:"node_out",name:"hN",qualifier:["float"],e:!1},{type:"node_out",name:"hO",qualifier:["float"],e:!1}],g:[{type:"textline",b:"hM = hL [ 0 ] ; hN = hL [ 1 ] ; hO = hL [ 2 ] ;".split(" ")}]},
{type:"node",name:"COMBXYZ",i:[{type:"node_in",name:"hP",qualifier:["float"],e:!1},{type:"node_in",name:"hQ",qualifier:["float"],e:!1},{type:"node_in",name:"hR",qualifier:["float"],e:!1},{type:"node_out",name:"hS",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"hS [ 0 ] = hP ; hS [ 1 ] = hQ ; hS [ 2 ] = hR ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",i:[{type:"node_in",name:"hT",qualifier:["vec3"],e:!1},{type:"node_in",name:"hU",qualifier:["float"],e:!1},{type:"node_in",name:"hV",qualifier:["float"],
e:!1},{type:"node_out",name:"hW",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = hU - hV * eh ; hW = max ( ( UNITY_VALUE_NODES + hV ) * hT + eZ , vec3 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",i:[{type:"node_in",name:"hX",qualifier:["float"],e:!1},{type:"node_in",name:"hY",qualifier:["float"],e:!1},{type:"node_out",name:"hZ",qualifier:["float"],e:!1},{type:"node_out",name:"h_",qualifier:["float"],e:!1},{type:"node_out",name:"ia",qualifier:["float"],e:!1}],g:[{type:"textline",
b:"hZ = h_ = ia = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["hX",";","hY",";"]}]},{type:"node",name:"TEX_IMAGE",i:[{type:"node_in",name:"ib",qualifier:["vec3"],e:!1},{type:"node_out",name:"ic",qualifier:["vec3"],e:!1},{type:"node_out",name:"id",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ic [ 0 ] = ic [ 1 ] = ic [ 2 ] = ZERO_VALUE_NODES ; id = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["ib",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",i:[{type:"node_in",name:"ie",qualifier:["vec3"],
e:!1},{type:"node_out",name:"ig",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ig [ 0 ] = ig [ 1 ] = ig [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ie",";"]}]},{type:"node",name:"TEX_SKY",i:[{type:"node_in",name:"ih",qualifier:["vec3"],e:!1},{type:"node_out",name:"ii",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ii [ 0 ] = ii [ 1 ] = ii [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",b:["ih",";"]}]},{type:"node",name:"TEX_NOISE",i:[{type:"node_in",name:"ij",qualifier:["vec3"],
e:!1},{type:"node_in",name:"ik",qualifier:["float"],e:!1},{type:"node_in",name:"il",qualifier:["float"],e:!1},{type:"node_in",name:"im",qualifier:["float"],e:!1},{type:"node_out",name:"io",qualifier:["vec3"],e:!1},{type:"node_out",name:"ip",qualifier:["float"],e:!1}],g:[{type:"textline",b:"io [ 0 ] = io [ 1 ] = io [ 2 ] = ZERO_VALUE_NODES ; ip = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"ij ; ik ; il ; im ;".split(" ")}]},{type:"node",name:"TEX_WAVE",i:[{type:"node_in",name:"iq",qualifier:["vec3"],
e:!1},{type:"node_in",name:"ir",qualifier:["float"],e:!1},{type:"node_in",name:"is",qualifier:["float"],e:!1},{type:"node_in",name:"it",qualifier:["float"],e:!1},{type:"node_in",name:"iu",qualifier:["float"],e:!1},{type:"node_out",name:"iv",qualifier:["vec3"],e:!1},{type:"node_out",name:"iw",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iv [ 0 ] = iv [ 1 ] = iv [ 2 ] = ZERO_VALUE_NODES ; iw = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iq ; ir ; is ; it ; iu ;".split(" ")}]},{type:"node",
name:"TEX_VORONOI",i:[{type:"node_in",name:"ix",qualifier:["vec3"],e:!1},{type:"node_in",name:"iy",qualifier:["float"],e:!1},{type:"node_out",name:"iz",qualifier:["vec3"],e:!1},{type:"node_out",name:"iA",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iz [ 0 ] = iz [ 1 ] = iz [ 2 ] = ZERO_VALUE_NODES ; iA = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["ix",";","iy",";"]}]},{type:"node",name:"TEX_MUSGRAVE",i:[{type:"node_in",name:"iB",qualifier:["vec3"],e:!1},{type:"node_in",name:"iC",qualifier:["float"],
e:!1},{type:"node_in",name:"iD",qualifier:["float"],e:!1},{type:"node_in",name:"iE",qualifier:["float"],e:!1},{type:"node_in",name:"iF",qualifier:["float"],e:!1},{type:"node_in",name:"iG",qualifier:["float"],e:!1},{type:"node_in",name:"iH",qualifier:["float"],e:!1},{type:"node_out",name:"iI",qualifier:["vec3"],e:!1},{type:"node_out",name:"iJ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iI [ 0 ] = iI [ 1 ] = iI [ 2 ] = ZERO_VALUE_NODES ; iJ = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",
b:"iB ; iC ; iD ; iE ; iF ; iG ; iH ;".split(" ")}]},{type:"node",name:"TEX_GRADIENT",i:[{type:"node_in",name:"iK",qualifier:["vec3"],e:!1},{type:"node_out",name:"iL",qualifier:["vec3"],e:!1},{type:"node_out",name:"iM",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iL [ 0 ] = iL [ 1 ] = iL [ 2 ] = ZERO_VALUE_NODES ; iM = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:["iK",";"]}]},{type:"node",name:"TEX_MAGIC",i:[{type:"node_in",name:"iN",qualifier:["vec3"],e:!1},{type:"node_in",name:"iO",
qualifier:["float"],e:!1},{type:"node_in",name:"iP",qualifier:["float"],e:!1},{type:"node_out",name:"iQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"iR",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iQ [ 0 ] = iQ [ 1 ] = iQ [ 2 ] = ZERO_VALUE_NODES ; iR = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iN ; iO ; iP ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",i:[{type:"node_in",name:"iS",qualifier:["vec3"],e:!1},{type:"node_in",name:"iT",qualifier:["vec3"],e:!1},{type:"node_in",name:"iU",
qualifier:["vec3"],e:!1},{type:"node_in",name:"iV",qualifier:["float"],e:!1},{type:"node_out",name:"iW",qualifier:["vec3"],e:!1},{type:"node_out",name:"iX",qualifier:["float"],e:!1}],g:[{type:"textline",b:"iW [ 0 ] = iW [ 1 ] = iW [ 2 ] = ZERO_VALUE_NODES ; iX = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",b:"iS ; iT ; iU ; iV ;".split(" ")}]},{type:"node",name:"TEX_BRICK",i:[{type:"node_in",name:"iY",qualifier:["vec3"],e:!1},{type:"node_in",name:"iZ",qualifier:["vec3"],e:!1},{type:"node_in",
name:"i_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ja",qualifier:["vec3"],e:!1},{type:"node_in",name:"jb",qualifier:["float"],e:!1},{type:"node_in",name:"jc",qualifier:["float"],e:!1},{type:"node_in",name:"jd",qualifier:["float"],e:!1},{type:"node_in",name:"je",qualifier:["float"],e:!1},{type:"node_in",name:"jf",qualifier:["float"],e:!1},{type:"node_out",name:"jg",qualifier:["vec3"],e:!1},{type:"node_out",name:"jh",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jg [ 0 ] = jg [ 1 ] = jg [ 2 ] = ZERO_VALUE_NODES ; jh = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",b:"iY ; iZ ; i_ ; ja ; jb ; jc ; jd ; je ; jf ;".split(" ")}]},{type:"node",name:"ADD_SHADER",i:[{type:"node_in",name:"ji",qualifier:["vec3"],e:!1},{type:"node_in",name:"jj",qualifier:["vec3"],e:!1},{type:"node_out",name:"jk",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jk = clamp ( ji + jj , vec3 ( ZERO_VALUE_NODES ) , vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",i:[{type:"node_in",name:"jl",qualifier:["float"],e:!1},{type:"node_in",name:"jm",
qualifier:["vec3"],e:!1},{type:"node_in",name:"jn",qualifier:["vec3"],e:!1},{type:"node_out",name:"jo",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( jl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; jo = eZ * jm + ( UNITY_VALUE_NODES - eZ ) * jn ;".split(" ")}]},{type:"node",name:"UV_MERGED",i:[{type:"node_out",name:"jp",qualifier:["vec3"],e:!1},{type:"node_out",name:"jq",qualifier:["vec3"],e:!1},{type:"node_param",name:"eF",qualifier:["varying","vec2"]}],g:[{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_jp"],g:[{type:"textline",b:"jp = ew ( eF ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_jq"],g:[{type:"textline",b:"jq = vec3 ( eF , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",i:[{type:"node_out",name:"jr",qualifier:["vec3"],e:!1},{type:"node_param",name:"eG",qualifier:["varying","vec2"]}],g:[{type:"textline",b:"jr = vec3 ( eG , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",i:[{type:"node_out",name:"js",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:["js","=","fi",";"]}]},{type:"node",name:"TEX_COORD_GE",i:[{type:"node_out",name:"jt",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["jt","=","eg",";"]}]},{type:"node",name:"TEX_COORD_OB",i:[{type:"node_out",name:"ju",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"ju [ 0 ] = ju [ 1 ] = ju [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_CA",i:[{type:"node_out",name:"jv",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jv [ 0 ] = fd [ 0 ] ; jv [ 1 ] = fd [ 1 ] ; jv [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"TEX_COORD_WI",i:[{type:"node_out",name:"jw",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jw [ 0 ] = jw [ 1 ] = jw [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",i:[{type:"node_out",name:"jx",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jx [ 0 ] = jx [ 1 ] = jx [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",i:[{type:"node_out",name:"jy",qualifier:["vec3"],e:!1},{type:"node_param",name:"eH",qualifier:["varying","vec2"]}],
g:[{type:"textline",b:"jy = vec3 ( eH , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",i:[{type:"node_out",name:"jz",qualifier:["float"],e:!1},{type:"node_out",name:"jA",qualifier:["float"],e:!1},{type:"node_out",name:"jB",qualifier:["float"],e:!1},{type:"node_out",name:"jC",qualifier:["vec3"],e:!1},{type:"node_out",name:"jD",qualifier:["float"],e:!1},{type:"node_out",name:"jE",qualifier:["vec3"],e:!1},{type:"node_out",name:"jF",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"jz = ZERO_VALUE_NODES ; jA = ZERO_VALUE_NODES ; jB = ZERO_VALUE_NODES ; jC = vec3 ( ZERO_VALUE_NODES ) ; jD = ZERO_VALUE_NODES ; jE = jC ; jF = jC ;".split(" ")}]},{type:"node",name:"HAIR_INFO",i:[{type:"node_out",name:"jG",qualifier:["float"],e:!1},{type:"node_out",name:"jH",qualifier:["float"],e:!1},{type:"node_out",name:"jI",qualifier:["float"],e:!1},{type:"node_out",name:"jJ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jG = ZERO_VALUE_NODES ; jH = ZERO_VALUE_NODES ; jI = ZERO_VALUE_NODES ; jJ = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},
{type:"node",name:"OBJECT_INFO",i:[{type:"node_out",name:"jK",qualifier:["vec3"],e:!1},{type:"node_out",name:"jL",qualifier:["float"],e:!1},{type:"node_out",name:"jM",qualifier:["float"],e:!1},{type:"node_out",name:"jN",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jL = ZERO_VALUE_NODES ; jM = ZERO_VALUE_NODES ; jN = ZERO_VALUE_NODES ; jK = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",i:[{type:"node_in",name:"jO",qualifier:["float"],e:!1},{type:"node_out",name:"jP",
qualifier:["float"],e:!1}],g:[{type:"textline",b:["jP","=","jO",";"]}]},{type:"node",name:"TANGENT",i:[{type:"node_out",name:"jQ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"jQ = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",i:[{type:"node_in",name:"jR",qualifier:["float"],e:!1},{type:"node_in",name:"jS",qualifier:["vec3"],e:!1},{type:"node_out",name:"jT",qualifier:["float"],e:!1},{type:"node_out",name:"jU",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jT = jU = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",b:["jS",";","jR",";"]}]},{type:"node",name:"LIGHT_PATH",i:[{type:"node_out",name:"jV",qualifier:["float"],e:!1},{type:"node_out",name:"jW",qualifier:["float"],e:!1},{type:"node_out",name:"jX",qualifier:["float"],e:!1},{type:"node_out",name:"jY",qualifier:["float"],e:!1},{type:"node_out",name:"jZ",qualifier:["float"],e:!1},{type:"node_out",name:"j_",qualifier:["float"],e:!1},{type:"node_out",name:"ka",qualifier:["float"],e:!1},{type:"node_out",name:"kb",qualifier:["float"],e:!1},{type:"node_out",
name:"kc",qualifier:["float"],e:!1},{type:"node_out",name:"kd",qualifier:["float"],e:!1}],g:[{type:"textline",b:"jV = jW = jX = ZERO_VALUE_NODES ; jY = jZ = j_ = ZERO_VALUE_NODES ; ka = ka = kc = kd = ZERO_VALUE_NODES ; kb = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"ATTRIBUTE",i:[{type:"node_out",name:"ke",qualifier:["vec3"],e:!1},{type:"node_out",name:"kf",qualifier:["vec3"],e:!1},{type:"node_out",name:"kg",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ke = kf = vec3 ( ZERO_VALUE_NODES ) ; kg = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"SCRIPT",i:[],g:[]},{type:"node",name:"CURVE_VEC",i:[{type:"node_in",name:"kh",qualifier:["float"],e:!1},{type:"node_in",name:"ki",qualifier:["vec3"],e:!1},{type:"node_out",name:"kj",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:["kj","=","ki",";"]},{type:"textline",b:["kh",";"]}]},{type:"node",name:"CURVE_RGB",i:[{type:"node_in",name:"kk",qualifier:["float"],e:!1},{type:"node_in",name:"kl",qualifier:["vec3"],e:!1},{type:"node_out",name:"km",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:["km","=","kl",";"]},{type:"textline",b:["kk",";"]}]},{type:"node",name:"VALTORGB",i:[{type:"node_in",name:"kn",qualifier:["float"],e:!1},{type:"node_out",name:"ko",qualifier:["vec3"],e:!1},{type:"node_out",name:"kp",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ko [ 0 ] = ko [ 1 ] = ko [ 2 ] = clamp ( kn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; kp = ko [ 0 ] ;".split(" ")}]},{type:"node",name:"MAPPING",i:[{type:"node_in",name:"kq",qualifier:["vec3"],e:!1},{type:"node_out",name:"kr",qualifier:["vec3"],
e:!1}],g:[{type:"textline",b:["kr","=","kq",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",g:[{type:"textline",b:"kr = ( MAPPING_TRS_MATRIX * vec4 ( kr , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",g:[{type:"textline",b:"kr = kr * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",g:[{type:"textline",b:"kr = kr + MAPPING_TRANSLATION ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",g:[{type:"textline",b:"kr = max ( kr , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",g:[{type:"textline",b:"kr = min ( kr , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],g:[{type:"textline",b:"kr = normalize ( kr ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",i:[{type:"node_in",name:"ks",qualifier:["float"],
e:!1},{type:"node_in",name:"kt",qualifier:["float"],e:!1},{type:"node_out",name:"ku",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ku = ks + kt ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ku = clamp ( ku , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",i:[{type:"node_in",name:"kv",qualifier:["float"],e:!1},{type:"node_in",name:"kw",qualifier:["float"],e:!1},{type:"node_out",name:"kx",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"kx = kv - kw ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kx = clamp ( kx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MULTIPLY",i:[{type:"node_in",name:"ky",qualifier:["float"],e:!1},{type:"node_in",name:"kz",qualifier:["float"],e:!1},{type:"node_out",name:"kA",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kA = ky * kz ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kA = clamp ( kA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",i:[{type:"node_in",name:"kB",qualifier:["float"],e:!1},{type:"node_in",name:"kC",qualifier:["float"],e:!1},{type:"node_out",name:"kD",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kD = ( kC != ZERO_VALUE_NODES ) ? kB / kC : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kD = clamp ( kD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SINE",i:[{type:"node_in",name:"kE",qualifier:["float"],e:!1},{type:"node_in",name:"kF",qualifier:["float"],e:!1},{type:"node_out",name:"kG",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kG = sin ( kE ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kG = clamp ( kG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kF",";"]}]},{type:"node",name:"MATH_COSINE",i:[{type:"node_in",name:"kH",
qualifier:["float"],e:!1},{type:"node_in",name:"kI",qualifier:["float"],e:!1},{type:"node_out",name:"kJ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kJ = cos ( kH ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kJ = clamp ( kJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kI",";"]}]},{type:"node",name:"MATH_TANGENT",i:[{type:"node_in",name:"kK",qualifier:["float"],e:!1},{type:"node_in",name:"kL",qualifier:["float"],
e:!1},{type:"node_out",name:"kM",qualifier:["float"],e:!1}],g:[{type:"textline",b:"kM = tan ( kK ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kM = clamp ( kM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kL",";"]}]},{type:"node",name:"MATH_ARCSINE",i:[{type:"node_in",name:"kN",qualifier:["float"],e:!1},{type:"node_in",name:"kO",qualifier:["float"],e:!1},{type:"node_out",name:"kP",qualifier:["float"],e:!1}],
g:[{type:"textline",b:"kP = ( kN <= UNITY_VALUE_NODES && kN >= - UNITY_VALUE_NODES ) ? asin ( kN ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kP = clamp ( kP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kO",";"]}]},{type:"node",name:"MATH_ARCCOSINE",i:[{type:"node_in",name:"kQ",qualifier:["float"],e:!1},{type:"node_in",name:"kR",qualifier:["float"],e:!1},{type:"node_out",name:"kS",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"kS = ( kQ <= UNITY_VALUE_NODES && kQ >= - UNITY_VALUE_NODES ) ? acos ( kQ ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kS = clamp ( kS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kR",";"]}]},{type:"node",name:"MATH_ARCTANGENT",i:[{type:"node_in",name:"kT",qualifier:["float"],e:!1},{type:"node_in",name:"kU",qualifier:["float"],e:!1},{type:"node_out",name:"kV",
qualifier:["float"],e:!1}],g:[{type:"textline",b:"kV = atan ( kT ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kV = clamp ( kV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["kU",";"]}]},{type:"node",name:"MATH_POWER",i:[{type:"node_in",name:"kW",qualifier:["float"],e:!1},{type:"node_in",name:"kX",qualifier:["float"],e:!1},{type:"node_out",name:"kY",qualifier:["float"],e:!1}],g:[{type:"textline",b:"if ( kW < ZERO_VALUE_NODES && kX != floor ( kX ) ) kY = ZERO_VALUE_NODES ; else if ( kX == ZERO_VALUE_NODES )".split(" ")},
{type:"textline",b:"kY = UNITY_VALUE_NODES ; else if ( kW < ZERO_VALUE_NODES ) kY = mix ( UNITY_VALUE_NODES , - UNITY_VALUE_NODES , sign ( mod ( - kX , 2.0 ) ) ) * pow ( - kW , kX ) ; else if ( kW == ZERO_VALUE_NODES ) kY = ZERO_VALUE_NODES ; else kY = pow ( kW , kX ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"kY = clamp ( kY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",i:[{type:"node_in",
name:"kZ",qualifier:["float"],e:!1},{type:"node_in",name:"k_",qualifier:["float"],e:!1},{type:"node_out",name:"la",qualifier:["float"],e:!1}],g:[{type:"textline",b:"la = ( kZ > ZERO_VALUE_NODES && k_ > ZERO_VALUE_NODES ) ? log2 ( kZ ) / log2 ( k_ ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"la = clamp ( la , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",i:[{type:"node_in",name:"lb",
qualifier:["float"],e:!1},{type:"node_in",name:"lc",qualifier:["float"],e:!1},{type:"node_out",name:"ld",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ld = min ( lb , lc ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ld = clamp ( ld , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MAXIMUM",i:[{type:"node_in",name:"le",qualifier:["float"],e:!1},{type:"node_in",name:"lf",qualifier:["float"],e:!1},{type:"node_out",
name:"lg",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lg = max ( le , lf ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lg = clamp ( lg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",i:[{type:"node_in",name:"lh",qualifier:["float"],e:!1},{type:"node_in",name:"li",qualifier:["float"],e:!1},{type:"node_out",name:"lj",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lj = floor ( lh + eh ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lj = clamp ( lj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["li",";"]}]},{type:"node",name:"MATH_LESS_THAN",i:[{type:"node_in",name:"lk",qualifier:["float"],e:!1},{type:"node_in",name:"ll",qualifier:["float"],e:!1},{type:"node_out",name:"lm",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lm = ( lk < ll ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lm = clamp ( lm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",i:[{type:"node_in",name:"ln",qualifier:["float"],e:!1},{type:"node_in",name:"lo",qualifier:["float"],e:!1},{type:"node_out",name:"lp",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lp = ( ln > lo ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",
b:"lp = clamp ( lp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",i:[{type:"node_in",name:"lq",qualifier:["float"],e:!1},{type:"node_in",name:"lr",qualifier:["float"],e:!1},{type:"node_out",name:"ls",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ls = abs ( lr ) > 0.000001 ? mod ( lq , lr ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"ls = clamp ( ls , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_ABSOLUTE",i:[{type:"node_in",name:"lt",qualifier:["float"],e:!1},{type:"node_in",name:"lu",qualifier:["float"],e:!1},{type:"node_out",name:"lv",qualifier:["float"],e:!1}],g:[{type:"textline",b:"lv = abs ( lt ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],g:[{type:"textline",b:"lv = clamp ( lv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["lu",";"]}]},{type:"node",name:"MIX_RGB_MIX",i:[{type:"node_in",name:"lw",
qualifier:["float"],e:!1},{type:"node_in",name:"lx",qualifier:["vec3"],e:!1},{type:"node_in",name:"ly",qualifier:["vec3"],e:!1},{type:"node_out",name:"lz",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lz = mix ( lx , ly , eZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lz = clamp ( lz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",
i:[{type:"node_in",name:"lA",qualifier:["float"],e:!1},{type:"node_in",name:"lB",qualifier:["vec3"],e:!1},{type:"node_in",name:"lC",qualifier:["vec3"],e:!1},{type:"node_out",name:"lD",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lD = mix ( lB , lB + lC , eZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lD = clamp ( lD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_MULTIPLY",i:[{type:"node_in",name:"lE",qualifier:["float"],e:!1},{type:"node_in",name:"lF",qualifier:["vec3"],e:!1},{type:"node_in",name:"lG",qualifier:["vec3"],e:!1},{type:"node_out",name:"lH",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lH = mix ( lF , lF * lG , eZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lH = clamp ( lH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",i:[{type:"node_in",name:"lI",qualifier:["float"],e:!1},{type:"node_in",name:"lJ",qualifier:["vec3"],e:!1},{type:"node_in",name:"lK",qualifier:["vec3"],e:!1},{type:"node_out",name:"lL",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lL = mix ( lJ , lJ - lK , eZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lL = clamp ( lL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SCREEN",i:[{type:"node_in",name:"lM",qualifier:["float"],e:!1},{type:"node_in",name:"lN",qualifier:["vec3"],e:!1},{type:"node_in",name:"lO",qualifier:["vec3"],e:!1},{type:"node_out",name:"lP",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; lP = vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( eY ) + eZ * ( vec3 ( UNITY_VALUE_NODES ) - lO ) ) * ( vec3 ( UNITY_VALUE_NODES ) - lN ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lP = clamp ( lP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",i:[{type:"node_in",name:"lQ",qualifier:["float"],e:!1},{type:"node_in",name:"lR",qualifier:["vec3"],e:!1},{type:"node_in",name:"lS",qualifier:["vec3"],e:!1},{type:"node_out",name:"lT",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; lS += step ( lS , vec3 ( ZERO_VALUE_NODES ) ) ; lT = eY * lR + eZ * lR / lS ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lT = clamp ( lT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",i:[{type:"node_in",name:"lU",qualifier:["float"],e:!1},{type:"node_in",name:"lV",qualifier:["vec3"],e:!1},{type:"node_in",name:"lW",qualifier:["vec3"],e:!1},{type:"node_out",name:"lX",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; lX = mix ( lV , abs ( lV - lW ) , eZ ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"lX = clamp ( lX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DARKEN",i:[{type:"node_in",name:"lY",qualifier:["float"],e:!1},{type:"node_in",name:"lZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"l_",qualifier:["vec3"],e:!1},{type:"node_out",name:"ma",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( lY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ma = min ( lZ . rgb , l_ . rgb * eZ ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"ma = clamp ( ma , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",i:[{type:"node_in",name:"mb",qualifier:["float"],e:!1},{type:"node_in",name:"mc",qualifier:["vec3"],e:!1},{type:"node_in",name:"md",qualifier:["vec3"],e:!1},{type:"node_out",name:"me",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; me = max ( mc . rgb , md . rgb * eZ ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"me = clamp ( me , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",i:[{type:"node_in",name:"mf",qualifier:["float"],e:!1},{type:"node_in",name:"mg",qualifier:["vec3"],e:!1},{type:"node_in",name:"mh",qualifier:["vec3"],e:!1},{type:"node_out",name:"mi",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES - eZ ) ; mi = mix ( mg * ( fk + 2.0 * eZ * mh ) , vec3 ( UNITY_VALUE_NODES ) - ( fk + 2.0 * eZ * ( vec3 ( UNITY_VALUE_NODES ) - mh ) ) * ( vec3 ( UNITY_VALUE_NODES ) - mg ) , step ( eh , mg ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mi = clamp ( mi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",i:[{type:"node_in",name:"mj",qualifier:["float"],e:!1},{type:"node_in",name:"mk",qualifier:["vec3"],e:!1},{type:"node_in",name:"ml",qualifier:["vec3"],e:!1},{type:"node_out",name:"mm",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES ) - eZ * ml ; fj = clamp ( mk / fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mm = mix ( mix ( fj , vec3 ( UNITY_VALUE_NODES ) , step ( fk , vec3 ( ZERO_VALUE_NODES ) ) ) , mk , step ( mk , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mm = clamp ( mm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",i:[{type:"node_in",name:"mn",qualifier:["float"],e:!1},{type:"node_in",name:"mo",qualifier:["vec3"],e:!1},{type:"node_in",name:"mp",qualifier:["vec3"],e:!1},{type:"node_out",name:"mq",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; fk = vec3 ( UNITY_VALUE_NODES - eZ ) ; fk = fk + eZ * mp ; fj = clamp ( vec3 ( UNITY_VALUE_NODES ) - ( vec3 ( UNITY_VALUE_NODES ) - mo ) / fk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mq = mix ( fj , vec3 ( ZERO_VALUE_NODES ) , step ( fk , vec3 ( ZERO_VALUE_NODES ) ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mq = clamp ( mq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",i:[{type:"node_in",name:"mr",qualifier:["float"],e:!1},{type:"node_in",name:"ms",qualifier:["vec3"],e:!1},{type:"node_in",name:"mt",qualifier:["vec3"],e:!1},{type:"node_out",name:"mu",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mu = ms ; fj = eq ( mt ) ; if ( fj . y != ZERO_VALUE_NODES ) { fk = eq ( mu ) ; fk . x = fj . x ; fl = eu ( fk ) ; mu = mix ( mu , fl , eZ ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mu = clamp ( mu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",i:[{type:"node_in",name:"mv",qualifier:["float"],e:!1},{type:"node_in",name:"mw",qualifier:["vec3"],e:!1},{type:"node_in",name:"mx",qualifier:["vec3"],e:!1},{type:"node_out",name:"my",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; my = mw ; fl = eq ( my ) ; if ( fl . y != ZERO_VALUE_NODES ) { fk = eq ( mx ) ; fl . y = eY * fl . y + eZ * fk . y ; my = eu ( fl ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"my = clamp ( my , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",i:[{type:"node_in",name:"mz",qualifier:["float"],e:!1},{type:"node_in",name:"mA",qualifier:["vec3"],e:!1},{type:"node_in",name:"mB",qualifier:["vec3"],e:!1},{type:"node_out",name:"mC",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; fl = eq ( mA ) ; fk = eq ( mB ) ; fl . z = eY * fl . z + eZ * fk . z ; mC = eu ( fl ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mC = clamp ( mC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",i:[{type:"node_in",name:"mD",qualifier:["float"],e:!1},{type:"node_in",name:"mE",qualifier:["vec3"],e:!1},{type:"node_in",name:"mF",qualifier:["vec3"],e:!1},{type:"node_out",name:"mG",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mG = mE ; fk = eq ( mF ) ; if ( fk . y != ZERO_VALUE_NODES ) { fl = eq ( mG ) ; fl . x = fk . x ; fl . y = fk . y ; fj = eu ( fl ) ; mG = mix ( mG , fj , eZ ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mG = clamp ( mG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",i:[{type:"node_in",name:"mH",qualifier:["float"],e:!1},{type:"node_in",name:"mI",qualifier:["vec3"],e:!1},{type:"node_in",name:"mJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"mK",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = UNITY_VALUE_NODES - eZ ; fj = mJ + mI - mJ * mI ; mK = mI * ( vec3 ( eY ) + vec3 ( eZ ) * ( ( vec3 ( UNITY_VALUE_NODES ) - mI ) * mJ + fj ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mK = clamp ( mK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",i:[{type:"node_in",name:"mL",qualifier:["float"],e:!1},{type:"node_in",name:"mM",qualifier:["vec3"],e:!1},{type:"node_in",name:"mN",qualifier:["vec3"],e:!1},{type:"node_out",name:"mO",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"eZ = clamp ( mL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mO = mM + eZ * ( 2.0 * mN - vec3 ( UNITY_VALUE_NODES ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],g:[{type:"textline",b:"mO = clamp ( mO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",i:[{type:"node_in",name:"mP",qualifier:["vec3"],e:!1},{type:"node_in",name:"mQ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"eO = mP ; eS = mQ ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",i:[{type:"node_in",name:"mR",qualifier:["vec3"],e:!1},{type:"node_in",name:"mS",qualifier:["vec3"],e:!1},{type:"node_in",
name:"mT",qualifier:["float"],e:!1},{type:"node_in",name:"mU",qualifier:["vec3"],e:!0},{type:"node_in",name:"mV",qualifier:["float"],e:!0},{type:"node_out",name:"mW",qualifier:["vec3"],e:!1},{type:"node_out",name:"mX",qualifier:["vec3"],e:!1},{type:"node_out",name:"mY",qualifier:["vec3"],e:!1},{type:"node_out",name:"mZ",qualifier:["vec3"],e:!1},{type:"node_out",name:"m_",qualifier:["vec3"],e:!1},{type:"node_out",name:"na",qualifier:["vec2"],e:!1},{type:"node_out",name:"nb",qualifier:["vec2"],e:!1},
{type:"node_out",name:"nc",qualifier:["float"],e:!1},{type:"node_param",name:"eI",qualifier:["const","vec2"]},{type:"node_param",name:"eJ",qualifier:["const","vec3"]}],g:[{type:"textline",b:"mY = clamp ( mR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"mZ = eJ [ 0 ] * clamp ( mS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],g:[{type:"textline",b:"m_ = normalize ( mU ) ;".split(" ")}]},{type:"node_else",
g:[{type:"textline",b:["m_","=","fi",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["SHADELESS_MAT",{type:"logic_negative_expr",d:1}],g:[{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT"],g:[{type:"textline",b:"mW = mV * mY ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"mW = eV * mY ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:["mY","*=","mT",";"]}]}]},{type:"textline",b:"mX = eW * u_environment_energy * dS ( m_ ) ; nc = du ( mY ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",0,{type:"g_expr",d:2}],g:[{type:"textline",b:"na = vec2 ( eI [ 0 ] , eI [ 1 ] ) ;".split(" ")},{type:"textline",b:"nb = vec2 ( eJ [ 1 ] , eJ [ 2 ] ) ;".split(" ")}]}]},{type:"textline",b:["eR","=","nc",";"]}]},{type:"node_else",g:[{type:"textline",b:"mW = vec3 ( ZERO_VALUE_NODES ) ; mX = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATERIAL_END",i:[{type:"node_in",name:"nd",qualifier:["vec4"],e:!1},{type:"node_in",name:"ne",
qualifier:["vec3"],e:!1},{type:"node_in",name:"nf",qualifier:["vec3"],e:!1},{type:"node_in",name:"ng",qualifier:["float"],e:!0},{type:"node_in",name:"nh",qualifier:["float"],e:!0},{type:"node_in",name:"ni",qualifier:["float"],e:!0},{type:"node_out",name:"nj",qualifier:["vec3"],e:!0},{type:"node_out",name:"nk",qualifier:["float"],e:!0},{type:"node_out",name:"nl",qualifier:["vec3"],e:!0},{type:"node_out",name:"nm",qualifier:["vec3"],e:!0},{type:"node_out",name:"nn",qualifier:["vec3"],e:!0},{type:"node_param",
name:"eK",qualifier:["float"]},{type:"node_param",name:"eL",qualifier:["float"]}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nj"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],g:[{type:"textline",b:"nj = nd . rgb ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"nj = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",d:2},{type:"logical_and_expr",
d:2}],g:[{type:"node_condition",a:[{type:"node_if",c:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",d:2}],g:[{type:"textline",b:"dP ( nj , eM , nf , ng , eN ) ;".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"dP ( nj , eM , nf , ng , mat4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:["nj","+=","ne",";"]}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nl"],g:[{type:"textline",b:["nl",
"=","nf",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["MATERIAL_EXT"],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nm"],g:[{type:"textline",b:"nm = nd . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nn"],g:[{type:"textline",b:["nn","=","ne",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nk"],g:[{type:"textline",b:"nk = clamp ( ni , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
g:[{type:"textline",b:"eZ = max ( max ( ne . r , ne . g ) , ne . b ) * nh ; nk = clamp ( ni * ( UNITY_VALUE_NODES - eZ ) + eZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nk"],g:[{type:"textline",b:"nk = clamp ( eK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:"eZ = max ( max ( ne . r , ne . g ) , ne . b ) * eL ; nk = eK * ( UNITY_VALUE_NODES - eZ ) + eZ ;".split(" ")}]}]}]}]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],g:[{type:"textline",b:["eP","=","ne",";"]}]},{type:"node_else",g:[{type:"textline",b:"eP = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["eQ","=","nf",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",i:[{type:"node_in",name:"no",qualifier:["vec3"],e:!1},{type:"node_in",name:"np",qualifier:["vec3"],e:!1},{type:"node_in",name:"nq",qualifier:["vec3"],e:!1},{type:"node_out",name:"nr",qualifier:["vec4"],e:!1},{type:"node_out",
name:"ns",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"nr = vec4 ( no + nq * np , ZERO_VALUE_NODES ) ; ns = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",i:[{type:"node_in",name:"nt",qualifier:["float"],e:!1},{type:"node_out",name:"nu",qualifier:["vec3"],e:!1},{type:"node_out",name:"nv",qualifier:["vec2"],e:!1},{type:"node_out",name:"nw",qualifier:["vec3"],e:!1},{type:"node_out",name:"nx",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nv = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","HEMI",{type:"equal_expr",d:2}],g:[{type:"textline",b:["nx","=","eh",";"]}]},{type:"node_else",g:[{type:"textline",b:["nx","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",b:"nw = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) nw *= nt ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2},"LAMP_TYPE","POINT",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],g:[{type:"textline",
b:"fj = u_light_positions [ LAMP_IND ] ; nu = fj - fh ;".split(" ")},{type:"textline",b:"eZ = length ( nu ) ; nw *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + eZ * eZ ) ; nu = normalize ( nu ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2}],g:[{type:"textline",b:"fj = u_light_directions [ LAMP_IND ] ; eZ = dot ( nu , fj ) ; eZ *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( eZ - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; nw *= eZ ;".split(" ")}]}]}]},
{type:"node_else",g:[{type:"textline",b:"nu = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",i:[{type:"node_in",name:"ny",qualifier:["vec3"],e:!1},{type:"node_in",name:"nz",qualifier:["vec2"],e:!1},{type:"node_in",name:"nA",qualifier:["vec3"],e:!1},{type:"node_in",name:"nB",qualifier:["float"],e:!1},{type:"node_in",name:"nC",qualifier:["vec2"],e:!1},{type:"node_out",name:"nD",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nD = ZERO_VALUE_NODES ; if ( nz . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nB ) * dot ( nA , ny ) + nB ; if ( nC [ 0 ] == ZERO_VALUE_NODES ) { nD = UNITY_VALUE_NODES ; } else { eZ = UNITY_VALUE_NODES + abs ( eZ ) ; eZ = nC [ 1 ] + ( UNITY_VALUE_NODES - nC [ 1 ] ) * pow ( eZ , nC [ 0 ] ) ; nD = clamp ( eZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } nD = max ( nD , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",i:[{type:"node_in",name:"nE",qualifier:["vec3"],e:!1},{type:"node_in",name:"nF",qualifier:["vec2"],e:!1},{type:"node_in",name:"nG",qualifier:["vec3"],e:!1},{type:"node_in",name:"nH",qualifier:["float"],e:!1},{type:"node_out",name:"nI",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nI = ZERO_VALUE_NODES ; if ( nF . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nH ) * dot ( nG , nE ) + nH ; nI = max ( eZ , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",i:[{type:"node_in",name:"nJ",qualifier:["vec3"],e:!1},{type:"node_in",name:"nK",qualifier:["vec2"],e:!1},{type:"node_in",name:"nL",qualifier:["vec3"],e:!1},{type:"node_in",name:"nM",qualifier:["float"],e:!1},{type:"node_in",name:"nN",qualifier:["vec2"],e:!1},{type:"node_out",name:"nO",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nO = ZERO_VALUE_NODES ; if ( nK . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nM ) * dot ( nL , nJ ) + nM ; if ( nN [ 0 ] > ZERO_VALUE_NODES ) { eY = max ( dot ( nL , eM ) , ZERO_VALUE_NODES ) ; eX = nN [ 0 ] * nN [ 0 ] ; e_ = UNITY_VALUE_NODES - eh * ( eX / ( eX + 0.33 ) ) ; fj = nJ - eZ * nL ; fl = eM - eY * nL ;".split(" ")},
{type:"textline",b:"if ( length ( fj ) == ZERO_VALUE_NODES || length ( fl ) == ZERO_VALUE_NODES || abs ( eZ ) > UNITY_VALUE_NODES || abs ( eY ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",b:"nO = eZ * e_ ; else { fa = acos ( eZ ) ; eY = acos ( eY ) ; fj = normalize ( fj ) ; fl = normalize ( fl ) ; fb = max ( fa , eY ) ; fc = min ( fa , eY ) ; fc *= 0.95 ; eY = max ( dot ( fj , fl ) , ZERO_VALUE_NODES ) ; eX = 0.45 * ( eX / ( eX + 0.09 ) ) ; nO = eZ * ( e_ + ( eX * eY * sin ( fb ) * tan ( fc ) ) ) ; } } else nO = eZ ; nO = max ( nO , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",i:[{type:"node_in",name:"nP",qualifier:["vec3"],e:!1},{type:"node_in",name:"nQ",qualifier:["vec2"],e:!1},{type:"node_in",name:"nR",qualifier:["vec3"],e:!1},{type:"node_in",name:"nS",qualifier:["float"],e:!1},{type:"node_in",name:"nT",qualifier:["vec2"],e:!1},{type:"node_out",name:"nU",qualifier:["float"],e:!1}],g:[{type:"textline",b:"nU = ZERO_VALUE_NODES ; if ( nQ . r != ZERO_VALUE_NODES ) { eZ = ( UNITY_VALUE_NODES - nS ) * dot ( nR , nP ) + nS ; fc = max ( dot ( nR , eM ) , ZERO_VALUE_NODES ) ; if ( nT [ 0 ] <= UNITY_VALUE_NODES ) nU = eZ * pow ( max ( fc * eZ , 0.1 ) , nT [ 0 ] - UNITY_VALUE_NODES ) ; else nU = eZ * pow ( 1.0001 - fc , nT [ 0 ] - UNITY_VALUE_NODES ) ; nU = max ( nU , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",i:[{type:"node_in",name:"nV",qualifier:["vec3"],e:!1},{type:"node_in",name:"nW",qualifier:["vec2"],e:!1},{type:"node_in",name:"nX",qualifier:["vec3"],e:!1},{type:"node_in",name:"nY",qualifier:["float"],e:!1},{type:"node_in",name:"nZ",qualifier:["vec2"],e:!1},{type:"node_out",name:"n_",qualifier:["float"],e:!1}],g:[{type:"textline",b:"n_ = ZERO_VALUE_NODES ; if ( nW . r != ZERO_VALUE_NODES ) { fc = ( UNITY_VALUE_NODES - nY ) * dot ( nX , nV ) + nY ; fc = acos ( fc ) ; if ( fc < nZ [ 0 ] ) n_ = UNITY_VALUE_NODES ; else if ( fc > ( nZ [ 0 ] + nZ [ 1 ] ) || nZ [ 1 ] == ZERO_VALUE_NODES ) n_ = ZERO_VALUE_NODES ; else n_ = UNITY_VALUE_NODES - ( ( fc - nZ [ 0 ] ) / nZ [ 1 ] ) ; n_ = max ( n_ , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",i:[{type:"node_in",name:"oa",qualifier:["vec3"],e:!1},{type:"node_in",name:"ob",qualifier:["vec2"],e:!1},{type:"node_in",name:"oc",qualifier:["vec3"],e:!1},{type:"node_in",name:"od",qualifier:["float"],e:!1},{type:"node_in",name:"oe",qualifier:["vec2"],e:!1},{type:"node_out",name:"of",qualifier:["float"],e:!1}],g:[{type:"textline",b:"of = ZERO_VALUE_NODES ; if ( ob . g == UNITY_VALUE_NODES ) { fl = normalize ( oa + eM ) ; of = ( UNITY_VALUE_NODES - od ) * max ( dot ( oc , fl ) , ZERO_VALUE_NODES ) + od ; of = pow ( of , oe [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",i:[{type:"node_in",name:"og",qualifier:["vec3"],e:!1},{type:"node_in",name:"oh",qualifier:["vec2"],e:!1},{type:"node_in",name:"oi",qualifier:["vec3"],e:!1},{type:"node_in",name:"oj",qualifier:["vec2"],e:!1},{type:"node_out",name:"ok",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ok = ZERO_VALUE_NODES ; if ( oh . g == UNITY_VALUE_NODES ) { fl = normalize ( og + eM ) ; fc = max ( dot ( oi , fl ) , 0.001 ) ;".split(" ")},{type:"textline",b:"eZ = max ( dot ( oi , eM ) , 0.01 ) ; fb = max ( dot ( oi , og ) , 0.01 ) ; fc = tan ( acos ( fc ) ) ; eY = max ( oj [ 0 ] , 0.001 ) ; ok = fb * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * eY * eY ) ) * ( exp ( - ( fc * fc ) / ( eY * eY ) ) / ( sqrt ( eZ * fb ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",i:[{type:"node_in",name:"ol",qualifier:["vec3"],e:!1},{type:"node_in",name:"om",qualifier:["vec2"],e:!1},{type:"node_in",name:"on",qualifier:["vec3"],e:!1},{type:"node_in",name:"oo",qualifier:["vec2"],e:!1},{type:"node_out",name:"op",qualifier:["float"],e:!1}],g:[{type:"textline",b:"op = ZERO_VALUE_NODES ; if ( om . g == UNITY_VALUE_NODES ) { fl = normalize ( ol + eM ) ; fb = acos ( dot ( fl , on ) ) ; if ( fb < oo [ 0 ] ) op = UNITY_VALUE_NODES ; else if ( fb >= oo [ 0 ] + oo [ 1 ] || oo [ 1 ] == ZERO_VALUE_NODES ) op = ZERO_VALUE_NODES ; else op = UNITY_VALUE_NODES - ( fb - oo [ 0 ] ) / oo [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",i:[{type:"node_in",name:"oq",qualifier:["vec3"],e:!1},{type:"node_in",name:"or",qualifier:["vec2"],e:!1},{type:"node_in",name:"os",qualifier:["vec3"],e:!1},{type:"node_in",name:"ot",qualifier:["float"],e:!1},{type:"node_in",name:"ou",qualifier:["vec2"],e:!1},{type:"node_out",name:"ov",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ov = ZERO_VALUE_NODES ; if ( or . g == UNITY_VALUE_NODES ) { if ( ou [ 0 ] < UNITY_VALUE_NODES || ou [ 1 ] == ZERO_VALUE_NODES ) ov = ZERO_VALUE_NODES ; else { if ( ou [ 1 ] < 100.0 ) ou [ 1 ] = sqrt ( UNITY_VALUE_NODES / ou [ 1 ] ) ; else ou [ 1 ] = 10.0 / ou [ 1 ] ; fl = normalize ( eM + oq ) ; fb = ( UNITY_VALUE_NODES - ot ) * max ( dot ( os , fl ) , ZERO_VALUE_NODES ) + ot ; if ( fb < ZERO_VALUE_NODES ) ov = ZERO_VALUE_NODES ; else { eZ = max ( dot ( os , eM ) , 0.01 ) ; eY = dot ( os , oq ) ; if ( eY <= 0.01 ) ov = ZERO_VALUE_NODES ; else { fc = max ( dot ( eM , fl ) , 0.01 ) ; eX = UNITY_VALUE_NODES ; eZ = ( 2.0 * fb * eZ ) / fc ; eY = ( 2.0 * fb * eY ) / fc ; eY = min ( min ( eX , eZ ) , eY ) ; eZ = sqrt ( pow ( ou [ 0 ] , 2.0 ) + pow ( fc , 2.0 ) - UNITY_VALUE_NODES ) ; fc = pow ( eZ - fc , 2.0 ) / pow ( eZ + fc , 2.0 ) * ( UNITY_VALUE_NODES + pow ( fc * ( eZ + fc ) - UNITY_VALUE_NODES , 2.0 ) / pow ( fc * ( eZ - fc ) + UNITY_VALUE_NODES , 2.0 ) ) ; fb = acos ( fb ) ; ov = max ( fc * eY * exp ( - pow ( fb , 2.0 ) / ( 2.0 * pow ( ou [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",i:[{type:"node_in",name:"ow",qualifier:["vec4"],e:!1},{type:"node_in",name:"ox",qualifier:["vec3"],e:!1},{type:"node_in",name:"oy",qualifier:["float"],e:!1},{type:"node_in",name:"oz",qualifier:["float"],e:!1},{type:"node_in",name:"oA",qualifier:["vec3"],e:!1},{type:"node_in",name:"oB",qualifier:["vec3"],e:!1},{type:"node_in",name:"oC",qualifier:["vec4"],e:!1},{type:"node_in",name:"oD",qualifier:["vec3"],e:!1},{type:"node_in",name:"oE",qualifier:["vec3"],e:!1},{type:"node_in",
name:"oF",qualifier:["vec3"],e:!1},{type:"node_in",name:"oG",qualifier:["float"],e:!1},{type:"node_out",name:"oH",qualifier:["vec4"],e:!1},{type:"node_out",name:"oI",qualifier:["vec3"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_NODE_B4W_TRANSLUCENCY"],g:[{type:"textline",b:"if ( dot ( oA , oB ) * dot ( eM , oB ) < ZERO_VALUE_NODES ) { fb = oC . x ; eY = oC . y ; fc = oC . z ; eZ = oC . w ;".split(" ")},{type:"textline",b:"eX = clamp ( abs ( dot ( oA , oB ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; e_ = clamp ( dot ( eM , - oA ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = pow ( e_ , eY ) ;".split(" ")},
{type:"textline",b:"oH = ow + oG * vec4 ( oF * eX * pow ( oD , vec3 ( fb ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",b:"oH += fc * mix ( vec4 ( oD , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , eZ ) * oG * vec4 ( oF * eX * vec3 ( eY ) , UNITY_VALUE_NODES ) ; oI = ox ; } else {".split(" ")},{type:"textline",b:"oI = ox + oF * oE * oz ; oH = ow + vec4 ( oF * oD * oy , oz ) ; }".split(" ")}]},{type:"node_else",g:[{type:"textline",b:"oI = ox + oF * oE * oz ; oH = ow + vec4 ( oF * oD * oy , oz ) ;".split(" ")}]}]}]},
{type:"node",name:"RGB",i:[{type:"node_out",name:"oJ",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"oJ = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",i:[{type:"node_in",name:"oK",qualifier:["vec3"],e:!1},{type:"node_out",name:"oL",qualifier:["float"],e:!1}],g:[{type:"textline",b:"oL = dot ( oK , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",i:[{type:"node_in",name:"oM",qualifier:["vec3"],e:!1},{type:"node_out",name:"oN",qualifier:["float"],e:!0},
{type:"node_out",name:"oO",qualifier:["float"],e:!0},{type:"node_out",name:"oP",qualifier:["float"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oN"],g:[{type:"textline",b:"oN = oM . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oO"],g:[{type:"textline",b:"oO = oM . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oP"],g:[{type:"textline",b:"oP = oM . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",i:[{type:"node_in",name:"oQ",
qualifier:["vec3"],e:!1},{type:"node_out",name:"oR",qualifier:["float"],e:!0},{type:"node_out",name:"oS",qualifier:["float"],e:!0},{type:"node_out",name:"oT",qualifier:["float"],e:!0}],g:[{type:"textline",b:"fl = eq ( oQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oR"],g:[{type:"textline",b:"oR = fl . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_oS"],g:[{type:"textline",b:"oS = fl . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_oT"],g:[{type:"textline",b:"oT = fl . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",i:[{type:"node_in",name:"oU",qualifier:["float"],e:!1},{type:"node_in",name:"oV",qualifier:["float"],e:!1},{type:"node_in",name:"oW",qualifier:["float"],e:!1},{type:"node_out",name:"oX",qualifier:["float"],e:!1}],g:[{type:"textline",b:"oX = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( oU - oW ) * oV ) ) ;".split(" ")}]},{type:"node",name:"GAMMA",i:[{type:"node_in",name:"oY",qualifier:["vec3"],
e:!1},{type:"node_in",name:"oZ",qualifier:["float"],e:!1},{type:"node_out",name:"o_",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"o_ = oY ; if ( o_ . x > ZERO_VALUE_NODES ) o_ . x = pow ( oY . x , oZ ) ; if ( o_ . y > ZERO_VALUE_NODES ) o_ . y = pow ( oY . y , oZ ) ; if ( o_ . z > ZERO_VALUE_NODES ) o_ . z = pow ( oY . z , oZ ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",i:[{type:"node_in",name:"pa",qualifier:["vec3"],e:!1},{type:"node_out",name:"pb",qualifier:["vec3"],e:!1}],g:[{type:"textline",
b:"pb = max ( vec3 ( ZERO_VALUE_NODES ) , pa ) ; pb = pow ( pb , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",i:[{type:"node_in",name:"pc",qualifier:["vec3"],e:!1},{type:"node_out",name:"pd",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"pd = max ( vec3 ( ZERO_VALUE_NODES ) , pc ) ; pd = pow ( pd , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_EMPTY",i:[{type:"node_out",name:"pe",qualifier:["vec3"],e:!1},{type:"node_out",name:"pf",qualifier:["vec3"],
e:!1},{type:"node_out",name:"pg",qualifier:["float"],e:!1}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pg"],g:[{type:"textline",b:"pe [ 2 ] = pe [ 1 ] = pe [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pg"],g:[{type:"textline",b:"pf [ 2 ] = pf [ 1 ] = pf [ 0 ] = ZERO_VALUE_NODES ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pg"],g:[{type:"textline",b:["pg","=","ZERO_VALUE_NODES",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",
i:[{type:"node_in",name:"ph",qualifier:["vec3"],e:!1},{type:"node_out",name:"pi",qualifier:["vec3"],e:!0},{type:"node_out",name:"pj",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],g:[{type:"textline",b:"fe = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , ph ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pi"],g:[{type:"textline",b:"pi = fe . xyz ; br ( pi ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_pj"],g:[{type:"textline",b:"pj = fe . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",i:[{type:"node_in",name:"pk",qualifier:["vec3"],e:!0},{type:"node_in",name:"pl",qualifier:["vec3"],e:!0},{type:"node_in",name:"pm",qualifier:["vec3"],e:!0},{type:"node_in",name:"pn",qualifier:["vec3"],e:!0},{type:"node_out",name:"po",qualifier:["vec3"],e:!0},{type:"node_out",name:"pp",qualifier:["float"],e:!0},{type:"node_out",name:"pq",qualifier:["vec3"],e:!0},{type:"node_out",
name:"pr",qualifier:["float"],e:!0},{type:"node_out",name:"ps",qualifier:["vec3"],e:!0},{type:"node_out",name:"pt",qualifier:["float"],e:!0},{type:"node_out",name:"pu",qualifier:["vec3"],e:!0},{type:"node_out",name:"pv",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pk ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_po"],g:[{type:"textline",
b:"po = fe . xyz ; br ( po ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pp"],g:[{type:"textline",b:"pp = fe . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pl ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pq"],g:[{type:"textline",b:"pq = fe . xyz ; br ( pq ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pr"],
g:[{type:"textline",b:"pr = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pm ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ps"],g:[{type:"textline",b:"ps = fe . xyz ; br ( ps ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pt"],g:[{type:"textline",b:"pt = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],
g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_COLOR_var_texture , ey ( pn ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pu"],g:[{type:"textline",b:"pu = fe . xyz ; br ( pu ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pv"],g:[{type:"textline",b:"pv = fe . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",i:[{type:"node_in",name:"pw",qualifier:["vec3"],e:!0},{type:"node_in",name:"px",qualifier:["vec3"],e:!0},{type:"node_in",
name:"py",qualifier:["vec3"],e:!0},{type:"node_in",name:"pz",qualifier:["vec3"],e:!0},{type:"node_out",name:"pA",qualifier:["vec3"],e:!0},{type:"node_out",name:"pB",qualifier:["float"],e:!0},{type:"node_out",name:"pC",qualifier:["vec3"],e:!0},{type:"node_out",name:"pD",qualifier:["float"],e:!0},{type:"node_out",name:"pE",qualifier:["vec3"],e:!0},{type:"node_out",name:"pF",qualifier:["float"],e:!0},{type:"node_out",name:"pG",qualifier:["vec3"],e:!0},{type:"node_out",name:"pH",qualifier:["float"],e:!0},
{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pw ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pA"],g:[{type:"textline",b:"pA = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pB"],g:[{type:"textline",b:"pB = fe . w ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv2"],
g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( px ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pC"],g:[{type:"textline",b:"pC = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pD"],g:[{type:"textline",b:"pD = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv3"],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( py ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pE"],g:[{type:"textline",b:"pE = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pF"],g:[{type:"textline",b:"pF = fe . w ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_uv4"],g:[{type:"textline",b:"fe = texture2D ( node_TEXTURE_NORMAL_var_texture , ey ( pz ) ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pG"],g:[{type:"textline",b:"pG = normalize ( ff * ( fe . xyz - eh ) ) ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pH"],g:[{type:"textline",b:"pH = fe . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",i:[{type:"node_out",name:"pI",qualifier:["float"],e:!1}],g:[{type:"textline",b:"pI = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",i:[{type:"node_in",name:"pJ",qualifier:["vec3"],e:!1},{type:"node_in",name:"pK",qualifier:["vec3"],e:!1},{type:"node_out",name:"pL",qualifier:["vec3"],e:!1},{type:"node_out",name:"pM",qualifier:["float"],
e:!0}],g:[{type:"textline",b:"pL = pJ + pK ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pM"],g:[{type:"textline",b:"pM = ( abs ( pL [ 0 ] ) + abs ( pL [ 1 ] ) + abs ( pL [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",i:[{type:"node_in",name:"pN",qualifier:["vec3"],e:!1},{type:"node_in",name:"pO",qualifier:["vec3"],e:!1},{type:"node_out",name:"pP",qualifier:["vec3"],e:!1},{type:"node_out",name:"pQ",qualifier:["float"],e:!0}],g:[{type:"textline",
b:"pP = pN - pO ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pQ"],g:[{type:"textline",b:"pQ = ( abs ( pP [ 0 ] ) + abs ( pP [ 1 ] ) + abs ( pP [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",i:[{type:"node_in",name:"pR",qualifier:["vec3"],e:!1},{type:"node_in",name:"pS",qualifier:["vec3"],e:!1},{type:"node_out",name:"pT",qualifier:["vec3"],e:!1},{type:"node_out",name:"pU",qualifier:["float"],e:!0}],g:[{type:"textline",b:"pT = pR + pS ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pU"],g:[{type:"textline",b:"pU = length ( pT ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pT"],g:[{type:"textline",b:"pT = normalize ( pT ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",i:[{type:"node_in",name:"pV",qualifier:["vec3"],e:!1},{type:"node_in",name:"pW",qualifier:["vec3"],e:!1},{type:"node_out",name:"pX",qualifier:["vec3"],e:!1},{type:"node_out",name:"pY",qualifier:["float"],e:!0}],g:[{type:"textline",
b:"pX = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_pY"],g:[{type:"textline",b:"pY = dot ( pV , pW ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",i:[{type:"node_in",name:"pZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"p_",qualifier:["vec3"],e:!1},{type:"node_out",name:"qa",qualifier:["vec3"],e:!1},{type:"node_out",name:"qb",qualifier:["float"],e:!0}],g:[{type:"textline",b:"qa = cross ( pZ , p_ ) ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_qb"],g:[{type:"textline",b:"qb = length ( qa ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",i:[{type:"node_in",name:"qc",qualifier:["vec3"],e:!1},{type:"node_in",name:"qd",qualifier:["vec3"],e:!1},{type:"node_out",name:"qe",qualifier:["vec3"],e:!1},{type:"node_out",name:"qf",qualifier:["float"],e:!0}],g:[{type:"textline",b:"qe = normalize ( qc ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qf"],g:[{type:"textline",b:"qf = length ( qc ) ;".split(" ")}]}]},
{type:"textline",b:["qd",";"]}]},{type:"node",name:"B4W_REFLECT",i:[{type:"node_in",name:"qg",qualifier:["vec3"],e:!1},{type:"node_in",name:"qh",qualifier:["vec3"],e:!1},{type:"node_out",name:"qi",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qi = reflect ( - qg , qh ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",i:[{type:"node_in",name:"qj",qualifier:["vec3"],e:!1},{type:"node_in",name:"qk",qualifier:["float"],e:!1},{type:"node_in",name:"ql",qualifier:["const","float"],e:!1},{type:"node_in",
name:"qm",qualifier:["const","float"],e:!1},{type:"node_out",name:"qn",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],g:[{type:"textline",b:"eY = length ( fd ) ; if ( eY < qm ) { eT = ey ( qj ) ; eY = clamp ( eh * ( qm - eY ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; eY = qk * eY ;".split(" ")},{type:"textline",b:"fl = normalize ( eM * ff ) ;".split(" ")},{type:"textline",b:"eX = UNITY_VALUE_NODES / ql ;".split(" ")},{type:"textline",
b:"eU = fl . xy * eY / ( ql * fl . z ) ; eY = UNITY_VALUE_NODES ; eZ = texture2D ( node_B4W_PARALLAX_var_texture , eT ) . a ;".split(" ")},{type:"textline",b:"for ( float qo = 1.0 ; qo <= ql ; qo ++ ) { if ( eZ < eY ) { eY -= eX ; eT -= eU ; eZ = texture2D ( node_B4W_PARALLAX_var_texture , eT ) . a ; } }".split(" ")},{type:"textline",b:"eU = eT + eU ; eX = texture2D ( node_B4W_PARALLAX_var_texture , eU ) . a - ( eY + eX ) ; eY = eZ - eY ; eX = eY / ( eY - eX ) ;".split(" ")},{type:"textline",b:"eT = eX * eU + ( UNITY_VALUE_NODES - eX ) * eT ; qn = ew ( eT ) ; } else qn = qj ;".split(" ")}]},
{type:"node",name:"B4W_CLAMP",i:[{type:"node_in",name:"qp",qualifier:["vec3"],e:!1},{type:"node_out",name:"qq",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qq = clamp ( qp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",i:[{type:"node_in",name:"qr",qualifier:["vec3"],e:!1},{type:"node_in",name:"qs",qualifier:["float"],e:!1},{type:"node_out",name:"qt",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qt = el ( qr , qs ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",i:[{type:"node_in",name:"qu",qualifier:["float"],e:!1},{type:"node_in",name:"qv",qualifier:["float"],e:!1},{type:"node_in",name:"qw",qualifier:["float"],e:!1},{type:"node_in",name:"qx",qualifier:["float"],e:!1},{type:"node_in",name:"qy",qualifier:["float"],e:!1},{type:"node_out",name:"qz",qualifier:["float"],e:!0},{type:"node_out",name:"qA",qualifier:["vec4"],e:!0}],g:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qz"],g:[{type:"textline",b:["qz","=","qu",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qA"],g:[{type:"textline",b:"qA = vec4 ( qv , qw , qx , qy ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",i:[{type:"node_out",name:"qB",qualifier:["float"],e:!1}],g:[{type:"textline",b:["qB","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",i:[{type:"node_in",name:"qC",qualifier:["float"],e:!1},{type:"node_in",name:"qD",qualifier:["float"],e:!1},{type:"node_in",name:"qE",qualifier:["float"],e:!1},{type:"node_out",name:"qF",qualifier:["float"],
e:!1}],g:[{type:"textline",b:"qF = smoothstep ( qD , qE , qC ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",i:[{type:"node_in",name:"qG",qualifier:["vec3"],e:!1},{type:"node_in",name:"qH",qualifier:["float"],e:!1}],g:[{type:"textline",b:"eO = qG ; eS = qH ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",i:[{type:"node_in",name:"qI",qualifier:["vec3"],e:!1},{type:"node_out",name:"qJ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"qJ = ( qI . r + qI . g + qI . b ) / 3.0 ;".split(" ")}]},
{type:"node",name:"B4W_SCALTOVEC",i:[{type:"node_in",name:"qK",qualifier:["float"],e:!1},{type:"node_out",name:"qL",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"qL [ 0 ] = qK ; qL [ 1 ] = qK ; qL [ 2 ] = qK ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:"void qM ( in vec3 eM , in mat4 eN , out vec3 eO , out vec3 eP , out vec3 eQ , out float eR , out float eS ) { vec2 eT , eU ; float eV , eW , eX , eY , eZ , e_ , fa , fb , fc ; vec4 fd , fe ; mat3 ff ; vec3 fg , fh , fi , fj , fk , fl ; eO = vec3 ( ZERO_VALUE_NODES ) ; eP = vec3 ( ZERO_VALUE_NODES ) ; eQ = vec3 ( ZERO_VALUE_NODES ) ; eR = ZERO_VALUE_NODES ; eS = ZERO_VALUE_NODES ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",d:5}],group:{type:"group",a:[{type:"textline",b:"fg = normalize ( bE ) ; fh = fg ;".split(" ")},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["INVERT_FRONTFACING"],group:{type:"group",a:[{type:"textline",b:["if","(","!",
"gl_FrontFacing",")"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["if","(","gl_FrontFacing",")"]}]}}]},{type:"textline",b:"fh = fh ; else fh = - fh ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:["fi","=","fh",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["fi","=","fg",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["fg","=",
"fh",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"fj = cross ( fh , bF . xyz ) * bF . w ; ff = mat3 ( bF . xyz , fj , fh ) ; ff = ff ;".split(" ")}]}}]},{type:"textline",b:"fh = bC ; fd = bD ; eV = u_emit ; eW = u_ambient ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI",
"/","4.0",")"]},{type:"textline",b:"const vec3 qN = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 qT ( vec3 qO , mat4 qP ) { vec3 qQ , qR , qS ; qQ = vec3 ( qP [ 0 ] [ 0 ] , qP [ 1 ] [ 0 ] , qP [ 2 ] [ 0 ] ) ; qR = vec3 ( qP [ 0 ] [ 1 ] , qP [ 1 ] [ 1 ] , qP [ 2 ] [ 1 ] ) ; qS = vec3 ( qP [ 0 ] [ 2 ] , qP [ 1 ] [ 2 ] , qP [ 2 ] [ 2 ] ) ; qR = cross ( qS , qQ ) ; qQ = normalize ( qQ ) ; qR = normalize ( qR ) ; qS = normalize ( qS ) ; return mat4 ( vec4 ( qQ , 0.0 ) , vec4 ( qR , 0.0 ) , vec4 ( qS , 0.0 ) , vec4 ( qO , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 qZ ( vec3 qU , vec3 qV ) { vec3 qW , qX , qY ; qW = qU - qV ; qW . y = 0.0 ; qX = cross ( qN , qW ) ; qY = cross ( qW , qX ) ; qX = normalize ( qX ) ; qY = normalize ( qY ) ; qW = normalize ( qW ) ; return mat4 ( vec4 ( qX , 0.0 ) , vec4 ( qY , 0.0 ) , vec4 ( qW , 0.0 ) , vec4 ( qV , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 rg ( in vec3 q_ , float ra , float rb , float rc , vec3 rd ) { float re , rf ; re = fract ( length ( rd ) / 0.17 ) ; rf = rc + re / 10.0 ; re = re ; if ( rc != 0.0 ) re /= rc ; q_ *= 1.0 + 0.5 * sin ( ra ) ; re = length ( q_ ) * rb * sin ( 2.0 * 3.14 * ra * rf + re ) ; return C ( re ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 ro ( in vec3 rh , in vec3 ri , in mat4 rj ) { vec3 rk ; float rl , rm ; mat4 rn ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",d:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",d:2},{type:"logical_and_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"rn = qT ( ri , rj ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",
b:"rl = fract ( ( ri . x * 1.43 + ri . y * 0.123 + ri . z * 6.1 ) ) ; rl = 2.0 * M_PI * rl ; rk = normalize ( vec3 ( rj [ 0 ] [ 2 ] , 0.0 , rj [ 2 ] [ 2 ] ) ) ; rm = acos ( rk [ 2 ] ) ; if ( rk [ 0 ] < 0.0 ) rm = 2.0 * M_PI - rm ; rm = rm - rl ; if ( rm < 0.0 ) rm = 2.0 * M_PI + rm ; rl = rl ; if ( rm <= MAX_BILLBOARD_ANGLE ) rl += rm ; else if ( rm <= M_PI - MAX_BILLBOARD_ANGLE ) rl += MAX_BILLBOARD_ANGLE * ( 2.0 * rm - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( rm <= M_PI + MAX_BILLBOARD_ANGLE ) rl += rm - M_PI ; else if ( rm <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) rl += MAX_BILLBOARD_ANGLE * ( 2.0 * rm - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else rl += rm - 2.0 * M_PI ; rn = A ( rl ) ; rn [ 3 ] = vec4 ( ri , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"rn = qZ ( rh , ri ) ;".split(" ")}]}}]},{type:"textline",b:["return","rn",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",d:1},{type:"logical_and_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"mat4 ru ( in vec3 rp , in vec3 rq , in mat4 rr , mat4 rs ) { mat4 rt ; rt = ro ( rp , rq , rr ) ; rs [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; rt = rt * rs ; return rt ; }".split(" ")}]}}]},
{type:"textline",b:"c rB ( in vec3 rv , in vec3 rw , in vec3 rx , in vec3 ry , in vec3 rz , in mat4 rA ) { rv = ( rA * vec4 ( rv , 1.0 ) ) . xyz ; rw = ( rA * vec4 ( rw , 1.0 ) ) . xyz ; rx = ( rA * vec4 ( rx , 0.0 ) ) . xyz ; ry = ( rA * vec4 ( ry , 0.0 ) ) . xyz ; rz = ( rA * vec4 ( rz , 0.0 ) ) . xyz ; return E ( c ( rv , rw , rx , ry , rz , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 rE ( vec2 rC , vec3 rD ) { return ( rC + 0.5 ) * rD . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 rL ( in vec4 rF , in vec4 rG , in float rH ) { float rI , rJ , rK ; rI = rF [ 0 ] * rG [ 0 ] + rF [ 1 ] * rG [ 1 ] + rF [ 2 ] * rG [ 2 ] + rF [ 3 ] * rG [ 3 ] ; if ( rI < 0.0 ) { rG *= - 1.0 ; rI = - rI ; } if ( abs ( rI ) >= 1.0 ) return rF ; rJ = acos ( rI ) ; rI = sqrt ( 1.0 - rI * rI ) ; if ( abs ( rI ) < 0.001 ) return vec4 ( rF * 0.5 + rG * 0.5 ) ; rK = sin ( ( 1.0 - rH ) * rJ ) / rI ; rI = sin ( rH * rJ ) / rI ; return rF * rK + rG * rI ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 rX ( in vec3 rM , in vec4 rN , in vec4 rO , in vec4 rP , in vec4 rQ , in float rR ) { vec4 rS , rT ; vec3 rU , rV , rW ; rU = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rM , 1.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"rS = rL ( rN , rO , rR ) ; rT = mix ( rP , rQ , rR ) ; rV = i ( rS , rU ) ; rV = rV * rT . w + rT . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"rW = i ( rN , rU ) ; rU = i ( rO , rU ) ; rW = rW * rP . w + rP . xyz ; rU = rU * rQ . w + rQ . xyz ; rV = mix ( rW , rU , rR ) ;".split(" ")}]}}]},{type:"textline",b:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rV , 1.0 ) ) ; } vec3 sf ( in vec3 rY , in vec4 rZ , in vec4 r_ , in float sa ) { vec4 sb ; vec3 sc , sd , se ; sc = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( rY , 0.0 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],
group:{type:"group",a:[{type:"textline",b:"sb = rL ( rZ , r_ , sa ) ; sd = i ( sb , sc ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"se = i ( rZ , sc ) ; sc = i ( r_ , sc ) ; sd = mix ( se , sc , sa ) ;".split(" ")}]}}]},{type:"textline",b:"return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sd , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 rX ( in vec3 sg , in vec4 sh , in vec4 si ) { vec3 sj ; sj = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sg , 1.0 ) ) ; sj = i ( sh , sj ) ; sj = sj * si . w + si . xyz ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sj , 1.0 ) ) ; } vec3 sf ( in vec3 sk , in vec4 sl ) { vec3 sm ; sm = p ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sk , 0.0 ) ) ; sm = i ( sl , sm ) ; return v ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( sm , 0.0 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void sB ( inout vec3 sn , inout vec3 so , inout vec3 sp , inout vec3 sq ) { int sr , ss ; vec4 st ; vec3 su , sv , sw , sx ; float sy , sz ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["sy","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { su = vec3 ( 0.0 , 0.0 , 0.0 ) ; sv = vec3 ( 0.0 , 0.0 , 0.0 ) ; sw = vec3 ( 0.0 , 0.0 , 0.0 ) ; sx = vec3 ( 0.0 , 0.0 , 0.0 ) ; st = a_influence ; for ( int sA = 0 ; sA < 4 ; sA ++ ) { sr = int ( st [ sA ] ) ; sz = fract ( st [ sA ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"su += sz * rX ( sn , u_quatsb [ sr ] , u_quatsa [ sr ] , u_transb [ sr ] , u_transa [ sr ] , sy ) ; sv += sz * sf ( so , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ; sw += sz * sf ( sp , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ; sx += sz * sf ( sq , u_quatsb [ sr ] , u_quatsa [ sr ] , sy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"su += sz * rX ( sn , u_quatsb [ sr ] , u_transb [ sr ] ) ; sx += sz * sf ( sq , u_quatsb [ sr ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"sv += sz * sf ( so , u_quatsb [ sr ] ) ; sw += sz * sf ( sp , u_quatsb [ sr ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} sn = su ; sq = sx ;".split(" ")},{type:"condition",a:[{type:"if",c:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"so = sv ; sp = sw ;".split(" ")}]}}]},{type:"textline",b:"} if ( ! ( a_influence . y > 0.0 ) ) { ss = int ( a_influence [ 0 ] - 1.0 ) ; if ( ss > - 1 ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"sn = rX ( sn , u_quatsb [ ss ] , u_quatsa [ ss ] , u_transb [ ss ] , u_transa [ ss ] , sy ) ; so = sf ( so , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ; sp = sf ( sp , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ; sq = sf ( sq , u_quatsb [ ss ] , u_quatsa [ ss ] , sy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"sn = rX ( sn , u_quatsb [ ss ] , u_transb [ ss ] ) ; sq = sf ( sq , u_quatsb [ ss ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DISABLE_TANGENT_SKINNING",{type:"logic_negative_expr",d:1}],group:{type:"group",a:[{type:"textline",b:"so = sf ( so , u_quatsb [ ss ] ) ; sp = sf ( sp , u_quatsb [ ss ] ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void sM ( inout vec3 sC , in vec3 sD , in float sE , in float sF , in float sG , in vec3 sH , in float sI ) { vec3 sJ ; float sK , sL ; sK = length ( sD ) ; sL = sF * ( 1.0 + 0.1 * fract ( sK ) ) ; sK = sE * sI * ( 1.0 + sin ( 2.0 * 3.14 * sG * sL + sK ) ) ; sL = ( sC . y - sD . y ) * abs ( sK ) ; sL += 1.0 ; sL *= sL ; sL = sL * sL - sL ; sJ = sC ; sJ . xz += sH . xz * sL * sign ( sK ) ; sJ = sJ - sD ; if ( all ( equal ( sJ , vec3 ( 0.0 ) ) ) ) sC = sD ; else { sK = length ( sC - sD ) ; sC = sD + normalize ( sJ ) * sK ; } }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 sO ( vec4 sN ) { return sN * sN * ( 3.0 - 2.0 * sN ) ; } vec4 sQ ( vec4 sP ) { return abs ( fract ( sP + 0.5 ) * 2.0 - 1.0 ) ; } vec4 sS ( vec4 sR ) { return sO ( sQ ( sR ) ) ; } void ti ( inout vec3 sT , in float sU , in vec3 sV , in vec3 sW , in vec3 sX , in float sY , in float sZ , in float s_ , in vec3 ta ) { vec3 tb ; vec4 tc ; vec2 td , te ; float tf , tg , th ; tf = dot ( sX , vec3 ( 1.0 ) ) ; tg = tf + ta . g ; th = dot ( sT , vec3 ( ta . g ) ) ; td = ( sU + vec2 ( th , tg ) ) ; tc = ( ( fract ( ( td . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( sW ) * sY ; tc = sS ( tc ) ; te = tc . xz + tc . yw ; te . y = 0.5 - te . y ; tb = te . xyx * ta . rbr * vec3 ( sZ * sV . x , s_ , sZ * sV . z ) ; sT += tb ; }".split(" ")}]}}]},
{type:"textline",b:"void tp ( inout vec3 tj , inout vec3 tk , in vec3 tl ) { vec3 tm , tn , to ; tm = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"tn = tk ; to = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tn = tj ; to = tk ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"ti ( tn , u_time , tl , tm , to , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"sM ( tn , to , au_wind_bending_amp , au_wind_bending_freq , u_time , tm , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"sM ( tn , to , au_wind_bending_amp , au_wind_bending_freq , u_time , tm , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"tj += tn - tk ; tk = tn ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"tj = tn ; tk = to ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_orco_tex_coord ; varying vec3 eg ;".split(" ")}]}}]},
{type:"node",name:"TEX_COORD_UV",i:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eG",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eG","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",i:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eF",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eF","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",
name:"UVMAP",i:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"eH",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["eH","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",i:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"ez",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["ez","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",i:[{type:"node_param",
name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"tq",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["tq","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",i:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"tr",qualifier:["varying","float"]}],g:[{type:"textline",b:["tr","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",
i:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"ts",qualifier:["varying","vec2"]}],g:[{type:"textline",b:["ts","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",i:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"tt",qualifier:["varying","vec3"]}],g:[{type:"textline",b:["tt","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},
{type:"nodes_global"},{type:"textline",b:["void","tu","(",")","{"]},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["eg","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 tz ( vec3 tv , float tw , vec2 tx ) { vec2 ty ; ty = vec2 ( ( tv . x - tx . x ) / tw , - ( tv . z - tx . y ) / tw ) ; return fract ( ty ) ; } vec2 tD ( vec2 tA , float tB , vec2 tC ) { return vec2 ( tA . x * tB , - tA . y * tB ) + tC ; } c tE ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c t_ ( vec3 tF , vec3 tG , vec3 tH , vec3 tI , vec3 tJ , PRECISION sampler2D tK , sampler2D tL , vec3 tM , float tN , vec3 tO , vec4 tP , mat4 tQ ) { mat4 tR ; vec4 tS ; vec2 tT , tU , tV ; float tW , tX ; vec3 tY ; tY = i ( tP , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; tW = - tY . x ; tX = - tY . z ; tT = vec2 ( tO . x + tN * ( - 1.0 - tW ) / 2.0 , tO . z + tN * ( 1.0 - tX ) / 2.0 ) ; tU = tz ( tJ , tN , tT ) ; tX = tN / 2.0 ; tV = abs ( tD ( tU - vec2 ( 0.5 ) , tN , vec2 ( 0.0 ) ) ) ; tX = tX * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( tV ) > tX ) return tE ( ) ; tX = tN / tM . z ; tV = ( tU - vec2 ( 0.5 ) ) * tX + vec2 ( 0.5 ) ; tY = tY * ( tN / tM . z - 1.0 ) / 2.0 ; tV . x += tY . x ; tV . y -= tY . z ; tS = texture2D ( tL , tV ) ; tX = tS . r ; if ( tX < u_scale_threshold ) return tE ( ) ; tW = tM . y - tM . x ; tW = tM . y - texture2D ( tK , tV ) . r * tW ; tV = tF . xz - tJ . xz ; tJ . xz = tD ( tU , tN , tT ) ; tJ . y = tW ; tF . xz = tJ . xz + tV ; tF . y *= tX ; tF . y += tW ; tY = tS . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"tF -= tJ ; tR = ro ( tO , tJ , tQ ) ; c tZ = rB ( tF , tJ , tG , tH , tI , tR ) ; tZ . b = tJ ; tZ . f = tY ; return E ( tZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return E ( c ( tF , tJ , tG , tH , tI , tY ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",a:[{type:"if",
c:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",d:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 ug ( mat4 ua , vec4 ub , mat4 uc ) { vec4 ud ; float ue ; vec2 uf ; uf = ( ua * uc [ 3 ] ) . xy ; ue = SHADOW_TEX_RES / 2.0 ; uf = floor ( uf * ue + 0.5 ) / ue - uf ; ud = ua * ub ; ud . xy += uf ; ud . xyz = 0.5 * ( ud . xyz + ud . w ) ; return ud ; } void ul ( vec3 uh , vec3 ui ) { vec4 uj ; mat4 uk ; uk = O ( u_v_light_tsr ) ; uj = uk * vec4 ( uh + u_normal_offset * ui , 1.0 ) ; bI = ug ( u_p_light_matrix0 , uj , uk ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"bJ = ug ( u_p_light_matrix1 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"bK = ug ( u_p_light_matrix2 , uj , uk ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"bL = ug ( u_p_light_matrix3 , uj , uk ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/fog.glslf"]=
{type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void uv ( inout vec3 up , in float uq , in float ur , in vec4 us ) { float ut , uu ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_FOG"],group:{type:"group",a:[{type:"textline",b:"ut = clamp ( ( uq - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOG_TYPE","QUADRATIC",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:["ut","*=","ut",";"]}]}},
{type:"elif",c:["FOG_TYPE","LINEAR",{type:"equal_expr",d:2}],group:{type:"group",a:[]}},{type:"elif",c:["FOG_TYPE","INVERSE_QUADRATIC",{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"ut = sqrt ( ut ) ;".split(" ")}]}}]},{type:"textline",b:"if ( u_fog_params . w > 0.0 ) { if ( ur > u_fog_params . w ) ut = 0.0 ; else if ( ur > 0.0 ) { uu = ( u_fog_params . w - ur ) / u_fog_params . w ; ut *= uu * uu ; } } ut = 1.0 - ( 1.0 - ut ) * ( 1.0 - u_fog_params . x ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["ut","=","0.0",";"]}]}}]},{type:"textline",b:"up = mix ( up , us . rgb , ut ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uB ( in mat4 uw , in vec3 ux ) { vec3 uy , uz , uA ; uy = mix ( uw [ 0 ] . rgb , uw [ 1 ] . rgb , max ( sign ( ux . x ) , 0.0 ) ) ; uz = mix ( uw [ 2 ] . rgb , uw [ 3 ] . rgb , max ( sign ( ux . z ) , 0.0 ) ) ; uA = vec3 ( uw [ 0 ] . a , uw [ 1 ] . a , uw [ 2 ] . a ) ; uz = mix ( uy , uz , abs ( ux . z ) ) ; uz = mix ( uz , uA , abs ( ux . y ) ) ; br ( uz ) ; return uz ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void uD ( inout float uC ) { uC -= 0.5 ; uC = 4.0 * ( uC * uC * uC ) + 0.5 ; } void uQ ( inout vec3 uE , in float uF , in vec3 uG , in float uH , in vec4 uI , in vec4 uJ , in float uK ) { vec3 uL , uM ; float uN , uO , uP ; uN = uJ . w * uF ; uN = exp ( - uN * uN ) ; uN = clamp ( uN , 0.0 , 1.0 ) ; uO = max ( uG . y , 0.0 ) ; uF = max ( uF - max ( uH / uO , 0.0 ) , 0.0 ) ; uP = uI . w * uF ; uP = 1.0 - uP ; uP = max ( uP , 0.0 ) ; uD ( uP ) ; uP += max ( uK - 0.5 , 0.0 ) ; if ( uP < uN ) { uL = vec3 ( 0.0 , 0.02 , 0.05 ) ; uM = uI . rgb ; uH = clamp ( - uH * 0.03 , 0.0 , 0.8 ) ; uL = mix ( uM , uL , min ( uO , 1.0 ) ) ; uL = mix ( uL , vec3 ( 0.0 ) , uH ) ; uE = mix ( uL , uE , uP ) ; } if ( uP >= uN ) { uE = mix ( uJ . rgb , uE , uN ) ; } } void uW ( inout vec3 uR , in float uS , in float uT ) { vec3 uU ; float uV ; uV = u_underwater_fog_color_density . w * uS ; uV = 1.0 - uV ; uV = clamp ( uV , 0.0 , 1.0 ) ; uD ( uV ) ; uT = clamp ( - uT * 0.03 , 0.0 , 0.8 ) ; uU = mix ( u_underwater_fog_color_density . rgb , vec3 ( 0.0 ) , uT ) ; uR = mix ( uU , uR , uV ) ; }".split(" ")}]}}]},
{type:"textline",b:"void vc ( inout vec3 uX , float uY , vec3 uZ , float u_ ) { vec4 va ; vec3 vb ;".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vb = uB ( u_cube_fog , uZ ) ; va = vec4 ( vb , u_fog_color_density . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["va","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uQ ( uX , uY , uZ , u_cam_water_depth , u_underwater_fog_color_density , va , u_ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"uv ( uX , uY , bC . y , va ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/lighting_nodes.glslf"]={type:"group",a:[{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"define",
name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float vf = 0.5 ;".split(" ")},{type:"node",name:"LIGHTING_BEGIN",i:[{type:"node_out",name:"vD",qualifier:["vec3"],e:!1},{type:"node_out",name:"vE",qualifier:["vec3"],e:!1},{type:"node_out",name:"vF",qualifier:["vec3"],e:!1},{type:"node_out",name:"vG",qualifier:["vec3"],e:!0},{type:"node_out",name:"vH",qualifier:["vec3"],e:!0},{type:"node_out",name:"vI",qualifier:["vec2"],e:!0},{type:"node_out",
name:"vJ",qualifier:["vec2"],e:!0},{type:"node_out",name:"vK",qualifier:["float"],e:!0},{type:"node_out",name:"vL",qualifier:["float"],e:!0},{type:"node_out",name:"vM",qualifier:["vec4"],e:!0}],g:[{type:"textline",b:"vD = vg ; vE = vh ; vF = vi ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vG"],g:[{type:"textline",b:["vG","=","vj",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vH"],g:[{type:"textline",b:["vH","=","vl",";"]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_vJ"],g:[{type:"textline",b:["vJ","=","vn",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vI"],g:[{type:"textline",b:["vI","=","vo",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vK"],g:[{type:"textline",b:["vK","=","vp",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vL"],g:[{type:"textline",b:["vL","=","vq",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_vM"],g:[{type:"textline",b:["vM","=","vr",";"]}]}]}]},{type:"node",
name:"LIGHTING_AMBIENT",i:[{type:"node_in",name:"vN",qualifier:["vec3"],e:!1},{type:"node_in",name:"vO",qualifier:["vec3"],e:!1},{type:"node_in",name:"vP",qualifier:["vec3"],e:!1},{type:"node_out",name:"vQ",qualifier:["vec4"],e:!1},{type:"node_out",name:"vR",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"vQ = vec4 ( vN + vP * vO , ZERO_VALUE_NODES ) ; vR = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",i:[{type:"node_in",name:"vS",qualifier:["float"],e:!1},{type:"node_out",
name:"vT",qualifier:["vec3"],e:!1},{type:"node_out",name:"vU",qualifier:["vec2"],e:!1},{type:"node_out",name:"vV",qualifier:["vec3"],e:!1},{type:"node_out",name:"vW",qualifier:["float"],e:!1}],g:[{type:"textline",b:"vU = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","HEMI",{type:"equal_expr",d:2}],g:[{type:"textline",b:["vW","=","vf",";"]}]},{type:"node_else",g:[{type:"textline",b:["vW","=","ZERO_VALUE_NODES",";"]}]}]},
{type:"textline",b:"vV = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) vV *= vS ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2},"LAMP_TYPE","POINT",{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],g:[{type:"textline",b:"vB = u_light_positions [ LAMP_IND ] ; vT = vB - vk ;".split(" ")},{type:"textline",b:"vu = length ( vT ) ; vV *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + vu * vu ) ; vT = normalize ( vT ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["LAMP_TYPE","SPOT",{type:"equal_expr",d:2}],g:[{type:"textline",b:"vB = u_light_directions [ LAMP_IND ] ; vu = dot ( vT , vB ) ; vu *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( vu - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; vV *= vu ;".split(" ")}]}]}]},{type:"node_else",g:[{type:"textline",b:"vT = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",i:[{type:"node_in",name:"vX",qualifier:["vec3"],e:!1},{type:"node_in",
name:"vY",qualifier:["vec2"],e:!1},{type:"node_in",name:"vZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"v_",qualifier:["float"],e:!1},{type:"node_in",name:"wa",qualifier:["vec2"],e:!1},{type:"node_out",name:"wb",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wb = ZERO_VALUE_NODES ; if ( vY . r != ZERO_VALUE_NODES ) { vu = ( UNITY_VALUE_NODES - v_ ) * dot ( vZ , vX ) + v_ ; if ( wa [ 0 ] == ZERO_VALUE_NODES ) { wb = UNITY_VALUE_NODES ; } else { vu = UNITY_VALUE_NODES + abs ( vu ) ; vu = wa [ 1 ] + ( UNITY_VALUE_NODES - wa [ 1 ] ) * pow ( vu , wa [ 0 ] ) ; wb = clamp ( vu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } wb = max ( wb , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_LAMBERT",i:[{type:"node_in",name:"wc",qualifier:["vec3"],e:!1},{type:"node_in",name:"wd",qualifier:["vec2"],e:!1},{type:"node_in",name:"we",qualifier:["vec3"],e:!1},{type:"node_in",name:"wf",qualifier:["float"],e:!1},{type:"node_out",name:"wg",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wg = ZERO_VALUE_NODES ; if ( wd . r != ZERO_VALUE_NODES ) { vu = ( UNITY_VALUE_NODES - wf ) * dot ( we , wc ) + wf ; wg = max ( vu , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",
name:"DIFFUSE_OREN_NAYAR",i:[{type:"node_in",name:"wh",qualifier:["vec3"],e:!1},{type:"node_in",name:"wi",qualifier:["vec2"],e:!1},{type:"node_in",name:"wj",qualifier:["vec3"],e:!1},{type:"node_in",name:"wk",qualifier:["float"],e:!1},{type:"node_in",name:"wl",qualifier:["vec2"],e:!1},{type:"node_out",name:"wm",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wm = ZERO_VALUE_NODES ; if ( wi . r != ZERO_VALUE_NODES ) { vu = ( UNITY_VALUE_NODES - wk ) * dot ( wj , wh ) + wk ; if ( wl [ 0 ] > ZERO_VALUE_NODES ) { vv = max ( dot ( wj , vm ) , ZERO_VALUE_NODES ) ; vw = wl [ 0 ] * wl [ 0 ] ; vx = UNITY_VALUE_NODES - vf * ( vw / ( vw + 0.33 ) ) ; vB = wh - vu * wj ; vC = vm - vv * wj ;".split(" ")},
{type:"textline",b:"if ( length ( vB ) == ZERO_VALUE_NODES || length ( vC ) == ZERO_VALUE_NODES || abs ( vu ) > UNITY_VALUE_NODES || abs ( vv ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",b:"wm = vu * vx ; else { vy = acos ( vu ) ; vv = acos ( vv ) ; vB = normalize ( vB ) ; vC = normalize ( vC ) ; vz = max ( vy , vv ) ; vA = min ( vy , vv ) ; vA *= 0.95 ; vv = max ( dot ( vB , vC ) , ZERO_VALUE_NODES ) ; vw = 0.45 * ( vw / ( vw + 0.09 ) ) ; wm = vu * ( vx + ( vw * vv * sin ( vz ) * tan ( vA ) ) ) ; } } else wm = vu ; wm = max ( wm , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",i:[{type:"node_in",name:"wn",qualifier:["vec3"],e:!1},{type:"node_in",name:"wo",qualifier:["vec2"],e:!1},{type:"node_in",name:"wp",qualifier:["vec3"],e:!1},{type:"node_in",name:"wq",qualifier:["float"],e:!1},{type:"node_in",name:"wr",qualifier:["vec2"],e:!1},{type:"node_out",name:"ws",qualifier:["float"],e:!1}],g:[{type:"textline",b:"ws = ZERO_VALUE_NODES ; if ( wo . r != ZERO_VALUE_NODES ) { vu = ( UNITY_VALUE_NODES - wq ) * dot ( wp , wn ) + wq ; vA = max ( dot ( wp , vm ) , ZERO_VALUE_NODES ) ; if ( wr [ 0 ] <= UNITY_VALUE_NODES ) ws = vu * pow ( max ( vA * vu , 0.1 ) , wr [ 0 ] - UNITY_VALUE_NODES ) ; else ws = vu * pow ( 1.0001 - vA , wr [ 0 ] - UNITY_VALUE_NODES ) ; ws = max ( ws , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",i:[{type:"node_in",name:"wt",qualifier:["vec3"],e:!1},{type:"node_in",name:"wu",qualifier:["vec2"],e:!1},{type:"node_in",name:"wv",qualifier:["vec3"],e:!1},{type:"node_in",name:"ww",qualifier:["float"],e:!1},{type:"node_in",name:"wx",qualifier:["vec2"],e:!1},{type:"node_out",name:"wy",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wy = ZERO_VALUE_NODES ; if ( wu . r != ZERO_VALUE_NODES ) { vA = ( UNITY_VALUE_NODES - ww ) * dot ( wv , wt ) + ww ; vA = acos ( vA ) ; if ( vA < wx [ 0 ] ) wy = UNITY_VALUE_NODES ; else if ( vA > ( wx [ 0 ] + wx [ 1 ] ) || wx [ 1 ] == ZERO_VALUE_NODES ) wy = ZERO_VALUE_NODES ; else wy = UNITY_VALUE_NODES - ( ( vA - wx [ 0 ] ) / wx [ 1 ] ) ; wy = max ( wy , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",i:[{type:"node_in",name:"wz",qualifier:["vec3"],e:!1},{type:"node_in",name:"wA",qualifier:["vec2"],e:!1},{type:"node_in",name:"wB",qualifier:["vec3"],e:!1},{type:"node_in",name:"wC",qualifier:["float"],e:!1},{type:"node_in",name:"wD",qualifier:["vec2"],e:!1},{type:"node_out",name:"wE",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wE = ZERO_VALUE_NODES ; if ( wA . g != ZERO_VALUE_NODES ) { vC = normalize ( wz + vm ) ; wE = ( UNITY_VALUE_NODES - wC ) * max ( dot ( wB , vC ) , ZERO_VALUE_NODES ) + wC ; wE = pow ( wE , wD [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",i:[{type:"node_in",name:"wF",qualifier:["vec3"],e:!1},{type:"node_in",name:"wG",qualifier:["vec2"],e:!1},{type:"node_in",name:"wH",qualifier:["vec3"],e:!1},{type:"node_in",name:"wI",qualifier:["vec2"],e:!1},{type:"node_out",name:"wJ",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wJ = ZERO_VALUE_NODES ; if ( wG . g != ZERO_VALUE_NODES ) { vC = normalize ( wF + vm ) ; vA = max ( dot ( wH , vC ) , 0.001 ) ;".split(" ")},{type:"textline",b:"vu = max ( dot ( wH , vm ) , 0.01 ) ; vz = max ( dot ( wH , wF ) , 0.01 ) ; vA = tan ( acos ( vA ) ) ; vv = max ( wI [ 0 ] , 0.001 ) ; wJ = vz * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * vv * vv ) ) * ( exp ( - ( vA * vA ) / ( vv * vv ) ) / ( sqrt ( vu * vz ) ) ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_TOON",i:[{type:"node_in",name:"wK",qualifier:["vec3"],e:!1},{type:"node_in",name:"wL",qualifier:["vec2"],e:!1},{type:"node_in",name:"wM",qualifier:["vec3"],e:!1},{type:"node_in",name:"wN",qualifier:["vec2"],e:!1},{type:"node_out",name:"wO",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wO = ZERO_VALUE_NODES ; if ( wL . g != ZERO_VALUE_NODES ) { vC = normalize ( wK + vm ) ; vz = acos ( dot ( vC , wM ) ) ; if ( vz < wN [ 0 ] ) wO = UNITY_VALUE_NODES ; else if ( vz >= wN [ 0 ] + wN [ 1 ] || wN [ 1 ] == ZERO_VALUE_NODES ) wO = ZERO_VALUE_NODES ; else wO = UNITY_VALUE_NODES - ( vz - wN [ 0 ] ) / wN [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",i:[{type:"node_in",name:"wP",qualifier:["vec3"],e:!1},{type:"node_in",name:"wQ",qualifier:["vec2"],e:!1},{type:"node_in",name:"wR",qualifier:["vec3"],e:!1},{type:"node_in",name:"wS",qualifier:["float"],e:!1},{type:"node_in",name:"wT",qualifier:["vec2"],e:!1},{type:"node_out",name:"wU",qualifier:["float"],e:!1}],g:[{type:"textline",b:"wU = ZERO_VALUE_NODES ; if ( wQ . g != ZERO_VALUE_NODES ) { if ( wT [ 0 ] < 1.0 || wT [ 1 ] == ZERO_VALUE_NODES ) wU = ZERO_VALUE_NODES ; else { if ( wT [ 1 ] < 100.0 ) wT [ 1 ] = sqrt ( 1.0 / wT [ 1 ] ) ; else wT [ 1 ] = 10.0 / wT [ 1 ] ; vC = normalize ( vm + wP ) ; vz = ( UNITY_VALUE_NODES - wS ) * max ( dot ( wR , vC ) , ZERO_VALUE_NODES ) + wS ; if ( vz < ZERO_VALUE_NODES ) wU = ZERO_VALUE_NODES ; else { vu = max ( dot ( wR , vm ) , 0.01 ) ; vv = dot ( wR , wP ) ; if ( vv <= 0.01 ) wU = ZERO_VALUE_NODES ; else { vA = max ( dot ( vm , vC ) , 0.01 ) ; vw = UNITY_VALUE_NODES ; vu = ( 2.0 * vz * vu ) / vA ; vv = ( 2.0 * vz * vv ) / vA ; vv = min ( min ( vw , vu ) , vv ) ; vu = sqrt ( pow ( wT [ 0 ] , 2.0 ) + pow ( vA , 2.0 ) - UNITY_VALUE_NODES ) ; vA = pow ( vu - vA , 2.0 ) / pow ( vu + vA , 2.0 ) * ( UNITY_VALUE_NODES + pow ( vA * ( vu + vA ) - UNITY_VALUE_NODES , 2.0 ) / pow ( vA * ( vu - vA ) + UNITY_VALUE_NODES , 2.0 ) ) ; vz = acos ( vz ) ; wU = max ( vA * vv * exp ( - pow ( vz , 2.0 ) / ( 2.0 * pow ( wT [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",i:[{type:"node_in",name:"wV",qualifier:["vec4"],e:!1},{type:"node_in",name:"wW",qualifier:["vec3"],e:!1},{type:"node_in",name:"wX",qualifier:["float"],e:!1},{type:"node_in",name:"wY",qualifier:["float"],e:!1},{type:"node_in",name:"wZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"w_",qualifier:["vec3"],e:!1},{type:"node_in",name:"xa",qualifier:["vec4"],e:!1},{type:"node_in",name:"xb",qualifier:["vec3"],e:!1},{type:"node_in",name:"xc",qualifier:["vec3"],e:!1},{type:"node_in",
name:"xd",qualifier:["vec3"],e:!1},{type:"node_in",name:"xe",qualifier:["float"],e:!1},{type:"node_out",name:"xf",qualifier:["vec4"],e:!1},{type:"node_out",name:"xg",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"xg = wW + xd * xc * wY ; xf = wV + vec4 ( xd * xb * wX , wY ) ;".split(" ")}]},{type:"node",name:"LIGHTING_END",i:[{type:"node_in",name:"xh",qualifier:["vec4"],e:!1},{type:"node_in",name:"xi",qualifier:["vec3"],e:!1}],g:[{type:"textline",b:"vs = xh . rgb ; vt = xi ;".split(" ")}]},{type:"nodes_global"},
{type:"textline",b:"void xj ( vec3 vg , vec3 vh , vec3 vi , vec3 vj , vec3 vk , vec3 vl , vec3 vm , vec2 vn , vec2 vo , float vp , float vq , vec4 vr , out vec3 vs , out vec3 vt ) { float vu , vv , vw , vx , vy , vz , vA ; vec3 vB , vC ;".split(" ")},{type:"nodes_main"},{type:"textline",b:["}"]}]};a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct xm { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",
a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void xs ( inout float xn , float xo , vec2 xp , vec2 xq ) { float xr ; xr = xq . x - xp . x ; xr = ( xo - xp . x ) / xr ; xn = mix ( xn , xq . y , clamp ( xr , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"void xy ( inout vec3 xt , float xu , vec4 xv , vec4 xw ) { float xx ; xx = xw . x - xv . x ; xx = ( xu - xv . x ) / xx ; xt = mix ( xt , xw . yzw , clamp ( xx , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"float xE ( float xz , float xA , vec2 xB [ SIZE_RAMP_LENGTH ] ) { float xC , xD ; xC = xz / xA ; xD = xB [ 0 ] . y ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xs ( xD , xC , xB [ 0 ] , xB [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",2,{type:"g_expr",d:2}],
group:{type:"group",a:[{type:"textline",b:"xs ( xD , xC , xB [ 1 ] , xB [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xs ( xD , xC , xB [ 2 ] , xB [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","xD",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec3 xK ( float xF , float xG , vec4 xH [ COLOR_RAMP_LENGTH ] ) { vec3 xI ; float xJ ; xJ = xF / xG ; xI = xH [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",1,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xy ( xI , xJ , xH [ 0 ] , xH [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",2,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xy ( xI , xJ , xH [ 1 ] , xH [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xy ( xI , xJ , xH [ 2 ] , xH [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",b:["return","xI",";","}"]}]}}]},{type:"textline",b:"float xS ( float xL , float xM , float xN , float xO ) { float xP , xQ , xR ; xP = max ( 0.01 , min ( xM , xN ) ) ; xQ = max ( 0.01 , min ( xM , xO ) ) ; xR = xM - xQ ; xQ = clamp ( xL / xP , 0.0 , 1.0 ) - step ( xR , xL ) * ( xL - xR ) / xQ ; return xQ ; } xm xZ ( ) { mat4 xT ; vec3 xU , xV ; float xW , xX ; xm xY ; if ( u_p_cyclic == 1 ) { xW = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( xW < 0.0 ) xW += u_p_length ; } if ( u_p_cyclic != 1 ) { xW = u_p_time - a_p_delay ; } if ( xW < 0.0 || xW >= a_p_lifetime ) { xY . a = 0.0001 ; xY . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( xW < 0.0 || xW >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"xU = a_position ; xV = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xT = O ( u_model_tsr ) ; xU = ( xT * vec4 ( a_position , 1.0 ) ) . xyz ; xV = ( xT * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"xU += u_p_nfactor * xW * xV ; xU += a_p_vels . xyz * xW ; xU . y -= u_p_gravity * xW * xW / 2.0 ; xX = max ( u_p_mass , EPSILON ) ; xU += ( u_p_wind_fac * u_wind / xX ) * xW * xW / 2.0 ; xY . b = xU ; xY . e = a_p_vels . w * xW ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xY . a = xE ( xW , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"xY . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",0,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"xY . d = xK ( xW , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"xY . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"xY . c = xS ( xW , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return xY ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",a:[{type:"textline",b:"float ya = 0.0 ; float yb = 1.0 ; vec3 yg ( vec3 yc ) { float yd , ye ; vec4 yf ; yf = vec4 ( ya , - yb / 3.0 , 2.0 / 3.0 , - yb ) ; yf = mix ( vec4 ( yc . bg , yf . wz ) , vec4 ( yc . gb , yf . xy ) , step ( yc . b , yc . g ) ) ; yf = mix ( vec4 ( yf . xyw , yc . r ) , vec4 ( yc . r , yf . yzx ) , step ( yf . x , yc . r ) ) ; yd = yf . x - min ( yf . w , yf . y ) ; ye = 1.0e-10 ; return vec3 ( abs ( yf . z + ( yf . w - yf . y ) / ( 6.0 * yd + ye ) ) , yd / ( yf . x + ye ) , yf . x ) ; } vec3 yk ( vec3 yh ) { vec3 yi ; vec4 yj ; yj = vec4 ( yb , 2.0 / 3.0 , yb / 3.0 , 3.0 ) ; yi = abs ( fract ( vec3 ( yh . r , yh . r , yh . r ) + yj . xyz ) * 6.0 - yj . www ) ; return yh . b * mix ( yj . xxx , clamp ( yi - yj . xxx , ya , yb ) , yh . g ) ; } vec3 yo ( vec3 yl , vec3 ym , float yn ) { return mix ( yl , ym , yn ) ; } vec3 ys ( vec3 yp , vec3 yq , float yr ) { return yr * yp + yq ; } vec3 yw ( vec3 yt , vec3 yu , float yv ) { return yu - yv * yt ; } vec3 yB ( vec3 yx , vec3 yy , float yz ) { float yA ; yA = yb - yz ; return ( vec3 ( yA ) + yz * yx ) * yy ; } vec3 yG ( vec3 yC , vec3 yD , float yE ) { vec3 yF ; yF = vec3 ( yb - yE ) ; return vec3 ( yb ) - ( yF + yE * ( vec3 ( yb ) - yC ) ) * ( vec3 ( yb ) - yD ) ; } vec3 yL ( vec3 yH , vec3 yI , float yJ ) { vec3 yK ; yK = vec3 ( yb - yJ ) ; return mix ( yI * ( yK + 2.0 * yJ * yH ) , vec3 ( yb ) - ( yK + 2.0 * yJ * ( vec3 ( yb ) - yH ) ) * ( vec3 ( yb ) - yI ) , step ( 0.5 , yI ) ) ; } vec3 yP ( vec3 yM , vec3 yN , float yO ) { return mix ( yN , abs ( yM - yN ) , yO ) ; } vec3 yT ( vec3 yQ , vec3 yR , float yS ) { return mix ( yR , yR / ( yQ + step ( yQ , vec3 ( ya ) ) ) , yS ) ; } vec3 yX ( vec3 yU , vec3 yV , float yW ) { return mix ( yV , min ( yU , yV ) , yW ) ; } vec3 za ( vec3 yY , vec3 yZ , float y_ ) { return max ( y_ * yY , yZ ) ; } vec3 zg ( vec3 zb , vec3 zc , float zd ) { vec3 ze , zf ; ze = yg ( zc ) ; if ( ze . y != ya ) { zf = yg ( zb ) ; zf = yk ( vec3 ( ze . x , zf . yz ) ) ; return mix ( zb , zf , zd ) ; } return zb ; } vec3 zm ( vec3 zh , vec3 zi , float zj ) { vec3 zk , zl ; zk = yg ( zh ) ; if ( zk . y != ya ) { zl = yg ( zi ) ; return yk ( vec3 ( zk . x , mix ( zk . y , zl . y , zj ) , zk . z ) ) ; } return zh ; } vec3 zs ( vec3 zn , vec3 zo , float zp ) { vec3 zq , zr ; zq = yg ( zn ) ; zr = yg ( zo ) ; return yk ( vec3 ( zq . xy , mix ( zq . z , zr . z , zp ) ) ) ; } vec3 zy ( vec3 zt , vec3 zu , float zv ) { vec3 zw , zx ; zw = yg ( zu ) ; if ( zw . y != ya ) { zx = yg ( zt ) ; zx = yk ( vec3 ( zw . xy , zx . z ) ) ; return mix ( zt , zx , zv ) ; } return zt ; } vec3 zD ( vec3 zz , vec3 zA , float zB ) { vec3 zC ; zC = vec3 ( yb ) - ( vec3 ( yb ) - zA ) * ( vec3 ( yb ) - zz ) ; return mix ( zz , ( ( vec3 ( yb ) - zz ) * zA * zz ) + zz * zC , zB ) ; } vec3 zH ( vec3 zE , vec3 zF , float zG ) { return zE + zG * ( 2.0 * zF - yb ) ; } float zN ( float zI , float zJ , float zK , float zL ) { float zM ; zM = yb - zL ; return ( zM + zK * zI ) * zJ ; } float zT ( float zO , float zP , float zQ , float zR ) { float zS ; zS = yb - zR ; return yb - ( zS + zQ * ( yb - zO ) ) * ( yb - zP ) ; } float zZ ( float zU , float zV , float zW , float zX ) { float zY ; zY = yb - zX ; return mix ( zV * ( zY + 2.0 * zW * zU ) , yb - ( zY + 2.0 * zW * ( yb - zU ) ) * ( yb - zV ) , step ( 0.5 , zV ) ) ; }".split(" ")}]};
a["include/fxaa.glslf"]={type:"group",a:[{type:"condition",a:[{type:"ifndef",name:"FXAA_PS3",group:{type:"group",a:[{type:"define",name:"FXAA_PS3",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_360",group:{type:"group",a:[{type:"define",name:"FXAA_360",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_360_OPT",group:{type:"group",a:[{type:"define",name:"FXAA_360_OPT",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_PC",group:{type:"group",a:[{type:"define",name:"FXAA_PC",
b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_PC_CONSOLE",group:{type:"group",a:[{type:"define",name:"FXAA_PC_CONSOLE",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_GLSL_120",group:{type:"group",a:[{type:"define",name:"FXAA_GLSL_120",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_GLSL_130",group:{type:"group",a:[{type:"define",name:"FXAA_GLSL_130",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_HLSL_3",group:{type:"group",a:[{type:"define",
name:"FXAA_HLSL_3",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_HLSL_4",group:{type:"group",a:[{type:"define",name:"FXAA_HLSL_4",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_HLSL_5",group:{type:"group",a:[{type:"define",name:"FXAA_HLSL_5",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_GREEN_AS_LUMA",group:{type:"group",a:[{type:"define",name:"FXAA_GREEN_AS_LUMA",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_EARLY_EXIT",group:{type:"group",
a:[{type:"define",name:"FXAA_EARLY_EXIT",b:["1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_DISCARD",group:{type:"group",a:[{type:"define",name:"FXAA_DISCARD",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",a:[{type:"condition",a:[{type:"ifdef",name:"GL_EXT_gpu_shader4",group:{type:"group",a:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",b:["1"]}]}}]},{type:"condition",a:[{type:"ifdef",name:"GL_NV_gpu_shader5",group:{type:"group",a:[{type:"define",
name:"FXAA_FAST_PIXEL_OFFSET",b:["1"]}]}}]},{type:"condition",a:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",a:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",b:["1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_FAST_PIXEL_OFFSET",group:{type:"group",a:[{type:"define",name:"FXAA_FAST_PIXEL_OFFSET",b:["0"]}]}}]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FXAA_HLSL_5",1,{type:"equal_expr",d:2}],
group:{type:"group",a:[{type:"define",name:"FXAA_GATHER4_ALPHA",b:["1"]}]}}]},{type:"condition",a:[{type:"ifdef",name:"GL_ARB_gpu_shader5",group:{type:"group",a:[{type:"define",name:"FXAA_GATHER4_ALPHA",b:["1"]}]}}]},{type:"condition",a:[{type:"ifdef",name:"GL_NV_gpu_shader5",group:{type:"group",a:[{type:"define",name:"FXAA_GATHER4_ALPHA",b:["1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_GATHER4_ALPHA",group:{type:"group",a:[{type:"define",name:"FXAA_GATHER4_ALPHA",b:["0"]}]}}]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:[0],group:{type:"group",a:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",b:["4.0"]}]}}]},{type:"condition",a:[{type:"if",c:[0],group:{type:"group",a:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",b:["2.0"]}]}}]}]}}]},{type:"condition",a:[{type:"ifndef",
name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:[1],group:{type:"group",a:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",b:["0.125"]}]}},{type:"else",group:{type:"group",a:[{type:"define",name:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",b:["0.25"]}]}}]}]}}]},{type:"condition",a:[{type:"ifndef",name:"FXAA_QUALITY_PRESET",group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PRESET",b:["12"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",
10,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["3"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",b:["3.0"]},{type:"define",name:"FXAA_QUALITY_P2",b:["12.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",11,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["4"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},
{type:"define",name:"FXAA_QUALITY_P2",b:["3.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["12.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",12,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["5"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["12.0"]}]}}]},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",13,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["6"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["12.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",
14,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["7"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["12.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",
15,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["8"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["12.0"]}]}}]},{type:"condition",
a:[{type:"if",c:["FXAA_QUALITY_PRESET",20,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["3"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P1",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P2",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",21,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["4"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",
name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",22,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["5"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P4",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",23,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["6"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["8.0"]}]}}]},{type:"condition",
a:[{type:"if",c:["FXAA_QUALITY_PRESET",24,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["7"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["3.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["8.0"]}]}}]},{type:"condition",
a:[{type:"if",c:["FXAA_QUALITY_PRESET",25,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["8"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P7",
b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",26,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["9"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",
b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P8",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",27,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["10"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",
b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P9",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",28,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["11"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",
b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P10",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",
29,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["12"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P2",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P3",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P6",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["2.0"]},{type:"define",
name:"FXAA_QUALITY_P8",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",b:["8.0"]}]}}]},{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PRESET",39,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"define",name:"FXAA_QUALITY_PS",b:["12"]},{type:"define",name:"FXAA_QUALITY_P0",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P1",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P2",b:["1.0"]},{type:"define",
name:"FXAA_QUALITY_P3",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P4",b:["1.0"]},{type:"define",name:"FXAA_QUALITY_P5",b:["1.5"]},{type:"define",name:"FXAA_QUALITY_P6",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P7",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P8",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P9",b:["2.0"]},{type:"define",name:"FXAA_QUALITY_P10",b:["4.0"]},{type:"define",name:"FXAA_QUALITY_P11",b:["8.0"]}]}}]},{type:"var",name:"FXAA_QUALITY_P12",b:["0.0"]},{type:"textline",b:"float Av ( float Au ) { return clamp ( Au , 0.0 , 1.0 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_BLEND4WEB",1,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"vec4 Ay ( sampler2D Aw , vec2 Ax ) { return texture2D ( Aw , Ax ) ; } vec4 AD ( sampler2D Az , vec2 AA , vec2 AB , vec2 AC ) { return texture2D ( Az , AA + ( AB * AC ) ) ; }".split(" ")}]}}]},{type:"textline",b:"vec4 Bj ( vec2 AE , sampler2D AF , vec2 AG , float AH , float AI , float AJ ) { bool AK , AL , AM , AN , AO ; float AP , AQ , AR , AS , AT , AU , AV , AW , AX , AY , AZ , A_ , Ba , Bb , Bc ; vec4 Bd ; vec2 Be , Bf , Bg , Bh , Bi ; Be . x = AE . x ; Be . y = AE . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_GATHER4_ALPHA",1,{type:"equal_expr",d:2}],group:{type:"group",a:[]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"Bd = Ay ( AF , Be ) ; AP = bB ( Bd ) ; AQ = bB ( AD ( AF , Be , vec2 ( 0 , 1 ) , AG . xy ) ) ; AR = bB ( AD ( AF , Be , vec2 ( 1 , 0 ) , AG . xy ) ) ; AS = bB ( AD ( AF , Be , vec2 ( 0 , - 1 ) , AG . xy ) ) ; AT = bB ( AD ( AF , Be , vec2 ( - 1 , 0 ) , AG . xy ) ) ;".split(" ")}]}}]},{type:"textline",b:"AU = max ( AQ , AP ) ; AV = min ( AQ , AP ) ; AU = max ( AR , AU ) ; AV = min ( AR , AV ) ; AW = max ( AS , AT ) ; AX = min ( AS , AT ) ; AU = max ( AW , AU ) ; AV = min ( AX , AV ) ; AX = AU * AI ; AV = AU - AV ; AX = max ( AJ , AX ) ; AK = AV < AX ; if ( AK ) return Bd ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_GATHER4_ALPHA",0,{type:"equal_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"AX = bB ( AD ( AF , Be , vec2 ( - 1 , - 1 ) , AG . xy ) ) ; AU = bB ( AD ( AF , Be , vec2 ( 1 , 1 ) , AG . xy ) ) ; AW = bB ( AD ( AF , Be , vec2 ( 1 , - 1 ) , AG . xy ) ) ; AY = bB ( AD ( AF , Be , vec2 ( - 1 , 1 ) , AG . xy ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[]}}]},{type:"textline",b:"AZ = AS + AQ ; A_ = AT + AR ; AV = 1.0 / AV ; Ba = AZ + A_ ; AZ = ( - 2.0 * AP ) + AZ ; A_ = ( - 2.0 * AP ) + A_ ; Bb = AW + AU ; AW = AX + AW ; Bc = ( - 2.0 * AR ) + Bb ; AW = ( - 2.0 * AS ) + AW ; AX = AX + AY ; AU = AY + AU ; Bc = ( abs ( AZ ) * 2.0 ) + abs ( Bc ) ; AW = ( abs ( A_ ) * 2.0 ) + abs ( AW ) ; A_ = ( - 2.0 * AT ) + AX ; AU = ( - 2.0 * AQ ) + AU ; Bc = abs ( A_ ) + Bc ; AW = abs ( AU ) + AW ; Bb = AX + Bb ; AX = AG . x ; AK = Bc >= AW ; Bb = Ba * 2.0 + Bb ; if ( ! AK ) AS = AT ; if ( ! AK ) AQ = AR ; if ( AK ) AX = AG . y ; Bb = ( Bb * ( 1.0 / 12.0 ) ) - AP ; AR = AS - AP ; AT = AQ - AP ; AS = AS + AP ; AQ = AQ + AP ; AL = abs ( AR ) >= abs ( AT ) ; AT = max ( abs ( AR ) , abs ( AT ) ) ; if ( AL ) AX = - AX ; AV = Av ( abs ( Bb ) * AV ) ; Bf . x = Be . x ; Bf . y = Be . y ; Bg . x = ( ! AK ) ? 0.0 : AG . x ; Bg . y = ( AK ) ? 0.0 : AG . y ; if ( ! AK ) Bf . x += AX * 0.5 ; if ( AK ) Bf . y += AX * 0.5 ; Bh . x = Bf . x - Bg . x * FXAA_QUALITY_P0 ; Bh . y = Bf . y - Bg . y * FXAA_QUALITY_P0 ; Bi . x = Bf . x + Bg . x * FXAA_QUALITY_P0 ; Bi . y = Bf . y + Bg . y * FXAA_QUALITY_P0 ; Bb = ( ( - 2.0 ) * AV ) + 3.0 ; AR = bB ( Ay ( AF , Bh ) ) ; AV = AV * AV ; Ba = bB ( Ay ( AF , Bi ) ) ; if ( ! AL ) AS = AQ ; AT = AT * 1.0 / 4.0 ; AQ = AP - AS * 0.5 ; AV = Bb * AV ; AL = AQ < 0.0 ; AR -= AS * 0.5 ; Ba -= AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P1 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P1 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P1 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P1 ; if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P2 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P2 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P2 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P2 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",3,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P3 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P3 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P3 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P3 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",4,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P4 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P4 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P4 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P4 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",5,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P5 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P5 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P5 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",6,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P6 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P6 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P6 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P6 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",7,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P7 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P7 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P7 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P7 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",8,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P8 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P8 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P8 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P8 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",9,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P9 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P9 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P9 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P9 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",10,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P10 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P10 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P10 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P10 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",11,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P11 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P11 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P11 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P11 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_QUALITY_PS",12,{type:"g_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"if ( AO ) { if ( ! AM ) AR = bB ( Ay ( AF , Bh . xy ) ) ; if ( ! AN ) Ba = bB ( Ay ( AF , Bi . xy ) ) ; if ( ! AM ) AR = AR - AS * 0.5 ; if ( ! AN ) Ba = Ba - AS * 0.5 ; AM = abs ( AR ) >= AT ; AN = abs ( Ba ) >= AT ; if ( ! AM ) Bh . x -= Bg . x * FXAA_QUALITY_P12 ; if ( ! AM ) Bh . y -= Bg . y * FXAA_QUALITY_P12 ; AO = ( ! AM ) || ( ! AN ) ; if ( ! AN ) Bi . x += Bg . x * FXAA_QUALITY_P12 ; if ( ! AN ) Bi . y += Bg . y * FXAA_QUALITY_P12 ; }".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:"} AT = Be . x - Bh . x ; AS = Bi . x - Be . x ; if ( ! AK ) AT = Be . y - Bh . y ; if ( ! AK ) AS = Bi . y - Be . y ; AN = ( AR < 0.0 ) != AL ; AR = ( AS + AT ) ; AL = ( Ba < 0.0 ) != AL ; AR = 1.0 / AR ; AM = AT < AS ; AS = min ( AT , AS ) ; AL = AM ? AN : AL ; AV = AV * AV ; AR = ( AS * ( - AR ) ) + 0.5 ; AV = AV * AH ; AR = AL ? AR : 0.0 ; AV = max ( AR , AV ) ; if ( ! AK ) Be . x += AV * AX ; if ( AK ) Be . y += AV * AX ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FXAA_DISCARD",1,{type:"equal_expr",d:2},"FXAA_BLEND4WEB",1,{type:"equal_expr",d:2},{type:"logical_or_expr",d:2}],group:{type:"group",a:[{type:"textline",b:"return Ay ( AF , Be ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return vec4 ( Ay ( AF , Be ) . xyz , AP ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float Bq ( in sampler2D Bk , in vec2 Bl , in vec2 Bm ) { float Bn , Bo , Bp ; Bn = texture2D ( Bk , Bl ) . r ; Bo = Bm . x ; Bp = Bm . y ; Bo = 2.0 * Bo / ( Bo + Bp - ( 2.0 * Bn - 1.0 ) * ( Bp - Bo ) ) ; return Bo ; }".split(" ")}]}};b4w.module.animation=function(a,p){var d=p("__animation"),b=p("__armature"),c=p("__obj_util"),m=p("__print"),e=p("__tsr");a.SLOT_0=d.SLOT_0;a.SLOT_1=d.SLOT_1;a.SLOT_2=d.SLOT_2;a.SLOT_3=d.SLOT_3;a.SLOT_4=d.SLOT_4;a.SLOT_5=d.SLOT_5;a.SLOT_6=d.SLOT_6;a.SLOT_7=d.SLOT_7;a.SLOT_ALL=d.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=d.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=d.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=d.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=d.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=d.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=d.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=d.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=d.AB_CYCLIC;a.AB_FINISH_RESET=d.AB_FINISH_RESET;a.AB_FINISH_STOP=d.AB_FINISH_STOP;var t=e.create();a.is_animated=function(a){return d.is_animated(a)};a.get_actions=function(){m.W("get_actions","get_anim_names");for(var a=[],b=d.Nt(),c=0;c<b.length;c++)a.push(d.JF(b[c].name));return a};a.get_current_action=function(b,c){m.W("get_current_action","get_current_anim_name");return a.get_current_anim_name(b,
c)};a.get_anim_names=function(a){return d.fv(a)?d.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.gC(a,b)};a.apply=function(a,b,c){if(c>d.SLOT_7)m.error("Can't apply animation to slot "+c+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{c=c||d.SLOT_0;if(d.is_animated(a)){var e=d.get_slot_num_by_anim(a,b);if(-1!=e&&e!=c){m.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+e+'").');
return}}d.WG(a,b)?d.apply(a,b,c):m.error('No fcurves in action "'+b+'"')}};a.remove=function(a){d.remove(a)};a.remove_slot_animation=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.remove_slot_animation(a,b))};a.apply_def=function(a){d.apply_def(a)};a.play=function(a,b,c){d.is_animated(a)?(c=c||d.SLOT_0,d.play(a,b,c),d.update_object_animation(a,0,c,!0)):m.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){d.is_animated(a)&&(b=b||d.SLOT_0,d.stop(a,b))};a.is_play=function(a,
b){if(!d.is_animated(a))return!1;b=b||d.SLOT_0;return d.is_play(a,b)};a.set_current_frame_float=function(b,c,d){m.W("set_current_frame_float","set_frame");a.set_frame(b,c,d)};a.get_current_frame_float=function(b,c){m.W("get_current_frame_float","use get_frame");return a.get_frame(b,c)};a.set_frame=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_frame(a,b,c))};a.set_first_frame=function(a,b){d.is_animated(a)&&d.set_first_frame(a,b)};a.set_last_frame=function(a,b){if(d.is_animated(a)){b=b||d.SLOT_0;
var c=d.get_anim_start_frame(a,b),e=d.get_anim_length(a,b);d.set_frame(a,c+e-d.Ox,b)}};a.get_frame=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return d.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!d.is_animated(a))return 0;b=b||d.SLOT_0;return a.G[b]?d.get_speed(a,b):0};a.get_frame_range=function(a,b){m.Pg("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");
if(d.is_animated(a)){b=b||d.SLOT_0;var c=a.G[b];if(c)return[c.start,c.start+c.length]}return null};a.get_anim_start_frame=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.G[b])?d.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return d.is_animated(a)&&(b=b||d.SLOT_0,a.G[b])?d.get_anim_length(a,b):-1};a.cyclic=function(b,c,e){m.W("cyclic","set_behavior");a.set_behavior(b,c?d.AB_CYCLIC:d.AB_FINISH_RESET,e)};a.is_cyclic=function(a,b){m.W("is_cyclic","get_behavior");if(!d.is_animated(a))return!1;
b=b||d.SLOT_0;return d.is_cyclic(a,b)};a.set_behavior=function(a,b,c){d.is_animated(a)&&(c=c||d.SLOT_0,d.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!d.is_animated(a))return null;b=b||d.SLOT_0;return d.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,e){e=e||d.SLOT_0;d.is_animated(a)&&d.apply_smoothing(a,b,c,e)};a.update_object_animation=function(a,b,c,e){m.W("update_object_animation","set_frame");d.is_animated(a)&&(c=c||d.SLOT_0,d.update_object_animation(a,b||0,c,e||!1))};a.frame_to_sec=
function(a){return d.frame_to_sec(a)};a.get_bone_translation=function(a,d,e){m.W("get_bone_translation","armature.get_bone_tsr");if(!c.is_armature(a))return null;if(!b.Kj(a,d))return m.error('There is no bone: "',d,'" in "',a.name,'".'),null;e||(e=new Float32Array(3));b.get_bone_tsr(a,d,!1,!1,t);e[0]=t[0];e[1]=t[1];e[2]=t[2];return e};a.get_first_armature_object=function(){m.Pg("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return d.is_animated(a)&&b?d.get_slot_num_by_anim(a,
b):null};a.get_anim_type=function(a,b){return d.is_animated(a)?d.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return d.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.f.sf};a.set_skel_mix_factor=function(a,b,e){c.is_armature(a)?(b=Math.min(Math.max(b,0),1),a.f.sf!=b&&d.set_skel_mix_factor(a,b,e||0)):m.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,p){var d=p("__anchors");p("__print");a.attach_move_cb=d.attach_move_cb;a.detach_move_cb=d.detach_move_cb;a.is_anchor=d.is_anchor;a.get_element_id=d.get_element_id};b4w.module.armature=function(a,p){var d=p("__armature"),b=p("__obj_util"),c=p("__transform"),m=p("__print");a.get_bone_tsr=function(a,c,k){if(!b.is_armature(a))return null;if(!d.Kj(a,c))return m.error('There is no bone: "',c,'" in "',a.name,'".'),null;k||(k=new Float32Array(8));d.get_bone_tsr(a,c,!1,!1,k);return k};a.get_bone_tsr_rel=function(a,c,k){if(!b.is_armature(a))return null;if(!d.Kj(a,c))return m.error('There is no bone: "',c,'" in "',a.name,'".'),null;k||(k=new Float32Array(8));d.get_bone_tsr(a,
c,!1,!0,k);return k};a.set_bone_tsr=function(a,t,k){b.is_armature(a)&&(d.Kj(a,t)?(d.set_bone_tsr(a,t,k,!1),c.o(a)):m.error('There is no bone: "',t,'" in "',a.name,'".'))};a.set_bone_tsr_rel=function(a,t,k){b.is_armature(a)&&(d.Kj(a,t)?(d.set_bone_tsr(a,t,k,!0),c.o(a)):m.error('There is no bone: "',t,'" in "',a.name,'".'))}};b4w.module.assets=function(a,p){var d=p("__assets");a.AT_ARRAYBUFFER=d.AT_ARRAYBUFFER;a.AT_JSON=d.AT_JSON;a.AT_TEXT=d.AT_TEXT;a.AT_AUDIOBUFFER=d.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=d.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=d.AT_AUDIO_ELEMENT;a.enqueue=function(a,c,m,e){if(a.length)if(a.id)d.enqueue(a,c,m,e);else{for(var t=[],k=0;k<a.length;k++){var n=a[k];t.push({id:n[0],type:n[1],url:n[2],ed:n.ed?n.ed:"GET",uh:null,Vf:null,eb:n[3]})}d.enqueue(t,c,m,e)}}};b4w.module.camera=function(a,p){function d(a,c){n.W("camera.set_pivot","camera.target_set_trans_pivot");b.is_target_camera(a)?(h.copy(c,a.f.kb),g.o(a),k.sync_transform(a)):n.error("set_pivot(): Wrong object or camera move style")}var b=p("__camera");p("__config");var c=p("__constraints"),m=p("__container");p("__mat3");var e=p("__mat4"),t=p("__obj_util"),k=p("__physics"),n=p("__print"),g=p("__transform"),x=p("__tsr"),l=p("__util"),h=p("__vec3");p("__vec4");var v=new Float32Array(2),C=new Float32Array(3),
A=new Float32Array(3);new Float32Array(4);new Float32Array(9);var B={};a.MS_STATIC=b.MS_STATIC;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.static_set_look_at=function(a,c,d){b.is_static_camera(a)?(c=c||x.get_trans_view(a.f.h),b.set_look_at(a,c,d),g.o(a),k.sync_transform(a)):n.error("static_set_look_at(): Wrong camera object or camera move style")};a.static_set_rotation=function(a,c){b.is_static_camera(a)?(g.set_rotation(a,
c),g.o(a),k.sync_transform(a)):n.error("static_set_rotation(): Wrong camera object or camera move style")};a.static_get_rotation=function(a,c){if(!b.is_static_camera(a))return n.error("static_get_rotation(): Wrong camera object or camera move style"),null;c=c||new Float32Array(4);return g.get_rotation(a,c)};a.eye_set_look_at=function(a,d,e){b.is_eye_camera(a)?(d=d||x.get_trans_view(a.f.h),b.set_look_at(a,d,e),c.correct_up(a,l.AXIS_Y,!0),g.o(a),k.sync_transform(a)):n.error("eye_set_look_at(): Wrong camera object or camera move style")};
a.eye_rotate=function(a,c,d,e,f){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,d,e||!1,f||!1),g.o(a),k.sync_transform(a)):n.error("eye_rotate(): Wrong camera object or camera move style")};a.eye_set_vertical_limits=function(a,c){if(b.is_eye_camera(a)){var d=a.f;c?"number"!=typeof c.down||"number"!=typeof c.up?n.error("eye_set_vertical_limits(): Incorrect limits object."):(d.r=d.r||{},d.r.down=c.down,d.r.up=c.up,d.r.di=c.down,d.r.oj=c.up,d.r.camera_space=Boolean(c.camera_space),b.sv(a),g.o(a),k.sync_transform(a)):
d.r=null}else n.error("eye_set_vertical_limits(): Wrong camera object or camera move style")};a.eye_get_vertical_limits=function(a,c){if(!b.is_eye_camera(a))return n.error("eye_get_vertical_limits(): Wrong camera object or camera move style"),null;var d=a.f;return d.r?(c=c||{},d.r.camera_space?(c.down=d.r.di,c.up=d.r.oj):(c.down=d.r.down,c.up=d.r.up),c.camera_space=d.r.camera_space,c):null};a.eye_set_horizontal_limits=function(a,c){if(b.is_eye_camera(a)){var d=a.f;c?"number"!=typeof c.left||"number"!=
typeof c.right?n.error("eye_set_horizontal_limits(): Incorrect limits object."):(d.N=d.N||{},d.N.left=c.left,d.N.right=c.right,d.N.yi=c.left,d.N.Ti=c.right,d.N.camera_space=Boolean(c.camera_space),b.rv(a),g.o(a),k.sync_transform(a)):d.N=null}else n.error("eye_set_horizontal_limits(): Wrong camera object or camera move style")};a.eye_get_horizontal_limits=function(a,c){if(!b.is_eye_camera(a))return n.error("eye_get_horizontal_limits(): Wrong camera object or camera move style"),null;var d=a.f;return d.N?
(c=c||{},d.N.camera_space?(c.left=d.N.yi,c.right=d.N.Ti):(c.left=d.N.left,c.right=d.N.right),c.camera_space=d.N.camera_space,c):null};a.target_rotate=function(a,c,d,e,f){b.is_target_camera(a)?(b.rotate_target_camera(a,c,d,e||!1,f||!1),g.o(a),k.sync_transform(a)):n.error("target_rotate(): Wrong camera object or camera move style")};a.target_set_trans_pivot=function(a,c,d){b.is_target_camera(a)?(c=c||x.get_trans_view(a.f.h),d=d||a.f.kb,b.set_trans_pivot(a,c,d),g.o(a),k.sync_transform(a)):n.error("target_set_trans_pivot(): Wrong camera object or camera move style")};
a.target_set_distance=function(a,c){if(b.is_target_camera(a)){var d=g.Ji(a,a.f.kb),e=Math.max(0,c);g.move_local(a,0,e-d,0);g.o(a);k.sync_transform(a)}else n.error("target_set_distance(): Wrong camera object or camera move style")};a.target_get_distance=function(a){return b.is_target_camera(a)?g.Ji(a,a.f.kb):(n.error("target_get_distance(): Wrong camera object or camera move style"),0)};a.target_zoom_object=function(a,c){if(b.is_target_camera(a)){var d=g.get_object_center(c,!1,C),e=g.get_object_size(c),
f=b.Ot(a)/2,e=e/Math.sin(f),f=g.Ji(a,d);b.set_trans_pivot(a,x.get_trans_view(a.f.h),d);g.o(a);g.move_local(a,0,e-f,0);g.o(a);k.sync_transform(a)}else n.error("target_zoom_object(): Wrong camera object or camera move style")};a.target_get_pivot=function(a,c){if(!b.is_target_camera(a))return n.error("target_get_pivot(): Wrong camera object or camera move style"),null;c=c||new Float32Array(3);h.copy(a.f.kb,c);return c};a.target_set_distance_limits=function(a,c){b.is_target_camera(a)?c&&("number"!=typeof c.min||
"number"!=typeof c.max||c.min>c.max)?n.error("target_set_distance_limits(): Wrong limits object"):(b.apply_distance_limits(a,c),g.o(a),k.sync_transform(a)):n.error("target_set_distance_limits(): Wrong camera object or camera move style")};a.target_get_distance_limits=function(a,c){if(!b.is_target_camera(a))return n.error("target_get_distance_limits(): Wrong camera object or camera move style"),null;var d=a.f;return d.Wa?(c=c||{},c.min=d.Wa.min,c.max=d.Wa.max,c):null};a.target_set_vertical_limits=
function(a,c){if(b.is_target_camera(a)){var d=a.f;c?"number"!=typeof c.down||"number"!=typeof c.up?n.error("target_set_vertical_limits(): Wrong limits object"):(d.r=d.r||{},d.r.down=c.down,d.r.up=c.up,d.r.di=c.down,d.r.oj=c.up,d.r.camera_space=Boolean(c.camera_space),b.sv(a),g.o(a),k.sync_transform(a)):d.r=null}else n.error("target_set_vertical_limits(): Wrong camera object or camera move style")};a.target_get_vertical_limits=function(a,c){if(!b.is_target_camera(a))return n.error("target_get_vertical_limits(): Wrong camera object or camera move style"),
null;var d=a.f;return d.r?(c=c||{},d.r.camera_space?(c.down=d.r.di,c.up=d.r.oj):(c.down=d.r.down,c.up=d.r.up),c.camera_space=d.r.camera_space,c):null};a.target_set_horizontal_limits=function(a,c){if(b.is_target_camera(a)){var d=a.f;c?"number"!=typeof c.left||"number"!=typeof c.right?n.error("target_set_horizontal_limits(): Wrong limits object"):(d.N=d.N||{},d.N.left=c.left,d.N.right=c.right,d.N.yi=c.left,d.N.Ti=c.right,d.N.camera_space=Boolean(c.camera_space),b.rv(a),g.o(a),k.sync_transform(a)):d.N=
null}else n.error("target_set_horizontal_limits(): Wrong camera object or camera move style")};a.target_get_horizontal_limits=function(a,c){if(!b.is_target_camera(a))return n.error("target_get_horizontal_limits(): Wrong camera object or camera move style"),null;var d=a.f;return d.N?(c=c||{},d.N.camera_space?(c.left=d.N.yi,c.right=d.N.Ti):(c.left=d.N.left,c.right=d.N.right),c.camera_space=d.N.camera_space,c):null};a.hover_rotate=function(a,c,d,e,f){b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,d,
e||!1,f||!1),g.o(a),k.sync_transform(a)):n.error("hover_rotate(): Wrong camera object or camera move style")};a.hover_set_pivot_translation=function(a,c){b.is_hover_camera(a)?(b.set_hover_pivot(a,c),g.o(a),k.sync_transform(a)):n.error("hover_set_pivot_translation(): Wrong camera object or camera move style")};a.hover_get_pivot=function(a,c){if(!b.is_hover_camera(a))return n.error("hover_get_pivot(): Wrong camera object or camera move style"),null;c=c||new Float32Array(3);h.copy(a.f.Ea,c);return c};
a.hover_get_distance=function(a){return b.is_hover_camera(a)?g.Ji(a,a.f.Ea):(n.error("hover_get_distance(): Wrong camera object or camera move style"),0)};a.hover_set_vertical_limits=function(a,c){b.is_hover_camera(a)?"number"!=typeof c.down||"number"!=typeof c.up||c.down<c.up?n.error("hover_set_vertical_limits(): Wrong limits object"):(b.hover_set_vertical_limits(a,c),g.o(a),k.sync_transform(a)):n.error("hover_set_vertical_limits(): Wrong camera object or camera move style")};a.hover_get_vertical_limits=
function(a,c){if(!b.is_hover_camera(a))return n.error("hover_get_vertical_limits(): Wrong camera object or camera move style"),null;var d=a.f;c=c||{};c.down=d.r.down;c.up=d.r.up;return c};a.hover_set_distance_limits=function(a,c){b.is_hover_camera(a)?"number"!=typeof c.min||"number"!=typeof c.max||c.min>c.max?n.error("hover_set_distance_limits(): Wrong limits object"):(b.apply_distance_limits(a,c),g.o(a),k.sync_transform(a)):n.error("hover_set_distance_limits(): Wrong camera object or camera move style")};
a.hover_get_distance_limits=function(a,c){if(!b.is_hover_camera(a))return n.error("hover_get_distance_limits(): Wrong camera object or camera move style"),null;var d=a.f;c=c||{};c.min=d.Wa.min;c.max=d.Wa.max;return c};a.hover_set_vert_trans_limits=function(a,c){if(b.is_hover_camera(a)){var d=a.f;c?"number"!=typeof c.min||"number"!=typeof c.max||c.min>c.max?n.error("hover_set_vert_trans_limits(): Wrong limits object"):(d.tb=d.tb||{},d.tb.min=c.min,d.tb.max=c.max,g.o(a),k.sync_transform(a)):d.tb=null}else n.error("hover_set_vert_trans_limits(): Wrong camera object or camera move style")};
a.hover_get_vert_trans_limits=function(a,c){if(!b.is_hover_camera(a))return n.error("hover_get_vert_trans_limits(): Wrong camera object or camera move style"),null;var d=a.f;return d.tb?(c=c||{},c.min=d.tb.min,c.max=d.tb.max,c):null};a.hover_set_horiz_trans_limits=function(a,c){if(b.is_hover_camera(a)){var d=a.f;c?"number"!=typeof c.min||"number"!=typeof c.max||c.min>c.max?n.error("hover_set_horiz_trans_limits(): Wrong limits object"):(d.Xb=d.Xb||{},d.Xb.min=c.min,d.Xb.max=c.max,g.o(a),k.sync_transform(a)):
d.Xb=null}else n.error("hover_set_horiz_trans_limits(): Wrong camera object or camera move style")};a.hover_get_horiz_trans_limits=function(a,c){if(!b.is_hover_camera(a))return n.error("hover_get_horiz_trans_limits(): Wrong camera object or camera move style"),null;var d=a.f;return d.Xb?(c=c||{},c.min=d.Xb.min,c.max=d.Xb.max,c):null};a.is_static_camera=b.is_static_camera;a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,
c){if(!t.is_camera(a))return n.error("set_move_style(): Wrong camera object"),!1;if(c!=b.MS_STATIC&&c!=b.MS_EYE_CONTROLS&&c!=b.MS_TARGET_CONTROLS&&c!=b.MS_HOVER_CONTROLS)return n.error("set_move_style(): Wrong move style"),!1;b.set_move_style(a,c);g.o(a);k.sync_transform(a);return!0};a.get_move_style=function(a){return t.is_camera(a)?b.get_move_style(a):(n.error("get_move_style(): Wrong camera object"),null)};a.set_translation=function(a,c){if(t.is_camera(a)){var d=a.f;if(b.is_target_camera(a)){var e=
x.get_trans_view(d.h),e=h.subtract(c,e,C);h.add(e,d.kb,d.kb)}else b.is_hover_camera(a)&&(e=x.get_trans_view(d.h),e=h.subtract(c,e,C),h.add(e,d.Ea,d.Ea));g.set_translation(a,c);g.o(a);k.sync_transform(a)}else n.error("set_translation(): Wrong camera object")};a.get_translation=function(a,b){if(!t.is_camera(a))return n.error("get_translation(): Wrong camera object"),null;b=b||new Float32Array(3);return g.get_translation(a,b)};a.rotate_camera=function(a,c,d,e,f){t.is_camera(a)?(e=e||!1,f=f||!1,b.is_target_camera(a)?
b.rotate_target_camera(a,c,d,e,f):b.is_eye_camera(a)?b.rotate_eye_camera(a,c,d,e,f):b.is_hover_camera(a)?b.rotate_hover_camera(a,c,d,e,f):b.is_static_camera(a)||n.error("rotate_camera(): Wrong camera move style"),g.o(a),k.sync_transform(a)):n.error("rotate_camera(): Wrong camera object")};a.set_velocities=function(a,b){if(t.is_camera(a)){var c=a.f;"number"==typeof b.trans&&(c.ol=l.clamp(b.trans,0,Infinity));"number"==typeof b.rot&&(c.nl=l.clamp(b.rot,0,Infinity));"number"==typeof b.zoom&&(c.pl=l.clamp(b.zoom,
0,1))}else n.error("set_velocities(): Wrong camera object")};a.get_velocities=function(a,b){if(!t.is_camera(a))return n.error("get_velocities(): Wrong camera object"),null;var c=a.f;b=b||{};b.trans=c.ol;b.rot=c.nl;b.zoom=c.pl;return b};a.is_look_up=function(a){if(!t.is_camera(a))return n.error("is_look_up(): Wrong camera object"),!1;a=x.get_quat_view(a.f.h);return 0<=l.quat_to_dir(a,l.AXIS_MY,C)[1]};a.get_camera_angles=function(a,c){if(!t.is_camera(a))return n.error("get_camera_angles(): Wrong camera object"),
null;c=c||new Float32Array(2);b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){if(!t.is_camera(a))return n.error("get_camera_angles_char(): Wrong camera object"),null;c=c||new Float32Array(2);b.get_camera_angles_char(a,c);return c};a.set_stereo_distance=function(a,c){if(t.is_camera(a))for(var d=a.f.X,e=0;e<d.length;e++){var f=d[e];f.type!=b.Ob&&f.type!=b.Tb||b.gF(f,c,f.ve)}else n.error("set_stereo_distance(): Wrong camera object")};a.get_stereo_distance=function(a){if(!t.is_camera(a))return n.error("get_stereo_distance(): Wrong camera object"),
0;a=a.f.X;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.Ob||d.type==b.Tb)return d.al}return 0};a.translate_view=function(a,c,d,h){if(t.is_camera(a)){a=a.f.X;for(var f=0;f<a.length;f++){var g=a[f];g.pc||b.Zf(g,g.Pa);var k=C;k[0]=-c;k[1]=-d;k[2]=0;e.translate(g.lb,k,g.lb);e.rotateZ(g.lb,h,g.lb);b.Ls(g);b.yo(g)}}else n.error("translate_view(): Wrong camera object")};a.get_fov=function(a){return t.is_camera(a)?l.gn(a.f.X[0].Wc):(n.error("get_fov(): Wrong camera object"),0)};a.set_fov=function(a,
c){if(t.is_camera(a))for(var d=a.f.X,e=0;e<d.length;e++){var f=d[e];f.Wc=l.hB(c);f.pc||b.Zf(f,f.Pa);b.Ls(f);b.yo(f)}else n.error("set_fov(): Wrong camera object")};a.correct_up=function(a,b){t.is_camera(a)?(b=b||l.AXIS_Y,c.correct_up(a,b),g.o(a),k.sync_transform(a)):n.error("correct_up(): Wrong camera object")};a.set_ortho_scale=function(a,c){if(t.is_camera(a)&&b.is_ortho_camera(a)){var d=a.f;if(b.is_target_camera(a)){var e=x.get_trans_view(d.h),e=h.dist(e,d.kb);d.ti=c/2*d.si/e}else b.is_hover_camera(a)?
(e=x.get_trans_view(d.h),e=h.distance(e,d.Ea),d.ti=c/2*d.si/e):a.f.X[0].top=c/2;b.yG(a)}else n.error("set_ortho_scale(): Wrong camera object")};a.get_ortho_scale=function(a){return t.is_camera(a)&&b.is_ortho_camera(a)?2*a.f.X[0].top:(n.error("get_ortho_scale(): Wrong camera object"),0)};a.is_ortho_camera=function(a){return t.is_camera(a)?b.is_ortho_camera(a):(n.error("is_ortho_camera(): Wrong camera object"),!1)};a.calc_ray=function(a,c,d,e){if(!t.is_camera(a))return n.error("calc_ray(): Wrong camera object"),
null;e=e||new Float32Array(3);var f=a.f.X[0];switch(f.type){case b.bc:case b.Ae:case b.Ob:case b.Tb:var g=Math.tan(f.Wc*Math.PI/360),k=g*f.Pa;c=m.Bo(c,d,v,f);C[0]=(2*c[0]/f.width-1)*k;C[1]=-1;C[2]=(2*c[1]/f.height-1)*g;x.transform_dir_vec3(C,a.f.h,C);e[0]=C[0];e[1]=C[1];e[2]=C[2];h.normalize(e,e);return e;default:return n.error("calc_ray(): Non-compatible camera"),e}};a.project_point=function(a,c,d){if(!t.is_camera(a))return n.error("project_point(): Wrong camera object"),null;d=d||new Float32Array(2);
return b.project_point(a,c,d)};a.has_distance_limits=function(a){return b.is_target_camera(a)||b.is_hover_camera(a)?null!==a.f.Wa:(n.error("has_distance_limits(): wrong object"),!1)};a.has_vertical_limits=function(a){return b.is_target_camera(a)||b.is_eye_camera(a)?null!==a.f.r:(n.error("has_vertical_limits(): Wrong camera object"),!1)};a.has_horizontal_limits=function(a){return b.is_target_camera(a)||b.is_eye_camera(a)?null!==a.f.N:(n.error("has_horizontal_limits(): Wrong camera object"),!1)};a.move_pivot=
function(a,c,d){if(b.is_target_camera(a)){var e=a.f;if(e.Tw){var f=x.get_trans_view(e.h),f=h.subtract(f,e.kb,A);C[0]=c;C[1]=0;C[2]=d;h.scale(C,h.len(f),C);x.transform_dir_vec3(C,e.h,C);h.add(e.kb,C,e.kb);f=x.get_trans_view(e.h);h.add(f,C,f);g.o(a);k.sync_transform(a)}}else n.error("move_pivot(): wrong object")};a.set_velocity_params=function(a,b){n.W("set_velocity_params","set_velocities");if(t.is_camera(a)){var c=a.f;c.ol=l.clamp(b[0],0,Infinity);c.nl=l.clamp(b[1],0,Infinity);c.pl=l.clamp(b[2],0,
1)}else n.error("set_velocity_params(): Wrong camera object")};a.get_velocity_params=function(a,b){n.W("get_velocity_params","get_velocities");if(!t.is_camera(a))return n.error("get_velocity_params(): Wrong camera object"),null;b=b||new Float32Array(3);var c=a.f;b[0]=c.ol;b[1]=c.nl;b[2]=c.pl;return b};a.clear_horizontal_limits=function(a){n.Pg('camera.clear_horizontal_limits() deprecated, use camera.target_set_horizontal_limits(), camera.eye_set_horizontal_limits() or camera.hover_set_horiz_trans_limits() with passing NULL as the "limits" argument.');
t.is_camera(a)?b.is_target_camera(a)||b.is_eye_camera(a)?a.f.N=null:b.is_hover_camera(a)&&(a.f.Xb=null):n.error("clear_horizontal_limits(): Wrong camera object")};a.clear_vertical_limits=function(a){n.Pg('camera.clear_vertical_limits() deprecated, use camera.target_set_vertical_limits(), camera.eye_set_vertical_limits() or camera.hover_set_vert_trans_limits() with passing NULL as the "limits" argument.');t.is_camera(a)?b.is_target_camera(a)||b.is_eye_camera(a)?a.f.r=null:b.is_hover_camera(a)&&(a.f.tb=
null):n.error("clear_vertical_limits(): Wrong camera object")};a.clear_hover_angle_limits=function(){n.Pg("camera.clear_hover_angle_limits() deprecated, HOVER camera always has hover angle limits")};a.set_look_at=function(a,d,e,h){n.Qe("camera.set_look_at",["camera.static_set_look_at","camera.eye_set_look_at"]);h=h||l.AXIS_Y;b.set_look_at(a,d,e);c.correct_up(a,h,!0);g.o(a);k.sync_transform(a)};a.rotate_eye_camera=function(a,c,d,e,f){n.Qe("camera.rotate_eye_camera",["camera.eye_rotate","camera.rotate_camera"]);
b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,d,e,f),g.o(a),k.sync_transform(a)):n.error("rotate_eye_camera(): wrong object")};a.rotate_target_camera=function(a,c,d,e,f){n.Qe("camera.rotate_target_camera",["camera.target_rotate","camera.rotate_camera"]);b.is_target_camera(a)?(b.rotate_target_camera(a,c,d,e,f),g.o(a),k.sync_transform(a)):n.error("rotate_target_camera(): wrong object")};a.set_trans_pivot=function(a,c,d){n.W("camera.set_trans_pivot","camera.target_set_trans_pivot");b.is_target_camera(a)?
(b.set_trans_pivot(a,c,d),g.o(a),k.sync_transform(a)):n.error("set_trans_pivot(): Wrong object or camera move style")};a.zoom_object=function(a,c){n.W("camera.zoom_object","camera.target_zoom_object");if(b.is_target_camera(a)){g.get_object_center(c,!1,C);d(a,C);g.o(a);var e=g.get_object_size(c),h=b.Ot(a)/2,e=e/Math.sin(h),h=g.Ji(a,C);g.move_local(a,0,e-h,0);g.o(a);k.sync_transform(a)}else n.error("zoom_object(): wrong object")};a.set_pivot=d;a.rotate_hover_camera=function(a,c,d,e,f){n.W("camera.rotate_hover_camera",
"camera.hover_rotate");b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,d,e,f),g.o(a),k.sync_transform(a)):n.error("rotate_hover_camera(): wrong object")};a.get_hover_cam_pivot=function(a,c){n.W("camera.get_hover_cam_pivot","camera.hover_get_pivot");if(!b.is_hover_camera(a))return n.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));h.copy(a.f.Ea,c);return c};a.get_eye=function(a,c){n.W("camera.get_eye","camera.get_translation");return t.is_camera(a)?b.get_eye(a,c):(n.error("get_eye(): Wrong object"),
null)};a.get_pivot=function(a,c){n.W("camera.get_pivot","camera.target_get_pivot");if(!b.is_target_camera(a))return n.error("get_pivot(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));h.copy(a.f.kb,c);return c};a.hover_cam_set_translation=function(a,c){n.W("camera.hover_cam_set_translation","camera.set_translation");if(b.is_hover_camera(a)){var d=a.f,e=x.get_trans_view(d.h),e=h.subtract(c,e,C);h.add(e,d.Ea,d.Ea);g.set_translation(a,c);g.o(a);k.sync_transform(a)}else n.error("hover_cam_set_translation(): wrong object")};
a.set_hover_pivot=function(a,c){n.W("camera.set_hover_pivot","camera.hover_set_pivot_translation");b.is_hover_camera(a)?(b.set_hover_pivot(a,c),g.o(a),k.sync_transform(a)):n.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){n.W("camera.get_hover_angle_limits","camera.hover_get_vertical_limits");if(!b.is_hover_camera(a))return n.error("get_hover_angle_limits(): wrong object"),null;c=c||new Float32Array(2);c[0]=a.f.r.down;c[1]=a.f.r.up;return c};a.get_cam_dist_limits=
function(a,c){n.Qe("camera.get_cam_dist_limits",["camera.hover_get_distance_limits","camera.target_get_distance_limits"]);if(!b.is_hover_camera(a)&&!b.is_target_camera(a))return n.error("get_cam_dist_limits(): wrong object"),null;if(a.f.Wa)c=c||new Float32Array(2),c[0]=a.f.Wa.max,c[1]=a.f.Wa.min;else return null;return c};a.apply_vertical_limits=function(c,d,e,h){n.Qe("camera.apply_vertical_limits",["camera.eye_set_vertical_limits","camera.target_set_vertical_limits","camera.hover_set_vert_trans_limits"]);
if(b.is_target_camera(c)){var f=B;f.down=d;f.up=e;f.camera_space=h==g.SPACE_LOCAL;a.target_set_vertical_limits(c,f)}else b.is_eye_camera(c)?(f=B,f.down=d,f.up=e,f.camera_space=h==g.SPACE_LOCAL,a.eye_set_vertical_limits(c,f)):b.is_hover_camera(c)?(f=B,f.min=d,f.max=e,a.hover_set_vert_trans_limits(c,f)):n.error("apply_vertical_limits(): wrong object")};a.apply_hover_angle_limits=function(b,c,d){n.W("camera.apply_hover_angle_limits","camera.hover_set_vertical_limits");B.down=c;B.up=d;a.hover_set_vertical_limits(b,
B)};a.apply_distance_limits=function(c,d,e){n.Qe("camera.apply_distance_limits",["camera.target_set_distance_limits","camera.hover_set_distance_limits"]);if(b.is_target_camera(c)){var h=B;h.min=d;h.max=e;a.target_set_distance_limits(c,h)}else b.is_hover_camera(c)?(h=B,h.min=d,h.max=e,a.hover_set_distance_limits(c,h)):n.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(b){n.W("camera.clear_distance_limits","camera.target_set_distance_limits");a.target_set_distance_limits(b,
null)};a.get_vertical_limits=function(a,c){n.Qe("camera.get_vertical_limits",["camera.eye_get_vertical_limits","camera.target_get_vertical_limits","camera.hover_get_vert_trans_limits"]);if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return n.error("get_vertical_limits(): wrong object"),null;var d=a.f;c=c||new Float32Array(2);if(b.is_eye_camera(a)||b.is_target_camera(a)){if(d.r)return c[0]=d.r.down,c[1]=d.r.up,c}else if(b.is_hover_camera(a)&&d.tb)return c[0]=d.tb.min,c[1]=d.tb.max,
c;return null};a.apply_horizontal_limits=function(c,d,e,h){n.Qe("camera.apply_horizontal_limits",["camera.eye_set_horizontal_limits","camera.target_set_horizontal_limits","camera.hover_set_horiz_trans_limits"]);if(b.is_target_camera(c)){var f=B;f.left=d;f.right=e;f.camera_space=h==g.SPACE_LOCAL;a.target_set_horizontal_limits(c,f)}else b.is_eye_camera(c)?(f=B,f.left=d,f.right=e,f.camera_space=h==g.SPACE_LOCAL,a.eye_set_horizontal_limits(c,f)):b.is_hover_camera(c)?(f=B,f.min=d,f.max=e,a.hover_set_horiz_trans_limits(c,
f)):n.error("apply_horizontal_limits(): wrong object")};a.get_horizontal_limits=function(a,c){n.Qe("camera.get_horizontal_limits",["camera.eye_get_horizontal_limits","camera.target_get_horizontal_limits","camera.hover_get_horiz_trans_limits"]);if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return n.error("get_horizontal_limits(): wrong object"),null;var d=a.f;c=c||new Float32Array(2);if(b.is_eye_camera(a)||b.is_target_camera(a)){if(d.N)return c[0]=d.N.left,c[1]=d.N.right,c}else if(b.is_hover_camera(a)&&
d.Xb)return c[0]=d.Xb.min,c[1]=d.Xb.max,c;return null}};b4w.module.config=function(a,p){var d=p("__config");a.P_LOW=d.P_LOW;a.P_HIGH=d.P_HIGH;a.P_ULTRA=d.P_ULTRA;a.P_CUSTOM=d.P_CUSTOM;a.set=d.set;a.get=d.get;a.reset=d.reset;a.get_std_assets_path=d.get_std_assets_path};b4w.module.controls=function(a,p){var d=p("__controls"),b=p("__print");a.CT_CONTINUOUS=d.CT_CONTINUOUS;a.CT_TRIGGER=d.CT_TRIGGER;a.CT_SHOT=d.CT_SHOT;a.CT_LEVEL=d.CT_LEVEL;a.CT_CHANGE=d.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_A=
65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;
a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=d.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=d.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=d.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=d.create_custom_sensor;a.create_keyboard_sensor=d.create_keyboard_sensor;a.create_collision_sensor=function(a,b,e){return d.create_collision_sensor(a,b||"ANY",
e||!1)};a.create_collision_impulse_sensor=d.create_collision_impulse_sensor;a.create_ray_sensor=function(a,b,e,t,k,n,g){return d.create_ray_sensor(a,b,e,t||"ANY",k||!1,n||!1,g||!1)};a.create_mouse_click_sensor=d.create_mouse_click_sensor;a.create_mouse_wheel_sensor=d.create_mouse_wheel_sensor;a.create_mouse_move_sensor=d.create_mouse_move_sensor;a.create_touch_move_sensor=d.create_touch_move_sensor;a.create_touch_zoom_sensor=d.create_touch_zoom_sensor;a.create_motion_sensor=d.create_motion_sensor;
a.create_vertical_velocity_sensor=d.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=d.create_gyro_angles_sensor;a.create_gyro_delta_sensor=d.create_gyro_delta_sensor;a.create_timer_sensor=function(a,b){return d.create_timer_sensor(a,b||!1)};a.reset_timer_sensor=d.reset_timer_sensor;a.create_elapsed_sensor=d.create_elapsed_sensor;a.create_timeline_sensor=d.create_timeline_sensor;a.create_selection_sensor=function(a,b){return d.create_selection_sensor(a,b||!1)};a.set_custom_sensor=function(a,
b){d.RE(a,b)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=d.get_sensor_value;a.get_sensor_payload=d.get_sensor_payload;a.create_sensor_manifold=function(a,b,e,t,k,n,g){k=k||d.ot;d.create_sensor_manifold(a,b,e,t,k,n,void 0===g?null:g)};a.create_kb_sensor_manifold=function(a,b,e,t,k,n){t=d.create_keyboard_sensor(t);d.create_sensor_manifold(a,b,e,[t],d.ot,k,void 0===n?null:n)};a.check_sensor_manifolds=function(a){return d.check_sensor_manifold(a,null)};a.check_sensor_manifold=
d.check_sensor_manifold;a.remove_sensor_manifolds=function(a){b.W("remove_sensor_manifolds","remove_sensor_manifold");d.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=d.remove_sensor_manifold;a.reset=d.reset;a.register_keyboard_events=d.register_keyboard_events;a.register_mouse_events=function(a,b,e){d.register_mouse_events(a,b,!!e)};a.register_wheel_events=d.register_wheel_events;a.register_touch_events=d.register_touch_events;a.register_device_orientation=d.register_device_orientation;
a.unregister_keyboard_events=d.unregister_keyboard_events;a.unregister_mouse_events=d.unregister_mouse_events;a.unregister_wheel_events=d.unregister_wheel_events;a.unregister_touch_events=d.unregister_touch_events;a.unregister_device_orientation=d.unregister_device_orientation};b4w.module.constraints=function(a,p){var d=p("__camera"),b=p("__constraints"),c=p("__obj_util"),m=p("__physics"),e=p("__print"),t=p("__transform");a.append_stiff=function(a,c,d,e,l){l=l||1;c instanceof Array&&2==c.length?b.ez(a,c[0],c[1],d,e,l):b.ss(a,c,d,e,l);t.o(a);m.sync_transform(a)};a.append_semi_stiff=function(a,c,d,e){b.dz(a,c,d,e);t.o(a);m.sync_transform(a)};a.append_semi_stiff_cam=function(a,c,g,p,l,h,v,C){d.is_eye_camera(a)?(b.cz(a,c,g,p,l,h,v,C),t.o(a),m.sync_transform(a)):e.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented.")};
a.append_semi_soft_cam=function(a,c,g,p){if(d.is_eye_camera(a)){if(!p||0>p)p=.25;b.bz(a,c,g,p);t.o(a);m.sync_transform(a)}else e.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_stiff_trans=function(a,c,d){b.gz(a,c,d);t.o(a);m.sync_transform(a)};a.append_copy_trans=function(a,c,d){b.Xy(a,c,d);t.o(a);m.sync_transform(a)};a.append_stiff_trans_rot=function(a,c,d,e){b.hz(a,c,d,e);t.o(a);m.sync_transform(a)};a.append_track=function(a,c){3==c.length?
b.kz(a,c):b.jz(a,c);t.o(a);m.sync_transform(a)};a.append_follow=function(a,c,d,e){3==c.length?b.Zy(a,c,d,e):b.Yy(a,c,d,e);t.o(a);m.sync_transform(a)};a.append_stiff_viewport=function(a,c,d){b.append_stiff_viewport(a,c,d);t.o(a);m.sync_transform(a)};a.remove=function(a){a.Va&&b.remove(a)};a.get_parent=function(a){e.W("constraints.get_parent","objects.get_parent");return c.get_parent(a)}};b4w.module.container=function(a,p){var d=p("__container"),b=p("__print");a.get_canvas=d.get_canvas;a.get_canvas_hud=d.get_canvas_hud;a.get_container=d.get_container;a.insert_to_container=function(a,m){2!=arguments.length?b.error("insert_to_container(): two arguments required"):a&&m&&d.insert_to_container(a,m)};a.set_canvas_offsets=d.set_canvas_offsets;a.update_canvas_offsets=d.update_canvas_offsets;a.client_to_canvas_coords=d.client_to_canvas_coords;a.force_offsets_updating=d.force_offsets_updating;
a.resize=function(a,m,e){a&&m||b.warn("Wrong canvas container dimensions: "+a+"x"+m+". Zero dimensions aren't allowed. Resized to: "+d.Sn+"x"+d.Rn+".");d.resize(a,m,e)}};b4w.module.data=function(a,p){var d=p("__data");p("__print");p("__util");a.load=d.load;a.unload=function(a){d.unload(a|0)};a.set_debug_resources_root=d.set_debug_resources_root;a.is_primary_loaded=d.is_primary_loaded;a.load_and_add_new=d.load;a.cleanup=a.unload};b4w.module.debug=function(a,p){function d(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function b(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function c(a){a.sort(function(a,b){return b.sp.ALU_OPS-a.sp.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.sp,e=c.dH,g=m(c.XA),g=g?"\t\t("+g.join(", ")+")":"\t\t(NA)";h.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",e.ALU_OPS,"TEX",e.TEX_OPS,g);h.groupCollapsed("directives");for(var g=c.nb.Cf,k=0;k<g.length;k++){var l=g[k];h.log(l[0],l[1])}h.groupEnd();h.groupCollapsed("vert src");
h.log(c.cH);h.groupEnd();h.groupCollapsed("vert stats");for(var n in e)"ALU_OPS"!=n&&"TEX_OPS"!=n&&h.log(n,e[n]);h.groupEnd();h.groupCollapsed("frag src");h.log(c.RB);h.groupEnd();h.groupCollapsed("frag stats");for(n in d)"ALU_OPS"!=n&&"TEX_OPS"!=n&&h.log(n,d[n]);h.groupEnd();h.groupEnd()}}function m(a){for(var b=v.mi(),c=0;c<b.length;c++)for(var d=b[c],e=g.wa(d,"MESH",g.DATA_ID_ALL),h=0;h<e.length;h++){var k=x.Sa(e[h],d);if(k&&k.V.length)for(var k=k.V,l=0;l<k.length;l++){var m=k[l];if(m.Sb==a&&m.Zc.length)return m.Zc}}return null}
p("__batch");p("__config");var e=p("__controls"),t=p("__debug"),k=p("__extensions"),n=p("__loader"),g=p("__objects"),x=p("__obj_util"),l=p("__physics"),h=p("__print"),v=p("__scenes"),C=p("__scenegraph"),A=p("__sfx"),B=p("__shaders"),q=p("__textures"),z=p("__util"),u=p("vec3");a.WM_NONE=t.WM_NONE;a.WM_OPAQUE_WIREFRAME=t.WM_OPAQUE_WIREFRAME;a.WM_TRANSPARENT_WIREFRAME=t.WM_TRANSPARENT_WIREFRAME;a.WM_FRONT_BACK_VIEW=t.WM_FRONT_BACK_VIEW;a.WM_DEBUG_SPHERES=t.WM_DEBUG_SPHERES;a.physics_stats=function(){l.eB()};
a.physics_id=function(a){h.log("O",l.GB(a));for(var b=l.fC().ob.q,c=0;c<b.length;c++){var d=b[c];d.n.v==a&&h.log("B",d)}};a.visible_objects=function(){for(var a=v.get_active(),b=g.wa(a,"MESH",g.DATA_ID_ALL),a=[v.ia(a,"MAIN_OPAQUE"),v.ia(a,"MAIN_BLEND")],c=0;c<a.length;c++){var d=a[c],e=d.q;if(e.length){h.group(d.type,"DYNAMIC");for(var k=0;k<b.length;k++){var l=b[k],m=l.f;if("DYNAMIC"==m.type)for(var n=0;n<e.length;n++){var t=e[n];if(t.yb&&t.Rd==m){h.fq(l.name,l);break}}}h.groupEnd();h.groupCollapsed(d.type,
"STATIC");for(k=0;k<b.length;k++)if(l=b[k],m=l.f,"DYNAMIC"!=m.type)for(n=0;n<e.length;n++)if(t=e[n],t.yb&&t.Rd==m){h.fq(l.name,l);break}h.groupEnd()}}};a.object_info=function(a){for(var b=v.get_active(),c=g.wa(b,"MESH",g.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];if(e.name==a){h.log("Object",e);for(var k=v.yp(b),l=0;l<k.length;l++){for(var m=k[l],n=m.q,t=[],p=0;p<n.length;p++)n[p].Rd==e.f&&t.push(n[p]);h.log("Subscene "+m.type,t)}}}};a.objects_stat=function(){var a=v.get_active();console.log("Armatures: "+
g.wa(a,"ARMATURE",g.DATA_ID_ALL).length);console.log("Cameras: "+g.wa(a,"CAMERA",g.DATA_ID_ALL).length);console.log("Curves: "+g.wa(a,"CURVE",g.DATA_ID_ALL).length);console.log("Empties: "+g.wa(a,"EMPTY",g.DATA_ID_ALL).length);console.log("Lamps: "+g.wa(a,"LAMP",g.DATA_ID_ALL).length);console.log("Meshes: "+g.wa(a,"MESH",g.DATA_ID_ALL).length);console.log("Speakers: "+g.wa(a,"SPEAKER",g.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=v.get_active(),b=[v.ia(b,"MAIN_OPAQUE"),v.ia(b,"MAIN_BLEND")],
c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.q,e=0;e<d.length;e++){var h=d[e].D;h&&(a+=h.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=v.get_active(),b=[v.ia(b,"MAIN_OPAQUE"),v.ia(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.q,e=0;e<d.length;e++){var h=d[e].D;h&&(a+=h.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=v.get_active(),b=[v.ia(a,"MAIN_OPAQUE"),v.ia(a,"MAIN_BLEND")],b=b[0].q.length+b[1].q.length,a=v.tw(a,["MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"]),
c=0;c<a.length;c++)var d=a[c],b="MAIN_PLANE_REFLECT"==d.type?b+d.q.length:b+6*d.q.length;return b};a.num_shaders=function(){return z.qk(B.St())};a.geometry_stats=function(){for(var a=v.get_active(),b=v.yp(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.q,h=0;h<e.length;h++){var g=e[h].D,k=e[h].Rd;g&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||k.Xm||k.Wm)&&(a[g.id]=g)}}var e=d=c=b=0,l;for(l in a)g=a[l],g=g.S,g.hm&&(d++,e+=g.hm/1048576),b++,c+=g.nt/1048576;
return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=v.get_active(),c=[v.ia(c,"MAIN_OPAQUE"),v.ia(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.q,h=0;h<e.length;h++){var g=e[h].D;if(g)for(var g=g.Z,k=0;k<g.length;k++){var l=g[k];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var m=l.Oa;-1===a.indexOf(m)&&(a.push(m),l=l.width*l.height*4/1048576/l.Ko,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=
function(){for(var a=[],b=0,c=v.get_active(),c=v.yp(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var h=e.j,g=[h.xb,h.wd];g.push.apply(g,e.we);for(e=0;e<g.length;e++){var k=g[e];q.wi(k)&&-1==a.indexOf(k)&&(a.push(k),b+=h.width*h.height*q.DC(k))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=v.get_active();(a=v.ia(a,"MAIN_OPAQUE"))&&v.Nu(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=v.get_active(),b=v.ia(a,"MAIN_OPAQUE"),a=v.tw(a,["SHADOW_CAST"]);
if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}v.Nu(d.j,b,e)}};a.scenegraph_to_dot=function(){for(var a=v.mi(),b=0;b<a.length;b++)h.log("\n"+C.bB(v.Wt(a[b])))};a.scenes_to_dot=function(){};a.loading_graph_to_dot=function(){h.log("\n"+n.JC())};a.controls_info=e.debug;a.object_distance=function(a,b){var c=m_tsr.get_trans_view(a.f.h),d=m_tsr.get_trans_view(b.f.h);return u.dist(c,d)};a.msg=t.msg;a.fbmsg=t.fbmsg;
a.print_telemetry=t.print_telemetry;a.plot_telemetry=t.plot_telemetry;a.fbres=function(a,b){function c(){t.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),h=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),k=new Float32Array([0,0,-1]);if(!z.xf(a,z.cs))throw"Wrong VEC3_IDENT";if(!z.xf(b,z.bs))throw"Wrong QUAT4_IDENT";if(!z.xf(c,
z.AXIS_X))throw"Wrong AXIS_X";if(!z.xf(d,z.AXIS_Y))throw"Wrong AXIS_Y";if(!z.xf(e,z.AXIS_Z))throw"Wrong AXIS_Z";if(!z.xf(h,z.AXIS_MX))throw"Wrong AXIS_MX";if(!z.xf(g,z.AXIS_MY))throw"Wrong AXIS_MY";if(!z.xf(k,z.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=A.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==A.Bp(c)&&A.mute(c,!0)}};a.check_finite=function(a){t.check_finite(a)};a.set_debug_params=function(a){var b=v.get_active();if(b=v.ia(b,"WIREFRAME")){if("number"==
typeof a.wireframe_mode)switch(a.wireframe_mode){case t.WM_NONE:case t.WM_OPAQUE_WIREFRAME:case t.WM_TRANSPARENT_WIREFRAME:case t.WM_FRONT_BACK_VIEW:case t.WM_DEBUG_SPHERES:v.lF(b,a.wireframe_mode);break;default:h.error("set_debug_params(): Wrong wireframe mode")}"object"==typeof a.wireframe_edge_color&&v.kF(b,a.wireframe_edge_color)}else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return h.rC()};a.get_warning_quantity=function(){return h.HC()};a.clear_errors_warnings=function(){return h.clear_errors_warnings()};
a.analyze_shaders=function(a){var e=B.St(),g=0,l;for(l in e)a&&-1===l.indexOf(a)||g++;var g="of "+g+" analyzing...",m={};for(l in e)if(!a||-1!==l.indexOf(a)){var n=e[l],t;var p=n.Mr;t=n.It;var q=k.Tt();if(q){p=q.getTranslatedShaderSource(p);t=q.getTranslatedShaderSource(t);p=p.replace("#version","#version 400 //");t=t.replace("#version","#version 400 //");var q=b("/nvidia_vert",p),u=d(q),v=b("/nvidia_frag",t),x=d(v);t={cH:p,kK:q,dH:u,RB:t,JI:v,sp:x}}else h.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),
t=void 0;q=n.nb;p=q.sj+" + "+q.ji;t.XA=n;t.nb=q;n=m[p]=m[p]||[];n.push(t);h.log(g)}for(p in m)h.group("%c"+p,"color: #800"),n=m[p],c(n),h.groupEnd()};a.fake_load=t.fake_load};b4w.module.geometry=function(a,p){var d=p("__batch"),b=p("__geometry"),c=p("__print"),m=p("__renderer");a.extract_vertex_array=function(a,m,k){if(!b.qi(a))return c.error("Wrong object:",a.name),null;if(a=d.Ca(a,m,"MAIN")){if((m=a.S)&&m.Yb&&m.Yb[k])return b.zB(m,k);c.error("Attribute not found:"+k);return null}c.error("Wrong material:",m);return null};a.extract_index_array=function(a,m){if(!b.qi(a))return c.error("Wrong object:",a.name),null;var k=d.Ca(a,m,"MAIN");if(k){if((k=k.S)&&k.Yb)return k.If;
c.error("Buffer data not found");return null}c.error("Wrong material:",m);return null};a.update_vertex_array=function(a,m,k,n){var g=["MAIN","DEPTH","COLOR_ID"];if(b.qi(a))for(var p=0;p<g.length;p++){var l=d.Ca(a,m,g[p]);l&&(l=l.S)&&l.Yb&&l.Yb[k]&&b.Fn(l,k,0,n)}else c.error("Wrong object:",a.name)};a.override_geometry=function(a,p,k,n,g){var x=["MAIN","DEPTH","COLOR_ID"];if(b.qi(a))if(k instanceof Uint16Array||k instanceof Uint32Array)if(n instanceof Float32Array)for(var l=0;l<x.length;l++){var h=
d.Ca(a,p,x[l]);if(h){var v=h.S;if(v){b.mG(v,h.Ne,k);var C=0,A;for(A in v.Yb)var B=v.Yb[A],C=C+n.length/3*B.oe;v.od=new Float32Array(C);var C=v.od,q=0;for(A in v.Yb)switch(B=v.Yb[A],A){case "a_position":C.set(n,q);B.offset=q;B.length=n.length;q+=B.length;break;case "a_normal":var z;g&&(z=b.Js(k,n,n));var u=b.Is(k,n,z);C.set(u,q);B.offset=q;B.length=n.length;q+=B.length;break;case "a_tangent":B.offset=q;B.length=n.length/3*B.oe;for(var u=new Float32Array(B.length),r=0;r<u.length;r+=4)u[r]=1,u[r+3]=
1;C.set(u,q);q+=B.length;break;default:B.offset=q,B.length=n.length/3*B.oe,u=new Float32Array(B.length),C.set(u,q),q+=B.length}b.Mw(v);m.vs(h);(h=d.Vc(a,h))&&h.S&&(h.S=v)}}}else c.error("Wrong positions_array type");else c.error("Wrong ibo_array type");else c.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,d,k){b.check_shape_keys(a)?b.Hp(a,d)?b.ts(a,d,parseFloat(k)):c.error("Wrong key name:",d):c.error("Wrong object:",a.name)};a.check_shape_keys=function(a){return b.check_shape_keys(a)};
a.get_shape_keys_names=function(a){return b.check_shape_keys(a)?b.get_shape_keys_names(a):(c.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,d){return b.check_shape_keys(a)?b.Hp(a,d)?b.get_shape_key_value(a,d):(c.error("Wrong key name:",d),null):(c.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,p){var d=p("__hud");p("__print");a.draw_mixer_strip=d.draw_mixer_strip;a.plot_array=d.plot_array};b4w.module.lights=function(a,p){function d(a){for(var b=k.get_active(),d=m.wa(b,"LAMP",m.DATA_ID_ALL),e=0;e<d.length;e++){var p=d[e];if("SUN"==p.Fa.type){var r=p;break}}r?"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(d=(90-a.vert_position)/180*Math.PI,e=r.f,n.set_rotation_euler(r,[d,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),p=g.get_quat_view(e.h),x.quat_to_dir(p,x.AXIS_Y,a),e=g.get_trans_view(e.h),e=l.length(e),l.copy(a,h),l.scale(h,e,h),n.set_translation(r,
h),n.o(r),a=r.Fa,a.vt&&(e=b.world.light_settings.environment_energy,p=Math.cos(Math.abs(d)),d=Math.max(Math.min(3*p,1),0)*a.qt,e*=Math.max(p,.1),c.Wq(a,d),k.set_environment_colors(b,e,null,null)),k.Gn(r,b)):t.error("There is no sun on the scene")}function b(a){if(e.is_lamp(a))return a.Fa.type;t.error("get_light_type(): Wrong object");return!1}var c=p("__lights"),m=p("__objects"),e=p("__obj_util"),t=p("__print"),k=p("__scenes"),n=p("__transform"),g=p("__tsr"),x=p("__util"),l=p("__vec3"),h=new Float32Array(3),
v,C=60;a.get_lamps=function(a){var b=k.get_active(),b=m.wa(b,"LAMP",m.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.Fa.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=k.get_active(),a=m.wa(a,"LAMP",m.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.Fa.type){b=d;break}}return b?(b=b.Fa.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=
b,c):null};a.set_sun_params=d;a.set_day_time=function(a){for(var b=k.get_active(),b=m.wa(b,"LAMP",m.DATA_ID_ALL),c=0;c<b.length;c++){var e=b[c];if("SUN"==e.Fa.type){var h=e;break}}h?(h=-Math.cos(a/12*Math.PI)*C,b={},b.hor_position=12>a?15*a:15*(a-24),b.vert_position=h,d(b)):t.error("There is no sun on the scene")};a.set_date=function(a){(v=a.getDate())?1582==v&&10==a.GJ&&4<a.aB&&15>a.aB&&t.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):t.error("There is no year 0 in the Julian system!")};
a.set_max_sun_angle=function(a){C=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(e.is_lamp(a))var c=a.Fa;else return t.error("get_light_params(): Wrong object"),!1;if(a=b(a))switch(a){case "SPOT":var d={light_type:a,light_color:c.color,light_energy:c.Pe,light_spot_blend:c.Zk,light_spot_size:c.gf,light_distance:c.distance};break;case "POINT":d={light_type:a,light_color:c.color,light_energy:c.Pe,light_distance:c.distance};break;default:d={light_type:a,light_color:c.color,light_energy:c.Pe}}return d?
d:!1};a.get_light_type=b;a.set_light_params=function(a,b){if(e.is_lamp(a)){var d=a.Fa,h=k.get_active();"number"==typeof b.light_energy&&c.Wq(d,b.light_energy);"object"==typeof b.light_color&&c.Sv(d,b.light_color);"number"==typeof b.light_spot_blend&&c.aF(d,b.light_spot_blend);"number"==typeof b.light_spot_size&&c.bF(d,b.light_spot_size);"number"==typeof b.light_distance&&c.$E(d,b.light_distance);k.Gn(a,h);m.cG(h)}else t.error("set_light_params(): Wrong object")}};b4w.module.material=function(a,p){function d(a,b){for(var c=a.K[0].V,d=0;d<c.length;d++){var e=c[d];if(-1<e.Zc.indexOf(b))return"MAIN"==e.type}return!1}function b(a,b){var c=m.Ca(a,b,"MAIN");return Boolean(c&&c.Kc[0])}function c(a,b){var c=m.Ca(a,b,"MAIN");return Boolean(c&&c.Kc[1])}var m=p("__batch"),e=p("__config"),t=p("__obj_util"),k=p("__print"),n=p("__shaders"),g=e.p;a.inherit_material=function(a,b,c,d){t.Sp(c)&&t.Sp(a)?m.inherit_material(a,b,c,d):k.error("Wrong or batched object(s)")};a.get_materials_names=
function(a){var b=[];a=a.K;for(var c=0;c<a.length;c++)for(var d=a[c].V,e=0;e<d.length;e++)for(var g=0;g<d[e].Zc.length;g++)-1==b.indexOf(d[e].Zc[g])&&b.push(d[e].Zc[g]);return b};a.set_diffuse_color=function(a,b,c){var d=m.Ca(a,b,"MAIN");d?(d.yc.set(c),(a=m.Vc(a,b,"MAIN"))&&a.yc.set(c)):k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=m.Ca(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.yc);return d}k.error('Couldn\'t get property "diffuse_color"!')};
a.set_diffuse_intensity=function(a,b,c){var d=m.Ca(a,b,"MAIN");if(d){if(d.Bf=c,a=m.Vc(a,b,"MAIN"))a.Bf=c}else k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=m.Ca(a,b,"MAIN");if(c)return c.Bf;k.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=m.Ca(a,b,"MAIN");d?(d.se.set(c),(a=m.Vc(a,b,"MAIN"))&&a.se.set(c)):k.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=m.Ca(a,
b,"MAIN");if(c){var d=Array(3);d[0]=c.se[0];d[1]=c.se[1];d[2]=c.se[2];return d}k.error('Couldn\'t get property "specular_color"!')};a.set_specular_color_factor=function(a,b,c){var d=m.Ca(a,b,"MAIN");if(d){if(d.Ch=c,a=m.Vc(a,b,"MAIN"))a.Ch=c}else k.error('Couldn\'t set property "specular_color_factor"!')};a.get_specular_color_factor=function(a,b){var c=m.Ca(a,b,"MAIN");if(c)return c.Ch;k.error('Couldn\'t get property "specular_color_factor"!')};a.set_specular_intensity=function(a,c,d){b(a,c)||k.error('Property "specular_intensity" is missing!');
m.Ca(a,c,"MAIN").Kc[0]=d;(a=m.Vc(a,c,"MAIN"))&&(a.Kc[0]=d)};a.get_specular_intensity=function(a,c){b(a,c)||k.error('Property "specular_intensity" is missing!');return m.Ca(a,c,"MAIN").Kc[0]};a.check_specular_intensity=b;a.set_specular_hardness=function(a,b,d){c(a,b)||k.error('Property "specular_hardness" is missing!');m.Ca(a,b,"MAIN").Kc[1]=d;(a=m.Vc(a,b,"MAIN"))&&(a.Kc[1]=d)};a.get_specular_hardness=function(a,b){c(a,b)||k.error('Property "specular_hardness" is missing!');return m.Ca(a,b,"MAIN").Kc[1]};
a.check_specular_hardness=c;a.set_emit_factor=function(a,b,c){var d=m.Ca(a,b,"MAIN");if(d){if(d.Oe=c,a=m.Vc(a,b,"MAIN"))a.Oe=c}else k.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=m.Ca(a,b,"MAIN");if(c)return c.Oe;k.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,b,c){var d=m.Ca(a,b,"MAIN");if(d){if(d.Ce=c,a=m.Vc(a,b,"MAIN"))a.Ce=c}else k.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=
m.Ca(a,b,"MAIN");if(c)return c.Ce;k.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var d=m.Ca(a,b,"MAIN");if(d){if(d.Af=c,a=m.Vc(a,b,"MAIN"))a.Af=c}else k.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=m.Ca(a,b,"MAIN");if(c)return c.Af;k.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=m.Ca(a,b,"MAIN");if(d){if(d.rf=c,a=m.Vc(a,b,"MAIN"))a.rf=c}else k.error('Couldn\'t set property "alpha_factor"!')};
a.get_alpha_factor=function(a,b){var c=m.Ca(a,b,"MAIN");if(c)return c.rf;k.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_material_params"),null;if(!d(a,b))return null;var c=m.Ca(a,b,"MAIN");if(!c)return null;var e={};"MAIN"==c.type&&(e.reflect_factor=c.reflect_factor,e.fresnel=c.Pd[2],e.fresnel_factor=5*(1-c.Pd[3]),e.parallax_scale=c.parallax_scale,e.parallax_steps=m.Qb(c,"PARALLAX_STEPS")[1]);return e};
a.get_water_material_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_water_material_params"),null;if(!d(a,b))return null;var c=m.Ca(a,b,"MAIN");if(!c||!c.ng)return null;if(!c)return k.error("material not found"),null;var e={};if("MAIN"==c.type){if(g.Xi){var n=e.shallow_water_col=Array(3);n[0]=c.shallow_water_col[0];n[1]=c.shallow_water_col[1];n[2]=c.shallow_water_col[2];n=e.shore_water_col=Array(3);n[0]=c.shore_water_col[0];n[1]=c.shore_water_col[1];n[2]=c.shore_water_col[2];
e.shallow_water_col_fac=c.shallow_water_col_fac;e.shore_water_col_fac=c.shore_water_col_fac}e.foam_factor=c.foam_factor;e.norm_uv_velocity=c.uj;e.absorb_factor=m.Qb(c,"ABSORB")[1];e.sss_strength=m.Qb(c,"SSS_STRENGTH")[1];e.sss_width=m.Qb(c,"SSS_WIDTH")[1];e.dst_noise_scale0=m.Qb(c,"DST_NOISE_SCALE_0")[1];e.dst_noise_scale1=m.Qb(c,"DST_NOISE_SCALE_1")[1];e.dst_noise_freq0=m.Qb(c,"DST_NOISE_FREQ_0")[1];e.dst_noise_freq1=m.Qb(c,"DST_NOISE_FREQ_1")[1];e.dir_min_shore_fac=m.Qb(c,"DIR_MIN_SHR_FAC")[1];
e.dir_freq=m.Qb(c,"DIR_FREQ")[1];e.dir_noise_scale=m.Qb(c,"DIR_NOISE_SCALE")[1];e.dir_noise_freq=m.Qb(c,"DIR_NOISE_FREQ")[1];e.dir_min_noise_fac=m.Qb(c,"DIR_MIN_NOISE_FAC")[1];e.dst_min_fac=m.Qb(c,"DST_MIN_FAC")[1];e.waves_hor_fac=m.Qb(c,"WAVES_HOR_FAC")[1]}return e};a.set_material_extended_params=function(a,b,c){if(a&&b&&c)if(d(a,b)){var e=m.Ca(a,b,"MAIN");if(e){var g=[e];(e=m.Vc(a,b,"MAIN"))&&g.push(e);for(a=0;a<g.length;a++)e=g[a],"number"==typeof c.material_reflectivity&&(e.reflect_factor=c.material_reflectivity),
"number"==typeof c.material_fresnel&&(e.Pd[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(e.Pd[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(e.parallax_scale=c.material_parallax_scale),"number"==typeof c.material_parallax_steps&&(b=n.s(parseFloat(c.material_parallax_steps)),m.ua(e,"PARALLAX_STEPS",b),m.Fb(e,!0))}else k.error("material not found")}else k.error("setting material params is not possible");else k.error("missing arguments in set_material_params")};
a.set_water_material_params=function(a,b,c){if(a&&b&&c)if(d(a,b)){var e=m.Ca(a,b,"MAIN");if(e){var p=[e];(e=m.Vc(a,b,"MAIN"))&&p.push(e);for(a=0;a<p.length;a++)e=p[a],g.Xi&&("object"==typeof c.shallow_water_col&&e.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(e.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&e.shore_water_col.set(c.shore_water_col),"number"==typeof c.shore_water_col_fac&&(e.shore_water_col_fac=c.shore_water_col_fac)),
g.shore_smoothing&&e.On&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?m.ua(e,"SHORE_SMOOTHING",1):m.ua(e,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=n.s(parseFloat(c.absorb_factor)),m.ua(e,"ABSORB",b))),"number"==typeof c.foam_factor&&g.hi&&(e.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&(e.uj=c.norm_uv_velocity),g.water_dynamic&&e.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?m.ua(e,"DYNAMIC",1):m.ua(e,"DYNAMIC",0)),"number"==typeof c.waves_height&&
(b=n.s(parseFloat(c.waves_height)),m.ua(e,"WAVES_HEIGHT",b)),"number"==typeof c.waves_length&&(b=n.s(parseFloat(c.waves_length)),m.ua(e,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&(b=n.s(parseFloat(c.sss_strength)),m.ua(e,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=n.s(parseFloat(c.sss_width)),m.ua(e,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=n.s(parseFloat(c.dst_noise_scale0)),m.ua(e,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=n.s(parseFloat(c.dst_noise_scale1)),
m.ua(e,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&(b=n.s(parseFloat(c.dst_noise_freq0)),m.ua(e,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=n.s(parseFloat(c.dst_noise_freq1)),m.ua(e,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=n.s(parseFloat(c.dir_min_shore_fac)),m.ua(e,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=n.s(parseFloat(c.dir_freq)),m.ua(e,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=n.s(parseFloat(c.dir_noise_scale)),
m.ua(e,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=n.s(parseFloat(c.dir_noise_freq)),m.ua(e,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=n.s(parseFloat(c.dir_min_noise_fac)),m.ua(e,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=n.s(parseFloat(c.dst_min_fac)),m.ua(e,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=n.s(parseFloat(c.waves_hor_fac)),m.ua(e,"WAVES_HOR_FAC",b))),m.Fb(e,!0)}else k.error("material not found")}else k.error("setting water material params is not possible");
else k.error("missing arguments in set_water_material_params")}};b4w.module.particles=function(a,p){var d=p("__particles"),b=p("__print");a.set_size=function(a,m,e){d.Ii(a)?d.set_size(a,m,e):b.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,m,e){d.Ii(a)?d.set_normal_factor(a,m,e):b.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,m,e){d.Ii(a)?(e=Math.min(e,1),e=Math.max(e,0),d.set_factor(a,m,e)):b.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){p("__config");var d=p("__ipc"),b=p("__physics"),c=p("__print"),m=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.J(a)?b.enable_simulation(a):c.error("No physics for object "+a.name)};a.disable_simulation=function(a){b.J(a)?b.disable_simulation(a):c.error("No physics for object "+a.name)};a.has_physics=function(a){return b.J(a)};a.has_simulated_physics=function(a){return b.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return b.has_dynamic_physics(a)};a.set_gravity=function(a,d){b.J(a)?b.set_gravity(a,d):c.error("No physics for object "+a.name)};a.set_damping=function(a,d,k){b.J(a)?b.w("set_damping",a.n.v,d,k):c.error("No physics for object "+a.name)};a.reset_damping=function(a){if(b.J(a)){var d=a.Sd;b.w("set_damping",a.n.v,d.Xo,d.Pq)}else c.error("No physics for object "+a.name)};a.set_transform=function(a,d,k){b.J(a)?b.set_transform.apply(this,arguments):c.error("No physics for object "+a.name)};a.sync_transform=
function(a){b.J(a)?b.sync_transform(a):c.error("No physics for object "+a.name)};a.apply_velocity=function(a){b.J(a)?b.apply_velocity.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){b.J(a)?b.apply_velocity_world.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_force=function(a,d,k,m){b.J(a)?b.apply_force.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_torque=function(a,d,k,m){b.J(a)?b.apply_torque.apply(this,
arguments):c.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,d){b.J(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_throttle(a,m.clamp(d,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,d,k){if(b.J(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");d=m.clamp(d,0,1);var n=a.l.ei;-1==k||1==k?n=Math.max(-1,Math.min(n+k*d,1)):0==k&&0<=n?(n-=d,n=Math.max(0,n)):0==k&&0>n?(n+=d,n=Math.min(0,
n)):c.error("Wrong steering direction");b.vehicle_throttle(a,m.clamp(n,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_steer=function(a,d){b.J(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_steer(a,m.clamp(d,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,d,k){if(b.J(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");d=m.clamp(d,0,1);var n=a.l.ej;-1==k||1==k?n=Math.max(-1,Math.min(n+k*d,
1)):0==k&&0<=n?(n-=d,n=Math.max(0,n)):0==k&&0>n?(n+=d,n=Math.min(0,n)):c.error("Wrong steering direction");b.vehicle_steer(a,m.clamp(n,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_brake=function(a,d){b.J(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_brake(a,m.clamp(d,0,1))):c.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,d){if(b.J(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");d=m.clamp(d,
-1,1);var k=a.l.Ej;b.vehicle_brake(a,m.clamp(k+k*d,0,1))}else c.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return b.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return b.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!b.J(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.Mc.name;c.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!b.J(a))return c.error("No physics for object "+
a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.l.ei;c.error("Wrong object");return null};a.get_vehicle_steering=function(a){if(!b.J(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.l.ej;c.error("Wrong object")};a.get_vehicle_brake=function(a){if(!b.J(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.l.Ej;c.error("Wrong object")};a.get_vehicle_speed=
function(a){if(!b.J(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return b.get_vehicle_speed(a);c.error("Wrong object")};a.is_character=function(a){return b.is_character(a)};a.set_character_move_dir=function(a,d,k){b.J(a)?b.set_character_move_dir(a,d,k):c.error("No physics for object "+a.name)};a.set_character_move_type=function(a,d){b.J(a)?b.set_character_move_type(a,d):c.error("No physics for object "+a.name)};a.set_character_walk_velocity=
function(a,d){b.J(a)?b.set_character_walk_velocity(a,d):c.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,d){b.J(a)?b.set_character_run_velocity(a,d):c.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,d){b.J(a)?b.set_character_fly_velocity(a,d):c.error("No physics for object "+a.name)};a.character_jump=function(a){b.J(a)?b.character_jump(a):c.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,d,k){b.J(a)?b.character_rotation_inc(a,
d,k):c.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,d){b.J(a)?b.set_character_rotation_quat(a,d):c.error("No physics for object "+a.name)};a.set_character_rotation=function(a,d,k){b.J(a)?b.set_character_rotation(a,d,k):c.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,d){b.J(a)?b.set_character_rotation_v(a,d):c.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,d){b.J(a)?b.set_character_rotation_h(a,d):c.error("No physics for object "+
a.name)};a.append_collision_test=function(a,d,k,m){b.J(a)?b.append_collision_test(a,d,k,m||!1):c.error("No physics for object "+a.name)};a.remove_collision_test=function(a,d,k){b.J(a)?b.remove_collision_test(a,d||"ANY",k):c.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,d){b.J(a)?b.apply_collision_impulse_test(a,d):c.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){b.J(a)?b.clear_collision_impulse_test(a):c.error("No physics for object "+
a.name)};a.append_ray_test=function(a,d,k,m,g,p){if(b.J(a))return b.append_ray_test(a,d,k,m,g,p||!1,!1,!1,!1);c.error("No physics for object "+a.name)};a.append_ray_test_ext=function(a,d,k,m,g,p,l,h,v){if(b.J(a))return b.append_ray_test(a,d,k,m,g,p||!1,l||!1,h||!1,v||!1);c.error("No physics for object "+a.name)};a.remove_ray_test=function(a){b.wu(a)?b.remove_ray_test(a):c.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,d,k){b.wu(a)?b.change_ray_test_from_to(a,d,k):c.error("Wrong ray test ID")};
a.apply_constraint=function(a,d,k,m,g,p,l,h,v,C){b.J(d)&&b.J(g)?b.apply_constraint(a,d,k,m,g,p,l,h,v,C):c.error("Wrong objects")};a.clear_constraint=function(a){b.J(a)&&b.MC(a)?b.clear_constraint(a):c.error("Wrong object")};a.pull_to_constraint_pivot=function(a,d,k,m,g,p){b.J(a)&&b.J(m)?b.pull_to_constraint_pivot(a,d,k,m,g,p):c.error("Wrong objects")};a.get_worker_listeners=d.get_worker_listeners};b4w.module.rgb=function(a,p){p("__print");var d=p("__util"),b=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,b,d){var p=new Float32Array(3);p[0]=a;p[1]=b;p[2]=d;return p};a.set=function(a,b,d,p){p[0]=a;p[1]=b;p[2]=d;return p};a.css_to_rgb=function(a,b,e,p){p=p||new Float32Array(3);p[0]=a/255;p[1]=b/255;p[2]=e/255;d.lw(p,p);return p};a.rgb_to_css=function(a){a=d.cq(a,b);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};a.rgb_to_css_hex=
function(a){function m(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a}a=d.cq(a,b);return"#"+m(a[0])+m(a[1])+m(a[2])}};
b4w.module.rgba=function(a,p){p("__print");var d=p("__util"),b=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,b,d,p){var k=new Float32Array(4);k[0]=a;k[1]=b;k[2]=d;k[3]=p;return k};a.set=function(a,b,d,p,k){k[0]=a;k[1]=b;k[2]=d;k[3]=p;return k};a.css_to_rgba=function(a,b,e,p,k){k=k||new Float32Array(4);k[0]=a/255;k[1]=b/255;k[2]=e/255;k[3]=p;d.lw(k,k);return k};a.rgba_to_css=function(a){var m=d.cq(a,b);return[Math.round(255*m[0]),Math.round(255*
m[1]),Math.round(255*m[2]),a[3]]}};b4w.module.scenes=function(a,p){var d=p("__batch"),b=p("__camera"),c=p("__data"),m=p("__graph"),e=p("__objects"),t=p("__obj_util"),k=p("__physics"),n=p("__print"),g=p("__scenes"),x=p("__util");a.DATA_ID_ALL=e.DATA_ID_ALL;a.set_active=function(a){var b=g.mi();g.set_active(x.keysearch("name",a,b))};a.get_active=function(){return g.pa()?g.get_active().name:""};a.get_scenes=function(){for(var a=g.mi(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(g.pa())return g.ni(g.get_active());
n.error("No active scene");return!1};a.get_object_by_name=function(a,b){var c=e.Wb(e.Un,a,b|0);if(c)return c;n.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=e.Wb(e.Tn,a,b,c|0))return a;n.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=e.Wb(e.tc,a,b|0);if(c)return c;n.error("get object "+a+": not found")};a.get_object_data_id=function(a){return g.get_object_data_id(a)};a.pick_object=e.pick_object;a.outlining_is_enabled=
function(a){return a&&a.f&&a.f.Eb};a.set_outline_intensity=function(a,b){a&&a.f&&a.f.Eb?a.f.Rf=b:n.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.f&&a.f.Eb)return a.f.Rf;n.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,c,d){a&&a.f&&a.f.Eb?e.apply_outline_anim(a,b,c,d):n.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.f&&a.f.Eb){var b=a.f.Li;e.apply_outline_anim(a,b.Mi,b.Ni,b.Oi)}else n.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.f&&a.f.Eb?e.clear_outline_anim(a):n.error("clear_outline_anim(): wrong object")};a.set_outline_color=g.set_outline_color;a.get_outline_color=function(a){var b=g.get_active();if(b=g.ia(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.af),a};a.set_glow_intensity=function(b,c){n.W("set_glow_intensity","set_outline_intensity");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){n.W("get_glow_intensity","get_outline_intensity");a.get_outline_intensity(b)};
a.apply_glow_anim=function(b,c,d,e){n.W("apply_glow_anim","apply_outline_anim");a.apply_outline_anim(b,c,d,e)};a.apply_glow_anim_def=function(b){n.W("apply_glow_anim_def","apply_outline_anim_def");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){n.W("clear_glow_anim","clear_outline_anim");a.clear_outline_anim(b)};a.set_glow_color=function(b){n.W("set_glow_color","set_outline_color");a.set_outline_color(b)};a.get_glow_color=function(b){n.W("get_glow_color, get_outline_color");a.get_outline_color(b)};
a.get_shadow_params=function(){if(!g.pa())return n.error("No active scene"),!1;var a=g.get_active(),b=g.ia(a,"SHADOW_CAST");if(!b)return null;var c=a.k.jc,d=g.ia(a,"MAIN_OPAQUE"),e=g.ia(a,"DEPTH"),k={};k.csm_resolution=c.csm_resolution;k.self_shadow_polygon_offset=b.self_shadow_polygon_offset;e&&(k.self_shadow_normal_offset=e.self_shadow_normal_offset);k.enable_csm=c.enable_csm;k.csm_num=c.csm_num;k.csm_first_cascade_border=c.csm_first_cascade_border;k.first_cascade_blur_radius=c.first_cascade_blur_radius;
k.csm_last_cascade_border=c.csm_last_cascade_border;k.last_cascade_blur_radius=c.last_cascade_blur_radius;k.fade_last_cascade=c.fade_last_cascade;k.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(k.csm_borders=g.oC(a,d.j),k.blur_radii=new Float32Array(c.csm_num),k.blur_radii.set(d.j.an.subarray(0,c.csm_num))):(k.csm_borders=null,k.blur_radii=null);return k};a.set_shadow_params=function(a){if(g.pa()){var c=g.get_active();"number"==typeof a.self_shadow_polygon_offset&&m.aa(c.k.sb,function(b,
c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var e=g.ia(c,"DEPTH");e&&("number"==typeof a.self_shadow_normal_offset&&(e.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(e.pcf_blur_radius=a.pcf_blur_radius));var k=g.ia(c,"MAIN_BLEND");k&&("number"==typeof a.self_shadow_normal_offset&&(k.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(k.pcf_blur_radius=a.pcf_blur_radius),
k.ya=!0);k=c.k.jc;"number"==typeof a.csm_first_cascade_border&&(k.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(k.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(k.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(k.last_cascade_blur_radius=a.last_cascade_blur_radius);if(e){for(var p=e.q,t=0;t<p.length;t++){var q=p[t];q.Rd.kc&&(q=q.D,d.ws(q,k),d.Fb(q))}e.ya=
!0}e=c.vg.f.X;for(t=0;t<e.length;t++)b.Dr(e[t],k);g.Sq(c)}else n.error("No active scene")};a.get_environment_colors=function(){if(!g.pa())return n.error("No active scene"),!1;var a=g.get_active();return g.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(g.pa()){var d=g.get_active();g.set_environment_colors(d,parseFloat(a),b,c)}else n.error("No active scene")};a.get_fog_color_density=function(a){if(!g.pa())return n.error("No active scene"),!1;var b=g.get_active();return g.get_fog_color_density(b,
a)};a.set_fog_color_density=function(a){if(g.pa()){var b=g.get_active();g.set_fog_color_density(b,a)}else n.error("No active scene")};a.get_ssao_params=function(){if(!g.pa())return n.error("No active scene"),!1;var a=g.get_active();return g.get_ssao_params(a)};a.set_ssao_params=function(a){if(g.pa()){var b=g.get_active();g.set_ssao_params(b,a)}else n.error("No active scene")};a.get_color_correction_params=function(){if(!g.pa())return n.error("No active scene"),null;var a=g.get_active(),a=g.ia(a,"COMPOSITING");
if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(g.pa()){var b=g.get_active();if(b=g.ia(b,"COMPOSITING"))"number"==typeof a.brightness&&(b.brightness=a.brightness),"number"==typeof a.contrast&&(b.contrast=a.contrast),"number"==typeof a.exposure&&(b.exposure=a.exposure),"number"==typeof a.saturation&&(b.saturation=a.saturation),b.ya=!0}else n.error("No active scene")};a.get_sky_params=
function(){if(!g.pa())return n.error("No active scene"),!1;var a=g.get_active();return g.get_sky_params(a)};a.set_sky_params=function(a){if(g.pa()){var b=g.get_active();g.set_sky_params(b,a)}else n.error("No active scene")};a.get_dof_params=function(){if(!g.pa())return n.error("No active scene"),!1;var a=g.get_active();return g.ia(a,"DOF")?g.get_dof_params(a):null};a.set_dof_params=function(a){if(g.pa()){var b=g.get_active();g.set_dof_params(b,a)}else n.error("No active scene")};a.get_god_rays_params=
function(){if(!g.pa())return n.error("No active scene"),!1;var a=g.get_active();return g.ia(a,"GOD_RAYS")?g.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(g.pa()){var b=g.get_active();g.set_god_rays_params(b,a)}else n.error("No active scene")};a.get_bloom_params=function(){if(!g.pa())return n.error("No active scene"),!1;var a=g.get_active();return g.ia(a,"BLOOM")?g.get_bloom_params(a):null};a.set_bloom_params=function(a){if(g.pa()){var b=g.get_active();g.set_bloom_params(b,a)}else n.error("No active scene")};
a.get_glow_material_params=function(){if(!g.pa())return n.error("No active scene"),!1;var a=g.get_active();return g.ia(a,"GLOW_COMBINE")?g.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(g.pa()){var b=g.get_active();g.set_glow_material_params(b,a)}else n.error("No active scene")};a.get_wind_params=function(){if(!g.pa())return n.error("No active scene"),!1;var a=g.get_active();return g.get_wind_params(a)};a.set_wind_params=function(a){if(g.pa()){var b=g.get_active();e.set_wind_params(b,
a)}else n.error("No active scene")};a.get_water_surface_level=g.get_water_surface_level;a.set_water_params=function(a){if(g.pa()){var b=g.get_active();g.set_water_params(b,a)}else n.error("No active scene")};a.get_water_mat_params=function(a){if(g.pa()){var b=g.get_active();g.get_water_mat_params(b,a)}else n.error("No active scene")};a.update_scene_materials_params=function(){if(g.pa()){var a=g.get_active();g.Fr(a)}else n.error("No active scene")};a.hide_object=function(a,b){b=b||!1;!t.is_mesh(a)&&
!t.is_empty(a)||t.ga(a)?b?g.Jj(a,!0):g.Qs(a,!0):n.error("show/hide is only supported for dynamic objects.")};a.show_object=function(a,b){b=b||!1;!t.is_mesh(a)&&!t.is_empty(a)||t.ga(a)?b?g.Jj(a,!1):g.Qs(a,!1):n.error("show/hide is only supported for dynamic objects.")};a.is_hidden=function(a){if(t.Sp(a)||t.is_empty(a)||t.is_lamp(a))return g.is_hidden(a);n.error("show/hide is only supported for dynamic meshes/empties and lamps");return!1};a.is_visible=function(a){return a.f.is_visible};a.check_object=
function(a){return g.pa()?e.aE(a,g.get_active()):(n.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return e.Wb(e.Un,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,c){return e.Wb(e.Tn,a,b,c|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return e.Wb(e.tc,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var c=g.get_active();a||(a="ALL");b||0===b||(b=e.DATA_ID_ALL);return e.wa(c,a,b)};a.get_object_name=function(a){return a?a.ph:(n.error("Wrong object name"),"")};a.get_object_name_hierarchy=
function(a){if(!a)return n.error("Wrong object name"),null;for(var b=[];a;)b.push(a.ph),a=t.get_dg_parent(a);return b.reverse()};a.get_object_type=function(a){return a&&a.type?a.type:(n.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){n.W("scenes.get_object_dg_parent","objects.get_dg_parent");return t.get_dg_parent(a)};a.get_object_children=function(a){return a.Kd.slice(0)};a.get_first_character=function(){for(var a=e.wa(g.get_active(),"MESH",e.DATA_ID_ALL),b=0;b<a.length;b++){var c=
a[b];if(k.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return g.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return g.get_cam_water_depth()};a.get_type_mesh_object=function(a){return t.is_mesh(a)?a.f.type:null};a.get_meta_tags=function(){if(!g.pa())return n.error("No active scene"),!1;var a=g.get_active();return g.get_meta_tags(a)};a.append_object=function(a,b){if(a.f.Rp){if(b)var c=g.mi(),c=x.keysearch("name",b,c);else c=g.get_active();g.append_object(c,
a,!0)}else n.error('object "'+a.name+'" has been created not by coping.')};a.remove_object=function(a){if(a.f.Rp){var b=g.get_active();c.qE(b,a,!1);e.remove_object(a)}else n.error("Can't remove object \""+a.name+'". It was not copied.')};a.marker_frame=function(a){var b=g.get_active();if(b.timeline_markers&&a in b.timeline_markers)return g.marker_frame(b,a);n.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=g.get_active();return(a=g.ia(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,
mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=g.get_active();(b=g.ia(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):n.error("The motion blur subscene doesn't exist.")};a.can_select_objects=function(){var a=g.get_active();return Boolean(g.ia(a,"COLOR_PICKING"))}};b4w.module.sfx=function(a,p){var d=p("__obj_util"),b=p("__scenes"),c=p("__sfx"),m=p("__print");a.play=function(a,b,d){c.play(a,b||0,d||0)};a.play_def=function(a){c.play_def(a)};a.is_play=function(a){return c.is_playing(a)};a.is_playing=function(a){return c.is_playing(a)};a.speaker_play=function(a,b,d,n){m.Pg("speaker_play() deprecated, use play() or play_def() instead");c.cyclic(a,b);n&&c.playrate(a,n);c.play(a,0,d)};a.speaker_stop=function(a){m.W("speaker_stop","stop");c.stop(a)};a.stop=function(a){c.stop(a)};
a.pause=function(a){c.xF(a)};a.resume=function(a){c.zF(a)};a.speaker_playback_rate=function(a,b){m.W("speaker_playback_rate","playrate");c.playrate(a,b)};a.playrate=function(a,b){c.playrate(a,b)};a.get_playrate=function(a){return c.get_playrate(a)};a.cyclic=function(a,b){c.cyclic(a,b)};a.is_cyclic=function(a){return c.is_cyclic(a)};a.listener_reset_speed=function(a,b){c.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,d){c.speaker_reset_speed(a,b,d)};a.get_volume=function(a){return a&&
"object"===typeof a?c.get_volume(a):c.xC()};a.set_volume=function(a,b){a&&"object"===typeof a?c.set_volume(a,b):c.dF(b)};a.mute=function(a,b){a&&"object"===typeof a?c.mute(a,b):c.VD(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.is_muted(a):c.bD()};a.get_speaker_objects=function(){return c.get_speaker_objects().slice(0)};a.get_speakers=function(){m.W("get_speakers","get_speaker_objects");return a.get_speaker_objects()};a.check_active_speakers=c.check_active_speakers;a.set_compressor_params=
function(a){c.set_compressor_params(b.get_active(),a)};a.get_compressor_params=function(){return c.get_compressor_params(b.get_active())};a.duck=function(a,b,d){a&&"object"===typeof a?c.duck(a,b,d):c.pB(b,d)};a.unduck=function(a){a&&"object"===typeof a?c.unduck(a):c.bG()};a.apply_playlist=c.apply_playlist;a.clear_playlist=c.clear_playlist;a.detect_audio_container=c.detect_audio_container;a.detect_video_container=c.detect_video_container;a.set_positional_params=c.set_positional_params;a.get_positional_params=
c.get_positional_params;a.set_filter_params=c.set_filter_params;a.get_filter_params=c.get_filter_params;a.get_filter_freq_response=c.get_filter_freq_response;a.get_duration=function(a){if(a&&d.is_speaker(a))return c.get_duration(a);m.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,p){var d=p("__print"),b=p("__scenes"),c=p("__textures");a.get_canvas_texture_context=function(a,b){b||(b=0);var p=c.lC(a,b);if(p)return p;d.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,b){b||(b=0);c.pG(a,b)||d.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,e){e||(e=0);b.get_active().b4w_use_nla&&c.Lr(a,e)?d.error("NLA texture can't be controlled directly through API."):c.play_video(a,e)||
d.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,e){e||(e=0);b.get_active().b4w_use_nla&&c.Lr(a,e)?d.error("NLA texture can't be controlled directly through API."):c.pause_video(a,e)||d.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a,e){e||(e=0);b.get_active().b4w_use_nla&&c.Lr(a,e)?d.error("NLA texture can't be controlled directly through API."):c.reset_video(a,e)||d.error('Texture with name "'+a+'" not found!')}};b4w.module.time=function(a,p){var d=p("__time");a.set_timeout=d.set_timeout;a.clear_timeout=d.clear_timeout;a.get_timeline=d.get_timeline;a.animate=d.animate;a.clear_animation=d.clear_animation};b4w.module.transform=function(a,p){var d=p("__obj_util"),b=p("__physics"),c=p("__print"),m=p("__quat"),e=p("__transform"),t=p("__tsr"),k=p("__util"),n=new Float32Array(4),g=new Float32Array(3),x=new Float32Array(4);a.SPACE_LOCAL=e.SPACE_LOCAL;a.SPACE_WORLD=e.SPACE_WORLD;a.set_translation=function(a,h,k,m){d.ga(a)?(g[0]=h,g[1]=k,g[2]=m,e.set_translation(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,h,k,m){d.ga(a)?(g[0]=h,g[1]=
k,g[2]=m,e.set_translation_rel(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,g){d.ga(a)?(e.set_translation(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,g){d.ga(a)?(e.set_translation_rel(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_obj_rel=function(a,h,m,n,p){d.ga(a)?(g[0]=h,g[1]=m,g[2]=n,
h=t.get_trans_view(p.f.h),p=t.get_quat_view(p.f.h),k.transform_vec3(g,1,p,h,g),e.set_translation(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));e.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));e.get_translation_rel(a,b);return b};a.set_rotation=function(a,g,k,m,n){d.ga(a)?(x[0]=g,x[1]=k,x[2]=m,x[3]=n,e.set_rotation(a,x),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,g,k,m,n){d.ga(a)?(x[0]=g,x[1]=k,x[2]=m,x[3]=n,e.set_rotation_rel(a,x),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat=function(){c.W("set_rotation_quat","set_rotation");return a.set_rotation};a.set_rotation_v=function(a,g){d.ga(a)?(e.set_rotation(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,g){d.ga(a)?(e.set_rotation_rel(a,
g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){c.W("set_rotation_quat_v","set_rotation_v");return a.set_rotation_v};a.get_rotation=function(a,b){b||(b=new Float32Array(4));e.get_rotation(a,b);return b};a.get_rotation_rel=function(a,b){b||(b=new Float32Array(4));e.get_rotation_rel(a,b);return b};a.get_rotation_quat=function(){c.W("get_rotation_quat","get_rotation");return a.get_rotation};a.set_rotation_euler=function(a,h,k,m){d.ga(a)?
(g[0]=h,g[1]=k,g[2]=m,e.set_rotation_euler(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel=function(a,h,k,m){d.ga(a)?(g[0]=h,g[1]=k,g[2]=m,e.set_rotation_euler_rel(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,g){d.ga(a)?(e.set_rotation_euler(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=function(a,
g){d.ga(a)?(e.set_rotation_euler_rel(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,b){d.ga(a)?(e.set_scale(a,b),e.o(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,b){d.ga(a)?(e.set_scale_rel(a,b),e.o(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return e.get_scale(a)};a.get_scale_rel=function(a){return e.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=
a.type)c.error("Wrong object: "+a.name);else{for(var g=0;g<a.Kd.length;g++)if(!d.ga(a.Kd[g])){c.error('Wrong object: "'+a.Kd[g].name+'" is not dynamic.');return}e.set_translation(a,[0,0,0]);e.set_rotation(a,[0,0,0,1]);e.set_scale(a,1);e.o(a);b.sync_transform(a)}};a.get_object_size=function(a){return d.is_mesh(a)?e.get_object_size(a):(c.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,b,g){return d.is_mesh(a)?e.get_object_center(a,b,g):(c.error("Wrong object: "+a.name),null)};a.move_local=
function(a,g,k,m){d.ga(a)?(e.move_local(a,g,k,m),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_x_local=function(a,g){if(d.ga(a)){var n=m.setAxisAngle(k.AXIS_X,g,x);e.Oq(a,n);e.o(a);b.sync_transform(a)}else c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_y_local=function(a,g){if(d.ga(a)){var n=m.setAxisAngle(k.AXIS_Y,g,x);e.Oq(a,n);e.o(a);b.sync_transform(a)}else c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=function(a,
g){if(d.ga(a)){var n=m.setAxisAngle(k.AXIS_Z,g,x);e.Oq(a,n);e.o(a);b.sync_transform(a)}else c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return e.get_object_bounding_box(a)};a.set_tsr=function(a,g){d.ga(a)?(e.set_tsr(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,g){d.ga(a)?(e.set_tsr_rel(a,g),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_tsr=
function(a,b){b||(b=new Float32Array(8));e.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));e.get_tsr_rel(a,b);return b};a.distance=function(a,b){return e.distance(a,b)};a.set_matrix=function(a,g){d.ga(a)?(t.from_mat4(g,n),e.set_tsr(a,n),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_matrix_rel=function(a,g){d.ga(a)?(t.from_mat4(g,n),e.set_tsr_rel(a,n),e.o(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.get_matrix=function(a,b){b||(b=new Float32Array(16));e.get_tsr(a,n);t.to_mat4(n,b);return b};a.get_matrix_rel=function(a,b){b||(b=new Float32Array(16));e.get_tsr_rel(a,n);t.to_mat4(n,b);return b}};b4w.module.tsr=function(a,p){function d(a,b,c,n){n||(n=m.create());d(a,b,c,n);return n}p("__mat3");var b=p("__mat4"),c=p("__print"),m=p("__tsr");a.create=m.create;a.from_values=m.from_values;a.copy=m.copy;a.identity=m.identity;a.create_sep=function(a,b,k,m){c.W("create_sep","set_sep");return d(a,b,k,m)};a.set_sep=m.set_sep;a.set_trans=m.set_trans;a.set_scale=m.set_scale;a.set_transcale=m.set_transcale;a.set_quat=m.set_quat;a.get_trans_view=m.get_trans_view;a.get_scale=m.get_scale;a.get_quat_view=
m.get_quat_view;a.invert=m.invert;a.to_mat4=function(a,c){c||(c=b.create());m.to_mat4(a,c);return c};a.from_mat4=m.from_mat4;a.multiply=m.multiply;a.transform_vec3=m.transform_vec3;a.transform_vec3_inv=m.transform_vec3_inv;a.transform_vectors=m.transform_vectors;a.transform_dir_vectors=m.transform_dir_vectors;a.transform_dir_vec3=m.transform_dir_vec3;a.transform_tangents=m.transform_tangents;a.translate=m.translate;a.interpolate=function(a,b,c,d){d||(d=m.create());m.interpolate(a,b,c,d);return d}};b4w.module.util=function(a,p){var d=p("__obj_util"),b=p("__print"),c=p("__util"),m=p("__vec3");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.f32=function(a){return new Float32Array(a||0)};a.assert=c.assert;a.keyfind=c.keyfind;a.keysearch=c.keysearch;a.matrix_to_quat=function(a){return c.matrix_to_quat(a)};a.euler_to_quat=function(a,
b){b||(b=new Float32Array(4));return c.euler_to_quat(a,b)};a.quat_to_euler=function(a,b){b||(b=new Float32Array(3));return c.quat_to_euler(a,b)};a.sign=c.sign;a.clamp=c.clamp;a.quat_to_dir=c.quat_to_dir;a.ground_project_quat=function(a,b){return c.quat_project(a,c.AXIS_MY,c.AXIS_Y,c.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return c.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,d,k,n,g){return 0!=m.dot(k,n)?(b.error("Wrong in-plane direction"),null):c.quat_project(a,d,k,n,g)};a.hash_code=
c.hash_code;a.smooth=c.smooth;a.smooth_v=c.smooth_v;a.is_vector=c.is_vector;a.correct_cam_quat_up=c.correct_cam_quat_up;a.quat_to_angle_axis=c.quat_to_angle_axis;a.random_from_array=c.random_from_array;a.xz_direction=c.xz_direction;a.line_plane_intersect=c.line_plane_intersect;a.is_mesh=function(a){b.W("util.is_mesh","objects.is_mesh");return d.is_mesh(a)};a.is_armature=function(a){b.W("util.is_armature","objects.is_armature");return d.is_armature(a)};a.angle_wrap_0_2pi=c.angle_wrap_0_2pi;a.angle_wrap_periodic=
c.angle_wrap_periodic;a.smooth_step=c.smooth_step;a.lerp=c.lerp};"object"==typeof module&&module.kp&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){p("__print");var d=p("__version");a.version=d.version;a.version_str=d.version_str;a.type=d.type;a.date=d.date;a.date_str=d.date_str};"object"==typeof module&&module.kp&&b4w.module.version(exports);b4w.module.objects=function(a,p){var d=p("__geometry"),b=p("__objects"),c=p("__obj_util"),m=p("__print"),e=p("__scenes");p("__util");a.get_meta_tags=function(a){if(a)return b.get_meta_tags(a)};a.copy=function(a,k,n){return c.is_mesh(a)?c.ga(a)?d.qi(a)||d.check_shape_keys(a)||!n?-1==b.wa(e.get_active(),"MESH",b.DATA_ID_ALL).indexOf(a)?(m.error('object "'+a.name+'" does not belong to the active scene.'),!1):b.copy(a,k||"",n):(m.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(m.error('object "'+a.name+'" is not dynamic.'),!1):(m.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,d,e){c.is_mesh(a)?b.set_nodemat_value(a,d,e):m.error('The type of the object "'+a.name+'" is not "MESH".')};a.set_nodemat_rgb=function(a,d,e,g,p){c.is_mesh(a)?b.set_nodemat_rgb(a,d,e,g,p):m.error('The type of the object "'+a.name+'" is not "MESH".')};a.update_boundings=function(a){c.is_mesh(a)?d.qi(a)||d.check_shape_keys(a)?b.update_boundings(a):m.error('object "'+
a.name+'" has not dynamic geometry.'):m.error('The type of the object "'+a.name+'" is not "MESH".')};a.get_parent=c.get_parent;a.get_dg_parent=c.get_dg_parent;a.is_mesh=c.is_mesh;a.is_armature=c.is_armature;a.is_speaker=c.is_speaker;a.is_camera=c.is_camera;a.is_lamp=c.is_lamp;a.is_empty=c.is_empty};b4w.module.main=function(a,p){function d(){}function b(){}function c(){}function m(){window.performance||(J.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(J.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});V.Vv(0)}function e(a,b){for(var c=null,d=b?U:L,e=0;e<d.length;e++){var f=d[e];try{c=a.getContext(f,ia)}catch(g){}if(c)break}c&&q.kB(c);return c}function t(a,c,d){a.addEventListener("webglcontextlost",
function(a){a.preventDefault();J.error("WebGL context lost");n()},!1);E.gd(d);var e=E.$t();e&&J.log("%cRENDERER INFO:","color: #00a",d.getParameter(e.UNMASKED_VENDOR_WEBGL)+", "+d.getParameter(e.UNMASKED_RENDERER_WEBGL));D.gd(d);w.gd(d);y.gd(d);I.gd(d);f.gd(d);z.gd(d);r.mF(a);z.init(a,c);G.Wv(a.width,a.height,1);M.init();b=h();x()}function k(){d=function(){}}function n(){g()||(ca=performance.now()/1E3,M.pause(),Q.pause(),y.pause(),v.pause())}function g(){return oa<ca}function x(){ga(x);var a=performance.now()/
1E3;X||(X=a);var c=a-X;if(!(c<1/aa.Qd)){for(var d=V.get_timeline(),e=0;e<fa.length;e++)fa[e](d,c);g()||(oa>X&&(c-=oa-Math.max(ca,X)),d+=c,V.Vv(d),f.update(),A.update(),r.update(),l(d,c),b(c));X=a}}function l(a,b){r.is_primary_loaded()&&(N.reset(),T.update(b),K.update(a,b),O.update(a,b),M.update(a,b),b&&C.update(b),r.is_primary_loaded()&&(Q.update(a,b),r.is_primary_loaded()&&(d(b,a),r.is_primary_loaded()&&(u.update(a,b),r.is_primary_loaded()&&(v.update(),F.update(a,b),G.update(a,b),v.Rw(),ma&&(ma(W.toDataURL()),
ma=null))))))}function h(){var a=60,b=0,d=aa.Gt,e=aa.JB;return function(f){f<1/aa.Qd||(a=R.smooth(1/f,a,f,d),f=Q.tC(),b=(b+1)%e,0==b&&c(Math.round(a),f))}}var v=p("__anchors"),C=p("__animation"),A=p("__assets"),B=p("__config"),q=p("__compat"),z=p("__container"),u=p("__controls"),r=p("__data"),f=p("__debug"),E=p("__extensions"),w=p("__geometry"),N=p("__hud"),O=p("__nla"),K=p("__logic_nodes"),F=p("__objects"),Q=p("__physics"),J=p("__print"),D=p("__renderer"),G=p("__scenes"),M=p("__sfx"),I=p("__shaders"),
y=p("__textures"),V=p("__time"),T=p("__transform");p("__armature");var R=p("__util"),ha=p("__version"),ia=B.context,aa=B.p,W=null,S=null,X=0,ca=0,oa=0,fa=[],ma=null,L=["webgl","experimental-webgl"],U=["webgl2","experimental-webgl2"],ga=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/aa.Qd)}}();a.init=function(a,b){B.eF();J.iF(aa.console_verbose);
var c=ha.version_str()+" "+ha.type()+" ("+ha.date_str()+")";J.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;m();W=a;b?(N.init(b),S=b):(B.p.show_hud_debug_info=!1,B.C.Rm=!1);q.nz();q.fA("Chrome")||(aa.sc=!1);c=e(a,aa.sc);!c&&aa.sc&&(aa.sc=!1,c=e(a,!1));if(!c)return null;J.log("%cINIT WEBGL "+(aa.sc?"2":"1"),"color: #00a");window.hJ=c;t(W,S,c);B.pz();q.YE(c);I.wD();aa.Kp&&(a.style["touch-action"]="none");J.log("%cSET PRECISION:","color: #00a",aa.precision);return c};
a.set_check_gl_errors=function(a){f.set_check_gl_errors(a)};a.resize=function(a,b,c){J.W("main.resize","container.resize");z.resize(a,b,c)};a.set_fps_callback=function(a){c=a};a.clear_fps_callback=function(){c=function(){}};a.set_render_callback=function(a){d=a};a.clear_render_callback=function(){k()};a.global_timeline=function(){return V.get_timeline()};a.redraw=function(){J.Pg("redraw() deprecated");l(V.get_timeline(),0)};a.pause=n;a.resume=function(){g()&&(oa=performance.now()/1E3,M.resume(),Q.resume(),
y.play(!0),v.resume())};a.is_paused=g;a.reset=function(){r.unload(0);S=W=null;oa=ca=X=0;c=function(){};b=function(){};d=function(){};fa.length=0;V.reset()};a.canvas_data_url=function(a){ma=a};a.get_canvas_elem=function(){return W};a.detect_mobile=function(){return q.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<fa.length;b++)if(fa[b]==a)return;fa.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<fa.length;b++)if(fa[b]==a){fa.splice(b,1);break}}};b4w.module.nla=function(a,p){var d=p("__nla"),b=p("__time"),c=p("__print"),m=p("__util");a.set_frame=function(a){a=m.clamp(a,d.get_frame_start(),d.get_frame_end());d.check_logic_nodes()?c.error("The active scene is using NLA script."):d.set_frame(a,b.get_timeline())};a.get_frame=function(){return d.get_frame(b.get_timeline())};a.stop=function(){d.check_logic_nodes()?c.error("The active scene is using NLA script."):d.kr()};a.play=function(a){d.check_logic_nodes()?c.error("The active scene is using NLA script."):
d.pv(a)};a.is_play=function(){return d.is_play()};a.get_frame_start=function(){return d.get_frame_start()};a.get_frame_end=function(){return d.get_frame_end()};a.check_nla=function(){return d.check_nla()};a.check_nla_scripts=function(){return d.check_logic_nodes()};a.check_logic_nodes=function(){return d.check_logic_nodes()};a.set_range=function(a,b){d.check_logic_nodes()?c.error("The active scene is using NLA script."):(b=parseFloat(b)||d.get_frame_end(),a=parseFloat(a)||d.get_frame_end(),b=m.clamp(b,
d.get_frame_start(),d.get_frame_end()),a=m.clamp(a,d.get_frame_start(),b),d.set_range(a,b))};a.reset_range=function(){d.check_logic_nodes()?c.error("The active scene is using NLA script."):d.reset_range()};a.set_cyclic=function(a){d.check_logic_nodes()?c.error("The active scene is using NLA script."):d.set_cyclic(a)};a.clear_callback=function(){d.check_logic_nodes()?c.error("The active scene is using NLA script."):d.clear_callback()}};b4w.module.app=function(a,p){function d(){var a=N.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=N.is_paused(),N.pause()):a||N.resume()},!1)}function b(a,b,c,d){var e=document.createElement("canvas"),f=document.getElementById(a);e.style.position="absolute";e.style.left=0;e.style.top=0;e.style.width=f.offsetWidth+"px";e.style.height=f.offsetHeight+"px";e.width=f.offsetWidth*window.devicePixelRatio;e.height=f.offsetHeight*window.devicePixelRatio;b?(b=document.createElement("canvas"),
b.style.position="absolute",e.style.left=0,e.style.top=0,b.style.pointerEvents="none"):b=null;f||(K.error('Warning: canvas container "'+a+'" not found, appending to body'),f=document.body);f.appendChild(e);if(!N.init(e,b))return c&&A("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",d),!1;b&&r.insert_to_container(b,"LAST");return!0}function c(a,b){a?(b&&(document.getElementById(b).style.display="block"),M=document.getElementById(a)):(M=document.createElement("div"),
M.innerHTML=0,M.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",r.insert_to_container(M,"JUST_AFTER_CANVAS"))}function m(a,b){var c=String(a);b&&(c+="/"+String(b));M.innerHTML=c}function e(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function t(){var a=r.get_container();r.resize(a.clientWidth,a.clientHeight,!0)}function k(a,b,c){var d=Math.max(q.hover_get_distance(a),1),e=Q.get_rotation(a,
S);b=J.quat_to_dir(e,b,ia);b[1]=0;D.normalize(b,b);D.scale(b,d*c,b);c=Q.get_translation(a,aa);D.add(c,b,c);q.set_translation(a,c)}function n(a,b){var c=q.hover_get_vertical_limits(a,ca);if(0>c.up-c.down){var d=q.get_camera_angles(a,ha)[1],c=(c.down-d)/(c.down-c.up),d=q.hover_get_distance_limits(a,ca),c=Math.max(c,2/d.max);q.hover_rotate(a,0,c*b)}}function g(a,b,c,d){Q.move_local(a,5*b,5*c,5*d)}function x(a,b,c){var d=Q.get_translation(a,ia),e=q.target_get_pivot(a,aa),d=D.dist(d,e),e=Math.abs(b);c=
Math.pow(e*c,1-Math.pow(e*c,.15));Q.move_local(a,0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function l(a,b,c,d){for(var e=c*b;0<a;--a)c+=e,d+=e,e=c*b;return d}function h(a,b,c,d,e){e?(e=q.target_get_pivot(a,ia),a=q.get_translation(a),a=D.dist(e,a)+d,d=0<b?l(b,-c,a,d):l(-b,c/(1-c),a,d)):d-=2*b*c;return d}function v(a,b,c){function d(a,b,c,e){if(1==c){var g=v?.003*w.trans:.003*w.rot;c=f.get_sensor_value(a,b,0);f.get_sensor_payload(a,b,0)===f.PL_SINGLE_TOUCH_MOVE?(ic+="X"==e?-c*g:0,Vb+="Y"==e?-c*g:0):f.get_sensor_payload(a,
b,0)===f.PL_MULTITOUCH_MOVE_PAN&&(a=v?.003*w.rot:7.5E-4*w.trans,Ka+="X"==e?-c*a:0,jb+="Y"==e?-c*a:0)}}function e(a,b,c,d){if(1==c){c=f.get_sensor_value(a,b,1);q.get_velocities(a,w);if(v)g=.003*w.trans,h=7.5E-4*w.rot;else var g=.003*w.rot,h=7.5E-4*w.trans;if(1===f.get_sensor_payload(a,b,0))Z+="X"==d?-c*g:0,wa+="Y"==d?-c*g:0;else if(2===f.get_sensor_payload(a,b,0)||3===f.get_sensor_payload(a,b,0))za+="X"==d?-c*h:0,Qb+="Y"==d?-c*h:0}}function l(a){return a[0]&&(a[1]||a[2])}function m(a,b,c){if(1==c)switch(c=
f.get_sensor_value(a,b,0),q.get_velocities(a,w),b){case "FORWARD":t?B[0]=1:v?(b=q.get_camera_angles(a,ha)[1],b=Math.abs(b)>=Math.PI/4?J.AXIS_MZ:J.AXIS_MY,k(a,b,.5*w.trans*c)):r?x(a,-w.zoom,c):g(a,0,-w.trans*c,0);break;case "BACKWARD":t?B[0]=-1:v?(b=q.get_camera_angles(a,ha)[1],b=Math.abs(b)>=Math.PI/4?J.AXIS_Z:J.AXIS_Y,k(a,b,.5*w.trans*c)):r?x(a,w.zoom,c):g(a,0,w.trans*c,0);break;case "UP":v?n(a,30*-w.zoom*c):t||g(a,0,0,-w.trans*c);break;case "DOWN":v?n(a,30*w.zoom*c):t||g(a,0,0,w.trans*c);break;
case "LEFT":t?B[1]=1:v?k(a,J.AXIS_MX,.5*w.trans*c):g(a,-w.trans*c,0,0);break;case "RIGHT":t?B[1]=-1:v?k(a,J.AXIS_X,.5*w.trans*c):g(a,w.trans*c,0,0);break;case "ROT_LEFT":r?q.target_rotate(a,2*-w.rot*c,0):q.eye_rotate(a,2*w.rot*c,0);break;case "ROT_RIGHT":r?q.target_rotate(a,2*w.rot*c,0):q.eye_rotate(a,2*-w.rot*c,0);break;case "ROT_UP":r?q.target_rotate(a,0,2*-w.rot*c):q.eye_rotate(a,0,2*w.rot*c);break;case "ROT_DOWN":r?q.target_rotate(a,0,2*w.rot*c):q.eye_rotate(a,0,2*-w.rot*c)}else switch(b){case "FORWARD":case "BACKWARD":t&&
(B[0]=0);break;case "LEFT":case "RIGHT":t&&(B[1]=0)}t&&(O.set_character_move_dir(t,B[0],B[1]),a=q.get_camera_angles_char(a,R),O.set_character_rotation(t,a[0],a[1]))}I=!0;y=a;V=b;T=c;var p=F.get_active_camera(),r=!1,t=null,v=!1;switch(q.get_move_style(p)){case q.MS_TARGET_CONTROLS:r=!a;break;case q.MS_EYE_CONTROLS:t=F.get_first_character();break;case q.MS_STATIC:return;case q.MS_HOVER_CONTROLS:v=!0}var w=q.get_velocities(p,X);a=f.create_elapsed_sensor();if(O.has_simulated_physics(p)){var z=f.create_collision_sensor(p,
null,!0);f.create_sensor_manifold(p,"CAMERA_COLLISION",f.CT_CONTINUOUS,[z],null,function(a,b,c){if(1==c&&(c=f.get_sensor_payload(a,b,0).coll_dist,0>c)){var d=f.get_sensor_payload(a,b,0).coll_norm;b=ia;D.scale(d,-.25*c,b);c=Q.get_translation(a,aa);D.add(c,b,c);Q.set_translation_v(a,c)}})}if(t){var z=Q.get_translation(p),A=Q.get_rotation(p),A=J.cam_quat_to_mesh_quat(A);z[1]-=.5;O.set_transform(t,z,A);u.append_stiff_trans(p,t,[0,.5,0]);var B=new Float32Array(2),C=!0;O.set_character_move_type(t,O.CM_FLY);
f.create_kb_sensor_manifold(p,"TOGGLE_CHAR_MOVE_TYPE",f.CT_SHOT,f.KEY_C,function(){C=!C;O.set_character_move_type(t,C?O.CM_FLY:O.CM_WALK)})}if(b)b=z=A=E=K=M=f.create_custom_sensor(0);else{b=f.create_keyboard_sensor(f.KEY_W);var z=f.create_keyboard_sensor(f.KEY_S),A=f.create_keyboard_sensor(f.KEY_A),E=f.create_keyboard_sensor(f.KEY_D),K=f.create_keyboard_sensor(f.KEY_R),M=f.create_keyboard_sensor(f.KEY_F)}var N=f.create_keyboard_sensor(f.KEY_UP),S=f.create_keyboard_sensor(f.KEY_DOWN),Y=f.create_keyboard_sensor(f.KEY_LEFT),
ca=f.create_keyboard_sensor(f.KEY_RIGHT);v||(f.create_sensor_manifold(p,"FORWARD",f.CT_CONTINUOUS,[a,b],null,m),f.create_sensor_manifold(p,"BACKWARD",f.CT_CONTINUOUS,[a,z],null,m));r?(f.create_sensor_manifold(p,"ROT_UP",f.CT_CONTINUOUS,[a,N,K],l,m),f.create_sensor_manifold(p,"ROT_DOWN",f.CT_CONTINUOUS,[a,S,M],l,m),f.create_sensor_manifold(p,"ROT_LEFT",f.CT_CONTINUOUS,[a,Y,A],l,m),f.create_sensor_manifold(p,"ROT_RIGHT",f.CT_CONTINUOUS,[a,ca,E],l,m)):v?(f.create_sensor_manifold(p,"LEFT",f.CT_CONTINUOUS,
[a,Y,A],l,m),f.create_sensor_manifold(p,"RIGHT",f.CT_CONTINUOUS,[a,ca,E],l,m),f.create_sensor_manifold(p,"FORWARD",f.CT_CONTINUOUS,[a,N,b],l,m),f.create_sensor_manifold(p,"BACKWARD",f.CT_CONTINUOUS,[a,S,z],l,m),f.create_sensor_manifold(p,"UP",f.CT_CONTINUOUS,[a,M],l,m),f.create_sensor_manifold(p,"DOWN",f.CT_CONTINUOUS,[a,K],l,m)):(f.create_sensor_manifold(p,"UP",f.CT_CONTINUOUS,[a,K],l,m),f.create_sensor_manifold(p,"DOWN",f.CT_CONTINUOUS,[a,M],l,m),f.create_sensor_manifold(p,"LEFT",f.CT_CONTINUOUS,
[a,A],l,m),f.create_sensor_manifold(p,"RIGHT",f.CT_CONTINUOUS,[a,E],l,m),f.create_sensor_manifold(p,"ROT_UP",f.CT_CONTINUOUS,[a,N],l,m),f.create_sensor_manifold(p,"ROT_DOWN",f.CT_CONTINUOUS,[a,S],l,m),f.create_sensor_manifold(p,"ROT_LEFT",f.CT_CONTINUOUS,[a,Y],l,m),f.create_sensor_manifold(p,"ROT_RIGHT",f.CT_CONTINUOUS,[a,ca],l,m));if(!c){var Ia=0;c=f.create_mouse_wheel_sensor();var Sa=0;b=f.create_touch_zoom_sensor();f.create_sensor_manifold(p,"MOUSE_WHEEL",f.CT_LEVEL,[c],null,function(a,b,c){1==
c&&(b=f.get_sensor_value(a,b,0),q.get_velocities(a,w),r||v?Ia=h(a,b,w.zoom,Ia,r):(w.trans*=1+b*w.zoom,q.set_velocities(a,w)))});f.create_sensor_manifold(p,"TOUCH_ZOOM",f.CT_LEVEL,[b],null,function(a,b,c){1==c&&(c=f.get_sensor_value(a,b,0),q.get_velocities(a,w),f.get_sensor_payload(a,b,0)===f.PL_MULTITOUCH_MOVE_ZOOM&&(Sa=h(a,c,.03*w.zoom,Sa,r)))});f.create_sensor_manifold(p,"ZOOM_INTERPOL",f.CT_CONTINUOUS,[a],null,function(a,b,c){if(1==c&&(r||v))if(1E-5<Math.abs(Ia)||1E-5<Math.abs(Sa)){b=f.get_sensor_value(a,
b,0);c=J.smooth(Ia,0,b,.1*G);Ia-=c;var d=J.smooth(Sa,0,b,.15*G);Sa-=d;if(v)n(a,-(c+d));else{b=q.target_get_pivot(a,ia);var e=q.get_translation(a,aa);.001<D.dist(b,e)+c+d?Q.move_local(a,0,c+d,0):(c=D.subtract(e,b,aa),d=D.normalize(c,W),D.scale(d,.001,d),D.add(b,d,c),Q.set_translation_v(a,c),Sa=Ia=0)}}else Sa=Ia=0})}var Z=0,wa=0,za=0,Qb=0;c=f.create_mouse_move_sensor("X");b=f.create_mouse_move_sensor("Y");z=f.create_mouse_click_sensor();f.create_sensor_manifold(p,"MOUSE_X",f.CT_LEVEL,[z,c],null,e,"X");
f.create_sensor_manifold(p,"MOUSE_Y",f.CT_LEVEL,[z,b],null,e,"Y");var ic=0,Vb=0,Ka=0,jb=0;c=f.create_touch_move_sensor("X");b=f.create_touch_move_sensor("Y");f.create_sensor_manifold(p,"TOUCH_X",f.CT_LEVEL,[c],null,d,"X");f.create_sensor_manifold(p,"TOUCH_Y",f.CT_LEVEL,[b],null,d,"Y");f.create_sensor_manifold(p,"ROT_TRANS_INTERPOL",f.CT_CONTINUOUS,[a],null,function(a,b,c){if(1==c&&(1E-5<Math.abs(Z)||1E-5<Math.abs(wa)||1E-5<Math.abs(ic)||1E-5<Math.abs(Vb)||1E-5<Math.abs(za)||1E-5<Math.abs(Qb)||1E-5<
Math.abs(Ka)||1E-5<Math.abs(jb))){var d=f.get_sensor_value(a,b,0),e=J.smooth(Z,0,d,.08*G);b=J.smooth(wa,0,d,.08*G);Z-=e;wa-=b;var g=J.smooth(ic,0,d,.12*G);c=J.smooth(Vb,0,d,.12*G);ic-=g;Vb-=c;var h=J.smooth(za,0,d,.08*G),l=J.smooth(Qb,0,d,.08*G);za-=h;Qb-=l;var m=J.smooth(Ka,0,d,.12*G),d=J.smooth(jb,0,d,.12*G);Ka-=m;jb-=d;r?(q.target_rotate(a,e+g,b+c),q.move_pivot(a,h+m,l+d)):v?(e+g&&k(a,J.AXIS_X,.2*(e+g)),b+c&&(e=q.get_camera_angles(a,ha)[1],k(a,Math.abs(e)>Math.PI/4?J.AXIS_Z:J.AXIS_Y,.2*(b+c))),
q.hover_rotate(a,h+m,0)):(q.eye_rotate(a,.5*(e+g),.5*(b+c)),t&&(a=q.get_camera_angles_char(a,R),O.set_character_rotation(t,a[0],a[1])))}});f.create_kb_sensor_manifold(p,"DEC_STEREO_DIST",f.CT_SHOT,f.KEY_LEFT_SQ_BRACKET,function(a){var b=q.get_stereo_distance(a);q.set_stereo_distance(a,.9*b)});f.create_kb_sensor_manifold(p,"INC_STEREO_DIST",f.CT_SHOT,f.KEY_RIGHT_SQ_BRACKET,function(a){var b=q.get_stereo_distance(a);q.set_stereo_distance(a,1.1*b)})}function C(){var a=F.get_active_camera();I=!1;for(var b=
"FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),c=0;c<b.length;c++)f.remove_sensor_manifold(a,b[c]);q.get_move_style(a)==q.MS_EYE_CONTROLS&&F.get_first_character()&&u.remove(a)}function A(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText=
"z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function B(a,b,c,d,e){function f(){var h=performance.now()-g;e(b+h*(c-b)/d);(h>=d||!a.parentNode)&&N.remove_loop_cb(f)}
var g=performance.now();N.append_loop_cb(f)}p("animation");var q=p("camera"),z=p("config"),u=p("constraints"),r=p("container"),f=p("controls"),E=p("data"),w=p("debug"),N=p("main"),O=p("physics"),K=p("print"),F=p("scenes"),Q=p("transform"),J=p("util"),D=p("vec3"),G=1,M=null,I=!1,y=!1,V=!1,T=!1,R=new Float32Array(2),ha=new Float32Array(2),ia=new Float32Array(3),aa=new Float32Array(3),W=new Float32Array(3),S=new Float32Array(4),X={},ca={};a.init=function(a){function e(){var a=b(l,B,F,n),f=r.get_canvas();
if(a){var g=r.get_container();t();N.set_check_gl_errors(v);D&&(c(p,u),N.set_fps_callback(m));x&&d();q&&N.append_loop_cb(function(){g.style.height=g.clientWidth/q+"px"});k&&N.append_loop_cb(function(){var a=g.clientWidth,b=g.clientHeight;a==f.clientWidth&&b==f.clientHeight||r.resize(a,b,!0)});J&&N.append_loop_cb(function(){r.force_offsets_updating()});h(f,!0)}else h(f,!1)}function g(a){a.keyCode==f.KEY_P&&(N.is_paused()?N.resume():N.pause())}function h(){}a=a||{};var k=!1,l=null,n=null,p=null,q=0,
u=null,v=!1,w=!0,x=!0,F=!0,y=!1,D=!1,A=!1,J=!1,G;for(G in a)switch(G){case "canvas_container_id":l=a.canvas_container_id;break;case "callback":h=a.callback;break;case "autoresize":k=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":v=a.gl_debug;break;case "show_hud_debug_info":A=a.show_hud_debug_info;break;case "sfx_mix_mode":y=a.sfx_mix_mode;break;case "show_fps":D=a.show_fps;break;case "track_container_position":J=a.track_container_position;break;case "fps_wrapper_id":u=a.fps_wrapper_id;
break;case "fps_elem_id":p=a.fps_elem_id;break;case "error_purge_elements":n=a.error_purge_elements;break;case "report_init_failure":F=a.report_init_failure;break;case "pause_invisible":x=a.pause_invisible;break;case "key_pause_enabled":w=a.key_pause_enabled;break;case "force_container_ratio":q=a.force_container_ratio;break;default:z.set(G,a[G])}w&&document.addEventListener("keydown",g,!1);z.set("show_hud_debug_info",A);z.set("sfx_mix_mode",y);var B=A||y||null;"complete"==document.readyState?window.setTimeout(e,
0):window.addEventListener("load",e,!1);window.addEventListener("unload",function(){E.cleanup()},!1)};a.resize_to_container=t;a.set_onclick=function(a,b){var c=e(a);c.addEventListener("mouseup",function(){b(c.value)},!1)};a.set_onchange=function(a,b){var c=e(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=e(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=v;a.disable_camera_controls=
C;a.set_camera_move_style=function(a){var b=I;b&&C();var c=F.get_active_camera();q.set_move_style(c,a);b&&v(y,V,T)};a.enable_object_controls=function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,e){if(1==e)switch(e=f.get_sensor_value(a,b,0),b){case "FORWARD":d?O.vehicle_throttle(a,1):Q.move_local(a,0,0,1*e);break;case "BACKWARD":d?O.vehicle_throttle(a,-1):Q.move_local(a,0,0,-1*e);break;case "LEFT":d?O.vehicle_steer(a,-1):Q.move_local(a,1*e,0,0);break;case "RIGHT":d?O.vehicle_steer(a,
1):Q.move_local(a,-1*e,0,0)}else switch(b){case "FORWARD":case "BACKWARD":d&&O.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":d&&O.vehicle_steer(a,0)}}var d=O.is_vehicle_chassis(a)||O.is_vehicle_hull(a),e=f.create_elapsed_sensor(),g=f.create_keyboard_sensor(f.KEY_W),h=f.create_keyboard_sensor(f.KEY_S),k=f.create_keyboard_sensor(f.KEY_A),l=f.create_keyboard_sensor(f.KEY_D),m=f.create_keyboard_sensor(f.KEY_UP),n=f.create_keyboard_sensor(f.KEY_DOWN),p=f.create_keyboard_sensor(f.KEY_LEFT),r=f.create_keyboard_sensor(f.KEY_RIGHT);
f.create_sensor_manifold(a,"FORWARD",f.CT_CONTINUOUS,[e,g,m],b,c);f.create_sensor_manifold(a,"BACKWARD",f.CT_CONTINUOUS,[e,h,n],b,c);f.create_sensor_manifold(a,"LEFT",f.CT_CONTINUOUS,[e,k,p],b,c);f.create_sensor_manifold(a,"RIGHT",f.CT_CONTINUOUS,[e,l,r],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)f.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){var b=r.get_container();a=a||!1;f.register_keyboard_events(document,!1);
f.register_mouse_events(b,!0,a);f.register_wheel_events(b,!0);f.register_touch_events(b,!0);f.register_device_orientation()};a.disable_controls=function(){var a=r.get_container();f.unregister_keyboard_events(document);f.unregister_mouse_events(a);f.unregister_wheel_events(a);f.unregister_touch_events(a);f.unregister_device_orientation()};a.enable_debug_controls=function(){f.create_kb_sensor_manifold(null,"CAMERA_SHOT",f.CT_SHOT,f.KEY_K,function(){w.make_camera_frustum_shot()});f.create_kb_sensor_manifold(null,
"LIGHT_SHOT",f.CT_SHOT,f.KEY_L,function(){w.make_light_frustum_shot()});f.create_kb_sensor_manifold(null,"TELEMETRY",f.CT_SHOT,f.KEY_T,function(){w.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),
document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==
a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?
!0:!1};a.report_app_error=A;a.get_url_params=function(a){a=!!a;var b=location.href.toString();if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,b,c,d,e,f,g,h){function k(e){a&&(l[b]=f+e+g,c>d&&e<=d||c<d&&e>=d)&&(l[b]=f+d+g,h())}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};
var l=a.style,m=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==l[b])if(void 0!=l["webkit"+m])b="webkit"+m;else if(void 0!=l["ms"+m])b="ms"+m;else if(void 0!=l["moz"+m])b="moz"+m;else return;B(a,c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,f){function g(e){a&&(0<=e&&a.setAttribute(b,e),c>d&&e<=d||c<d&&e>=d)&&(a.setAttribute(b,d),f())}a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(f=f||function(){},B(a,c,d,e,g))};a.queue_animate=function(b){if(b.length){var c=b.shift(),d=c.elem,e=c.prop,f=c.from,g=
c.to,h=c.duration,k=c.opt_prefix,l=c.opt_suffix,m=function(){c.cb&&c.cb();a.queue_animate(b)};"css"==c.type?a.css_animate(d,e,f,g,h,k,l,m):"attr"==c.type&&a.attr_animate(d,e,f,g,h,m)}};a.set_camera_smooth_factor=function(a){G=a};a.get_camera_smooth_factor=function(){return G}};b4w.module.camera_anim=function(a,p){function d(a,b,c,d){b=g.angle_wrap_0_2pi(a-b);a=g.angle_wrap_0_2pi(c-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;d[0]=b;d[1]=a;return d}var b=p("camera"),c=p("controls"),m=p("print"),e=p("scenes"),t=p("time"),k=p("transform"),n=p("tsr"),g=p("util"),x=p("vec3"),l=p("quat"),h=new Float32Array(2),v=new Float32Array(2),C=new Float32Array(3),A=new Float32Array(3),B=new Float32Array(3),q=new Float32Array(4),
z=n.create(),u=n.create(),r=n.create(),f={},E=!1,w=!1,N=!1,O=!1;a.track_to_target=function(a,d,e,f,n,p,r,t){if(!b.is_eye_camera(a))m.error("track_to_target(): wrong object");else if(a&&d){if(g.is_vector(d))var u=d;else u=B,k.get_object_center(d,!1,u);d=e||1;e=f||2;var v=n||1;n=p||1;A[0]=0;A[1]=-1;A[2]=0;var w=k.get_rotation(a);p=g.quat_to_dir(w,A);f=b.get_camera_angles(a,h);var z=k.get_translation(a);x.subtract(u,z,C);x.normalize(C,C);var E=l.rotationTo(p,C,l.create());l.multiply(E,w,q);g.correct_cam_quat_up(q,
!1);x.subtract(u,z,A);var N=x.length(A)*(1-1/e),u=Math.asin(C[1]);e=Math.acos(-C[2]/Math.abs(Math.cos(u)));0<C[0]&&(e=2*Math.PI-e);var O=e-f[0],W=u-f[1];B[0]=0;B[1]=0;B[2]=-1;e=k.get_rotation(a);0>g.quat_to_dir(e,B)[1]?(W=0<p[1]?u-Math.PI+f[1]:u+Math.PI+f[1],O=0<O?-Math.PI+O:Math.PI+O):Math.abs(O)>Math.PI&&(O=0<O?O-2*Math.PI:O+2*Math.PI);var S=0,u=c.create_elapsed_sensor();p=Math.abs(O/d);d=Math.abs(W/d);var X=p>d?p:d,ca=X+v,oa=ca+n,fa=oa+v,ma=O,L=W,U=N,ga=function(){c.remove_sensor_manifold(a,"TRACK_TO_TARGET");
r&&r()};c.create_sensor_manifold(a,"TRACK_TO_TARGET",c.CT_CONTINUOUS,[u],null,function(a,d,e){if(e)if(b.is_eye_camera(a))if(e=c.get_sensor_value(a,d,0),S+=e,S<X){var f=O/X*e;e*=W/X;d=S/X;d=6*d*(1-d);f*=d;e*=d;ma-=f;L-=e;b.eye_rotate(a,f,e)}else S<ca?(ma&&(b.eye_rotate(a,ma,L),ma=0,t&&t()),d=(S-X)/v,e=-N*e/v,U-=f,k.move_local(a,0,6*e*d*(1-d),0)):S<oa?U&&(k.move_local(a,0,U,0),U=0):S<fa?(d=(S-oa)/v,e=N*e/v,e=6*e*d*(1-d),k.move_local(a,0,e,0)):(k.set_translation_v(a,z),ga());else ga()})}};a.auto_rotate=
function(a,k,l){function n(e,k,l){if(1==l)if(l=b.get_move_style(e),l==b.MS_STATIC)p();else if(l!=b.MS_TARGET_CONTROLS&&l!=b.MS_EYE_CONTROLS||!b.has_horizontal_limits(e))q=null,k=c.get_sensor_value(e,k,0),b.rotate_camera(e,k*a,0);else{l=l==b.MS_EYE_CONTROLS?b.eye_get_horizontal_limits(e,f):b.target_get_horizontal_limits(e,f);if(null===q||l.left!=q.left||l.right!=q.right){q=q||{};q.left=l.left;q.right=l.right;t=Math.min(.2,g.angle_wrap_0_2pi(q.right-q.left)/2);l=q;var m=b.get_camera_angles(r,h)[0];
l=d(m,l.left,l.right,v);u=a*Math.min(1,l[0]/.2,l[1]/.2)}k=c.get_sensor_value(e,k,0);l=b.get_camera_angles(e,h)[0];l=d(l,q.left,q.right,v);l[1]>t&&l[0]>t?u=g.sign(u)*a:l[1]<t?u-=Math.pow(a,2)/.4*k:l[0]<t&&(u+=Math.pow(a,2)/.4*k);b.rotate_camera(e,k*u,0)}}function p(){c.remove_sensor_manifold(r,"AUTO_ROTATE");c.remove_sensor_manifold(r,"DISABLE_AUTO_ROTATE");k()}k=k||function(){};var r=e.get_active_camera();if(b.is_static_camera(r))m.error("auto_rotate(): Wrong camera move style");else{var q={},t=0,
u=0;if(c.check_sensor_manifold(r,"AUTO_ROTATE"))p();else{var w=c.create_mouse_move_sensor("X"),x=c.create_mouse_move_sensor("Y"),z=c.create_mouse_click_sensor(),A=c.create_touch_move_sensor(),B=c.create_touch_zoom_sensor(),C=c.create_elapsed_sensor();l=l?c.create_mouse_wheel_sensor():c.create_custom_sensor(0);c.create_sensor_manifold(r,"DISABLE_AUTO_ROTATE",c.CT_LEVEL,[w,x,z,A,B,l],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]||a[5]},p);c.create_sensor_manifold(r,"AUTO_ROTATE",c.CT_CONTINUOUS,
[C],function(a){return a[0]},n)}}};a.is_auto_rotate=function(){var a=e.get_active_camera();return c.check_sensor_manifold(a,"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=e.get_active_camera();return b.get_move_style(a)==b.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,c,d,e,f){if(b.get_move_style(a)!=b.MS_STATIC)m.error("move_camera_to_point(): wrong camera type");else if(!E)if(a)if(c){d=d||1;e=e||.01;var h=g.is_vector(a)?a:k.get_tsr(a,z),l=g.is_vector(c)?c:k.get_tsr(c,u);c=x.distance(n.get_trans_view(h),
n.get_trans_view(l))/d;d=g.quat_to_dir(n.get_quat_view(h),g.AXIS_MY,C);var p=g.quat_to_dir(n.get_quat_view(l),g.AXIS_MY,A);d=Math.min(Math.abs(x.dot(d,p)),1);e=1E3*Math.max(c,Math.acos(d)/e);E=!0;var q=t.animate(0,1,e,function(b){var c=n.interpolate(h,l,g.smooth_step(b),r);N?(t.clear_animation(q),E=N=!1):(k.set_tsr(a,c),1==b&&(E=!1,f&&f()))})}else m.error("move_camera_to_point(): you must specify the point object");else m.error("move_camera_to_point(): you must specify the camera object")};a.rotate_camera=
function(a,c,d,e,f){if(!w)if(a)if(c||d){w=!0;var g=0,h=0,k=0!=c?c:d,l=t.animate(0,k,e||1E3,function(e){O?(t.clear_animation(l),w=O=!1):(g-=e,h-=e,d&&c?b.rotate_camera(a,g,h):d?b.rotate_camera(a,0,h):c&&b.rotate_camera(a,g,0),h=g=e,e==k&&(w=!1,f&&f()))})}else m.error("rotate_camera(): you must specify the rotation angle");else m.error("rotate_camera(): you must specify the camera object")};a.stop_cam_moving=function(){N=!0};a.stop_cam_rotating=function(){O=!0};a.is_moving=function(){return E};a.is_rotating=
function(){return w}};b4w.module.gyroscope=function(a,p){function d(a){var c=b.create_gyro_angles_sensor(),d=!0;b.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",b.CT_CONTINUOUS,[c],null,function(a,c,h){if(0<h){t=b.get_sensor_payload(a,c,0);d&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],d=!1);h=c=0;0==window.orientation&&(c=t[1]-e[1],h=t[0]-e[0],t[1]>n&&t[1]<k&&(h=0));if(180==window.orientation){c=t[1]-e[1];0>t[1]&&(c=-c);h=e[0]-t[0];if(c>Math.PI/2||c<-Math.PI/2)c=0;t[1]>-k&&t[1]<-n&&(h=0)}if(-90==window.orientation){c=t[0]-e[0];if(c>
Math.PI/2||c<-Math.PI/2)c=0;h=e[1]-t[1];if(t[0]>g||t[0]<x)h=0}if(90==window.orientation){c=e[0]-t[0];if(c>Math.PI/2||c<-Math.PI/2)c=0;h=t[1]-e[1];if(t[0]>g||t[0]<x)h=0}m.rotate_camera(a,h,c);e[0]=t[0];e[1]=t[1];e[2]=t[2]}})}var b=p("controls"),c=p("scenes"),m=p("camera"),e=new Float32Array(3),t=new Float32Array(3),k=110*Math.PI/180,n=70*Math.PI/180,g=70*Math.PI/180,x=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=c.get_active_camera();d(a)}};b4w.module.mixer=function(a,p){function d(){B=A.length=0;q=b();z=new Float32Array(q.length);u=new Float32Array(q.length);var a=v.get_speaker_objects();if(a.length){A.push(c());for(var d=0;d<a.length;d++)A.push(e(a[d]));A.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function b(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/
99;return a}function c(){var a=m("MASTER");a.M.push(["VOLUME",v.get_volume(null),0,1,50,!1]);var b=v.get_compressor_params();b&&(a.M.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.M.push(["KNEE",b.knee,0,40,40,!1]),a.M.push(["RATIO",b.ratio,1,20,20,!1]),a.M.push(["ATTACK",b.attack,0,1,1E3,!1]),a.M.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=v.is_muted(null)?1:0;a.Gd=-1;return a}function m(a){return{id:a,M:[],xg:0,mute:-1,Gd:-1,Na:null}}function e(a){var b=m(h.get_object_name(a));b.mute=v.is_muted(a)?
1:0;b.Gd=0;b.Na=a;return b}function t(a){if(a.Na){a.M.length=0;a.M.push(["VOLUME",v.get_volume(a.Na),0,1,50,!1]);var b=v.get_positional_params(a.Na);b&&(a.M.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.M.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.M.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=v.get_filter_params(a.Na))a.M.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.M.push(["EQ_Q",b.Q,0,10,100,!1]),a.M.push(["EQ_GAIN",b.gain,-70,30,100,!1]);C.clamp(a.xg,0,a.M.length-1)}}function k(a){for(var b=
0;b<A.length;b++){var c=A[b];if(c!=a&&1==c.Gd)return!0}return!1}function n(a){for(var b=0;b<A.length;b++){var c=A[b];c!=a&&0==c.mute&&0==c.Gd&&v.mute(c.Na,!1)}}function g(){if(0==A.length)return[0,-1];var a=8*Math.floor(B/8),b=a+7,a=C.clamp(a,0,A.length-1),b=C.clamp(b,0,A.length-1);return[a,b]}var x=p("controls");p("debug");var l=p("hud"),h=p("scenes"),v=p("sfx"),C=p("util"),A=[],B=0,q=null,z=null,u=null;a.enable_mixer_controls=function(){function a(b,c,d){if(1==d){var e=Boolean(x.get_sensor_value(b,
c,2))?-1:1,f=A[B];if(f)switch(d=f.M[f.xg],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=C.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?v.set_volume(f.Na,d[1]):v.set_volume(null,d[1]);break;case "DIST_REF":e=v.get_positional_params(f.Na);e.dist_ref=d[1];v.set_positional_params(f.Na,e);break;case "ATTENUATION":e=v.get_positional_params(f.Na);e.attenuation=d[1];v.set_positional_params(f.Na,e);break;case "DIST_MAX":e=v.get_positional_params(f.Na);e.dist_max=d[1];v.set_positional_params(f.Na,
e);break;case "EQ_FREQ":e=v.get_filter_params(f.Na);e.freq=d[1];v.set_filter_params(f.Na,e);break;case "EQ_Q":e=v.get_filter_params(f.Na);e.Q=d[1];v.set_filter_params(f.Na,e);break;case "EQ_GAIN":e=v.get_filter_params(f.Na);e.gain=d[1];v.set_filter_params(f.Na,e);break;case "THRESHOLD":f=v.get_compressor_params();f.threshold=d[1];v.set_compressor_params(f);break;case "KNEE":f=v.get_compressor_params();f.knee=d[1];v.set_compressor_params(f);break;case "RATIO":f=v.get_compressor_params();f.ratio=d[1];
v.set_compressor_params(f);break;case "ATTACK":f=v.get_compressor_params();f.attack=d[1];v.set_compressor_params(f);break;case "RELEASE":f=v.get_compressor_params();f.release=d[1];v.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==c?x.reset_timer_sensor(b,c,6,.35):x.reset_timer_sensor(b,c,6,.05)}else x.reset_timer_sensor(b,c,6,10)}function b(a,c,d){if(1==d){d=Boolean(x.get_sensor_value(a,c,0))?-1:1;if(A.length){1==d&&B<A.length-1?B++:-1==d&&0<B&&B--;d=g();for(var e=d[0];e<=
d[1];e++)t(A[e])}"SWITCH_STRIP"==c?x.reset_timer_sensor(a,c,5,.15+.3):x.reset_timer_sensor(a,c,5,.15)}else x.reset_timer_sensor(a,c,5,10)}d();var c=x.create_keyboard_sensor(x.KEY_LEFT_SQ_BRACKET),e=x.create_keyboard_sensor(x.KEY_RIGHT_SQ_BRACKET),h=x.create_keyboard_sensor(x.KEY_SEMI_COLON),m=x.create_keyboard_sensor(x.KEY_SINGLE_QUOTE),p=x.create_keyboard_sensor(x.KEY_SHIFT),F=x.create_timer_sensor(.15,!0),Q=x.create_timer_sensor(.05,!0),c=[c,e,h,m,p,F,Q];x.create_sensor_manifold(null,"SWITCH_STRIP",
x.CT_TRIGGER,c,function(a){return(a[0]||a[1])&&!a[4]},b);x.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",x.CT_SHOT,c,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);x.create_sensor_manifold(null,"SWITCH_PARAM",x.CT_SHOT,c,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(x.get_sensor_value(a,b,0))?-1:1,d=A[B];d&&(1==c&&d.xg<d.M.length-1?d.xg++:-1==c&&0<d.xg&&d.xg--)});x.create_sensor_manifold(null,"INC_DEC",x.CT_TRIGGER,c,function(a){return(a[2]||a[3])&&!a[4]},a);x.create_sensor_manifold(null,
"INC_DEC_HOLD",x.CT_SHOT,c,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);x.create_sensor_manifold(null,"MUTE_SOLO",x.CT_SHOT,c,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(x.get_sensor_value(a,b,2))){var c=A[B];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,v.mute(c.Na,!0),1==c.Gd&&(c.Gd=0,k(c)||n(c))):(c.mute=0,k(c)||v.mute(c.Na,!1)):0==c.mute?(c.mute=1,v.mute(null,!0)):(c.mute=0,v.mute(null,!1)))}else if((c=A[B])&&0<=c.Gd)if(0==c.Gd){c.Gd=1;v.mute(c.Na,!1);1==c.mute&&(c.mute=
0);for(var d=0;d<A.length;d++){var e=A[d];e!=c&&0==e.mute&&0==e.Gd&&v.mute(e.Na,!0)}}else c.Gd=0,k(c)?v.mute(c.Na,!0):n(c)});c=x.create_elapsed_sensor();x.create_sensor_manifold(null,"MIXER_DRAW",x.CT_CONTINUOUS,[c],null,function(){if(A[B])for(var a=g(),b=a[0];b<=a[1];b++){var c=A[b];l.draw_mixer_strip(c.id,b==B,b%8,c.M,c.xg,c.mute,c.Gd);if(c.Na&&v.get_filter_params(c.Na)){v.get_filter_freq_response(c.Na,q,z,u);for(c=0;c<z.length;c++)z[c]=20*Math.log(z[c])/Math.LN10;l.plot_array("EQ",b%8,z,20,2E4,
-10,10)}}});c=x.create_timer_sensor(1,!0);x.create_sensor_manifold(null,"MIXER_UPDATE",x.CT_TRIGGER,[c],null,function(){for(var a=g(),b=a[0];b<=a[1];b++)t(A[b])})}};b4w.module.npc_ai=function(a,p){function d(a,b){var c=b.destination,d=B;h.get_translation(b.empty,d);var e=q;h.get_translation(b.collider,e);var g=0;b.vj?g=b.vj:b.of&&(g=b.of,b.type==w&&(g*=.5),b.type==O&&(g*=a));switch(b.type){case w:if(b.random&&b.Xf){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var l=f,d=z,m=b.speed,n=b.rot_speed;h.get_rotation(b.collider,l);C.transformQuat(v.AXIS_Z,l,d);d[1]=0;C.normalize(d,d);l=.5*m/Math.sin(n/2);m=C.dist(c,e);m<2*l&&C.scaleAndAdd(c,
d,2*l-m,c);b.Xf=!1}c[1]=e[1];g&&(c[1]+=g);break;case N:case O:b.random&&b.Xf&&(b.type==O?(b.speed=Math.random()+.1,l=b.MD-b.SD):l=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=e[1]+(Math.random()*l-.5*l),c[2]=10*Math.random()-5+d[2],b.Xf=!1),g&&(c[1]=e[1]+g)}var c=B,d=q,m=z,e=E,p=b.rig,l=b.collider,g=b.destination,A=b.speed,R=b.actions,ha=k.get_current_anim_name(p);if(!k.is_play(p)||!R.uk||-1==R.uk.indexOf(ha)){h.get_translation(l,c);var n=g[0]-c[0],ia=g[2]-c[2],n=Math.sqrt(n*n+ia*ia);
if(n>2*A*a)b.state=20,v.xz_direction(g,c,m),R=b.rig,k.is_animated(R)&&(p=b.speed,A=k.get_frame(R),R=k.get_anim_length(R),p*=R/24*(1-A/R),.9>n/p&&C.scaleAndAdd(g,m,p-n,g)),n=f,p=u,h.get_rotation(b.collider,n),C.transformQuat(v.AXIS_Z,n,d),p[0]=d[0],p[1]=0,p[2]=d[2],C.normalize(p,p),A=C.dot(p,m),R=a/(Math.abs(Math.acos(A))/Math.PI)*b.rot_speed*b.Qq,x.rotationTo(p,m,e),x.rotationTo(v.AXIS_Z,p,n),1<=Math.abs(A)?x.copy(n,e):(x.multiply(e,n,e),x.slerp(n,e,Math.min(R,1),e)),m=a,b.type!=N&&(m=Math.max(m,
1/60),n=r,p=f,x.setAxisAngle(v.AXIS_X,-Math.asin(d[1]),p),x.setAxisAngle(v.AXIS_X,-Math.atan(b.of/(b.speed*m)),n),x.slerp(p,n,m,n),x.multiply(e,n,e)),h.set_rotation_v(l,e),d=z,l=u,v.quat_to_dir(e,v.AXIS_Z,d),C.scale(d,b.speed*a,l),C.add(l,c,l),l[1]=b.type!=w?(g[1]-c[1])*a*.1+c[1]:g[1],h.set_translation_v(b.collider,l);else if(b.type==w)R.move?ha&&-1!=R.move.indexOf(ha)&&k.is_play(p)?b.state=20:(b.state=10,b.Xf=!0):(b.state=10,b.Xf=!0);else if(b.type==O||b.type==N)b.Xf=!0;if(t(b)&&(c=b.rig,!k.is_play(c))){e=
null;switch(b.state){case 10:e=b.actions;e=e.uk?v.random_from_array(e.uk):null;break;case 20:e=k.get_current_anim_name(b.rig),d=g=b.actions,d.$e&&-1==d.$e.indexOf(e)&&d.move&&-1!=d.move.indexOf(e)&&.33<Math.random()?(g=b.actions,e=g.$e[g.move.indexOf(e)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(e)||!d.$e&&!d.Mf||!d.Mf&&!e||d.$e&&-1!=d.$e.indexOf(e)||d.Mf&&-1!=d.Mf.indexOf(e))?(g=b.actions,g.$e?(d=g.$e.indexOf(e),-1!=d?(e=d+1,e=e<g.move.length?e:0,e=g.move[e]):e=-1!=g.move.indexOf(e)?e:v.random_from_array(g.move)):
e=v.random_from_array(g.move)):(d=b.actions,e=d.Mf&&-1==d.Mf.indexOf(e)&&d.move&&-1==d.move.indexOf(e)?v.random_from_array(g.Mf):null))}e&&(k.apply(c,e),k.set_behavior(c,k.AB_FINISH_RESET),k.set_frame(c,0),k.play(c))}}}function b(a,b,c,d){if(d)if(1==c)switch(d.type){case N:a:{for(c=0;3>c;c++){var e=n.get_sensor_payload(a,b,c).hit_fract;if(e){b=e;break a}}b=void 0}a=100*b;d.of=a<d.min_height?10:a>d.max_height?-10:0;break;case w:a=n.get_sensor_payload(a,b,0).hit_fract;d.of=d.uv==a?0:1-100*a;d.uv=a;
break;case O:a=n.get_sensor_payload(a,b,0).hit_fract,"CLOSE_GROUND"==b?(d.of=100*a-1,d.of=.1>d.of?.05:0):"CLOSE_WATER"==b&&(d.vj=100*a,d.vj=d.vj<d.SD?-.02:d.vj>d.MD?.02:0)}else d.of=0}function c(){for(var a=0;a<A.length;a++){var b=A[a];m(b);e(b);b.rig&&k.get_current_anim_name(b.rig)&&k.play(b.rig)}}function m(a){var c=C.create(),d=a.collider;switch(a.type){case N:var e=n.create_ray_sensor(d,c,[0,-100,0],"TERRAIN",!0),f=n.create_ray_sensor(d,c,[0,-100,0],"STONE",!0),c=n.create_ray_sensor(d,c,[0,-100,
0],"WATER",!0),e=[e,f,c];n.create_sensor_manifold(d,"CLOSE_GROUND",n.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},b,a);break;case w:e=n.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0);e=[e];n.create_sensor_manifold(d,"CLOSE_GROUND",n.CT_CONTINUOUS,e,null,b,a);break;case O:e=n.create_ray_sensor(d,[0,1,0],[0,-99,0],"TERRAIN",!0),c=n.create_ray_sensor(d,c,[0,100,0],"WATER",!0),e=[e],n.create_sensor_manifold(d,"CLOSE_WATER",n.CT_CONTINUOUS,[c],null,b,a),n.create_sensor_manifold(d,"CLOSE_GROUND",
n.CT_CONTINUOUS,e,null,b,a)}}function e(a){function b(c,d,e){1==e?(h.get_translation(a.empty,a.destination),a.Qq=4):a.Qq=1}var c=a.collider;if(a.type==w){var d=n.create_collision_sensor(c,"CONSTRUCTION",!1);n.create_sensor_manifold(c,"CONSTRUCTION_COLL",n.CT_CONTINUOUS,[d],null,b)}}function t(a){var b=a.rig;if(!k.is_play(b))return!0;b=k.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.uk)return!1;if(-1==c.uk.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||
c.Mf&&-1!=c.Mf.indexOf(b)||c.$e&&-1!=c.$e.indexOf(b))return!1;break;default:return!1}return!0}var k=p("animation"),n=p("controls"),g=p("main"),x=p("quat"),l=p("scenes"),h=p("transform"),v=p("util"),C=p("vec3"),A=[];new Float32Array(9);var B=new Float32Array(3),q=new Float32Array(3),z=new Float32Array(3),u=new Float32Array(3),r=new Float32Array(4),f=new Float32Array(4),E=new Float32Array(4),w=a.NT_WALKING=10,N=a.NT_FLYING=20,O=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);
a.start=[];a.ended=[];a.rm=[];a.of=null;a.uv=null;a.vj=null;a.Xf=!0;a.Qq=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.rm[b]=!1;A.push(a)};a.enable_animation=function(){if(A.length){c();var a=n.create_elapsed_sensor();n.create_sensor_manifold(A[0].collider,"ELAPSED",n.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,c){if(1==c)for(a=n.get_sensor_value(a,b,0),b=0;b<A.length;b++){c=A[b];var e=a;if(l.is_visible(c.obj))if(c.random)d(e,c);else{for(var f=g.global_timeline(),
h=0;h<c.path.length;h++)if(!c.ended[h]){c.rm[h]||(c.rm[h]=!0,c.destination[0]=c.path[h][0],c.destination[1]=c.path[h][1],c.destination[2]=c.path[h][2],c.start[h]=f+c.delay[h]);if(f<c.start[h])break;d(e,c);c.ended[h]=c.Xf;break}a:{for(e=0;e<c.path.length;e++)if(0==c.ended[e]){e=!1;break a}e=!0}if(e)for(e=0;e<c.path.length;e++)c.rm[e]=!1,c.ended[e]=!1}}})}};a.disable_animation=function(){if(!(0>=A.length))for(var a=0;a<A.length;a++){var b=A[a];n.check_sensor_manifolds(b.collider)&&n.remove_sensor_manifold(b.collider);
k.is_play(b.rig)&&k.stop(b.rig)}}};b4w.module.mouse=function(a,p){function d(){1==K&&(K=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);v.remove_sensor_manifold(B.get_active_camera(),"SMOOTH_PL")}function b(a){2==K&&(K=0);a.removeEventListener("mousedown",m,!1);a.removeEventListener("mouseup",e,!1);a.removeEventListener("mousemove",c,!1);v.remove_sensor_manifold(B.get_active_camera(),"SMOOTH_DRAG")}function c(a){N()&&(E[0]+=2*(a.clientX-r),E[1]+=
2*(a.clientY-f),r=a.clientX,f=a.clientY);a.preventDefault()}function m(a){r=a.clientX;f=a.clientY;a.currentTarget.addEventListener("mousemove",c,!1);a.preventDefault()}function e(a){a.currentTarget.removeEventListener("mousemove",c,!1);a.preventDefault()}function t(a,b,c,d){if(.01<Math.abs(E[0])||.01<Math.abs(E[1]))b=v.get_sensor_value(a,b,0),a=q.smooth(E[0],0,b,.1*u),b=q.smooth(E[1],0,b,.1*u),E[0]-=a,E[1]-=b,d(4E-4*-a,4E-4*-b)}function k(a,b){var c=B.get_first_character(),d=B.get_active_camera();
l.eye_rotate(d,a,b);c&&(d=l.get_camera_angles_char(d,w),C.set_character_rotation(c,d[0],d[1]))}function n(){z.detect_mobile()||z.get_canvas_elem().addEventListener("mousemove",x)}function g(){z.detect_mobile()||(z.get_canvas_elem().removeEventListener("mousemove",x),O&&B.set_outline_intensity(O,0))}function x(a){a=h.client_to_canvas_coords(a.clientX,a.clientY,w);(a=B.pick_object(a[0],a[1]))?(B.outlining_is_enabled(a)&&B.set_outline_intensity(a,1),B.outlining_is_enabled(O)&&a!=O&&B.set_outline_intensity(O,
0)):B.outlining_is_enabled(O)&&B.set_outline_intensity(O,0);O=a}var l=p("camera"),h=p("container"),v=p("controls"),C=p("physics"),A=p("print"),B=p("scenes"),q=p("util"),z=p("main"),u=1,r=0,f=0,E=new Float32Array(2),w=new Float32Array(2),N=null,O=null,K=0;a.request_pointerlock=function(a,c,d,e,f,g){function h(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){b(a);a.addEventListener("mousemove",e,!1);var f=B.get_active_camera();if(!v.check_sensor_manifold(f,
"SMOOTH_PL")){var k=v.create_elapsed_sensor();v.create_sensor_manifold(f,"SMOOTH_PL",v.CT_CONTINUOUS,[k],null,t,g)}c()}else a.removeEventListener("mousemove",e,!1),K=0,document.removeEventListener("pointerlockchange",h,!1),document.removeEventListener("webkitpointerlockchange",h,!1),document.removeEventListener("mozpointerlockchange",h,!1),d()}if(1!=K){K=1;c=c||function(){};d=d||function(){};g=g||k;f=f||function(){return!0};e=e||function(a){if(f()){if("number"==typeof a.movementX){var b=a.movementX;
a=a.movementY}else"number"==typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;E[0]+=b;E[1]+=a}};document.addEventListener("pointerlockchange",h,!1);document.addEventListener("webkitpointerlockchange",h,!1);document.addEventListener("mozpointerlockchange",h,!1);var l=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof l?l.apply(a):A.error("Pointer lock is not available")}};
a.exit_pointerlock=d;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b,c){2!=K&&(K=2,d(),N=b||function(){return!0},c=c||k,a.addEventListener("mousedown",m,!1),a.addEventListener("mouseup",e,!1),a=B.get_active_camera(),v.check_sensor_manifold(a,"SMOOTH_DRAG")||(b=v.create_elapsed_sensor(),v.create_sensor_manifold(a,"SMOOTH_DRAG",v.CT_CONTINUOUS,[b],null,t,c)))};a.exit_mouse_drag=
b;a.enable_mouse_hover_outline=n;a.enable_mouse_hover_glow=function(){A.error("enable_mouse_hover_glow() deprecated, use enable_mouse_hover_outline() instead");n()};a.disable_mouse_hover_outline=g;a.disable_mouse_hover_glow=function(){A.error("disable_mouse_hover_glow() deprecated, use disable_mouse_hover_outline() instead");g()};a.get_coords_x=function(a){return"clientX"in a?a.clientX:a.touches&&"clientX"in a.touches[0]?a.touches[0].clientX:-1};a.get_coords_y=function(a){return"clientY"in a?a.clientY:
a.touches&&"clientY"in a.touches[0]?a.touches[0].clientY:-1};a.set_plock_smooth_factor=function(a){u=a};a.get_plock_smooth_factor=function(){return u}};b4w.module.preloader=function(a,p){var d=p("app"),b,c,m,e,t,k,n,g,x,l=null;a.create_simple_preloader=function(a){var d=null,g=null,n="#bf9221",p="#000",q;for(q in a)switch(q){case "canvas_container_id":d=a.canvas_container_id;break;case "background_container_id":g=a.background_container_id;break;case "bg_color":p=a.bg_color;break;case "bar_color":n=a.bar_color;break;case "preloader_fadeout":b=a.preloader_fadeout}a=document.createElement("div");q=document.createElement("div");a.id="simple_preloader_container";
var x=document.createElement("div"),u=document.createElement("div"),g=document.getElementById(g);l=document.getElementById(d);a.style.cssText="z-index: 4;background-color: "+p+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";q.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";x.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
n+";border-radius: 0px;";u.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+q.appendChild(x);q.appendChild(u);a.appendChild(q);document.body.appendChild(a);c="SIMPLE";m=a;e=x;t=u;k=g};a.create_rotation_preloader=function(a){var b=null,d=null,e="rgba(0,0,0,0)",g="",p="",x="rgba(0,0,0,0)",u;for(u in a)switch(u){case "canvas_container_id":b=a.canvas_container_id;
break;case "background_container_id":d=a.background_container_id;break;case "frame_bg_color":e=a.frame_bg_color;break;case "bg_color":x=a.bg_color;break;case "frame_class":g=a.frame_class;break;case "anim_elem_class":p=a.anim_elem_class}a=document.createElement("div");u=document.createElement("div");var r=document.createElement("div"),f=document.createElement("div"),d=document.getElementById(d);l=document.getElementById(b);a.style.cssText="z-index: 4;background-color: "+x+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
u.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+e+";";r.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";f.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";r.className=p;u.appendChild(r);u.className=g;u.appendChild(f);
a.appendChild(u);l.appendChild(a);c="ROTATION";m=a;n=r;t=f;k=d};a.create_advanced_preloader=function(a){var b=a.preloader_width,b=b/(b-a.img_width),d=document.getElementById(a.preloader_bar_id),n=document.getElementById(a.fill_band_id),p=document.getElementById(a.preloader_caption_id),q=document.getElementById(a.preloader_container_id),z=document.getElementById(a.background_container_id);l=document.getElementById(a.canvas_container_id);c="ADVANCED";e=d;g=n;x=b;t=p;m=q;k=z};a.update_preloader=function(a){t.innerHTML=
a+"%";"SIMPLE"==c&&(e.style.width=a+"%");"ADVANCED"==c&&(e.style.width=a/x+"%",g.style.width=100-a+"%");"ROTATION"==c&&(n.style.transform="rotate("+a+"deg)");100==a&&(b?(d.css_animate(k,"opacity",1,0,1500,null,null,function(){k.parentNode.removeChild(k)}),d.css_animate(m,"opacity",1,0,1E3,null,null,function(){m.parentNode.removeChild(m)})):(m.parentNode.removeChild(m),k&&k.parentNode.removeChild(k)))}};b4w.module.storage=function(a,p){function d(a){m=a;if(!e){try{e=window.localStorage;try{e.tmp=null,delete e.tmp}catch(b){c.warn("localStorage quota is limited. Disabling localStorage"),e=null}}catch(d){c.warn("Applying chrome localStorage bug workaround"),e=null}e||(c.warn("localStorage is not available, initializing temporary storage"),e={})}}function b(){return e[m]?JSON.parse(e[m]):{}}var c=p("__print"),m="",e=null;a.init=d;a.set=function(a,c){var d=b();d[a]=String(c);e[m]=JSON.stringify(d)};a.cleanup=
function(){delete e[m]};a.get=function(a){var c=b();return c[a]?c[a]:""};a.debug=function(){c.log(b())};d("b4w")};b4w.module.screenshooter=function(a,p){var d=p("main");a.shot=function(){d.canvas_data_url(function(a){var c=window.document.createElement("a");document.body.appendChild(c);c.style.display="none";c.href=a;c.download="screenshot.png";c.click();document.body.removeChild(c)})}};
